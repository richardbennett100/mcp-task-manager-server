
> mcp-task-manager-server@0.1.0 test
> dotenv -e .env.test -- cross-env NODE_OPTIONS=--experimental-vm-modules jest --runInBand

{"level":"INFO","time":"2025-05-02T14:45:14.458Z","pid":118906,"hostname":"richard","msg":"Loading environment variable overrides for configuration..."}
(node:118906) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
{"level":"INFO","time":"2025-05-02T14:45:14.459Z","pid":118906,"hostname":"richard","msg":"Overriding pgHost from env: localhost"}
{"level":"INFO","time":"2025-05-02T14:45:14.459Z","pid":118906,"hostname":"richard","msg":"Overriding pgPort from env: 5432"}
{"level":"INFO","time":"2025-05-02T14:45:14.459Z","pid":118906,"hostname":"richard","msg":"Overriding pgUser from env: taskmanager_user"}
{"level":"INFO","time":"2025-05-02T14:45:14.459Z","pid":118906,"hostname":"richard","msg":"Overriding pgPassword from env."}
{"level":"INFO","time":"2025-05-02T14:45:14.459Z","pid":118906,"hostname":"richard","msg":"Overriding pgDatabase from env: taskmanager_db"}
{"level":"INFO","time":"2025-05-02T14:45:14.459Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] Setting up PostgreSQL connection pool..."}
{"level":"INFO","time":"2025-05-02T14:45:14.460Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] PostgreSQL connection pool configured."}
{"level":"INFO","time":"2025-05-02T14:45:14.460Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] Starting database schema initialization..."}
{"level":"INFO","time":"2025-05-02T14:45:14.497Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] Connected to PostgreSQL for schema check/application."}
{"level":"INFO","time":"2025-05-02T14:45:14.497Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] Force schema run enabled or tables missing. Initializing/Re-initializing schema..."}
{"level":"INFO","time":"2025-05-02T14:45:14.497Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] Looking for schema file at: /home/richard/repos/mcp-task-manager-server/dist/db/schema.sql"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.499Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] Schema file read successfully. Executing schema setup..."}
{"level":"INFO","time":"2025-05-02T14:45:14.521Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] Full schema script executed."}
{"level":"INFO","time":"2025-05-02T14:45:14.525Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] Confirmed work_items table exists after schema execution."}
{"level":"INFO","time":"2025-05-02T14:45:14.525Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] Initialization marked as complete."}
{"level":"INFO","time":"2025-05-02T14:45:14.526Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] Released schema check/application client."}
{"level":"INFO","time":"2025-05-02T14:45:14.526Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] Instance created and database initialized."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.529Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Starting database clean up..."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.530Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating undo_steps CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.532Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating action_history CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.542Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating work_item_dependencies CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.544Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating work_items CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.557Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Database clean up committed."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.557Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Database client released."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.558Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 1e6c8b89-2996-456d-b1e8-1cae3553d386"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.560Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Parent Project\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.564Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:14.564Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: parent-project"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.564Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:14.564Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197114564"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.565Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 1e6c8b89-2996-456d-b1e8-1cae3553d386 within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:14.568Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 1e6c8b89-2996-456d-b1e8-1cae3553d386 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.570Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 2a8063ea-af3c-49b4-b8eb-ffe463a7b577 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.572Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 55ca734f-6995-44ee-8ee6-b4a139d78be2 for action 2a8063ea-af3c-49b4-b8eb-ffe463a7b577 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.574Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:14.574Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 1e6c8b89-2996-456d-b1e8-1cae3553d386 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.576Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item b07caeda-9a17-44e5-910b-80e143875e7d"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.577Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 1e6c8b89-2996-456d-b1e8-1cae3553d386 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.578Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 1e6c8b89-2996-456d-b1e8-1cae3553d386 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.578Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 1e6c8b89-2996-456d-b1e8-1cae3553d386. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.578Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Child Task 1\", parentId: 1e6c8b89-2996-456d-b1e8-1cae3553d386, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.579Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: 1e6c8b89-2996-456d-b1e8-1cae3553d386 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.579Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.580Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent 1e6c8b89-2996-456d-b1e8-1cae3553d386 (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.580Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent 1e6c8b89-2996-456d-b1e8-1cae3553d386 (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:14.580Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: child-task-1"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.580Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: 1e6c8b89-2996-456d-b1e8-1cae3553d386, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:14.580Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197114580"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.580Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item b07caeda-9a17-44e5-910b-80e143875e7d within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:14.582Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item b07caeda-9a17-44e5-910b-80e143875e7d with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.583Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 10858287-d91b-48c5-89e2-5ab1fad12d4a in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.584Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 6486dc04-d1c7-4bcb-9db3-ef1f1014e469 for action 10858287-d91b-48c5-89e2-5ab1fad12d4a in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.586Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:14.586Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item b07caeda-9a17-44e5-910b-80e143875e7d and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.588Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 8f29fa82-7837-4069-a96c-08086e383df0"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.589Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 1e6c8b89-2996-456d-b1e8-1cae3553d386 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.591Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 1e6c8b89-2996-456d-b1e8-1cae3553d386 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.591Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 1e6c8b89-2996-456d-b1e8-1cae3553d386. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.591Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Child Task 2\", parentId: 1e6c8b89-2996-456d-b1e8-1cae3553d386, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.591Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: 1e6c8b89-2996-456d-b1e8-1cae3553d386 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.591Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.593Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent 1e6c8b89-2996-456d-b1e8-1cae3553d386 (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.593Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent 1e6c8b89-2996-456d-b1e8-1cae3553d386 (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:14.593Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: child-task-2"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.593Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: 1e6c8b89-2996-456d-b1e8-1cae3553d386, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:14.593Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197114593"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.593Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 8f29fa82-7837-4069-a96c-08086e383df0 within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:14.595Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 8f29fa82-7837-4069-a96c-08086e383df0 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.598Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 4bf2c748-4b91-4cb0-82e3-76bcbcf0ab28 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.600Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 054b03fa-38e1-4ad3-9479-4e2626be5ad9 for action 4bf2c748-4b91-4cb0-82e3-76bcbcf0ab28 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.601Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:14.601Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 8f29fa82-7837-4069-a96c-08086e383df0 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.604Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 9c84c514-9b18-4502-85ae-200002bf956a"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.605Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: b07caeda-9a17-44e5-910b-80e143875e7d with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.607Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID b07caeda-9a17-44e5-910b-80e143875e7d (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.607Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item b07caeda-9a17-44e5-910b-80e143875e7d. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.607Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Grandchild Task 1\", parentId: b07caeda-9a17-44e5-910b-80e143875e7d, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.607Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: b07caeda-9a17-44e5-910b-80e143875e7d with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.607Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.609Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent b07caeda-9a17-44e5-910b-80e143875e7d (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.609Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent b07caeda-9a17-44e5-910b-80e143875e7d (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:14.609Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: grandchild-task-1"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.609Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: b07caeda-9a17-44e5-910b-80e143875e7d, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:14.609Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197114609"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.609Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 9c84c514-9b18-4502-85ae-200002bf956a within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:14.611Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 9c84c514-9b18-4502-85ae-200002bf956a with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.613Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action e95cd001-7444-4caa-8e9e-b3fec2fb963d in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.615Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 35ed7884-13a1-481b-87d4-9e48a4e427bb for action e95cd001-7444-4caa-8e9e-b3fec2fb963d in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.617Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:14.617Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 9c84c514-9b18-4502-85ae-200002bf956a and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.619Z","pid":118906,"hostname":"richard","msg":"BeforeEach setup complete for WorkItemDeleteIntegration.test.ts"}
{"level":"WARN","time":"2025-05-02T14:45:14.628Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Attempting to soft delete 1 work item(s) and cascade: 8f29fa82-7837-4069-a96c-08086e383df0"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.629Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Finding all descendants..."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.629Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: 8f29fa82-7837-4069-a96c-08086e383df0 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.629Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.630Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent 8f29fa82-7837-4069-a96c-08086e383df0 (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.630Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent 8f29fa82-7837-4069-a96c-08086e383df0 (active: false, status: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.630Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Full cascade list (1 items) identified: 8f29fa82-7837-4069-a96c-08086e383df0"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.632Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item list (count: 1, link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.633Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item list (count: 1, link active: false, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.633Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Identified 0 potentially affected dependency links for cascade delete."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.635Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found 1 work items by IDs (count: 1, isActive: true)."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.635Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Found 1 active items in cascade list for deletion."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.635Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Attempting to soft delete item IDs in cascade: 8f29fa82-7837-4069-a96c-08086e383df0"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.635Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] Executing softDelete SQL: \n      UPDATE work_items\n      SET is_active = FALSE, updated_at = $1\n      WHERE work_item_id IN ($2) AND is_active = TRUE;\n     PARAMS: [\"2025-05-02T14:45:14.635Z\",\"8f29fa82-7837-4069-a96c-08086e383df0\"]"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.636Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] softDelete result rowCount: 1"}
{"level":"INFO","time":"2025-05-02T14:45:14.636Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Soft deleted 1 work item(s)."}
{"level":"INFO","time":"2025-05-02T14:45:14.636Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Repository reported 1 work item(s) soft deleted."}
{"level":"INFO","time":"2025-05-02T14:45:14.636Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] No active dependency links found to soft delete within the cascade."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.638Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 8021edfe-3b7c-4fbf-a30c-adaf91152992 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.639Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 1d58e936-388b-4fa0-bf8d-1002deaf703a for action 8021edfe-3b7c-4fbf-a30c-adaf91152992 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.640Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:14.640Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Recorded history for delete action 8021edfe-3b7c-4fbf-a30c-adaf91152992."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.642Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Returning count: 1 (based on repository rowCount)"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.644Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 8f29fa82-7837-4069-a96c-08086e383df0 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.645Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 8f29fa82-7837-4069-a96c-08086e383df0 (isActive: false) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.645Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 8f29fa82-7837-4069-a96c-08086e383df0. isActive: false"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.648Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 5 recent actions."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.650Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Found 1 steps for action 8021edfe-3b7c-4fbf-a30c-adaf91152992."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.653Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Starting database clean up..."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.654Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating undo_steps CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.656Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating action_history CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.666Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating work_item_dependencies CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.667Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating work_items CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.680Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Database clean up committed."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.680Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Database client released."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.680Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item b4ad3917-29f6-4257-8914-eb8a22f65544"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.681Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Parent Project\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.683Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:14.683Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: parent-project"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.683Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:14.683Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197114683"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.683Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item b4ad3917-29f6-4257-8914-eb8a22f65544 within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:14.685Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item b4ad3917-29f6-4257-8914-eb8a22f65544 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.687Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 87f8612a-1041-4594-8eec-14d51605f9c7 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.689Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 1fed0814-1091-4fe6-8020-990a23a5fc4e for action 87f8612a-1041-4594-8eec-14d51605f9c7 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.690Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:14.691Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item b4ad3917-29f6-4257-8914-eb8a22f65544 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.693Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item b262a5bc-bedd-4504-a3a7-9aa51002524c"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.694Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: b4ad3917-29f6-4257-8914-eb8a22f65544 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.695Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID b4ad3917-29f6-4257-8914-eb8a22f65544 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.695Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item b4ad3917-29f6-4257-8914-eb8a22f65544. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.695Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Child Task 1\", parentId: b4ad3917-29f6-4257-8914-eb8a22f65544, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.695Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: b4ad3917-29f6-4257-8914-eb8a22f65544 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.695Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.696Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent b4ad3917-29f6-4257-8914-eb8a22f65544 (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.696Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent b4ad3917-29f6-4257-8914-eb8a22f65544 (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:14.696Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: child-task-1"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.696Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: b4ad3917-29f6-4257-8914-eb8a22f65544, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:14.696Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197114696"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.696Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item b262a5bc-bedd-4504-a3a7-9aa51002524c within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:14.698Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item b262a5bc-bedd-4504-a3a7-9aa51002524c with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.699Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 908ac254-c6ca-4cd9-946b-2eebecf4da6c in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.699Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step a3973a19-fd20-453c-bf98-8131db6241a4 for action 908ac254-c6ca-4cd9-946b-2eebecf4da6c in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.700Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:14.700Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item b262a5bc-bedd-4504-a3a7-9aa51002524c and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.702Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item aca93b51-5e78-4d8a-98fd-fea0f63acd79"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.703Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: b4ad3917-29f6-4257-8914-eb8a22f65544 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.704Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID b4ad3917-29f6-4257-8914-eb8a22f65544 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.704Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item b4ad3917-29f6-4257-8914-eb8a22f65544. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.704Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Child Task 2\", parentId: b4ad3917-29f6-4257-8914-eb8a22f65544, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.704Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: b4ad3917-29f6-4257-8914-eb8a22f65544 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.704Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.705Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent b4ad3917-29f6-4257-8914-eb8a22f65544 (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.705Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent b4ad3917-29f6-4257-8914-eb8a22f65544 (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:14.705Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: child-task-2"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.705Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: b4ad3917-29f6-4257-8914-eb8a22f65544, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:14.705Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197114705"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.705Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item aca93b51-5e78-4d8a-98fd-fea0f63acd79 within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:14.706Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item aca93b51-5e78-4d8a-98fd-fea0f63acd79 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.707Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action d7a58426-e49c-4cab-8a46-13588feb03c6 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.708Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 044b8de9-792d-40cd-b304-75fffbd06fe5 for action d7a58426-e49c-4cab-8a46-13588feb03c6 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.709Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:14.709Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item aca93b51-5e78-4d8a-98fd-fea0f63acd79 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.711Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 9cc0dc12-50f3-492c-a19a-f50de9d71cab"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.712Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: b262a5bc-bedd-4504-a3a7-9aa51002524c with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.714Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID b262a5bc-bedd-4504-a3a7-9aa51002524c (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.714Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item b262a5bc-bedd-4504-a3a7-9aa51002524c. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.714Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Grandchild Task 1\", parentId: b262a5bc-bedd-4504-a3a7-9aa51002524c, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.714Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: b262a5bc-bedd-4504-a3a7-9aa51002524c with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.714Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.715Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent b262a5bc-bedd-4504-a3a7-9aa51002524c (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.715Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent b262a5bc-bedd-4504-a3a7-9aa51002524c (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:14.715Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: grandchild-task-1"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.715Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: b262a5bc-bedd-4504-a3a7-9aa51002524c, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:14.715Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197114715"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.715Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 9cc0dc12-50f3-492c-a19a-f50de9d71cab within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:14.716Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 9cc0dc12-50f3-492c-a19a-f50de9d71cab with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.717Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action eb0e47c2-6f1d-4693-a012-9f837bf1179d in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.718Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step b136264e-8154-4731-baef-25960fc4587f for action eb0e47c2-6f1d-4693-a012-9f837bf1179d in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.719Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:14.719Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 9cc0dc12-50f3-492c-a19a-f50de9d71cab and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.721Z","pid":118906,"hostname":"richard","msg":"BeforeEach setup complete for WorkItemDeleteIntegration.test.ts"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.722Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService] Updating work item 9cc0dc12-50f3-492c-a19a-f50de9d71cab with data:"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.724Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 9cc0dc12-50f3-492c-a19a-f50de9d71cab with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.726Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 9cc0dc12-50f3-492c-a19a-f50de9d71cab (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.726Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 9cc0dc12-50f3-492c-a19a-f50de9d71cab. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.727Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item 9cc0dc12-50f3-492c-a19a-f50de9d71cab (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.728Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps Before Update for 9cc0dc12-50f3-492c-a19a-f50de9d71cab:"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.728Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Desired Deps State for 9cc0dc12-50f3-492c-a19a-f50de9d71cab:"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.728Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updating work item 9cc0dc12-50f3-492c-a19a-f50de9d71cab in transaction"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.729Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] No core fields to update for 9cc0dc12-50f3-492c-a19a-f50de9d71cab."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.729Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updating dependencies for item 9cc0dc12-50f3-492c-a19a-f50de9d71cab. Input dependencies:"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.730Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] Found 0 existing dependencies (any state) for 9cc0dc12-50f3-492c-a19a-f50de9d71cab:"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.730Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] Desired Deps State for 9cc0dc12-50f3-492c-a19a-f50de9d71cab:"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.730Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] Dependencies actions for 9cc0dc12-50f3-492c-a19a-f50de9d71cab: To Insert/Update:"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.730Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Inserting/Updating 1 dependencies for 9cc0dc12-50f3-492c-a19a-f50de9d71cab."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.731Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Total inserted/updated dependencies for 9cc0dc12-50f3-492c-a19a-f50de9d71cab: 1."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.731Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Finished updating dependencies for item 9cc0dc12-50f3-492c-a19a-f50de9d71cab."}
{"level":"INFO","time":"2025-05-02T14:45:14.731Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Successfully processed update for item 9cc0dc12-50f3-492c-a19a-f50de9d71cab."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.731Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 9cc0dc12-50f3-492c-a19a-f50de9d71cab with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.732Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 9cc0dc12-50f3-492c-a19a-f50de9d71cab (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.733Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 9cc0dc12-50f3-492c-a19a-f50de9d71cab. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.733Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item 9cc0dc12-50f3-492c-a19a-f50de9d71cab (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.734Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps After Update Repo Call for 9cc0dc12-50f3-492c-a19a-f50de9d71cab:"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.734Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Item fields did NOT change for 9cc0dc12-50f3-492c-a19a-f50de9d71cab."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.734Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Checking dependency changes for 9cc0dc12-50f3-492c-a19a-f50de9d71cab..."}
{"level":"INFO","time":"2025-05-02T14:45:14.734Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService] Update called for 9cc0dc12-50f3-492c-a19a-f50de9d71cab, but no effective changes detected (Item: false, Deps: false). Skipping history."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.736Z","pid":118906,"hostname":"richard","msg":"[WorkItemReadingService] Getting work item by ID: 9cc0dc12-50f3-492c-a19a-f50de9d71cab with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.736Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 9cc0dc12-50f3-492c-a19a-f50de9d71cab with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.737Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 9cc0dc12-50f3-492c-a19a-f50de9d71cab (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.737Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 9cc0dc12-50f3-492c-a19a-f50de9d71cab. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.737Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: 9cc0dc12-50f3-492c-a19a-f50de9d71cab with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.737Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.739Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 1 dependencies for item 9cc0dc12-50f3-492c-a19a-f50de9d71cab (link active: true, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.757Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent 9cc0dc12-50f3-492c-a19a-f50de9d71cab (active: true, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.757Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent 9cc0dc12-50f3-492c-a19a-f50de9d71cab (active: true, status: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.757Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item 9cc0dc12-50f3-492c-a19a-f50de9d71cab (link active: true, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.759Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 1 dependencies for item 9cc0dc12-50f3-492c-a19a-f50de9d71cab (link active: true, dependsOn active: any)."}
{"level":"WARN","time":"2025-05-02T14:45:14.804Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Attempting to soft delete 1 work item(s) and cascade: b4ad3917-29f6-4257-8914-eb8a22f65544"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.806Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Finding all descendants..."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.806Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: b4ad3917-29f6-4257-8914-eb8a22f65544 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.806Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.808Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent b4ad3917-29f6-4257-8914-eb8a22f65544 (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.808Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent b4ad3917-29f6-4257-8914-eb8a22f65544 (active: false, status: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.808Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Full cascade list (1 items) identified: b4ad3917-29f6-4257-8914-eb8a22f65544"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.809Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item list (count: 1, link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.811Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item list (count: 1, link active: false, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.811Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Identified 0 potentially affected dependency links for cascade delete."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.812Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found 1 work items by IDs (count: 1, isActive: true)."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.812Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Found 1 active items in cascade list for deletion."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.812Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Attempting to soft delete item IDs in cascade: b4ad3917-29f6-4257-8914-eb8a22f65544"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.812Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] Executing softDelete SQL: \n      UPDATE work_items\n      SET is_active = FALSE, updated_at = $1\n      WHERE work_item_id IN ($2) AND is_active = TRUE;\n     PARAMS: [\"2025-05-02T14:45:14.812Z\",\"b4ad3917-29f6-4257-8914-eb8a22f65544\"]"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.813Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] softDelete result rowCount: 1"}
{"level":"INFO","time":"2025-05-02T14:45:14.813Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Soft deleted 1 work item(s)."}
{"level":"INFO","time":"2025-05-02T14:45:14.813Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Repository reported 1 work item(s) soft deleted."}
{"level":"INFO","time":"2025-05-02T14:45:14.813Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] No active dependency links found to soft delete within the cascade."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.815Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action d3ee4c0f-ecf2-4b42-9cd2-ed2ad4c37b5f in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.816Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step c81e158a-1fce-42fe-8289-565fadd5f1a1 for action d3ee4c0f-ecf2-4b42-9cd2-ed2ad4c37b5f in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.818Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:14.818Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Recorded history for delete action d3ee4c0f-ecf2-4b42-9cd2-ed2ad4c37b5f."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.821Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Returning count: 1 (based on repository rowCount)"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.830Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Starting database clean up..."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.831Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating undo_steps CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.832Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating action_history CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.843Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating work_item_dependencies CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.845Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating work_items CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.858Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Database clean up committed."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.858Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Database client released."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.858Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 9943edff-13e4-4d23-9d37-d64b3db2e48a"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.859Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Parent Project\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.861Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:14.861Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: parent-project"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.861Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:14.861Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197114861"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.861Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 9943edff-13e4-4d23-9d37-d64b3db2e48a within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:14.863Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 9943edff-13e4-4d23-9d37-d64b3db2e48a with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.865Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action f0cde0ff-3ea6-4323-ac8d-57393b2130ff in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.867Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 885d5272-165c-4bcd-b171-69cfd22d1260 for action f0cde0ff-3ea6-4323-ac8d-57393b2130ff in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.868Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:14.869Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 9943edff-13e4-4d23-9d37-d64b3db2e48a and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.871Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item a852cc80-4b89-4b13-a050-f3ca14582546"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.872Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 9943edff-13e4-4d23-9d37-d64b3db2e48a with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.874Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 9943edff-13e4-4d23-9d37-d64b3db2e48a (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.874Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 9943edff-13e4-4d23-9d37-d64b3db2e48a. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.874Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Child Task 1\", parentId: 9943edff-13e4-4d23-9d37-d64b3db2e48a, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.874Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: 9943edff-13e4-4d23-9d37-d64b3db2e48a with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.874Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.876Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent 9943edff-13e4-4d23-9d37-d64b3db2e48a (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.876Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent 9943edff-13e4-4d23-9d37-d64b3db2e48a (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:14.876Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: child-task-1"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.876Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: 9943edff-13e4-4d23-9d37-d64b3db2e48a, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:14.876Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197114876"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.876Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item a852cc80-4b89-4b13-a050-f3ca14582546 within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:14.878Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item a852cc80-4b89-4b13-a050-f3ca14582546 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.879Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 09cd5e8a-bab5-48d0-8eb7-e35dc8548682 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.881Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 96cf6b70-a2bc-451b-892d-c2aae5b5ddfe for action 09cd5e8a-bab5-48d0-8eb7-e35dc8548682 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.882Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:14.882Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item a852cc80-4b89-4b13-a050-f3ca14582546 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.884Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item eb992ae0-45fe-490c-b783-474deddb5c70"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.885Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 9943edff-13e4-4d23-9d37-d64b3db2e48a with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.886Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 9943edff-13e4-4d23-9d37-d64b3db2e48a (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.886Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 9943edff-13e4-4d23-9d37-d64b3db2e48a. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.886Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Child Task 2\", parentId: 9943edff-13e4-4d23-9d37-d64b3db2e48a, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.886Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: 9943edff-13e4-4d23-9d37-d64b3db2e48a with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.886Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.887Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent 9943edff-13e4-4d23-9d37-d64b3db2e48a (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.887Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent 9943edff-13e4-4d23-9d37-d64b3db2e48a (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:14.887Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: child-task-2"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.887Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: 9943edff-13e4-4d23-9d37-d64b3db2e48a, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:14.887Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197114887"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.887Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item eb992ae0-45fe-490c-b783-474deddb5c70 within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:14.889Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item eb992ae0-45fe-490c-b783-474deddb5c70 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.890Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 36146734-de99-4dcc-aa07-00fc2d0f72fe in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.891Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 088b2bcb-fecb-4a63-aaa8-7acb05452991 for action 36146734-de99-4dcc-aa07-00fc2d0f72fe in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.892Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:14.892Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item eb992ae0-45fe-490c-b783-474deddb5c70 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.894Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 05ae126a-5b53-4236-a034-8c64bee85e2c"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.895Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: a852cc80-4b89-4b13-a050-f3ca14582546 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.896Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID a852cc80-4b89-4b13-a050-f3ca14582546 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.896Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item a852cc80-4b89-4b13-a050-f3ca14582546. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.896Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Grandchild Task 1\", parentId: a852cc80-4b89-4b13-a050-f3ca14582546, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.896Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: a852cc80-4b89-4b13-a050-f3ca14582546 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.896Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.897Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent a852cc80-4b89-4b13-a050-f3ca14582546 (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.897Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent a852cc80-4b89-4b13-a050-f3ca14582546 (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:14.897Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: grandchild-task-1"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.897Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: a852cc80-4b89-4b13-a050-f3ca14582546, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:14.897Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197114897"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.897Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 05ae126a-5b53-4236-a034-8c64bee85e2c within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:14.898Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 05ae126a-5b53-4236-a034-8c64bee85e2c with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.899Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 0be911d9-8809-4b42-8db5-beb185f731f6 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.900Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 99a74ad6-6e97-412d-a317-ef665a7e12f7 for action 0be911d9-8809-4b42-8db5-beb185f731f6 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.901Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:14.901Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 05ae126a-5b53-4236-a034-8c64bee85e2c and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.903Z","pid":118906,"hostname":"richard","msg":"BeforeEach setup complete for WorkItemDeleteIntegration.test.ts"}
{"level":"WARN","time":"2025-05-02T14:45:14.904Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Attempting to soft delete 1 work item(s) and cascade: a852cc80-4b89-4b13-a050-f3ca14582546"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.904Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Finding all descendants..."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.904Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: a852cc80-4b89-4b13-a050-f3ca14582546 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.904Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.905Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent a852cc80-4b89-4b13-a050-f3ca14582546 (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.905Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent a852cc80-4b89-4b13-a050-f3ca14582546 (active: false, status: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.905Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Full cascade list (1 items) identified: a852cc80-4b89-4b13-a050-f3ca14582546"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.906Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item list (count: 1, link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.907Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item list (count: 1, link active: false, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.907Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Identified 0 potentially affected dependency links for cascade delete."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.908Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found 1 work items by IDs (count: 1, isActive: true)."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.908Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Found 1 active items in cascade list for deletion."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.908Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Attempting to soft delete item IDs in cascade: a852cc80-4b89-4b13-a050-f3ca14582546"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.908Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] Executing softDelete SQL: \n      UPDATE work_items\n      SET is_active = FALSE, updated_at = $1\n      WHERE work_item_id IN ($2) AND is_active = TRUE;\n     PARAMS: [\"2025-05-02T14:45:14.908Z\",\"a852cc80-4b89-4b13-a050-f3ca14582546\"]"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.909Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] softDelete result rowCount: 1"}
{"level":"INFO","time":"2025-05-02T14:45:14.909Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Soft deleted 1 work item(s)."}
{"level":"INFO","time":"2025-05-02T14:45:14.909Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Repository reported 1 work item(s) soft deleted."}
{"level":"INFO","time":"2025-05-02T14:45:14.909Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] No active dependency links found to soft delete within the cascade."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.910Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 12aa8083-6bbd-4da7-a0d5-c170d33d045c in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.912Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 35c237ed-5dfb-49aa-a204-246448de8688 for action 12aa8083-6bbd-4da7-a0d5-c170d33d045c in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.913Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:14.913Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Recorded history for delete action 12aa8083-6bbd-4da7-a0d5-c170d33d045c."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.915Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Returning count: 1 (based on repository rowCount)"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.917Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"INFO","time":"2025-05-02T14:45:14.919Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to undo last action."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.921Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Found original action to undo: 12aa8083-6bbd-4da7-a0d5-c170d33d045c (DELETE_WORK_ITEM_CASCADE)"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.923Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Found 1 steps for action 12aa8083-6bbd-4da7-a0d5-c170d33d045c."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.925Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Executing 1 undo steps for action 12aa8083-6bbd-4da7-a0d5-c170d33d045c in reverse order"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.925Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Executing undo step 1 (UPDATE) on work_items record a852cc80-4b89-4b13-a050-f3ca14582546 for action 12aa8083-6bbd-4da7-a0d5-c170d33d045c"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.928Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryUndoRedo] Updated row in work_items a852cc80-4b89-4b13-a050-f3ca14582546 based on PKs."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.929Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action d9dd9eb3-9bc2-4537-8f6b-bd723dbfb488 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.931Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked action 12aa8083-6bbd-4da7-a0d5-c170d33d045c as undone by action d9dd9eb3-9bc2-4537-8f6b-bd723dbfb488."}
{"level":"INFO","time":"2025-05-02T14:45:14.931Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Successfully undid action 12aa8083-6bbd-4da7-a0d5-c170d33d045c"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.937Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"WARN","time":"2025-05-02T14:45:14.939Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Attempting to soft delete 1 work item(s) and cascade: eb992ae0-45fe-490c-b783-474deddb5c70"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.941Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Finding all descendants..."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.941Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: eb992ae0-45fe-490c-b783-474deddb5c70 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.941Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.942Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent eb992ae0-45fe-490c-b783-474deddb5c70 (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.942Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent eb992ae0-45fe-490c-b783-474deddb5c70 (active: false, status: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.942Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Full cascade list (1 items) identified: eb992ae0-45fe-490c-b783-474deddb5c70"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.943Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item list (count: 1, link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.944Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item list (count: 1, link active: false, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.944Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Identified 0 potentially affected dependency links for cascade delete."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.945Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found 1 work items by IDs (count: 1, isActive: true)."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.945Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Found 1 active items in cascade list for deletion."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.945Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Attempting to soft delete item IDs in cascade: eb992ae0-45fe-490c-b783-474deddb5c70"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.945Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] Executing softDelete SQL: \n      UPDATE work_items\n      SET is_active = FALSE, updated_at = $1\n      WHERE work_item_id IN ($2) AND is_active = TRUE;\n     PARAMS: [\"2025-05-02T14:45:14.945Z\",\"eb992ae0-45fe-490c-b783-474deddb5c70\"]"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.946Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] softDelete result rowCount: 1"}
{"level":"INFO","time":"2025-05-02T14:45:14.946Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Soft deleted 1 work item(s)."}
{"level":"INFO","time":"2025-05-02T14:45:14.946Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Repository reported 1 work item(s) soft deleted."}
{"level":"INFO","time":"2025-05-02T14:45:14.946Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] No active dependency links found to soft delete within the cascade."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.947Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 2cc17f11-fbe3-4a9f-916b-dc099048b6fa in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.948Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 5d82f14c-ba60-48fc-b481-acbd3b4e5795 for action 2cc17f11-fbe3-4a9f-916b-dc099048b6fa in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.949Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.951Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked UNDO_ACTION d9dd9eb3-9bc2-4537-8f6b-bd723dbfb488 as redone/invalidated by action 2cc17f11-fbe3-4a9f-916b-dc099048b6fa."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.951Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Invalidated 1 potential redo(s) due to new action 2cc17f11-fbe3-4a9f-916b-dc099048b6fa."}
{"level":"INFO","time":"2025-05-02T14:45:14.951Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Recorded history for delete action 2cc17f11-fbe3-4a9f-916b-dc099048b6fa."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.953Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Returning count: 1 (based on repository rowCount)"}
{"level":"DEBUG","time":"2025-05-02T14:45:14.954Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"INFO","time":"2025-05-02T14:45:14.956Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to redo last undo action."}
{"level":"DEBUG","time":"2025-05-02T14:45:14.957Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] No un-redone UNDO_ACTIONs found."}
FAIL dist/services/__tests__/workItemDeleteIntegration.test.js
  ● Console

    console.log
      
      --- DB State Check: BEFORE DELETE ---

      at logDatabaseState (src/services/__tests__/workItemDeleteIntegration.test.ts:19:13)

    console.log
      Work Items Found (4):
      [
        {
          "work_item_id": "b4ad3917-29f6-4257-8914-eb8a22f65544",
          "name": "Parent Project",
          "shortname": "parent-project",
          "is_active": true,
          "status": "todo",
          "parent_work_item_id": null,
          "order_key": "1746197114683",
          "created_at": "2025-05-02T14:45:14.680Z",
          "updated_at": "2025-05-02T14:45:14.680Z"
        },
        {
          "work_item_id": "b262a5bc-bedd-4504-a3a7-9aa51002524c",
          "name": "Child Task 1",
          "shortname": "child-task-1",
          "is_active": true,
          "status": "todo",
          "parent_work_item_id": "b4ad3917-29f6-4257-8914-eb8a22f65544",
          "order_key": "1746197114696",
          "created_at": "2025-05-02T14:45:14.693Z",
          "updated_at": "2025-05-02T14:45:14.693Z"
        },
        {
          "work_item_id": "aca93b51-5e78-4d8a-98fd-fea0f63acd79",
          "name": "Child Task 2",
          "shortname": "child-task-2",
          "is_active": true,
          "status": "todo",
          "parent_work_item_id": "b4ad3917-29f6-4257-8914-eb8a22f65544",
          "order_key": "1746197114705",
          "created_at": "2025-05-02T14:45:14.702Z",
          "updated_at": "2025-05-02T14:45:14.702Z"
        },
        {
          "work_item_id": "9cc0dc12-50f3-492c-a19a-f50de9d71cab",
          "name": "Grandchild Task 1",
          "shortname": "grandchild-task-1",
          "is_active": true,
          "status": "todo",
          "parent_work_item_id": "b262a5bc-bedd-4504-a3a7-9aa51002524c",
          "order_key": "1746197114715",
          "created_at": "2025-05-02T14:45:14.711Z",
          "updated_at": "2025-05-02T14:45:14.711Z"
        }
      ]

      at logDatabaseState (src/services/__tests__/workItemDeleteIntegration.test.ts:28:13)

    console.error
      Error during DB State Check: BEFORE DELETE: error: column "created_at" does not exist
          at /home/richard/repos/mcp-task-manager-server/node_modules/pg-pool/index.js:45:11
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at logDatabaseState (/home/richard/repos/mcp-task-manager-server/src/services/__tests__/workItemDeleteIntegration.test.ts:32:25)
          at Object.<anonymous> (/home/richard/repos/mcp-task-manager-server/src/services/__tests__/workItemDeleteIntegration.test.ts:168:7) {
        length: 110,
        severity: 'ERROR',
        code: '42703',
        detail: undefined,
        hint: undefined,
        position: '75',
        internalPosition: undefined,
        internalQuery: undefined,
        where: undefined,
        schema: undefined,
        table: undefined,
        column: undefined,
        dataType: undefined,
        constraint: undefined,
        file: 'parse_relation.c',
        line: '3716',
        routine: 'errorMissingColumn'
      }

      57 |   } catch (error) {
      58 |     // Use console.error for errors
    > 59 |     console.error(`Error during DB State Check${context ? `: ${context}` : ''}:`, error);
         |             ^
      60 |   }
      61 | };
      62 |

      at logDatabaseState (src/services/__tests__/workItemDeleteIntegration.test.ts:59:13)
      at Object.<anonymous> (src/services/__tests__/workItemDeleteIntegration.test.ts:168:7)

    console.log
      
      --- DB State Check: AFTER DELETE ---

      at logDatabaseState (src/services/__tests__/workItemDeleteIntegration.test.ts:19:13)

    console.log
      Work Items Found (4):
      [
        {
          "work_item_id": "b4ad3917-29f6-4257-8914-eb8a22f65544",
          "name": "Parent Project",
          "shortname": "parent-project",
          "is_active": false,
          "status": "todo",
          "parent_work_item_id": null,
          "order_key": "1746197114683",
          "created_at": "2025-05-02T14:45:14.680Z",
          "updated_at": "2025-05-02T14:45:14.812Z"
        },
        {
          "work_item_id": "b262a5bc-bedd-4504-a3a7-9aa51002524c",
          "name": "Child Task 1",
          "shortname": "child-task-1",
          "is_active": true,
          "status": "todo",
          "parent_work_item_id": "b4ad3917-29f6-4257-8914-eb8a22f65544",
          "order_key": "1746197114696",
          "created_at": "2025-05-02T14:45:14.693Z",
          "updated_at": "2025-05-02T14:45:14.693Z"
        },
        {
          "work_item_id": "aca93b51-5e78-4d8a-98fd-fea0f63acd79",
          "name": "Child Task 2",
          "shortname": "child-task-2",
          "is_active": true,
          "status": "todo",
          "parent_work_item_id": "b4ad3917-29f6-4257-8914-eb8a22f65544",
          "order_key": "1746197114705",
          "created_at": "2025-05-02T14:45:14.702Z",
          "updated_at": "2025-05-02T14:45:14.702Z"
        },
        {
          "work_item_id": "9cc0dc12-50f3-492c-a19a-f50de9d71cab",
          "name": "Grandchild Task 1",
          "shortname": "grandchild-task-1",
          "is_active": true,
          "status": "todo",
          "parent_work_item_id": "b262a5bc-bedd-4504-a3a7-9aa51002524c",
          "order_key": "1746197114715",
          "created_at": "2025-05-02T14:45:14.711Z",
          "updated_at": "2025-05-02T14:45:14.711Z"
        }
      ]

      at logDatabaseState (src/services/__tests__/workItemDeleteIntegration.test.ts:28:13)

    console.error
      Error during DB State Check: AFTER DELETE: error: column "created_at" does not exist
          at /home/richard/repos/mcp-task-manager-server/node_modules/pg-pool/index.js:45:11
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at logDatabaseState (/home/richard/repos/mcp-task-manager-server/src/services/__tests__/workItemDeleteIntegration.test.ts:32:25)
          at Object.<anonymous> (/home/richard/repos/mcp-task-manager-server/src/services/__tests__/workItemDeleteIntegration.test.ts:174:7) {
        length: 110,
        severity: 'ERROR',
        code: '42703',
        detail: undefined,
        hint: undefined,
        position: '75',
        internalPosition: undefined,
        internalQuery: undefined,
        where: undefined,
        schema: undefined,
        table: undefined,
        column: undefined,
        dataType: undefined,
        constraint: undefined,
        file: 'parse_relation.c',
        line: '3716',
        routine: 'errorMissingColumn'
      }

      57 |   } catch (error) {
      58 |     // Use console.error for errors
    > 59 |     console.error(`Error during DB State Check${context ? `: ${context}` : ''}:`, error);
         |             ^
      60 |   }
      61 | };
      62 |

      at logDatabaseState (src/services/__tests__/workItemDeleteIntegration.test.ts:59:13)
      at Object.<anonymous> (src/services/__tests__/workItemDeleteIntegration.test.ts:174:7)

  ● WorkItemService - Delete Work Item Integration Tests › Soft Delete Operations › should soft delete parent and all descendants recursively

    expect(received).toBe(expected) // Object.is equality

    Expected: 4
    Received: 1

      176 |       // Verify count of deleted items matches the full cascade size now
      177 |       // --- THIS IS THE FAILING ASSERTION ---
    > 178 |       expect(deletedCount).toBe(descendantIds.length); // Expect 4
          |                            ^
      179 |       // -------------------------------------
      180 |
      181 |       // Query each descendant to confirm soft delete (verify the cascade *intent* worked)

      at Object.<anonymous> (src/services/__tests__/workItemDeleteIntegration.test.ts:178:28)

{"level":"INFO","time":"2025-05-02T14:45:15.181Z","pid":118906,"hostname":"richard","msg":"Loading environment variable overrides for configuration..."}
{"level":"INFO","time":"2025-05-02T14:45:14.957Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] No undo action found to redo."}
{"level":"INFO","time":"2025-05-02T14:45:15.181Z","pid":118906,"hostname":"richard","msg":"Overriding pgHost from env: localhost"}
{"level":"INFO","time":"2025-05-02T14:45:15.181Z","pid":118906,"hostname":"richard","msg":"Overriding pgPort from env: 5432"}
{"level":"INFO","time":"2025-05-02T14:45:15.181Z","pid":118906,"hostname":"richard","msg":"Overriding pgUser from env: taskmanager_user"}
{"level":"INFO","time":"2025-05-02T14:45:15.181Z","pid":118906,"hostname":"richard","msg":"Overriding pgPassword from env."}
{"level":"INFO","time":"2025-05-02T14:45:15.181Z","pid":118906,"hostname":"richard","msg":"Overriding pgDatabase from env: taskmanager_db"}
{"level":"INFO","time":"2025-05-02T14:45:15.181Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] Setting up PostgreSQL connection pool..."}
{"level":"INFO","time":"2025-05-02T14:45:15.182Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] PostgreSQL connection pool configured."}
{"level":"INFO","time":"2025-05-02T14:45:15.183Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] Starting database schema initialization..."}
{"level":"INFO","time":"2025-05-02T14:45:15.198Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] Connected to PostgreSQL for schema check/application."}
{"level":"INFO","time":"2025-05-02T14:45:15.198Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] Force schema run enabled or tables missing. Initializing/Re-initializing schema..."}
{"level":"INFO","time":"2025-05-02T14:45:15.198Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] Looking for schema file at: /home/richard/repos/mcp-task-manager-server/dist/db/schema.sql"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.198Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] Schema file read successfully. Executing schema setup..."}
{"level":"INFO","time":"2025-05-02T14:45:15.221Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] Full schema script executed."}
{"level":"INFO","time":"2025-05-02T14:45:15.225Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] Confirmed work_items table exists after schema execution."}
{"level":"INFO","time":"2025-05-02T14:45:15.225Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] Initialization marked as complete."}
{"level":"INFO","time":"2025-05-02T14:45:15.226Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] Released schema check/application client."}
{"level":"INFO","time":"2025-05-02T14:45:15.226Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] Instance created and database initialized."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.227Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Starting database clean up..."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.228Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating undo_steps CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.229Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating action_history CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.239Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating work_item_dependencies CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.240Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating work_items CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.252Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Database clean up committed."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.252Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Database client released."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.252Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item c5abd0c0-fa22-44a1-b615-8c190b933699"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.254Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Item 1\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.257Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:15.257Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: item-1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.257Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:15.257Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197115257"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.257Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item c5abd0c0-fa22-44a1-b615-8c190b933699 within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:15.260Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item c5abd0c0-fa22-44a1-b615-8c190b933699 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.262Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 24070239-5692-4491-9fb7-c50b74e7e90c in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.263Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step f6b8cbd4-3110-4502-899b-0b106043191a for action 24070239-5692-4491-9fb7-c50b74e7e90c in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.265Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:15.265Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item c5abd0c0-fa22-44a1-b615-8c190b933699 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.268Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.268Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item f8dac477-addb-402e-84bd-21f382e8d8e6"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.269Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Item 2\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.270Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:15.270Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: item-2"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.270Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:15.270Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197115270"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.270Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item f8dac477-addb-402e-84bd-21f382e8d8e6 within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:15.272Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item f8dac477-addb-402e-84bd-21f382e8d8e6 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.273Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action a5a92806-a6c1-43b2-9c9b-15c0b8a863ef in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.274Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 97050bdf-d600-4aae-8be4-bc859b3e5b7e for action a5a92806-a6c1-43b2-9c9b-15c0b8a863ef in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.275Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:15.275Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item f8dac477-addb-402e-84bd-21f382e8d8e6 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.278Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.278Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService] Updating work item c5abd0c0-fa22-44a1-b615-8c190b933699 with data:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.280Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: c5abd0c0-fa22-44a1-b615-8c190b933699 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.281Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID c5abd0c0-fa22-44a1-b615-8c190b933699 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.281Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item c5abd0c0-fa22-44a1-b615-8c190b933699. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.283Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item c5abd0c0-fa22-44a1-b615-8c190b933699 (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.283Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps Before Update for c5abd0c0-fa22-44a1-b615-8c190b933699:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.283Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Item 1 Updated\", parentId: null, currentItemId: c5abd0c0-fa22-44a1-b615-8c190b933699"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.284Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:15.284Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: item-1-updated"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.284Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Desired Deps State for c5abd0c0-fa22-44a1-b615-8c190b933699:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.284Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updating work item c5abd0c0-fa22-44a1-b615-8c190b933699 in transaction"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.286Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updated work item c5abd0c0-fa22-44a1-b615-8c190b933699 fields. Row count: 1"}
{"level":"INFO","time":"2025-05-02T14:45:15.286Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Successfully processed update for item c5abd0c0-fa22-44a1-b615-8c190b933699."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.286Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: c5abd0c0-fa22-44a1-b615-8c190b933699 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.287Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID c5abd0c0-fa22-44a1-b615-8c190b933699 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.287Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item c5abd0c0-fa22-44a1-b615-8c190b933699. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.288Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item c5abd0c0-fa22-44a1-b615-8c190b933699 (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.288Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps After Update Repo Call for c5abd0c0-fa22-44a1-b615-8c190b933699:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.288Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Item fields changed for c5abd0c0-fa22-44a1-b615-8c190b933699."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.288Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Effective changes detected for c5abd0c0-fa22-44a1-b615-8c190b933699. Generating history."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.289Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 9b702577-a381-413a-a9f6-f68cc425ee06 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.290Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 52079774-b98d-470c-bc21-6a7249eedc16 for action 9b702577-a381-413a-a9f6-f68cc425ee06 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.291Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:15.291Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService] Recorded history for update of work item c5abd0c0-fa22-44a1-b615-8c190b933699."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.292Z","pid":118906,"hostname":"richard","msg":"[WorkItemReadingService] Getting work item by ID: c5abd0c0-fa22-44a1-b615-8c190b933699 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.292Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: c5abd0c0-fa22-44a1-b615-8c190b933699 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.293Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID c5abd0c0-fa22-44a1-b615-8c190b933699 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.293Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item c5abd0c0-fa22-44a1-b615-8c190b933699. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.294Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: c5abd0c0-fa22-44a1-b615-8c190b933699 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.294Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.295Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item c5abd0c0-fa22-44a1-b615-8c190b933699 (link active: true, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.313Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent c5abd0c0-fa22-44a1-b615-8c190b933699 (active: true, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.313Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent c5abd0c0-fa22-44a1-b615-8c190b933699 (active: true, status: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.313Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item c5abd0c0-fa22-44a1-b615-8c190b933699 (link active: true, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.314Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"WARN","time":"2025-05-02T14:45:15.315Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Attempting to soft delete 1 work item(s) and cascade: f8dac477-addb-402e-84bd-21f382e8d8e6"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.316Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Finding all descendants..."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.316Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: f8dac477-addb-402e-84bd-21f382e8d8e6 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.316Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.317Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent f8dac477-addb-402e-84bd-21f382e8d8e6 (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.317Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent f8dac477-addb-402e-84bd-21f382e8d8e6 (active: false, status: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.317Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Full cascade list (1 items) identified: f8dac477-addb-402e-84bd-21f382e8d8e6"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.318Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item list (count: 1, link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.319Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item list (count: 1, link active: false, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.319Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Identified 0 potentially affected dependency links for cascade delete."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.320Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found 1 work items by IDs (count: 1, isActive: true)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.320Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Found 1 active items in cascade list for deletion."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.320Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Attempting to soft delete item IDs in cascade: f8dac477-addb-402e-84bd-21f382e8d8e6"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.321Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] Executing softDelete SQL: \n      UPDATE work_items\n      SET is_active = FALSE, updated_at = $1\n      WHERE work_item_id IN ($2) AND is_active = TRUE;\n     PARAMS: [\"2025-05-02T14:45:15.320Z\",\"f8dac477-addb-402e-84bd-21f382e8d8e6\"]"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.321Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] softDelete result rowCount: 1"}
{"level":"INFO","time":"2025-05-02T14:45:15.321Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Soft deleted 1 work item(s)."}
{"level":"INFO","time":"2025-05-02T14:45:15.321Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Repository reported 1 work item(s) soft deleted."}
{"level":"INFO","time":"2025-05-02T14:45:15.321Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] No active dependency links found to soft delete within the cascade."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.322Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 92f53152-dac4-456d-a62a-0269c4ba1d13 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.323Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step d3960d11-9cbf-4215-b319-921bdc1dc436 for action 92f53152-dac4-456d-a62a-0269c4ba1d13 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.325Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:15.325Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Recorded history for delete action 92f53152-dac4-456d-a62a-0269c4ba1d13."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.329Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Returning count: 1 (based on repository rowCount)"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.330Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.332Z","pid":118906,"hostname":"richard","msg":"BeforeEach setup complete. Initial items: item1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.332Z","pid":118906,"hostname":"richard","msg":"Initial actions: action1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.332Z","pid":118906,"hostname":"richard","msg":"Test: should undo last action (delete item 2) - Starting"}
{"level":"INFO","time":"2025-05-02T14:45:15.332Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to undo last action."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.334Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Found original action to undo: 92f53152-dac4-456d-a62a-0269c4ba1d13 (DELETE_WORK_ITEM_CASCADE)"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.335Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Found 1 steps for action 92f53152-dac4-456d-a62a-0269c4ba1d13."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.336Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Executing 1 undo steps for action 92f53152-dac4-456d-a62a-0269c4ba1d13 in reverse order"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.337Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Executing undo step 1 (UPDATE) on work_items record f8dac477-addb-402e-84bd-21f382e8d8e6 for action 92f53152-dac4-456d-a62a-0269c4ba1d13"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.338Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryUndoRedo] Updated row in work_items f8dac477-addb-402e-84bd-21f382e8d8e6 based on PKs."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.339Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 62c186c1-f99c-4b72-854e-04767ec67427 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.340Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked action 92f53152-dac4-456d-a62a-0269c4ba1d13 as undone by action 62c186c1-f99c-4b72-854e-04767ec67427."}
{"level":"INFO","time":"2025-05-02T14:45:15.340Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Successfully undid action 92f53152-dac4-456d-a62a-0269c4ba1d13"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.343Z","pid":118906,"hostname":"richard","msg":"Test: should undo last action (delete item 2) - undoLastAction result:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.344Z","pid":118906,"hostname":"richard","msg":"Test: should undo last action (delete item 2) - Fetching item 2 after undo"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.344Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: f8dac477-addb-402e-84bd-21f382e8d8e6 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.345Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID f8dac477-addb-402e-84bd-21f382e8d8e6 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.345Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item f8dac477-addb-402e-84bd-21f382e8d8e6. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.345Z","pid":118906,"hostname":"richard","msg":"Test: should undo last action (delete item 2) - Fetched item 2 after undo:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.345Z","pid":118906,"hostname":"richard","msg":"Test: should undo last action (delete item 2) - Fetching item 1 after undo"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.346Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: c5abd0c0-fa22-44a1-b615-8c190b933699 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.347Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID c5abd0c0-fa22-44a1-b615-8c190b933699 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.347Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item c5abd0c0-fa22-44a1-b615-8c190b933699. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.347Z","pid":118906,"hostname":"richard","msg":"Test: should undo last action (delete item 2) - Fetched item 1 after undo:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.349Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.349Z","pid":118906,"hostname":"richard","msg":"Test: should undo last action (delete item 2) - Finished"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.351Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Starting database clean up..."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.352Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating undo_steps CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.354Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating action_history CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.365Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating work_item_dependencies CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.367Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating work_items CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.380Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Database clean up committed."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.380Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Database client released."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.380Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item c8c558d0-d3ed-48cd-b5b9-e0d63be0f344"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.381Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Item 1\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.383Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:15.383Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: item-1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.383Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:15.383Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197115383"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.383Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item c8c558d0-d3ed-48cd-b5b9-e0d63be0f344 within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:15.385Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item c8c558d0-d3ed-48cd-b5b9-e0d63be0f344 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.387Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action cbe3270f-653e-4d67-860b-ea902b801aaf in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.388Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step b57fff94-97a9-498a-8770-741339c23d99 for action cbe3270f-653e-4d67-860b-ea902b801aaf in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.389Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:15.389Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item c8c558d0-d3ed-48cd-b5b9-e0d63be0f344 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.391Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.391Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 46d14582-f6f5-4c94-a18f-5bcc8d44222c"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.392Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Item 2\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.392Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:15.392Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: item-2"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.392Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:15.392Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197115392"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.393Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 46d14582-f6f5-4c94-a18f-5bcc8d44222c within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:15.393Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 46d14582-f6f5-4c94-a18f-5bcc8d44222c with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.394Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 1b8fb5a2-8de5-4453-9692-7b3609cb3d08 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.395Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 8c06cf68-ed5f-46da-b0f6-2d5dd8896686 for action 1b8fb5a2-8de5-4453-9692-7b3609cb3d08 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.396Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:15.396Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 46d14582-f6f5-4c94-a18f-5bcc8d44222c and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.398Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.399Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService] Updating work item c8c558d0-d3ed-48cd-b5b9-e0d63be0f344 with data:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.399Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: c8c558d0-d3ed-48cd-b5b9-e0d63be0f344 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.400Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID c8c558d0-d3ed-48cd-b5b9-e0d63be0f344 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.400Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item c8c558d0-d3ed-48cd-b5b9-e0d63be0f344. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.401Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item c8c558d0-d3ed-48cd-b5b9-e0d63be0f344 (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.401Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps Before Update for c8c558d0-d3ed-48cd-b5b9-e0d63be0f344:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.401Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Item 1 Updated\", parentId: null, currentItemId: c8c558d0-d3ed-48cd-b5b9-e0d63be0f344"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.401Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:15.401Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: item-1-updated"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.401Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Desired Deps State for c8c558d0-d3ed-48cd-b5b9-e0d63be0f344:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.401Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updating work item c8c558d0-d3ed-48cd-b5b9-e0d63be0f344 in transaction"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.402Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updated work item c8c558d0-d3ed-48cd-b5b9-e0d63be0f344 fields. Row count: 1"}
{"level":"INFO","time":"2025-05-02T14:45:15.402Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Successfully processed update for item c8c558d0-d3ed-48cd-b5b9-e0d63be0f344."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.402Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: c8c558d0-d3ed-48cd-b5b9-e0d63be0f344 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.403Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID c8c558d0-d3ed-48cd-b5b9-e0d63be0f344 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.403Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item c8c558d0-d3ed-48cd-b5b9-e0d63be0f344. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.404Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item c8c558d0-d3ed-48cd-b5b9-e0d63be0f344 (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.404Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps After Update Repo Call for c8c558d0-d3ed-48cd-b5b9-e0d63be0f344:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.404Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Item fields changed for c8c558d0-d3ed-48cd-b5b9-e0d63be0f344."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.404Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Effective changes detected for c8c558d0-d3ed-48cd-b5b9-e0d63be0f344. Generating history."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.405Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action ecf33bd9-5168-4658-b565-40f77801a74a in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.406Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step f8ac0de5-be30-4f6f-bd4a-9285826ff3a2 for action ecf33bd9-5168-4658-b565-40f77801a74a in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.407Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:15.407Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService] Recorded history for update of work item c8c558d0-d3ed-48cd-b5b9-e0d63be0f344."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.409Z","pid":118906,"hostname":"richard","msg":"[WorkItemReadingService] Getting work item by ID: c8c558d0-d3ed-48cd-b5b9-e0d63be0f344 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.409Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: c8c558d0-d3ed-48cd-b5b9-e0d63be0f344 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.410Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID c8c558d0-d3ed-48cd-b5b9-e0d63be0f344 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.410Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item c8c558d0-d3ed-48cd-b5b9-e0d63be0f344. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.410Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: c8c558d0-d3ed-48cd-b5b9-e0d63be0f344 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.410Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.411Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item c8c558d0-d3ed-48cd-b5b9-e0d63be0f344 (link active: true, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.412Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent c8c558d0-d3ed-48cd-b5b9-e0d63be0f344 (active: true, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.412Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent c8c558d0-d3ed-48cd-b5b9-e0d63be0f344 (active: true, status: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.412Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item c8c558d0-d3ed-48cd-b5b9-e0d63be0f344 (link active: true, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.413Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"WARN","time":"2025-05-02T14:45:15.413Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Attempting to soft delete 1 work item(s) and cascade: 46d14582-f6f5-4c94-a18f-5bcc8d44222c"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.414Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Finding all descendants..."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.414Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: 46d14582-f6f5-4c94-a18f-5bcc8d44222c with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.414Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.414Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent 46d14582-f6f5-4c94-a18f-5bcc8d44222c (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.415Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent 46d14582-f6f5-4c94-a18f-5bcc8d44222c (active: false, status: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.415Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Full cascade list (1 items) identified: 46d14582-f6f5-4c94-a18f-5bcc8d44222c"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.415Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item list (count: 1, link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.417Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item list (count: 1, link active: false, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.417Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Identified 0 potentially affected dependency links for cascade delete."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.418Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found 1 work items by IDs (count: 1, isActive: true)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.418Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Found 1 active items in cascade list for deletion."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.418Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Attempting to soft delete item IDs in cascade: 46d14582-f6f5-4c94-a18f-5bcc8d44222c"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.418Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] Executing softDelete SQL: \n      UPDATE work_items\n      SET is_active = FALSE, updated_at = $1\n      WHERE work_item_id IN ($2) AND is_active = TRUE;\n     PARAMS: [\"2025-05-02T14:45:15.418Z\",\"46d14582-f6f5-4c94-a18f-5bcc8d44222c\"]"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.419Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] softDelete result rowCount: 1"}
{"level":"INFO","time":"2025-05-02T14:45:15.419Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Soft deleted 1 work item(s)."}
{"level":"INFO","time":"2025-05-02T14:45:15.419Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Repository reported 1 work item(s) soft deleted."}
{"level":"INFO","time":"2025-05-02T14:45:15.419Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] No active dependency links found to soft delete within the cascade."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.420Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 8374dab5-0ab5-422c-bbf0-4224be1cd999 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.423Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step c7b7011b-69ef-42bf-9045-97eaa0fdbb37 for action 8374dab5-0ab5-422c-bbf0-4224be1cd999 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.425Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:15.425Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Recorded history for delete action 8374dab5-0ab5-422c-bbf0-4224be1cd999."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.426Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Returning count: 1 (based on repository rowCount)"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.427Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.428Z","pid":118906,"hostname":"richard","msg":"BeforeEach setup complete. Initial items: item1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.428Z","pid":118906,"hostname":"richard","msg":"Initial actions: action1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.429Z","pid":118906,"hostname":"richard","msg":"Test: should undo multiple actions sequentially - Starting"}
{"level":"INFO","time":"2025-05-02T14:45:15.429Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to undo last action."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.430Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Found original action to undo: 8374dab5-0ab5-422c-bbf0-4224be1cd999 (DELETE_WORK_ITEM_CASCADE)"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.431Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Found 1 steps for action 8374dab5-0ab5-422c-bbf0-4224be1cd999."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.431Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Executing 1 undo steps for action 8374dab5-0ab5-422c-bbf0-4224be1cd999 in reverse order"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.431Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Executing undo step 1 (UPDATE) on work_items record 46d14582-f6f5-4c94-a18f-5bcc8d44222c for action 8374dab5-0ab5-422c-bbf0-4224be1cd999"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.432Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryUndoRedo] Updated row in work_items 46d14582-f6f5-4c94-a18f-5bcc8d44222c based on PKs."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.433Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action fe4af7fe-b145-479c-a532-d405fdc946ea in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.434Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked action 8374dab5-0ab5-422c-bbf0-4224be1cd999 as undone by action fe4af7fe-b145-479c-a532-d405fdc946ea."}
{"level":"INFO","time":"2025-05-02T14:45:15.434Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Successfully undid action 8374dab5-0ab5-422c-bbf0-4224be1cd999"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.437Z","pid":118906,"hostname":"richard","msg":"Test: should undo multiple actions sequentially - 1st undo (delete) result:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.437Z","pid":118906,"hostname":"richard","msg":"Test: should undo multiple actions sequentially - Performing 2nd undo (update)"}
{"level":"INFO","time":"2025-05-02T14:45:15.437Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to undo last action."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.438Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Found original action to undo: ecf33bd9-5168-4658-b565-40f77801a74a (UPDATE_WORK_ITEM)"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.439Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Found 1 steps for action ecf33bd9-5168-4658-b565-40f77801a74a."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.439Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Executing 1 undo steps for action ecf33bd9-5168-4658-b565-40f77801a74a in reverse order"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.439Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Executing undo step 1 (UPDATE) on work_items record c8c558d0-d3ed-48cd-b5b9-e0d63be0f344 for action ecf33bd9-5168-4658-b565-40f77801a74a"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.440Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryUndoRedo] Updated row in work_items c8c558d0-d3ed-48cd-b5b9-e0d63be0f344 based on PKs."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.442Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 11df111f-d853-4208-8556-a1685dbacdcf in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.443Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked action ecf33bd9-5168-4658-b565-40f77801a74a as undone by action 11df111f-d853-4208-8556-a1685dbacdcf."}
{"level":"INFO","time":"2025-05-02T14:45:15.443Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Successfully undid action ecf33bd9-5168-4658-b565-40f77801a74a"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.445Z","pid":118906,"hostname":"richard","msg":"Test: should undo multiple actions sequentially - 2nd undo (update) result:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.446Z","pid":118906,"hostname":"richard","msg":"Test: should undo multiple actions sequentially - Fetching items after 2nd undo"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.446Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: c8c558d0-d3ed-48cd-b5b9-e0d63be0f344 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.447Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID c8c558d0-d3ed-48cd-b5b9-e0d63be0f344 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.447Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item c8c558d0-d3ed-48cd-b5b9-e0d63be0f344. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.447Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 46d14582-f6f5-4c94-a18f-5bcc8d44222c with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.448Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 46d14582-f6f5-4c94-a18f-5bcc8d44222c (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.448Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 46d14582-f6f5-4c94-a18f-5bcc8d44222c. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.448Z","pid":118906,"hostname":"richard","msg":"Test: should undo multiple actions sequentially - Fetched item 1 after 2nd undo:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.448Z","pid":118906,"hostname":"richard","msg":"Test: should undo multiple actions sequentially - Fetched item 2 after 2nd undo:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.451Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.453Z","pid":118906,"hostname":"richard","msg":"Test: should undo multiple actions sequentially - Finished"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.455Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Starting database clean up..."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.456Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating undo_steps CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.461Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating action_history CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.478Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating work_item_dependencies CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.479Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating work_items CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.491Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Database clean up committed."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.491Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Database client released."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.491Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item a73e5ebd-9e04-4f29-9596-530cc94df2a3"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.491Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Item 1\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.493Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:15.493Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: item-1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.493Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:15.493Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197115493"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.493Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item a73e5ebd-9e04-4f29-9596-530cc94df2a3 within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:15.494Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item a73e5ebd-9e04-4f29-9596-530cc94df2a3 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.495Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 2ee336a4-4ebf-44fb-a83b-286798683e75 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.497Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 14c9312d-a3b2-44bd-b273-4bb40169a7ae for action 2ee336a4-4ebf-44fb-a83b-286798683e75 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.497Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:15.497Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item a73e5ebd-9e04-4f29-9596-530cc94df2a3 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.499Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.500Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item f6a29872-6d0d-4918-9a0c-e818dd411633"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.500Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Item 2\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.500Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:15.500Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: item-2"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.500Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:15.500Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197115500"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.500Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item f6a29872-6d0d-4918-9a0c-e818dd411633 within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:15.501Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item f6a29872-6d0d-4918-9a0c-e818dd411633 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.502Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 8ff2f292-014f-4f9c-b9b4-c5ed124ab554 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.503Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 61ded561-04f2-493c-bc9d-86eb2a7578f6 for action 8ff2f292-014f-4f9c-b9b4-c5ed124ab554 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.503Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:15.503Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item f6a29872-6d0d-4918-9a0c-e818dd411633 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.506Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.506Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService] Updating work item a73e5ebd-9e04-4f29-9596-530cc94df2a3 with data:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.506Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: a73e5ebd-9e04-4f29-9596-530cc94df2a3 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.507Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID a73e5ebd-9e04-4f29-9596-530cc94df2a3 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.507Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item a73e5ebd-9e04-4f29-9596-530cc94df2a3. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.507Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item a73e5ebd-9e04-4f29-9596-530cc94df2a3 (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.507Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps Before Update for a73e5ebd-9e04-4f29-9596-530cc94df2a3:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.507Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Item 1 Updated\", parentId: null, currentItemId: a73e5ebd-9e04-4f29-9596-530cc94df2a3"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.508Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:15.508Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: item-1-updated"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.508Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Desired Deps State for a73e5ebd-9e04-4f29-9596-530cc94df2a3:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.508Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updating work item a73e5ebd-9e04-4f29-9596-530cc94df2a3 in transaction"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.509Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updated work item a73e5ebd-9e04-4f29-9596-530cc94df2a3 fields. Row count: 1"}
{"level":"INFO","time":"2025-05-02T14:45:15.509Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Successfully processed update for item a73e5ebd-9e04-4f29-9596-530cc94df2a3."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.509Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: a73e5ebd-9e04-4f29-9596-530cc94df2a3 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.510Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID a73e5ebd-9e04-4f29-9596-530cc94df2a3 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.510Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item a73e5ebd-9e04-4f29-9596-530cc94df2a3. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.510Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item a73e5ebd-9e04-4f29-9596-530cc94df2a3 (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.510Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps After Update Repo Call for a73e5ebd-9e04-4f29-9596-530cc94df2a3:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.510Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Item fields changed for a73e5ebd-9e04-4f29-9596-530cc94df2a3."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.510Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Effective changes detected for a73e5ebd-9e04-4f29-9596-530cc94df2a3. Generating history."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.511Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action a744621b-a276-4553-b0b0-457119352094 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.512Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step a63ec0b9-0e69-4157-9646-b2b0069bd506 for action a744621b-a276-4553-b0b0-457119352094 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.513Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:15.513Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService] Recorded history for update of work item a73e5ebd-9e04-4f29-9596-530cc94df2a3."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.514Z","pid":118906,"hostname":"richard","msg":"[WorkItemReadingService] Getting work item by ID: a73e5ebd-9e04-4f29-9596-530cc94df2a3 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.514Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: a73e5ebd-9e04-4f29-9596-530cc94df2a3 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.515Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID a73e5ebd-9e04-4f29-9596-530cc94df2a3 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.515Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item a73e5ebd-9e04-4f29-9596-530cc94df2a3. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.515Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: a73e5ebd-9e04-4f29-9596-530cc94df2a3 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.515Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.516Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item a73e5ebd-9e04-4f29-9596-530cc94df2a3 (link active: true, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.517Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item a73e5ebd-9e04-4f29-9596-530cc94df2a3 (link active: true, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.517Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent a73e5ebd-9e04-4f29-9596-530cc94df2a3 (active: true, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.517Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent a73e5ebd-9e04-4f29-9596-530cc94df2a3 (active: true, status: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.518Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"WARN","time":"2025-05-02T14:45:15.518Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Attempting to soft delete 1 work item(s) and cascade: f6a29872-6d0d-4918-9a0c-e818dd411633"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.518Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Finding all descendants..."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.518Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: f6a29872-6d0d-4918-9a0c-e818dd411633 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.518Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.519Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent f6a29872-6d0d-4918-9a0c-e818dd411633 (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.519Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent f6a29872-6d0d-4918-9a0c-e818dd411633 (active: false, status: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.519Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Full cascade list (1 items) identified: f6a29872-6d0d-4918-9a0c-e818dd411633"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.520Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item list (count: 1, link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.520Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item list (count: 1, link active: false, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.520Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Identified 0 potentially affected dependency links for cascade delete."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.521Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found 1 work items by IDs (count: 1, isActive: true)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.521Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Found 1 active items in cascade list for deletion."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.521Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Attempting to soft delete item IDs in cascade: f6a29872-6d0d-4918-9a0c-e818dd411633"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.521Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] Executing softDelete SQL: \n      UPDATE work_items\n      SET is_active = FALSE, updated_at = $1\n      WHERE work_item_id IN ($2) AND is_active = TRUE;\n     PARAMS: [\"2025-05-02T14:45:15.521Z\",\"f6a29872-6d0d-4918-9a0c-e818dd411633\"]"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.522Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] softDelete result rowCount: 1"}
{"level":"INFO","time":"2025-05-02T14:45:15.522Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Soft deleted 1 work item(s)."}
{"level":"INFO","time":"2025-05-02T14:45:15.522Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Repository reported 1 work item(s) soft deleted."}
{"level":"INFO","time":"2025-05-02T14:45:15.522Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] No active dependency links found to soft delete within the cascade."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.523Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action bb31035f-d0f5-4612-8e1f-5a2290041a06 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.524Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 87e85150-5bde-4d74-adcc-2edb53890a60 for action bb31035f-d0f5-4612-8e1f-5a2290041a06 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.524Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:15.524Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Recorded history for delete action bb31035f-d0f5-4612-8e1f-5a2290041a06."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.526Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Returning count: 1 (based on repository rowCount)"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.527Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.527Z","pid":118906,"hostname":"richard","msg":"BeforeEach setup complete. Initial items: item1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.527Z","pid":118906,"hostname":"richard","msg":"Initial actions: action1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.528Z","pid":118906,"hostname":"richard","msg":"Test: should return null if no action to undo - Starting"}
{"level":"INFO","time":"2025-05-02T14:45:15.528Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to undo last action."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.535Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Found original action to undo: bb31035f-d0f5-4612-8e1f-5a2290041a06 (DELETE_WORK_ITEM_CASCADE)"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.536Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Found 1 steps for action bb31035f-d0f5-4612-8e1f-5a2290041a06."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.536Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Executing 1 undo steps for action bb31035f-d0f5-4612-8e1f-5a2290041a06 in reverse order"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.536Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Executing undo step 1 (UPDATE) on work_items record f6a29872-6d0d-4918-9a0c-e818dd411633 for action bb31035f-d0f5-4612-8e1f-5a2290041a06"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.538Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryUndoRedo] Updated row in work_items f6a29872-6d0d-4918-9a0c-e818dd411633 based on PKs."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.538Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action d799061b-b6e1-4932-8f26-b58a8cc48565 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.539Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked action bb31035f-d0f5-4612-8e1f-5a2290041a06 as undone by action d799061b-b6e1-4932-8f26-b58a8cc48565."}
{"level":"INFO","time":"2025-05-02T14:45:15.539Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Successfully undid action bb31035f-d0f5-4612-8e1f-5a2290041a06"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.541Z","pid":118906,"hostname":"richard","msg":"Test: should return null if no action to undo - 1st undo result:"}
{"level":"INFO","time":"2025-05-02T14:45:15.541Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to undo last action."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.542Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Found original action to undo: a744621b-a276-4553-b0b0-457119352094 (UPDATE_WORK_ITEM)"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.542Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Found 1 steps for action a744621b-a276-4553-b0b0-457119352094."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.543Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Executing 1 undo steps for action a744621b-a276-4553-b0b0-457119352094 in reverse order"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.543Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Executing undo step 1 (UPDATE) on work_items record a73e5ebd-9e04-4f29-9596-530cc94df2a3 for action a744621b-a276-4553-b0b0-457119352094"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.543Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryUndoRedo] Updated row in work_items a73e5ebd-9e04-4f29-9596-530cc94df2a3 based on PKs."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.544Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 035e6999-8f05-42bc-b492-4e69a44e6c72 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.544Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked action a744621b-a276-4553-b0b0-457119352094 as undone by action 035e6999-8f05-42bc-b492-4e69a44e6c72."}
{"level":"INFO","time":"2025-05-02T14:45:15.545Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Successfully undid action a744621b-a276-4553-b0b0-457119352094"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.546Z","pid":118906,"hostname":"richard","msg":"Test: should return null if no action to undo - 2nd undo result:"}
{"level":"INFO","time":"2025-05-02T14:45:15.546Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to undo last action."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.547Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Found original action to undo: 8ff2f292-014f-4f9c-b9b4-c5ed124ab554 (ADD_WORK_ITEM)"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.548Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Found 1 steps for action 8ff2f292-014f-4f9c-b9b4-c5ed124ab554."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.548Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Executing 1 undo steps for action 8ff2f292-014f-4f9c-b9b4-c5ed124ab554 in reverse order"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.548Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Executing undo step 1 (UPDATE) on work_items record f6a29872-6d0d-4918-9a0c-e818dd411633 for action 8ff2f292-014f-4f9c-b9b4-c5ed124ab554"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.549Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryUndoRedo] Updated row in work_items f6a29872-6d0d-4918-9a0c-e818dd411633 based on PKs."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.550Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 7ac9b7ae-ef51-40c7-a6ad-9537a3287e34 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.550Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked action 8ff2f292-014f-4f9c-b9b4-c5ed124ab554 as undone by action 7ac9b7ae-ef51-40c7-a6ad-9537a3287e34."}
{"level":"INFO","time":"2025-05-02T14:45:15.550Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Successfully undid action 8ff2f292-014f-4f9c-b9b4-c5ed124ab554"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.552Z","pid":118906,"hostname":"richard","msg":"Test: should return null if no action to undo - 3rd undo result:"}
{"level":"INFO","time":"2025-05-02T14:45:15.553Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to undo last action."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.553Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Found original action to undo: 2ee336a4-4ebf-44fb-a83b-286798683e75 (ADD_WORK_ITEM)"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.554Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Found 1 steps for action 2ee336a4-4ebf-44fb-a83b-286798683e75."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.554Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Executing 1 undo steps for action 2ee336a4-4ebf-44fb-a83b-286798683e75 in reverse order"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.554Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Executing undo step 1 (UPDATE) on work_items record a73e5ebd-9e04-4f29-9596-530cc94df2a3 for action 2ee336a4-4ebf-44fb-a83b-286798683e75"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.555Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryUndoRedo] Updated row in work_items a73e5ebd-9e04-4f29-9596-530cc94df2a3 based on PKs."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.556Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 2eb8bc75-db79-4d95-8818-ec074d7a1265 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.556Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked action 2ee336a4-4ebf-44fb-a83b-286798683e75 as undone by action 2eb8bc75-db79-4d95-8818-ec074d7a1265."}
{"level":"INFO","time":"2025-05-02T14:45:15.556Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Successfully undid action 2ee336a4-4ebf-44fb-a83b-286798683e75"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.559Z","pid":118906,"hostname":"richard","msg":"Test: should return null if no action to undo - 4th undo result:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.559Z","pid":118906,"hostname":"richard","msg":"Test: should return null if no action to undo - Attempting 5th undo"}
{"level":"INFO","time":"2025-05-02T14:45:15.559Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to undo last action."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.560Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] No un-undone original actions found."}
{"level":"INFO","time":"2025-05-02T14:45:15.560Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] No original action found to undo."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.560Z","pid":118906,"hostname":"richard","msg":"Test: should return null if no action to undo - 5th undo result:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.560Z","pid":118906,"hostname":"richard","msg":"Test: should return null if no action to undo - Fetching items after all undos"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.560Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: a73e5ebd-9e04-4f29-9596-530cc94df2a3 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.561Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID a73e5ebd-9e04-4f29-9596-530cc94df2a3 (isActive: false) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.562Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item a73e5ebd-9e04-4f29-9596-530cc94df2a3. isActive: false"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.562Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: f6a29872-6d0d-4918-9a0c-e818dd411633 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.562Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID f6a29872-6d0d-4918-9a0c-e818dd411633 (isActive: false) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.562Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item f6a29872-6d0d-4918-9a0c-e818dd411633. isActive: false"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.562Z","pid":118906,"hostname":"richard","msg":"Test: should return null if no action to undo - Fetched item 1 after all undos (isActive: false):"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.562Z","pid":118906,"hostname":"richard","msg":"Test: should return null if no action to undo - Fetched item 2 after all undos (isActive: false):"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.562Z","pid":118906,"hostname":"richard","msg":"Test: should return null if no action to undo - Finished"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.564Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Starting database clean up..."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.564Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating undo_steps CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.566Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating action_history CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.577Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating work_item_dependencies CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.579Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating work_items CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.591Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Database clean up committed."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.591Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Database client released."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.591Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 8c8546f0-694e-4d72-954b-54b2f7ae233d"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.592Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Item 1\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.593Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:15.593Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: item-1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.593Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:15.593Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197115593"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.593Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 8c8546f0-694e-4d72-954b-54b2f7ae233d within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:15.595Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 8c8546f0-694e-4d72-954b-54b2f7ae233d with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.596Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 38f87b25-a975-423e-9cfa-c4e91d52f0a5 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.597Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 2f37a952-ac99-47a9-932d-d87a280dd4ee for action 38f87b25-a975-423e-9cfa-c4e91d52f0a5 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.598Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:15.598Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 8c8546f0-694e-4d72-954b-54b2f7ae233d and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.601Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.601Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item e8c1f2b7-82e1-48ea-a336-6da30d276984"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.601Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Item 2\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.602Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:15.602Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: item-2"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.602Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:15.602Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197115602"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.602Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item e8c1f2b7-82e1-48ea-a336-6da30d276984 within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:15.602Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item e8c1f2b7-82e1-48ea-a336-6da30d276984 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.603Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 460b3f98-b203-4305-90a8-f88f32bba1c3 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.604Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 89cc8fc7-df29-4939-a1c3-a315fd3ec047 for action 460b3f98-b203-4305-90a8-f88f32bba1c3 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.604Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:15.604Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item e8c1f2b7-82e1-48ea-a336-6da30d276984 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.607Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.607Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService] Updating work item 8c8546f0-694e-4d72-954b-54b2f7ae233d with data:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.608Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 8c8546f0-694e-4d72-954b-54b2f7ae233d with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.608Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 8c8546f0-694e-4d72-954b-54b2f7ae233d (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.608Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 8c8546f0-694e-4d72-954b-54b2f7ae233d. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.609Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item 8c8546f0-694e-4d72-954b-54b2f7ae233d (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.610Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps Before Update for 8c8546f0-694e-4d72-954b-54b2f7ae233d:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.610Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Item 1 Updated\", parentId: null, currentItemId: 8c8546f0-694e-4d72-954b-54b2f7ae233d"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.610Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:15.610Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: item-1-updated"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.610Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Desired Deps State for 8c8546f0-694e-4d72-954b-54b2f7ae233d:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.610Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updating work item 8c8546f0-694e-4d72-954b-54b2f7ae233d in transaction"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.611Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updated work item 8c8546f0-694e-4d72-954b-54b2f7ae233d fields. Row count: 1"}
{"level":"INFO","time":"2025-05-02T14:45:15.611Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Successfully processed update for item 8c8546f0-694e-4d72-954b-54b2f7ae233d."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.611Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 8c8546f0-694e-4d72-954b-54b2f7ae233d with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.612Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 8c8546f0-694e-4d72-954b-54b2f7ae233d (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.612Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 8c8546f0-694e-4d72-954b-54b2f7ae233d. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.613Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item 8c8546f0-694e-4d72-954b-54b2f7ae233d (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.613Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps After Update Repo Call for 8c8546f0-694e-4d72-954b-54b2f7ae233d:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.613Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Item fields changed for 8c8546f0-694e-4d72-954b-54b2f7ae233d."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.613Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Effective changes detected for 8c8546f0-694e-4d72-954b-54b2f7ae233d. Generating history."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.614Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 8b7d98e0-357a-4045-8d33-88d8c2268c86 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.615Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step e832e2bd-7b59-4eb1-ab72-765100660fef for action 8b7d98e0-357a-4045-8d33-88d8c2268c86 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.615Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:15.616Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService] Recorded history for update of work item 8c8546f0-694e-4d72-954b-54b2f7ae233d."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.617Z","pid":118906,"hostname":"richard","msg":"[WorkItemReadingService] Getting work item by ID: 8c8546f0-694e-4d72-954b-54b2f7ae233d with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.617Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 8c8546f0-694e-4d72-954b-54b2f7ae233d with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.618Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 8c8546f0-694e-4d72-954b-54b2f7ae233d (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.618Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 8c8546f0-694e-4d72-954b-54b2f7ae233d. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.618Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: 8c8546f0-694e-4d72-954b-54b2f7ae233d with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.618Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.619Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item 8c8546f0-694e-4d72-954b-54b2f7ae233d (link active: true, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.620Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item 8c8546f0-694e-4d72-954b-54b2f7ae233d (link active: true, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.620Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent 8c8546f0-694e-4d72-954b-54b2f7ae233d (active: true, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.620Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent 8c8546f0-694e-4d72-954b-54b2f7ae233d (active: true, status: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.621Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"WARN","time":"2025-05-02T14:45:15.621Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Attempting to soft delete 1 work item(s) and cascade: e8c1f2b7-82e1-48ea-a336-6da30d276984"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.622Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Finding all descendants..."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.622Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: e8c1f2b7-82e1-48ea-a336-6da30d276984 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.622Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.623Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent e8c1f2b7-82e1-48ea-a336-6da30d276984 (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.623Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent e8c1f2b7-82e1-48ea-a336-6da30d276984 (active: false, status: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.623Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Full cascade list (1 items) identified: e8c1f2b7-82e1-48ea-a336-6da30d276984"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.624Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item list (count: 1, link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.625Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item list (count: 1, link active: false, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.626Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Identified 0 potentially affected dependency links for cascade delete."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.627Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found 1 work items by IDs (count: 1, isActive: true)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.627Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Found 1 active items in cascade list for deletion."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.627Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Attempting to soft delete item IDs in cascade: e8c1f2b7-82e1-48ea-a336-6da30d276984"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.627Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] Executing softDelete SQL: \n      UPDATE work_items\n      SET is_active = FALSE, updated_at = $1\n      WHERE work_item_id IN ($2) AND is_active = TRUE;\n     PARAMS: [\"2025-05-02T14:45:15.627Z\",\"e8c1f2b7-82e1-48ea-a336-6da30d276984\"]"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.628Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] softDelete result rowCount: 1"}
{"level":"INFO","time":"2025-05-02T14:45:15.628Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Soft deleted 1 work item(s)."}
{"level":"INFO","time":"2025-05-02T14:45:15.628Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Repository reported 1 work item(s) soft deleted."}
{"level":"INFO","time":"2025-05-02T14:45:15.628Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] No active dependency links found to soft delete within the cascade."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.629Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 892158a4-3d88-4c84-acc6-a512c5bd975d in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.631Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step aa0d4e83-875e-45da-b7f2-45ee4df04341 for action 892158a4-3d88-4c84-acc6-a512c5bd975d in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.632Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:15.632Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Recorded history for delete action 892158a4-3d88-4c84-acc6-a512c5bd975d."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.634Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Returning count: 1 (based on repository rowCount)"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.634Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.635Z","pid":118906,"hostname":"richard","msg":"BeforeEach setup complete. Initial items: item1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.635Z","pid":118906,"hostname":"richard","msg":"Initial actions: action1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.636Z","pid":118906,"hostname":"richard","msg":"Test: should redo the last undone action - Starting"}
{"level":"INFO","time":"2025-05-02T14:45:15.636Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to undo last action."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.636Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Found original action to undo: 892158a4-3d88-4c84-acc6-a512c5bd975d (DELETE_WORK_ITEM_CASCADE)"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.638Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Found 1 steps for action 892158a4-3d88-4c84-acc6-a512c5bd975d."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.638Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Executing 1 undo steps for action 892158a4-3d88-4c84-acc6-a512c5bd975d in reverse order"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.638Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Executing undo step 1 (UPDATE) on work_items record e8c1f2b7-82e1-48ea-a336-6da30d276984 for action 892158a4-3d88-4c84-acc6-a512c5bd975d"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.639Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryUndoRedo] Updated row in work_items e8c1f2b7-82e1-48ea-a336-6da30d276984 based on PKs."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.640Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action cc828b3f-6aa8-42d6-beb9-15809e97ce93 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.641Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked action 892158a4-3d88-4c84-acc6-a512c5bd975d as undone by action cc828b3f-6aa8-42d6-beb9-15809e97ce93."}
{"level":"INFO","time":"2025-05-02T14:45:15.641Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Successfully undid action 892158a4-3d88-4c84-acc6-a512c5bd975d"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.643Z","pid":118906,"hostname":"richard","msg":"Test: should redo the last undone action - After undoing delete (action 4)"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.643Z","pid":118906,"hostname":"richard","msg":"Test: should redo the last undone action - Fetching item 2 after undo"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.643Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: e8c1f2b7-82e1-48ea-a336-6da30d276984 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.644Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID e8c1f2b7-82e1-48ea-a336-6da30d276984 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.644Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item e8c1f2b7-82e1-48ea-a336-6da30d276984. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.644Z","pid":118906,"hostname":"richard","msg":"Test: should redo the last undone action - Fetched item 2 after undo:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.645Z","pid":118906,"hostname":"richard","msg":"Test: should redo the last undone action - Performing redo"}
{"level":"INFO","time":"2025-05-02T14:45:15.646Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to redo last undo action."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.648Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Found UNDO action to redo: cc828b3f-6aa8-42d6-beb9-15809e97ce93"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.650Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Found original action 892158a4-3d88-4c84-acc6-a512c5bd975d linked to UNDO action cc828b3f-6aa8-42d6-beb9-15809e97ce93."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.652Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Found 1 steps for action 892158a4-3d88-4c84-acc6-a512c5bd975d."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.653Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Re-executing 1 original steps (redo) for action 892158a4-3d88-4c84-acc6-a512c5bd975d"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.653Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Re-executing 1 (UPDATE) on work_items record e8c1f2b7-82e1-48ea-a336-6da30d276984 from original action 892158a4-3d88-4c84-acc6-a512c5bd975d"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.654Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryUndoRedo] Updated row in work_items e8c1f2b7-82e1-48ea-a336-6da30d276984 based on PKs."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.655Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 22ad5eb9-3a56-4a83-9915-7591333ee4e9 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.656Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked action 892158a4-3d88-4c84-acc6-a512c5bd975d as NOT undone (redone)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.657Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked UNDO_ACTION cc828b3f-6aa8-42d6-beb9-15809e97ce93 as redone/invalidated by action 22ad5eb9-3a56-4a83-9915-7591333ee4e9."}
{"level":"INFO","time":"2025-05-02T14:45:15.657Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Successfully redid action 892158a4-3d88-4c84-acc6-a512c5bd975d"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.660Z","pid":118906,"hostname":"richard","msg":"Test: should redo the last undone action - redoLastUndo result:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.661Z","pid":118906,"hostname":"richard","msg":"Test: should redo the last undone action - Fetching item 2 after redo"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.661Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: e8c1f2b7-82e1-48ea-a336-6da30d276984 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.663Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID e8c1f2b7-82e1-48ea-a336-6da30d276984 (isActive: false) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.663Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item e8c1f2b7-82e1-48ea-a336-6da30d276984. isActive: false"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.663Z","pid":118906,"hostname":"richard","msg":"Test: should redo the last undone action - Fetched item 2 after redo:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.663Z","pid":118906,"hostname":"richard","msg":"Test: should redo the last undone action - Fetching item 1 after redo"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.664Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 8c8546f0-694e-4d72-954b-54b2f7ae233d with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.665Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 8c8546f0-694e-4d72-954b-54b2f7ae233d (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.665Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 8c8546f0-694e-4d72-954b-54b2f7ae233d. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.665Z","pid":118906,"hostname":"richard","msg":"Test: should redo the last undone action - Fetched item 1 after redo:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.667Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 6 recent actions."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.670Z","pid":118906,"hostname":"richard","msg":"Test: should redo the last undone action - Finished"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.671Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Starting database clean up..."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.672Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating undo_steps CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.675Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating action_history CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.702Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating work_item_dependencies CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.703Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating work_items CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.714Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Database clean up committed."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.715Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Database client released."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.715Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item ee9a0158-3430-4505-bf5a-b7a5c626d67f"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.715Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Item 1\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.716Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:15.716Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: item-1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.716Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:15.716Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197115716"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.716Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item ee9a0158-3430-4505-bf5a-b7a5c626d67f within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:15.718Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item ee9a0158-3430-4505-bf5a-b7a5c626d67f with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.720Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action b733086e-a721-4a01-ad22-036edf436c52 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.723Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 396de942-4b80-4f57-a962-478eaaf04ba1 for action b733086e-a721-4a01-ad22-036edf436c52 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.724Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:15.724Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item ee9a0158-3430-4505-bf5a-b7a5c626d67f and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.728Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.728Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 7ec69580-1ee1-4185-96e7-689ea0248d80"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.729Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Item 2\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.731Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:15.731Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: item-2"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.731Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:15.731Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197115731"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.731Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 7ec69580-1ee1-4185-96e7-689ea0248d80 within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:15.732Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 7ec69580-1ee1-4185-96e7-689ea0248d80 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.733Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action fc837941-af17-4d0e-b9c7-89c2c0f84045 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.735Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 6806f35f-c6e4-48bb-b13d-446834f74cc8 for action fc837941-af17-4d0e-b9c7-89c2c0f84045 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.736Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:15.736Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 7ec69580-1ee1-4185-96e7-689ea0248d80 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.738Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.738Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService] Updating work item ee9a0158-3430-4505-bf5a-b7a5c626d67f with data:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.739Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: ee9a0158-3430-4505-bf5a-b7a5c626d67f with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.741Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID ee9a0158-3430-4505-bf5a-b7a5c626d67f (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.741Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item ee9a0158-3430-4505-bf5a-b7a5c626d67f. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.743Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item ee9a0158-3430-4505-bf5a-b7a5c626d67f (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.743Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps Before Update for ee9a0158-3430-4505-bf5a-b7a5c626d67f:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.743Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Item 1 Updated\", parentId: null, currentItemId: ee9a0158-3430-4505-bf5a-b7a5c626d67f"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.744Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:15.744Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: item-1-updated"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.744Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Desired Deps State for ee9a0158-3430-4505-bf5a-b7a5c626d67f:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.744Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updating work item ee9a0158-3430-4505-bf5a-b7a5c626d67f in transaction"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.746Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updated work item ee9a0158-3430-4505-bf5a-b7a5c626d67f fields. Row count: 1"}
{"level":"INFO","time":"2025-05-02T14:45:15.746Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Successfully processed update for item ee9a0158-3430-4505-bf5a-b7a5c626d67f."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.746Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: ee9a0158-3430-4505-bf5a-b7a5c626d67f with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.748Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID ee9a0158-3430-4505-bf5a-b7a5c626d67f (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.748Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item ee9a0158-3430-4505-bf5a-b7a5c626d67f. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.750Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item ee9a0158-3430-4505-bf5a-b7a5c626d67f (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.750Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps After Update Repo Call for ee9a0158-3430-4505-bf5a-b7a5c626d67f:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.750Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Item fields changed for ee9a0158-3430-4505-bf5a-b7a5c626d67f."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.750Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Effective changes detected for ee9a0158-3430-4505-bf5a-b7a5c626d67f. Generating history."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.751Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 76d7069b-8f7d-4b54-ae6a-ef721a58cdda in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.753Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 139007b4-81af-4769-8232-71d60b63dd16 for action 76d7069b-8f7d-4b54-ae6a-ef721a58cdda in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.754Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:15.754Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService] Recorded history for update of work item ee9a0158-3430-4505-bf5a-b7a5c626d67f."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.756Z","pid":118906,"hostname":"richard","msg":"[WorkItemReadingService] Getting work item by ID: ee9a0158-3430-4505-bf5a-b7a5c626d67f with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.756Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: ee9a0158-3430-4505-bf5a-b7a5c626d67f with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.757Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID ee9a0158-3430-4505-bf5a-b7a5c626d67f (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.757Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item ee9a0158-3430-4505-bf5a-b7a5c626d67f. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.757Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: ee9a0158-3430-4505-bf5a-b7a5c626d67f with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.757Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.758Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item ee9a0158-3430-4505-bf5a-b7a5c626d67f (link active: true, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.759Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent ee9a0158-3430-4505-bf5a-b7a5c626d67f (active: true, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.759Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent ee9a0158-3430-4505-bf5a-b7a5c626d67f (active: true, status: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.759Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item ee9a0158-3430-4505-bf5a-b7a5c626d67f (link active: true, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.760Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"WARN","time":"2025-05-02T14:45:15.760Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Attempting to soft delete 1 work item(s) and cascade: 7ec69580-1ee1-4185-96e7-689ea0248d80"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.760Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Finding all descendants..."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.760Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: 7ec69580-1ee1-4185-96e7-689ea0248d80 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.760Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.761Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent 7ec69580-1ee1-4185-96e7-689ea0248d80 (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.761Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent 7ec69580-1ee1-4185-96e7-689ea0248d80 (active: false, status: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.761Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Full cascade list (1 items) identified: 7ec69580-1ee1-4185-96e7-689ea0248d80"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.761Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item list (count: 1, link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.762Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item list (count: 1, link active: false, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.762Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Identified 0 potentially affected dependency links for cascade delete."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.763Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found 1 work items by IDs (count: 1, isActive: true)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.763Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Found 1 active items in cascade list for deletion."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.763Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Attempting to soft delete item IDs in cascade: 7ec69580-1ee1-4185-96e7-689ea0248d80"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.764Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] Executing softDelete SQL: \n      UPDATE work_items\n      SET is_active = FALSE, updated_at = $1\n      WHERE work_item_id IN ($2) AND is_active = TRUE;\n     PARAMS: [\"2025-05-02T14:45:15.763Z\",\"7ec69580-1ee1-4185-96e7-689ea0248d80\"]"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.764Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] softDelete result rowCount: 1"}
{"level":"INFO","time":"2025-05-02T14:45:15.764Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Soft deleted 1 work item(s)."}
{"level":"INFO","time":"2025-05-02T14:45:15.764Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Repository reported 1 work item(s) soft deleted."}
{"level":"INFO","time":"2025-05-02T14:45:15.764Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] No active dependency links found to soft delete within the cascade."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.765Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 97f82a63-ee16-49ae-a593-9b335b660775 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.766Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 9d5b8948-49ad-4c69-b026-47897f91c627 for action 97f82a63-ee16-49ae-a593-9b335b660775 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.767Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:15.767Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Recorded history for delete action 97f82a63-ee16-49ae-a593-9b335b660775."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.769Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Returning count: 1 (based on repository rowCount)"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.770Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.770Z","pid":118906,"hostname":"richard","msg":"BeforeEach setup complete. Initial items: item1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.770Z","pid":118906,"hostname":"richard","msg":"Initial actions: action1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.771Z","pid":118906,"hostname":"richard","msg":"Test: should redo multiple undone actions sequentially - Starting"}
{"level":"INFO","time":"2025-05-02T14:45:15.771Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to undo last action."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.772Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Found original action to undo: 97f82a63-ee16-49ae-a593-9b335b660775 (DELETE_WORK_ITEM_CASCADE)"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.773Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Found 1 steps for action 97f82a63-ee16-49ae-a593-9b335b660775."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.774Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Executing 1 undo steps for action 97f82a63-ee16-49ae-a593-9b335b660775 in reverse order"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.774Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Executing undo step 1 (UPDATE) on work_items record 7ec69580-1ee1-4185-96e7-689ea0248d80 for action 97f82a63-ee16-49ae-a593-9b335b660775"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.775Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryUndoRedo] Updated row in work_items 7ec69580-1ee1-4185-96e7-689ea0248d80 based on PKs."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.776Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action e5336dad-a54b-4a1e-b1b7-839f8b4e2576 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.777Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked action 97f82a63-ee16-49ae-a593-9b335b660775 as undone by action e5336dad-a54b-4a1e-b1b7-839f8b4e2576."}
{"level":"INFO","time":"2025-05-02T14:45:15.777Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Successfully undid action 97f82a63-ee16-49ae-a593-9b335b660775"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.779Z","pid":118906,"hostname":"richard","msg":"Test: should redo multiple undone actions sequentially - After 1st undo (delete action 4)"}
{"level":"INFO","time":"2025-05-02T14:45:15.779Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to undo last action."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.781Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Found original action to undo: 76d7069b-8f7d-4b54-ae6a-ef721a58cdda (UPDATE_WORK_ITEM)"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.782Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Found 1 steps for action 76d7069b-8f7d-4b54-ae6a-ef721a58cdda."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.783Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Executing 1 undo steps for action 76d7069b-8f7d-4b54-ae6a-ef721a58cdda in reverse order"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.783Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Executing undo step 1 (UPDATE) on work_items record ee9a0158-3430-4505-bf5a-b7a5c626d67f for action 76d7069b-8f7d-4b54-ae6a-ef721a58cdda"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.785Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryUndoRedo] Updated row in work_items ee9a0158-3430-4505-bf5a-b7a5c626d67f based on PKs."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.787Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 1a42bef7-5241-4943-8a76-ebb5be59022b in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.788Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked action 76d7069b-8f7d-4b54-ae6a-ef721a58cdda as undone by action 1a42bef7-5241-4943-8a76-ebb5be59022b."}
{"level":"INFO","time":"2025-05-02T14:45:15.788Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Successfully undid action 76d7069b-8f7d-4b54-ae6a-ef721a58cdda"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.792Z","pid":118906,"hostname":"richard","msg":"Test: should redo multiple undone actions sequentially - After 2nd undo (update action 3)"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.792Z","pid":118906,"hostname":"richard","msg":"Test: should redo multiple undone actions sequentially - Fetching items after undos"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.792Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: ee9a0158-3430-4505-bf5a-b7a5c626d67f with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.794Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID ee9a0158-3430-4505-bf5a-b7a5c626d67f (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.794Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item ee9a0158-3430-4505-bf5a-b7a5c626d67f. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.794Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 7ec69580-1ee1-4185-96e7-689ea0248d80 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.795Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 7ec69580-1ee1-4185-96e7-689ea0248d80 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.795Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 7ec69580-1ee1-4185-96e7-689ea0248d80. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.795Z","pid":118906,"hostname":"richard","msg":"Test: should redo multiple undone actions sequentially - Fetched item 1 after undos:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.795Z","pid":118906,"hostname":"richard","msg":"Test: should redo multiple undone actions sequentially - Fetched item 2 after undos:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.796Z","pid":118906,"hostname":"richard","msg":"Test: should redo multiple undone actions sequentially - Performing 1st redo (update action 3)"}
{"level":"INFO","time":"2025-05-02T14:45:15.796Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to redo last undo action."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.797Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Found UNDO action to redo: 1a42bef7-5241-4943-8a76-ebb5be59022b"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.797Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Found original action 76d7069b-8f7d-4b54-ae6a-ef721a58cdda linked to UNDO action 1a42bef7-5241-4943-8a76-ebb5be59022b."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.799Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Found 1 steps for action 76d7069b-8f7d-4b54-ae6a-ef721a58cdda."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.799Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Re-executing 1 original steps (redo) for action 76d7069b-8f7d-4b54-ae6a-ef721a58cdda"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.800Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Re-executing 1 (UPDATE) on work_items record ee9a0158-3430-4505-bf5a-b7a5c626d67f from original action 76d7069b-8f7d-4b54-ae6a-ef721a58cdda"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.800Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryUndoRedo] Updated row in work_items ee9a0158-3430-4505-bf5a-b7a5c626d67f based on PKs."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.801Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 1468d65e-ec41-47ac-824f-af12f73c1148 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.802Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked action 76d7069b-8f7d-4b54-ae6a-ef721a58cdda as NOT undone (redone)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.803Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked UNDO_ACTION 1a42bef7-5241-4943-8a76-ebb5be59022b as redone/invalidated by action 1468d65e-ec41-47ac-824f-af12f73c1148."}
{"level":"INFO","time":"2025-05-02T14:45:15.803Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Successfully redid action 76d7069b-8f7d-4b54-ae6a-ef721a58cdda"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.806Z","pid":118906,"hostname":"richard","msg":"Test: should redo multiple undone actions sequentially - 1st redo (update) result:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.806Z","pid":118906,"hostname":"richard","msg":"Test: should redo multiple undone actions sequentially - Fetching items after 1st redo"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.806Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: ee9a0158-3430-4505-bf5a-b7a5c626d67f with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.807Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID ee9a0158-3430-4505-bf5a-b7a5c626d67f (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.807Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item ee9a0158-3430-4505-bf5a-b7a5c626d67f. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.807Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 7ec69580-1ee1-4185-96e7-689ea0248d80 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.808Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 7ec69580-1ee1-4185-96e7-689ea0248d80 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.808Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 7ec69580-1ee1-4185-96e7-689ea0248d80. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.808Z","pid":118906,"hostname":"richard","msg":"Test: should redo multiple actions sequentially - Fetched item 1 after 1st redo:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.808Z","pid":118906,"hostname":"richard","msg":"Test: should redo multiple actions sequentially - Fetched item 2 after 1st redo:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.809Z","pid":118906,"hostname":"richard","msg":"Test: should redo multiple undone actions sequentially - Performing 2nd redo (delete action 4)"}
{"level":"INFO","time":"2025-05-02T14:45:15.809Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to redo last undo action."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.810Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Found UNDO action to redo: e5336dad-a54b-4a1e-b1b7-839f8b4e2576"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.811Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Found original action 97f82a63-ee16-49ae-a593-9b335b660775 linked to UNDO action e5336dad-a54b-4a1e-b1b7-839f8b4e2576."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.813Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Found 1 steps for action 97f82a63-ee16-49ae-a593-9b335b660775."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.813Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Re-executing 1 original steps (redo) for action 97f82a63-ee16-49ae-a593-9b335b660775"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.814Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Re-executing 1 (UPDATE) on work_items record 7ec69580-1ee1-4185-96e7-689ea0248d80 from original action 97f82a63-ee16-49ae-a593-9b335b660775"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.814Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryUndoRedo] Updated row in work_items 7ec69580-1ee1-4185-96e7-689ea0248d80 based on PKs."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.815Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action c81160d9-f6ac-4755-af5c-bc8d1f8a6470 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.816Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked action 97f82a63-ee16-49ae-a593-9b335b660775 as NOT undone (redone)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.817Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked UNDO_ACTION e5336dad-a54b-4a1e-b1b7-839f8b4e2576 as redone/invalidated by action c81160d9-f6ac-4755-af5c-bc8d1f8a6470."}
{"level":"INFO","time":"2025-05-02T14:45:15.817Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Successfully redid action 97f82a63-ee16-49ae-a593-9b335b660775"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.819Z","pid":118906,"hostname":"richard","msg":"Test: should redo multiple undone actions sequentially - 2nd redo (delete) result:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.820Z","pid":118906,"hostname":"richard","msg":"Test: should redo multiple undone actions sequentially - Fetching items after 2nd redo"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.820Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: ee9a0158-3430-4505-bf5a-b7a5c626d67f with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.820Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID ee9a0158-3430-4505-bf5a-b7a5c626d67f (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.820Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item ee9a0158-3430-4505-bf5a-b7a5c626d67f. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.820Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 7ec69580-1ee1-4185-96e7-689ea0248d80 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.821Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 7ec69580-1ee1-4185-96e7-689ea0248d80 (isActive: false) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.821Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 7ec69580-1ee1-4185-96e7-689ea0248d80. isActive: false"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.821Z","pid":118906,"hostname":"richard","msg":"Test: should redo multiple actions sequentially - Fetched item 1 after 2nd redo:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.821Z","pid":118906,"hostname":"richard","msg":"Test: should redo multiple actions sequentially - Fetched item 2 after 2nd redo:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.822Z","pid":118906,"hostname":"richard","msg":"Test: should redo multiple undone actions sequentially - Finished"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.823Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Starting database clean up..."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.824Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating undo_steps CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.825Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating action_history CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.836Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating work_item_dependencies CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.838Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating work_items CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.849Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Database clean up committed."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.849Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Database client released."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.849Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item aa2f3d7c-98b4-4315-a548-b565c2673bbb"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.850Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Item 1\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.851Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:15.851Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: item-1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.851Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:15.851Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197115851"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.851Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item aa2f3d7c-98b4-4315-a548-b565c2673bbb within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:15.852Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item aa2f3d7c-98b4-4315-a548-b565c2673bbb with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.854Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 674e0742-b1c2-4163-aa78-e71858a8b7c7 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.855Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step df44a610-eafc-4359-bd2f-3d1b2aa0c9a1 for action 674e0742-b1c2-4163-aa78-e71858a8b7c7 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.856Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:15.856Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item aa2f3d7c-98b4-4315-a548-b565c2673bbb and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.858Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.858Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item e58aad6c-a07a-4179-a110-2d283794fbbe"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.858Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Item 2\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.859Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:15.860Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: item-2"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.860Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:15.860Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197115860"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.860Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item e58aad6c-a07a-4179-a110-2d283794fbbe within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:15.862Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item e58aad6c-a07a-4179-a110-2d283794fbbe with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.863Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 21d3c266-abfe-459e-8ed2-54fa40140eb1 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.865Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 882a9499-7e32-45bf-b39b-f48260503d5e for action 21d3c266-abfe-459e-8ed2-54fa40140eb1 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.866Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:15.866Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item e58aad6c-a07a-4179-a110-2d283794fbbe and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.869Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.869Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService] Updating work item aa2f3d7c-98b4-4315-a548-b565c2673bbb with data:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.871Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: aa2f3d7c-98b4-4315-a548-b565c2673bbb with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.872Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID aa2f3d7c-98b4-4315-a548-b565c2673bbb (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.872Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item aa2f3d7c-98b4-4315-a548-b565c2673bbb. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.874Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item aa2f3d7c-98b4-4315-a548-b565c2673bbb (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.874Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps Before Update for aa2f3d7c-98b4-4315-a548-b565c2673bbb:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.874Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Item 1 Updated\", parentId: null, currentItemId: aa2f3d7c-98b4-4315-a548-b565c2673bbb"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.875Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:15.875Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: item-1-updated"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.875Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Desired Deps State for aa2f3d7c-98b4-4315-a548-b565c2673bbb:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.875Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updating work item aa2f3d7c-98b4-4315-a548-b565c2673bbb in transaction"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.877Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updated work item aa2f3d7c-98b4-4315-a548-b565c2673bbb fields. Row count: 1"}
{"level":"INFO","time":"2025-05-02T14:45:15.877Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Successfully processed update for item aa2f3d7c-98b4-4315-a548-b565c2673bbb."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.877Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: aa2f3d7c-98b4-4315-a548-b565c2673bbb with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.878Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID aa2f3d7c-98b4-4315-a548-b565c2673bbb (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.879Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item aa2f3d7c-98b4-4315-a548-b565c2673bbb. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.880Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item aa2f3d7c-98b4-4315-a548-b565c2673bbb (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.880Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps After Update Repo Call for aa2f3d7c-98b4-4315-a548-b565c2673bbb:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.880Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Item fields changed for aa2f3d7c-98b4-4315-a548-b565c2673bbb."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.880Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Effective changes detected for aa2f3d7c-98b4-4315-a548-b565c2673bbb. Generating history."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.881Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action c08ebad0-386a-4dcc-9e41-2ada8a550435 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.883Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 7a3281e9-4688-466e-83e2-ac02a1f159cb for action c08ebad0-386a-4dcc-9e41-2ada8a550435 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.884Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:15.884Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService] Recorded history for update of work item aa2f3d7c-98b4-4315-a548-b565c2673bbb."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.886Z","pid":118906,"hostname":"richard","msg":"[WorkItemReadingService] Getting work item by ID: aa2f3d7c-98b4-4315-a548-b565c2673bbb with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.886Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: aa2f3d7c-98b4-4315-a548-b565c2673bbb with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.888Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID aa2f3d7c-98b4-4315-a548-b565c2673bbb (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.888Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item aa2f3d7c-98b4-4315-a548-b565c2673bbb. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.888Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: aa2f3d7c-98b4-4315-a548-b565c2673bbb with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.888Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.889Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item aa2f3d7c-98b4-4315-a548-b565c2673bbb (link active: true, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.890Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item aa2f3d7c-98b4-4315-a548-b565c2673bbb (link active: true, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.891Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent aa2f3d7c-98b4-4315-a548-b565c2673bbb (active: true, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.891Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent aa2f3d7c-98b4-4315-a548-b565c2673bbb (active: true, status: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.893Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"WARN","time":"2025-05-02T14:45:15.893Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Attempting to soft delete 1 work item(s) and cascade: e58aad6c-a07a-4179-a110-2d283794fbbe"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.894Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Finding all descendants..."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.894Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: e58aad6c-a07a-4179-a110-2d283794fbbe with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.894Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.896Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent e58aad6c-a07a-4179-a110-2d283794fbbe (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.896Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent e58aad6c-a07a-4179-a110-2d283794fbbe (active: false, status: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.896Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Full cascade list (1 items) identified: e58aad6c-a07a-4179-a110-2d283794fbbe"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.897Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item list (count: 1, link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.897Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item list (count: 1, link active: false, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.897Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Identified 0 potentially affected dependency links for cascade delete."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.898Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found 1 work items by IDs (count: 1, isActive: true)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.898Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Found 1 active items in cascade list for deletion."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.898Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Attempting to soft delete item IDs in cascade: e58aad6c-a07a-4179-a110-2d283794fbbe"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.899Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] Executing softDelete SQL: \n      UPDATE work_items\n      SET is_active = FALSE, updated_at = $1\n      WHERE work_item_id IN ($2) AND is_active = TRUE;\n     PARAMS: [\"2025-05-02T14:45:15.898Z\",\"e58aad6c-a07a-4179-a110-2d283794fbbe\"]"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.899Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] softDelete result rowCount: 1"}
{"level":"INFO","time":"2025-05-02T14:45:15.899Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Soft deleted 1 work item(s)."}
{"level":"INFO","time":"2025-05-02T14:45:15.899Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Repository reported 1 work item(s) soft deleted."}
{"level":"INFO","time":"2025-05-02T14:45:15.899Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] No active dependency links found to soft delete within the cascade."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.900Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 3603e7f8-b0e2-43fb-8180-e670029127a0 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.901Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 8ab05def-d870-41dd-894f-f991ffa6b06f for action 3603e7f8-b0e2-43fb-8180-e670029127a0 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.902Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:15.902Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Recorded history for delete action 3603e7f8-b0e2-43fb-8180-e670029127a0."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.904Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Returning count: 1 (based on repository rowCount)"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.904Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.905Z","pid":118906,"hostname":"richard","msg":"BeforeEach setup complete. Initial items: item1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.905Z","pid":118906,"hostname":"richard","msg":"Initial actions: action1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.905Z","pid":118906,"hostname":"richard","msg":"Test: should return null if no action to undo - Starting"}
{"level":"INFO","time":"2025-05-02T14:45:15.905Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to undo last action."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.906Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Found original action to undo: 3603e7f8-b0e2-43fb-8180-e670029127a0 (DELETE_WORK_ITEM_CASCADE)"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.907Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Found 1 steps for action 3603e7f8-b0e2-43fb-8180-e670029127a0."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.907Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Executing 1 undo steps for action 3603e7f8-b0e2-43fb-8180-e670029127a0 in reverse order"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.907Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Executing undo step 1 (UPDATE) on work_items record e58aad6c-a07a-4179-a110-2d283794fbbe for action 3603e7f8-b0e2-43fb-8180-e670029127a0"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.908Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryUndoRedo] Updated row in work_items e58aad6c-a07a-4179-a110-2d283794fbbe based on PKs."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.909Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 1cff5bb3-550d-47aa-9451-56ae5c4340a6 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.909Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked action 3603e7f8-b0e2-43fb-8180-e670029127a0 as undone by action 1cff5bb3-550d-47aa-9451-56ae5c4340a6."}
{"level":"INFO","time":"2025-05-02T14:45:15.910Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Successfully undid action 3603e7f8-b0e2-43fb-8180-e670029127a0"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.912Z","pid":118906,"hostname":"richard","msg":"Test: should return null if no action to undo - 1st undo result:"}
{"level":"INFO","time":"2025-05-02T14:45:15.912Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to undo last action."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.912Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Found original action to undo: c08ebad0-386a-4dcc-9e41-2ada8a550435 (UPDATE_WORK_ITEM)"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.913Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Found 1 steps for action c08ebad0-386a-4dcc-9e41-2ada8a550435."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.913Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Executing 1 undo steps for action c08ebad0-386a-4dcc-9e41-2ada8a550435 in reverse order"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.913Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Executing undo step 1 (UPDATE) on work_items record aa2f3d7c-98b4-4315-a548-b565c2673bbb for action c08ebad0-386a-4dcc-9e41-2ada8a550435"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.914Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryUndoRedo] Updated row in work_items aa2f3d7c-98b4-4315-a548-b565c2673bbb based on PKs."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.915Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action e13bd81a-986b-4e4d-9303-98661ee491be in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.916Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked action c08ebad0-386a-4dcc-9e41-2ada8a550435 as undone by action e13bd81a-986b-4e4d-9303-98661ee491be."}
{"level":"INFO","time":"2025-05-02T14:45:15.916Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Successfully undid action c08ebad0-386a-4dcc-9e41-2ada8a550435"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.919Z","pid":118906,"hostname":"richard","msg":"Test: should return null if no action to undo - 2nd undo result:"}
{"level":"INFO","time":"2025-05-02T14:45:15.919Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to undo last action."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.921Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Found original action to undo: 21d3c266-abfe-459e-8ed2-54fa40140eb1 (ADD_WORK_ITEM)"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.922Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Found 1 steps for action 21d3c266-abfe-459e-8ed2-54fa40140eb1."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.922Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Executing 1 undo steps for action 21d3c266-abfe-459e-8ed2-54fa40140eb1 in reverse order"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.922Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Executing undo step 1 (UPDATE) on work_items record e58aad6c-a07a-4179-a110-2d283794fbbe for action 21d3c266-abfe-459e-8ed2-54fa40140eb1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.924Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryUndoRedo] Updated row in work_items e58aad6c-a07a-4179-a110-2d283794fbbe based on PKs."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.925Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 86a066be-2dfd-4c85-8f31-5553bb303d4c in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.926Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked action 21d3c266-abfe-459e-8ed2-54fa40140eb1 as undone by action 86a066be-2dfd-4c85-8f31-5553bb303d4c."}
{"level":"INFO","time":"2025-05-02T14:45:15.926Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Successfully undid action 21d3c266-abfe-459e-8ed2-54fa40140eb1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.929Z","pid":118906,"hostname":"richard","msg":"Test: should return null if no action to undo - 3rd undo result:"}
{"level":"INFO","time":"2025-05-02T14:45:15.929Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to undo last action."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.930Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Found original action to undo: 674e0742-b1c2-4163-aa78-e71858a8b7c7 (ADD_WORK_ITEM)"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.931Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Found 1 steps for action 674e0742-b1c2-4163-aa78-e71858a8b7c7."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.932Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Executing 1 undo steps for action 674e0742-b1c2-4163-aa78-e71858a8b7c7 in reverse order"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.932Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Executing undo step 1 (UPDATE) on work_items record aa2f3d7c-98b4-4315-a548-b565c2673bbb for action 674e0742-b1c2-4163-aa78-e71858a8b7c7"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.932Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryUndoRedo] Updated row in work_items aa2f3d7c-98b4-4315-a548-b565c2673bbb based on PKs."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.933Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 5d9a431f-bb0d-4ad4-be9a-a27c5feba763 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.934Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked action 674e0742-b1c2-4163-aa78-e71858a8b7c7 as undone by action 5d9a431f-bb0d-4ad4-be9a-a27c5feba763."}
{"level":"INFO","time":"2025-05-02T14:45:15.934Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Successfully undid action 674e0742-b1c2-4163-aa78-e71858a8b7c7"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.937Z","pid":118906,"hostname":"richard","msg":"Test: should return null if no action to undo - 4th undo result:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.937Z","pid":118906,"hostname":"richard","msg":"Test: should return null if no action to undo - Attempting 5th undo"}
{"level":"INFO","time":"2025-05-02T14:45:15.937Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to undo last action."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.938Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] No un-undone original actions found."}
{"level":"INFO","time":"2025-05-02T14:45:15.938Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] No original action found to undo."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.938Z","pid":118906,"hostname":"richard","msg":"Test: should return null if no action to undo - 5th undo result:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.938Z","pid":118906,"hostname":"richard","msg":"Test: should return null if no action to undo - Fetching items after all undos"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.938Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: aa2f3d7c-98b4-4315-a548-b565c2673bbb with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.939Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID aa2f3d7c-98b4-4315-a548-b565c2673bbb (isActive: false) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.939Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item aa2f3d7c-98b4-4315-a548-b565c2673bbb. isActive: false"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.939Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: e58aad6c-a07a-4179-a110-2d283794fbbe with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.940Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID e58aad6c-a07a-4179-a110-2d283794fbbe (isActive: false) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.940Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item e58aad6c-a07a-4179-a110-2d283794fbbe. isActive: false"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.940Z","pid":118906,"hostname":"richard","msg":"Test: should return null if no action to undo - Fetched item 1 after all undos (isActive: false):"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.940Z","pid":118906,"hostname":"richard","msg":"Test: should return null if no action to undo - Fetched item 2 after all undos (isActive: false):"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.940Z","pid":118906,"hostname":"richard","msg":"Test: should return null if no action to undo - Finished"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.941Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Starting database clean up..."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.942Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating undo_steps CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.945Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating action_history CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.958Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating work_item_dependencies CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.960Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating work_items CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.972Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Database clean up committed."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.972Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Database client released."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.972Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 09b88efb-2e12-4e15-baa6-481771f424a3"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.973Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Item 1\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.974Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:15.974Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: item-1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.974Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:15.974Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197115974"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.974Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 09b88efb-2e12-4e15-baa6-481771f424a3 within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:15.975Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 09b88efb-2e12-4e15-baa6-481771f424a3 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.976Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 2ad16271-2d34-40b6-b9cf-4661bfb19aff in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.977Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 1c73d70b-5603-43a0-9734-9775f71859f0 for action 2ad16271-2d34-40b6-b9cf-4661bfb19aff in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.978Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:15.978Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 09b88efb-2e12-4e15-baa6-481771f424a3 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.980Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.980Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item f1bbcdfe-86e2-4a00-a571-c609ad0b3fd3"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.980Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Item 2\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.981Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:15.981Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: item-2"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.981Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:15.981Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197115981"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.981Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item f1bbcdfe-86e2-4a00-a571-c609ad0b3fd3 within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:15.983Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item f1bbcdfe-86e2-4a00-a571-c609ad0b3fd3 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.984Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action b7aeee0b-7300-4140-978f-f7b8fa9e6a97 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.985Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 7c0b0fc9-00db-4f92-b660-1f71392a38e0 for action b7aeee0b-7300-4140-978f-f7b8fa9e6a97 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.986Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:15.986Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item f1bbcdfe-86e2-4a00-a571-c609ad0b3fd3 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.988Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.988Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService] Updating work item 09b88efb-2e12-4e15-baa6-481771f424a3 with data:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.989Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 09b88efb-2e12-4e15-baa6-481771f424a3 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.989Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 09b88efb-2e12-4e15-baa6-481771f424a3 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.989Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 09b88efb-2e12-4e15-baa6-481771f424a3. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.990Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item 09b88efb-2e12-4e15-baa6-481771f424a3 (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.990Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps Before Update for 09b88efb-2e12-4e15-baa6-481771f424a3:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.990Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Item 1 Updated\", parentId: null, currentItemId: 09b88efb-2e12-4e15-baa6-481771f424a3"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.990Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:15.990Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: item-1-updated"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.991Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Desired Deps State for 09b88efb-2e12-4e15-baa6-481771f424a3:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.991Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updating work item 09b88efb-2e12-4e15-baa6-481771f424a3 in transaction"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.991Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updated work item 09b88efb-2e12-4e15-baa6-481771f424a3 fields. Row count: 1"}
{"level":"INFO","time":"2025-05-02T14:45:15.991Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Successfully processed update for item 09b88efb-2e12-4e15-baa6-481771f424a3."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.991Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 09b88efb-2e12-4e15-baa6-481771f424a3 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.992Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 09b88efb-2e12-4e15-baa6-481771f424a3 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.992Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 09b88efb-2e12-4e15-baa6-481771f424a3. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.992Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item 09b88efb-2e12-4e15-baa6-481771f424a3 (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.992Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps After Update Repo Call for 09b88efb-2e12-4e15-baa6-481771f424a3:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.992Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Item fields changed for 09b88efb-2e12-4e15-baa6-481771f424a3."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.992Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Effective changes detected for 09b88efb-2e12-4e15-baa6-481771f424a3. Generating history."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.993Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action ee80fb88-faec-497d-ba4f-4c4ee7f71c17 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.994Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 23fe82f6-6f4e-48b3-87ef-aa546e4e1c9b for action ee80fb88-faec-497d-ba4f-4c4ee7f71c17 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.994Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:15.994Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService] Recorded history for update of work item 09b88efb-2e12-4e15-baa6-481771f424a3."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.996Z","pid":118906,"hostname":"richard","msg":"[WorkItemReadingService] Getting work item by ID: 09b88efb-2e12-4e15-baa6-481771f424a3 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.996Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 09b88efb-2e12-4e15-baa6-481771f424a3 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.996Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 09b88efb-2e12-4e15-baa6-481771f424a3 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.996Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 09b88efb-2e12-4e15-baa6-481771f424a3. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.996Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: 09b88efb-2e12-4e15-baa6-481771f424a3 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.996Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.997Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item 09b88efb-2e12-4e15-baa6-481771f424a3 (link active: true, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.998Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item 09b88efb-2e12-4e15-baa6-481771f424a3 (link active: true, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:15.999Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent 09b88efb-2e12-4e15-baa6-481771f424a3 (active: true, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T14:45:15.999Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent 09b88efb-2e12-4e15-baa6-481771f424a3 (active: true, status: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.000Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"WARN","time":"2025-05-02T14:45:16.000Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Attempting to soft delete 1 work item(s) and cascade: f1bbcdfe-86e2-4a00-a571-c609ad0b3fd3"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.001Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Finding all descendants..."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.001Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: f1bbcdfe-86e2-4a00-a571-c609ad0b3fd3 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.001Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.001Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent f1bbcdfe-86e2-4a00-a571-c609ad0b3fd3 (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.001Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent f1bbcdfe-86e2-4a00-a571-c609ad0b3fd3 (active: false, status: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.001Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Full cascade list (1 items) identified: f1bbcdfe-86e2-4a00-a571-c609ad0b3fd3"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.002Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item list (count: 1, link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.003Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item list (count: 1, link active: false, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.003Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Identified 0 potentially affected dependency links for cascade delete."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.003Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found 1 work items by IDs (count: 1, isActive: true)."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.003Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Found 1 active items in cascade list for deletion."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.003Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Attempting to soft delete item IDs in cascade: f1bbcdfe-86e2-4a00-a571-c609ad0b3fd3"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.003Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] Executing softDelete SQL: \n      UPDATE work_items\n      SET is_active = FALSE, updated_at = $1\n      WHERE work_item_id IN ($2) AND is_active = TRUE;\n     PARAMS: [\"2025-05-02T14:45:16.003Z\",\"f1bbcdfe-86e2-4a00-a571-c609ad0b3fd3\"]"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.004Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] softDelete result rowCount: 1"}
{"level":"INFO","time":"2025-05-02T14:45:16.004Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Soft deleted 1 work item(s)."}
{"level":"INFO","time":"2025-05-02T14:45:16.004Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Repository reported 1 work item(s) soft deleted."}
{"level":"INFO","time":"2025-05-02T14:45:16.004Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] No active dependency links found to soft delete within the cascade."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.004Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action fcf8d52b-a5fb-4b5f-9213-53637d46af90 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.005Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 30870ca7-5185-41d4-b2e0-678950745429 for action fcf8d52b-a5fb-4b5f-9213-53637d46af90 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.005Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:16.005Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Recorded history for delete action fcf8d52b-a5fb-4b5f-9213-53637d46af90."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.007Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Returning count: 1 (based on repository rowCount)"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.007Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.008Z","pid":118906,"hostname":"richard","msg":"BeforeEach setup complete. Initial items: item1"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.008Z","pid":118906,"hostname":"richard","msg":"Initial actions: action1"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.008Z","pid":118906,"hostname":"richard","msg":"Test: should return null if no action to redo - Starting"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.008Z","pid":118906,"hostname":"richard","msg":"Test: should return null if no action to redo - Attempting 1st redo"}
{"level":"INFO","time":"2025-05-02T14:45:16.008Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to redo last undo action."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.008Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] No un-redone UNDO_ACTIONs found."}
{"level":"INFO","time":"2025-05-02T14:45:16.008Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] No undo action found to redo."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.008Z","pid":118906,"hostname":"richard","msg":"Test: should return null if no action to redo - 1st redo result:"}
{"level":"INFO","time":"2025-05-02T14:45:16.009Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to undo last action."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.009Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Found original action to undo: fcf8d52b-a5fb-4b5f-9213-53637d46af90 (DELETE_WORK_ITEM_CASCADE)"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.010Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Found 1 steps for action fcf8d52b-a5fb-4b5f-9213-53637d46af90."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.010Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Executing 1 undo steps for action fcf8d52b-a5fb-4b5f-9213-53637d46af90 in reverse order"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.010Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Executing undo step 1 (UPDATE) on work_items record f1bbcdfe-86e2-4a00-a571-c609ad0b3fd3 for action fcf8d52b-a5fb-4b5f-9213-53637d46af90"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.011Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryUndoRedo] Updated row in work_items f1bbcdfe-86e2-4a00-a571-c609ad0b3fd3 based on PKs."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.011Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 0eead2ba-866c-4ee7-8836-375ac61f680d in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.012Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked action fcf8d52b-a5fb-4b5f-9213-53637d46af90 as undone by action 0eead2ba-866c-4ee7-8836-375ac61f680d."}
{"level":"INFO","time":"2025-05-02T14:45:16.012Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Successfully undid action fcf8d52b-a5fb-4b5f-9213-53637d46af90"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.014Z","pid":118906,"hostname":"richard","msg":"Test: should return null if no action to redo - After undoing delete item 2"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.014Z","pid":118906,"hostname":"richard","msg":"Test: should return null if no action to redo - Attempting 2nd redo"}
{"level":"INFO","time":"2025-05-02T14:45:16.014Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to redo last undo action."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.014Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Found UNDO action to redo: 0eead2ba-866c-4ee7-8836-375ac61f680d"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.015Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Found original action fcf8d52b-a5fb-4b5f-9213-53637d46af90 linked to UNDO action 0eead2ba-866c-4ee7-8836-375ac61f680d."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.016Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Found 1 steps for action fcf8d52b-a5fb-4b5f-9213-53637d46af90."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.016Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Re-executing 1 original steps (redo) for action fcf8d52b-a5fb-4b5f-9213-53637d46af90"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.016Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Re-executing 1 (UPDATE) on work_items record f1bbcdfe-86e2-4a00-a571-c609ad0b3fd3 from original action fcf8d52b-a5fb-4b5f-9213-53637d46af90"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.017Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryUndoRedo] Updated row in work_items f1bbcdfe-86e2-4a00-a571-c609ad0b3fd3 based on PKs."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.017Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 7ad5a612-ab0b-4ebe-96cb-e1776886041c in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.018Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked action fcf8d52b-a5fb-4b5f-9213-53637d46af90 as NOT undone (redone)."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.018Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked UNDO_ACTION 0eead2ba-866c-4ee7-8836-375ac61f680d as redone/invalidated by action 7ad5a612-ab0b-4ebe-96cb-e1776886041c."}
{"level":"INFO","time":"2025-05-02T14:45:16.018Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Successfully redid action fcf8d52b-a5fb-4b5f-9213-53637d46af90"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.020Z","pid":118906,"hostname":"richard","msg":"Test: should return null if no action to redo - After redoing delete item 2"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.020Z","pid":118906,"hostname":"richard","msg":"Test: should return null if no action to redo - Attempting 3rd redo"}
{"level":"INFO","time":"2025-05-02T14:45:16.020Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to redo last undo action."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.021Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] No un-redone UNDO_ACTIONs found."}
{"level":"INFO","time":"2025-05-02T14:45:16.021Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] No undo action found to redo."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.021Z","pid":118906,"hostname":"richard","msg":"Test: should return null if no action to redo - 3rd redo result:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.021Z","pid":118906,"hostname":"richard","msg":"Test: should return null if no action to redo - Fetching items at the end"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.021Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 09b88efb-2e12-4e15-baa6-481771f424a3 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.022Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 09b88efb-2e12-4e15-baa6-481771f424a3 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.022Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 09b88efb-2e12-4e15-baa6-481771f424a3. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.022Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: f1bbcdfe-86e2-4a00-a571-c609ad0b3fd3 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.022Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID f1bbcdfe-86e2-4a00-a571-c609ad0b3fd3 (isActive: false) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.022Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item f1bbcdfe-86e2-4a00-a571-c609ad0b3fd3. isActive: false"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.022Z","pid":118906,"hostname":"richard","msg":"Test: should return null if no action to redo - Fetched item 1 at end (isActive: true):"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.022Z","pid":118906,"hostname":"richard","msg":"Test: should return null if no action to redo - Fetched item 2 at end (isActive: false):"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.022Z","pid":118906,"hostname":"richard","msg":"Test: should return null if no action to redo - Finished"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.023Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Starting database clean up..."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.024Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating undo_steps CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.025Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating action_history CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.036Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating work_item_dependencies CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.038Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating work_items CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.056Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Database clean up committed."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.057Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Database client released."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.057Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item db1d4a36-0b36-485a-baf5-4a13ea85c294"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.057Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Item 1\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.058Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:16.058Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: item-1"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.058Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:16.058Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197116058"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.058Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item db1d4a36-0b36-485a-baf5-4a13ea85c294 within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:16.059Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item db1d4a36-0b36-485a-baf5-4a13ea85c294 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.060Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 45badebe-8042-4fbf-88cb-ddc16c137c81 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.061Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 331e35c3-7919-420b-850e-16092a591b17 for action 45badebe-8042-4fbf-88cb-ddc16c137c81 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.062Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:16.062Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item db1d4a36-0b36-485a-baf5-4a13ea85c294 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.063Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.064Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item db9820a7-5ac0-4c04-b347-0e082a7af688"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.064Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Item 2\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.064Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:16.064Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: item-2"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.064Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:16.064Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197116064"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.064Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item db9820a7-5ac0-4c04-b347-0e082a7af688 within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:16.065Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item db9820a7-5ac0-4c04-b347-0e082a7af688 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.065Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 2d0b98cc-8f6b-4b69-b39a-8643e20998c3 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.066Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 2898d754-b389-4b5f-bb1e-8a7aa4032639 for action 2d0b98cc-8f6b-4b69-b39a-8643e20998c3 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.066Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:16.066Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item db9820a7-5ac0-4c04-b347-0e082a7af688 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.068Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.068Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService] Updating work item db1d4a36-0b36-485a-baf5-4a13ea85c294 with data:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.068Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: db1d4a36-0b36-485a-baf5-4a13ea85c294 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.069Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID db1d4a36-0b36-485a-baf5-4a13ea85c294 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.069Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item db1d4a36-0b36-485a-baf5-4a13ea85c294. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.069Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item db1d4a36-0b36-485a-baf5-4a13ea85c294 (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.069Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps Before Update for db1d4a36-0b36-485a-baf5-4a13ea85c294:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.069Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Item 1 Updated\", parentId: null, currentItemId: db1d4a36-0b36-485a-baf5-4a13ea85c294"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.070Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:16.070Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: item-1-updated"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.070Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Desired Deps State for db1d4a36-0b36-485a-baf5-4a13ea85c294:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.070Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updating work item db1d4a36-0b36-485a-baf5-4a13ea85c294 in transaction"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.070Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updated work item db1d4a36-0b36-485a-baf5-4a13ea85c294 fields. Row count: 1"}
{"level":"INFO","time":"2025-05-02T14:45:16.070Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Successfully processed update for item db1d4a36-0b36-485a-baf5-4a13ea85c294."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.070Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: db1d4a36-0b36-485a-baf5-4a13ea85c294 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.071Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID db1d4a36-0b36-485a-baf5-4a13ea85c294 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.071Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item db1d4a36-0b36-485a-baf5-4a13ea85c294. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.071Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item db1d4a36-0b36-485a-baf5-4a13ea85c294 (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.071Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps After Update Repo Call for db1d4a36-0b36-485a-baf5-4a13ea85c294:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.071Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Item fields changed for db1d4a36-0b36-485a-baf5-4a13ea85c294."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.071Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Effective changes detected for db1d4a36-0b36-485a-baf5-4a13ea85c294. Generating history."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.072Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 3134b237-2e18-420e-9c4a-36449dd2375c in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.072Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 4fb18d5d-39c8-41d0-bd44-c9842ebaf797 for action 3134b237-2e18-420e-9c4a-36449dd2375c in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.072Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:16.072Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService] Recorded history for update of work item db1d4a36-0b36-485a-baf5-4a13ea85c294."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.074Z","pid":118906,"hostname":"richard","msg":"[WorkItemReadingService] Getting work item by ID: db1d4a36-0b36-485a-baf5-4a13ea85c294 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.074Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: db1d4a36-0b36-485a-baf5-4a13ea85c294 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.074Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID db1d4a36-0b36-485a-baf5-4a13ea85c294 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.074Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item db1d4a36-0b36-485a-baf5-4a13ea85c294. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.074Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: db1d4a36-0b36-485a-baf5-4a13ea85c294 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.074Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.074Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item db1d4a36-0b36-485a-baf5-4a13ea85c294 (link active: true, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.075Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent db1d4a36-0b36-485a-baf5-4a13ea85c294 (active: true, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.075Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent db1d4a36-0b36-485a-baf5-4a13ea85c294 (active: true, status: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.075Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item db1d4a36-0b36-485a-baf5-4a13ea85c294 (link active: true, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.076Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"WARN","time":"2025-05-02T14:45:16.076Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Attempting to soft delete 1 work item(s) and cascade: db9820a7-5ac0-4c04-b347-0e082a7af688"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.077Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Finding all descendants..."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.077Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: db9820a7-5ac0-4c04-b347-0e082a7af688 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.077Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.077Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent db9820a7-5ac0-4c04-b347-0e082a7af688 (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.077Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent db9820a7-5ac0-4c04-b347-0e082a7af688 (active: false, status: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.077Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Full cascade list (1 items) identified: db9820a7-5ac0-4c04-b347-0e082a7af688"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.078Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item list (count: 1, link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.078Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item list (count: 1, link active: false, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.078Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Identified 0 potentially affected dependency links for cascade delete."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.079Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found 1 work items by IDs (count: 1, isActive: true)."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.079Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Found 1 active items in cascade list for deletion."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.079Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Attempting to soft delete item IDs in cascade: db9820a7-5ac0-4c04-b347-0e082a7af688"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.079Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] Executing softDelete SQL: \n      UPDATE work_items\n      SET is_active = FALSE, updated_at = $1\n      WHERE work_item_id IN ($2) AND is_active = TRUE;\n     PARAMS: [\"2025-05-02T14:45:16.079Z\",\"db9820a7-5ac0-4c04-b347-0e082a7af688\"]"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.079Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] softDelete result rowCount: 1"}
{"level":"INFO","time":"2025-05-02T14:45:16.079Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Soft deleted 1 work item(s)."}
{"level":"INFO","time":"2025-05-02T14:45:16.079Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Repository reported 1 work item(s) soft deleted."}
{"level":"INFO","time":"2025-05-02T14:45:16.079Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] No active dependency links found to soft delete within the cascade."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.080Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 2ae15e0e-cd2d-48a0-acf2-0b2def6fd32b in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.082Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 5e437d4b-3f02-47d9-b66e-e4ba2265160a for action 2ae15e0e-cd2d-48a0-acf2-0b2def6fd32b in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.082Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:16.082Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Recorded history for delete action 2ae15e0e-cd2d-48a0-acf2-0b2def6fd32b."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.084Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Returning count: 1 (based on repository rowCount)"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.085Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.086Z","pid":118906,"hostname":"richard","msg":"BeforeEach setup complete. Initial items: item1"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.086Z","pid":118906,"hostname":"richard","msg":"Initial actions: action1"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.086Z","pid":118906,"hostname":"richard","msg":"Test: should return null if redo stack is cleared by a new action - Starting"}
{"level":"INFO","time":"2025-05-02T14:45:16.086Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to undo last action."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.087Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Found original action to undo: 2ae15e0e-cd2d-48a0-acf2-0b2def6fd32b (DELETE_WORK_ITEM_CASCADE)"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.088Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Found 1 steps for action 2ae15e0e-cd2d-48a0-acf2-0b2def6fd32b."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.089Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Executing 1 undo steps for action 2ae15e0e-cd2d-48a0-acf2-0b2def6fd32b in reverse order"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.089Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Executing undo step 1 (UPDATE) on work_items record db9820a7-5ac0-4c04-b347-0e082a7af688 for action 2ae15e0e-cd2d-48a0-acf2-0b2def6fd32b"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.090Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryUndoRedo] Updated row in work_items db9820a7-5ac0-4c04-b347-0e082a7af688 based on PKs."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.090Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action afff64c2-d11e-454e-9dbc-85c53a24bfd0 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.092Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked action 2ae15e0e-cd2d-48a0-acf2-0b2def6fd32b as undone by action afff64c2-d11e-454e-9dbc-85c53a24bfd0."}
{"level":"INFO","time":"2025-05-02T14:45:16.092Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Successfully undid action 2ae15e0e-cd2d-48a0-acf2-0b2def6fd32b"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.093Z","pid":118906,"hostname":"richard","msg":"Test: should return null if redo stack is cleared by a new action - After undoing delete item 2"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.093Z","pid":118906,"hostname":"richard","msg":"Test: should return null if redo stack is cleared by a new action - Performing new action (update item 1)"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.093Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService] Updating work item db1d4a36-0b36-485a-baf5-4a13ea85c294 with data:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.094Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: db1d4a36-0b36-485a-baf5-4a13ea85c294 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.094Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID db1d4a36-0b36-485a-baf5-4a13ea85c294 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.094Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item db1d4a36-0b36-485a-baf5-4a13ea85c294. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.095Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item db1d4a36-0b36-485a-baf5-4a13ea85c294 (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.095Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps Before Update for db1d4a36-0b36-485a-baf5-4a13ea85c294:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.095Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Desired Deps State for db1d4a36-0b36-485a-baf5-4a13ea85c294:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.095Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updating work item db1d4a36-0b36-485a-baf5-4a13ea85c294 in transaction"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.095Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updated work item db1d4a36-0b36-485a-baf5-4a13ea85c294 fields. Row count: 1"}
{"level":"INFO","time":"2025-05-02T14:45:16.095Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Successfully processed update for item db1d4a36-0b36-485a-baf5-4a13ea85c294."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.095Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: db1d4a36-0b36-485a-baf5-4a13ea85c294 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.096Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID db1d4a36-0b36-485a-baf5-4a13ea85c294 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.096Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item db1d4a36-0b36-485a-baf5-4a13ea85c294. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.096Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item db1d4a36-0b36-485a-baf5-4a13ea85c294 (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.096Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps After Update Repo Call for db1d4a36-0b36-485a-baf5-4a13ea85c294:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.096Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Item fields changed for db1d4a36-0b36-485a-baf5-4a13ea85c294."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.096Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Effective changes detected for db1d4a36-0b36-485a-baf5-4a13ea85c294. Generating history."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.097Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 521a6081-a23c-4522-9938-17afdb568040 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.097Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 5f037bdc-4617-4697-91cc-e02af359d862 for action 521a6081-a23c-4522-9938-17afdb568040 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.098Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.098Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked UNDO_ACTION afff64c2-d11e-454e-9dbc-85c53a24bfd0 as redone/invalidated by action 521a6081-a23c-4522-9938-17afdb568040."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.098Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Invalidated 1 potential redo(s) due to new action 521a6081-a23c-4522-9938-17afdb568040."}
{"level":"INFO","time":"2025-05-02T14:45:16.098Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService] Recorded history for update of work item db1d4a36-0b36-485a-baf5-4a13ea85c294."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.099Z","pid":118906,"hostname":"richard","msg":"[WorkItemReadingService] Getting work item by ID: db1d4a36-0b36-485a-baf5-4a13ea85c294 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.099Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: db1d4a36-0b36-485a-baf5-4a13ea85c294 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.100Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID db1d4a36-0b36-485a-baf5-4a13ea85c294 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.100Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item db1d4a36-0b36-485a-baf5-4a13ea85c294. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.100Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: db1d4a36-0b36-485a-baf5-4a13ea85c294 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.100Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.100Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item db1d4a36-0b36-485a-baf5-4a13ea85c294 (link active: true, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.101Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent db1d4a36-0b36-485a-baf5-4a13ea85c294 (active: true, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.101Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent db1d4a36-0b36-485a-baf5-4a13ea85c294 (active: true, status: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.101Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item db1d4a36-0b36-485a-baf5-4a13ea85c294 (link active: true, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.101Z","pid":118906,"hostname":"richard","msg":"Test: should return null if redo stack is cleared by a new action - After new action"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.101Z","pid":118906,"hostname":"richard","msg":"Test: should return null if redo stack is cleared by a new action - Attempting redo"}
{"level":"INFO","time":"2025-05-02T14:45:16.101Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to redo last undo action."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.101Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] No un-redone UNDO_ACTIONs found."}
{"level":"INFO","time":"2025-05-02T14:45:16.101Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] No undo action found to redo."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.101Z","pid":118906,"hostname":"richard","msg":"Test: should return null if redo stack is cleared by a new action - Redo result:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.102Z","pid":118906,"hostname":"richard","msg":"Test: should return null if redo stack is cleared by a new action - Fetching items at the end"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.102Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: db1d4a36-0b36-485a-baf5-4a13ea85c294 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.102Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID db1d4a36-0b36-485a-baf5-4a13ea85c294 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.102Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item db1d4a36-0b36-485a-baf5-4a13ea85c294. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.102Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: db9820a7-5ac0-4c04-b347-0e082a7af688 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.103Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID db9820a7-5ac0-4c04-b347-0e082a7af688 (isActive: false) executed. Rows found: 0"}
PASS dist/services/__tests__/workItemHistoryIntegration.test.js
{"level":"INFO","time":"2025-05-02T14:45:16.269Z","pid":118906,"hostname":"richard","msg":"Loading environment variable overrides for configuration..."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.103Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Work item db9820a7-5ac0-4c04-b347-0e082a7af688 not found or filtered out (isActive filter: false)."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.103Z","pid":118906,"hostname":"richard","msg":"Test: should return null if redo stack is cleared by a new action - Fetched item 1 at end (isActive: true):"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.103Z","pid":118906,"hostname":"richard","msg":"Test: should return null if redo stack is cleared by a new action - Fetched item 2 at end (isActive: false):"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.103Z","pid":118906,"hostname":"richard","msg":"Test: should return null if redo stack is cleared by a new action - Finished"}
{"level":"INFO","time":"2025-05-02T14:45:16.269Z","pid":118906,"hostname":"richard","msg":"Overriding pgHost from env: localhost"}
{"level":"INFO","time":"2025-05-02T14:45:16.270Z","pid":118906,"hostname":"richard","msg":"Overriding pgPort from env: 5432"}
{"level":"INFO","time":"2025-05-02T14:45:16.270Z","pid":118906,"hostname":"richard","msg":"Overriding pgUser from env: taskmanager_user"}
{"level":"INFO","time":"2025-05-02T14:45:16.270Z","pid":118906,"hostname":"richard","msg":"Overriding pgPassword from env."}
{"level":"INFO","time":"2025-05-02T14:45:16.270Z","pid":118906,"hostname":"richard","msg":"Overriding pgDatabase from env: taskmanager_db"}
{"level":"INFO","time":"2025-05-02T14:45:16.270Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] Setting up PostgreSQL connection pool..."}
{"level":"INFO","time":"2025-05-02T14:45:16.270Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] PostgreSQL connection pool configured."}
{"level":"INFO","time":"2025-05-02T14:45:16.270Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] Starting database schema initialization..."}
{"level":"INFO","time":"2025-05-02T14:45:16.292Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] Connected to PostgreSQL for schema check/application."}
{"level":"INFO","time":"2025-05-02T14:45:16.292Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] Force schema run enabled or tables missing. Initializing/Re-initializing schema..."}
{"level":"INFO","time":"2025-05-02T14:45:16.293Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] Looking for schema file at: /home/richard/repos/mcp-task-manager-server/dist/db/schema.sql"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.293Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] Schema file read successfully. Executing schema setup..."}
{"level":"INFO","time":"2025-05-02T14:45:16.323Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] Full schema script executed."}
{"level":"INFO","time":"2025-05-02T14:45:16.327Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] Confirmed work_items table exists after schema execution."}
{"level":"INFO","time":"2025-05-02T14:45:16.327Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] Initialization marked as complete."}
{"level":"INFO","time":"2025-05-02T14:45:16.327Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] Released schema check/application client."}
{"level":"INFO","time":"2025-05-02T14:45:16.327Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] Instance created and database initialized."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.329Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Starting database clean up..."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.330Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating undo_steps CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.331Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating action_history CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.341Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating work_item_dependencies CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.343Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating work_items CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.354Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Database clean up committed."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.354Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Database client released."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.354Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item b0d2877a-ecbf-4b3c-9261-4477621a1871"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.355Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Parent Project\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.360Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:16.360Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: parent-project"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.360Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:16.360Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197116360"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.361Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item b0d2877a-ecbf-4b3c-9261-4477621a1871 within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:16.365Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item b0d2877a-ecbf-4b3c-9261-4477621a1871 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.368Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action c6e42109-d68f-4875-a72e-f4a1dab3868d in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.372Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 301c7cf9-5d91-44c6-a33d-9be87bc76f7a for action c6e42109-d68f-4875-a72e-f4a1dab3868d in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.373Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:16.373Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item b0d2877a-ecbf-4b3c-9261-4477621a1871 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.378Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item d3c2f088-ec60-4e10-801a-77cff970c049"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.379Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Update Me\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.380Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:16.380Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: update-me"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.380Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:16.380Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197116380"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.380Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item d3c2f088-ec60-4e10-801a-77cff970c049 within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:16.382Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item d3c2f088-ec60-4e10-801a-77cff970c049 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.384Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 0469eb55-03a4-4a8d-aa8d-cbcef750dab6 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.385Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step d2b97d3b-872e-4a5b-b1f6-8a5b7159ac7f for action 0469eb55-03a4-4a8d-aa8d-cbcef750dab6 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.386Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:16.386Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item d3c2f088-ec60-4e10-801a-77cff970c049 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.388Z","pid":118906,"hostname":"richard","msg":"BeforeEach setup complete for WorkItemUpdateIntegration.test.ts"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.388Z","pid":118906,"hostname":"richard","msg":"Test: should update item basic fields - Starting"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.389Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService] Updating work item d3c2f088-ec60-4e10-801a-77cff970c049 with data:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.390Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: d3c2f088-ec60-4e10-801a-77cff970c049 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.392Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID d3c2f088-ec60-4e10-801a-77cff970c049 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.392Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item d3c2f088-ec60-4e10-801a-77cff970c049. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.393Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item d3c2f088-ec60-4e10-801a-77cff970c049 (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.393Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps Before Update for d3c2f088-ec60-4e10-801a-77cff970c049:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.393Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Updated Name\", parentId: null, currentItemId: d3c2f088-ec60-4e10-801a-77cff970c049"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.394Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:16.394Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: updated-name"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.394Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Desired Deps State for d3c2f088-ec60-4e10-801a-77cff970c049:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.395Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updating work item d3c2f088-ec60-4e10-801a-77cff970c049 in transaction"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.396Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updated work item d3c2f088-ec60-4e10-801a-77cff970c049 fields. Row count: 1"}
{"level":"INFO","time":"2025-05-02T14:45:16.396Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Successfully processed update for item d3c2f088-ec60-4e10-801a-77cff970c049."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.396Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: d3c2f088-ec60-4e10-801a-77cff970c049 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.397Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID d3c2f088-ec60-4e10-801a-77cff970c049 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.397Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item d3c2f088-ec60-4e10-801a-77cff970c049. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.398Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item d3c2f088-ec60-4e10-801a-77cff970c049 (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.398Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps After Update Repo Call for d3c2f088-ec60-4e10-801a-77cff970c049:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.398Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Item fields changed for d3c2f088-ec60-4e10-801a-77cff970c049."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.398Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Effective changes detected for d3c2f088-ec60-4e10-801a-77cff970c049. Generating history."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.399Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 1268ca09-2537-4be6-a917-5a184a1faf5a in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.400Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 58ce7f32-642b-40a2-9ea4-7db5e9dce4be for action 1268ca09-2537-4be6-a917-5a184a1faf5a in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.401Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:16.401Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService] Recorded history for update of work item d3c2f088-ec60-4e10-801a-77cff970c049."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.403Z","pid":118906,"hostname":"richard","msg":"[WorkItemReadingService] Getting work item by ID: d3c2f088-ec60-4e10-801a-77cff970c049 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.403Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: d3c2f088-ec60-4e10-801a-77cff970c049 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.405Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID d3c2f088-ec60-4e10-801a-77cff970c049 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.405Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item d3c2f088-ec60-4e10-801a-77cff970c049. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.405Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: d3c2f088-ec60-4e10-801a-77cff970c049 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.405Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.407Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item d3c2f088-ec60-4e10-801a-77cff970c049 (link active: true, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.424Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent d3c2f088-ec60-4e10-801a-77cff970c049 (active: true, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.424Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent d3c2f088-ec60-4e10-801a-77cff970c049 (active: true, status: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.425Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item d3c2f088-ec60-4e10-801a-77cff970c049 (link active: true, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.427Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: d3c2f088-ec60-4e10-801a-77cff970c049 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.428Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID d3c2f088-ec60-4e10-801a-77cff970c049 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.428Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item d3c2f088-ec60-4e10-801a-77cff970c049. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.428Z","pid":118906,"hostname":"richard","msg":"Test: should update item basic fields - Finished"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.430Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Starting database clean up..."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.430Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating undo_steps CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.433Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating action_history CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.451Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating work_item_dependencies CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.453Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating work_items CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.478Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Database clean up committed."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.478Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Database client released."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.478Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item fc3f0215-cd33-41dc-9e03-000d995e10fd"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.479Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Parent Project\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.481Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:16.481Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: parent-project"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.481Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:16.481Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197116481"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.481Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item fc3f0215-cd33-41dc-9e03-000d995e10fd within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:16.482Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item fc3f0215-cd33-41dc-9e03-000d995e10fd with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.484Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 241996a9-0510-46dd-ab0b-d10c33aa3358 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.485Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 571c9193-374b-4a8f-9245-5ef6d9eef9d1 for action 241996a9-0510-46dd-ab0b-d10c33aa3358 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.487Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:16.487Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item fc3f0215-cd33-41dc-9e03-000d995e10fd and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.489Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 20dc1261-322e-4929-befc-cb87a986677e"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.489Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Update Me\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.490Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:16.490Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: update-me"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.490Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:16.490Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197116490"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.490Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 20dc1261-322e-4929-befc-cb87a986677e within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:16.491Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 20dc1261-322e-4929-befc-cb87a986677e with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.492Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action b62adb7f-b567-4469-967a-edab7beb38fa in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.494Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 7be3502d-46c3-41e7-bbb9-dd4694cd2a70 for action b62adb7f-b567-4469-967a-edab7beb38fa in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.494Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:16.495Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 20dc1261-322e-4929-befc-cb87a986677e and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.496Z","pid":118906,"hostname":"richard","msg":"BeforeEach setup complete for WorkItemUpdateIntegration.test.ts"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.497Z","pid":118906,"hostname":"richard","msg":"Test: should update parent and recalculate related fields - Starting"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.497Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService] Updating work item 20dc1261-322e-4929-befc-cb87a986677e with data:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.497Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 20dc1261-322e-4929-befc-cb87a986677e with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.498Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 20dc1261-322e-4929-befc-cb87a986677e (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.498Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 20dc1261-322e-4929-befc-cb87a986677e. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.500Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item 20dc1261-322e-4929-befc-cb87a986677e (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.500Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps Before Update for 20dc1261-322e-4929-befc-cb87a986677e:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.500Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: fc3f0215-cd33-41dc-9e03-000d995e10fd with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.501Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID fc3f0215-cd33-41dc-9e03-000d995e10fd (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.501Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item fc3f0215-cd33-41dc-9e03-000d995e10fd. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.501Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Update Me\", parentId: fc3f0215-cd33-41dc-9e03-000d995e10fd, currentItemId: 20dc1261-322e-4929-befc-cb87a986677e"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.502Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 siblings for item 20dc1261-322e-4929-befc-cb87a986677e (parent: fc3f0215-cd33-41dc-9e03-000d995e10fd, active filter: false)."}
{"level":"INFO","time":"2025-05-02T14:45:16.502Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: update-me"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.502Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: fc3f0215-cd33-41dc-9e03-000d995e10fd, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:16.502Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197116502"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.502Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Desired Deps State for 20dc1261-322e-4929-befc-cb87a986677e:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.502Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updating work item 20dc1261-322e-4929-befc-cb87a986677e in transaction"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.503Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updated work item 20dc1261-322e-4929-befc-cb87a986677e fields. Row count: 1"}
{"level":"INFO","time":"2025-05-02T14:45:16.503Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Successfully processed update for item 20dc1261-322e-4929-befc-cb87a986677e."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.503Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 20dc1261-322e-4929-befc-cb87a986677e with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.504Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 20dc1261-322e-4929-befc-cb87a986677e (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.504Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 20dc1261-322e-4929-befc-cb87a986677e. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.505Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item 20dc1261-322e-4929-befc-cb87a986677e (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.505Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps After Update Repo Call for 20dc1261-322e-4929-befc-cb87a986677e:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.505Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Item fields changed for 20dc1261-322e-4929-befc-cb87a986677e."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.505Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Effective changes detected for 20dc1261-322e-4929-befc-cb87a986677e. Generating history."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.506Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 8aced0d6-81b1-4495-a716-af73123fa148 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.507Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step bb763718-6d57-4038-b186-e215046ad469 for action 8aced0d6-81b1-4495-a716-af73123fa148 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.508Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:16.508Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService] Recorded history for update of work item 20dc1261-322e-4929-befc-cb87a986677e."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.510Z","pid":118906,"hostname":"richard","msg":"[WorkItemReadingService] Getting work item by ID: 20dc1261-322e-4929-befc-cb87a986677e with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.510Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 20dc1261-322e-4929-befc-cb87a986677e with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.511Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 20dc1261-322e-4929-befc-cb87a986677e (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.511Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 20dc1261-322e-4929-befc-cb87a986677e. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.511Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: 20dc1261-322e-4929-befc-cb87a986677e with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.511Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.512Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item 20dc1261-322e-4929-befc-cb87a986677e (link active: true, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.513Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent 20dc1261-322e-4929-befc-cb87a986677e (active: true, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.513Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent 20dc1261-322e-4929-befc-cb87a986677e (active: true, status: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.513Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item 20dc1261-322e-4929-befc-cb87a986677e (link active: true, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.513Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 20dc1261-322e-4929-befc-cb87a986677e with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.514Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 20dc1261-322e-4929-befc-cb87a986677e (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.514Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 20dc1261-322e-4929-befc-cb87a986677e. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.514Z","pid":118906,"hostname":"richard","msg":"Test: should update parent and recalculate related fields - Finished"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.515Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Starting database clean up..."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.515Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating undo_steps CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.517Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating action_history CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.529Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating work_item_dependencies CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.532Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating work_items CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.550Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Database clean up committed."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.550Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Database client released."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.550Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 1d8586a3-c3d7-47e6-b5d3-1e35ac5d5afe"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.551Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Parent Project\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.553Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:16.553Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: parent-project"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.553Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:16.553Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197116553"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.553Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 1d8586a3-c3d7-47e6-b5d3-1e35ac5d5afe within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:16.554Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 1d8586a3-c3d7-47e6-b5d3-1e35ac5d5afe with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.555Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action d10aa0f0-ecb6-49c1-af4e-49b89a3bc7e0 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.557Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step f729dd8d-53d1-4040-8804-614262f324e3 for action d10aa0f0-ecb6-49c1-af4e-49b89a3bc7e0 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.558Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:16.558Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 1d8586a3-c3d7-47e6-b5d3-1e35ac5d5afe and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.560Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.561Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Update Me\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.562Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:16.562Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: update-me"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.562Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:16.562Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197116562"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.562Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023 within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:16.563Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.565Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 6cec64b2-a3dc-48fc-a09b-2f265ace0351 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.566Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 67b5654d-6ec4-495d-8167-dc4005f92ef4 for action 6cec64b2-a3dc-48fc-a09b-2f265ace0351 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.567Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:16.567Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.569Z","pid":118906,"hostname":"richard","msg":"BeforeEach setup complete for WorkItemUpdateIntegration.test.ts"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.569Z","pid":118906,"hostname":"richard","msg":"Test: should add, modify, and manage dependencies - Starting"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.570Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 31549524-bda1-4674-9c46-e58c4034ca30"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.570Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Dependency 1\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.571Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:16.571Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: dependency-1"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.571Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:16.571Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197116571"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.571Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 31549524-bda1-4674-9c46-e58c4034ca30 within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:16.572Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 31549524-bda1-4674-9c46-e58c4034ca30 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.573Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action bec36018-14c9-4c20-bdb1-a713b7b3167a in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.574Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step f61ae7cf-09f5-4a32-897b-e0af282c9e7b for action bec36018-14c9-4c20-bdb1-a713b7b3167a in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.575Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:16.575Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 31549524-bda1-4674-9c46-e58c4034ca30 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.577Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item db3368a2-332e-49ec-acf8-59d05b837235"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.577Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Dependency 2\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.578Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:16.579Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: dependency-2"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.579Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:16.579Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197116579"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.579Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item db3368a2-332e-49ec-acf8-59d05b837235 within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:16.580Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item db3368a2-332e-49ec-acf8-59d05b837235 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.581Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 143a746d-d0a1-4550-8725-fa32f07b1b42 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.581Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 5c2d91f8-17db-41ce-a592-399aafb2df08 for action 143a746d-d0a1-4550-8725-fa32f07b1b42 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.582Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:16.582Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item db3368a2-332e-49ec-acf8-59d05b837235 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.584Z","pid":118906,"hostname":"richard","msg":"Test: should add, modify, and manage dependencies - Created dep1:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.584Z","pid":118906,"hostname":"richard","msg":"Test: should add, modify, and manage dependencies - Adding initial dependency to dep1"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.584Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService] Updating work item f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023 with data:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.585Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.586Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.586Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.588Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023 (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.588Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps Before Update for f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.588Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Desired Deps State for f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.588Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updating work item f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023 in transaction"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.589Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] No core fields to update for f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.589Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updating dependencies for item f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023. Input dependencies:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.590Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] Found 0 existing dependencies (any state) for f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.590Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] Desired Deps State for f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.590Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] Dependencies actions for f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023: To Insert/Update:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.590Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Inserting/Updating 1 dependencies for f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.591Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Total inserted/updated dependencies for f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023: 1."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.591Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Finished updating dependencies for item f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023."}
{"level":"INFO","time":"2025-05-02T14:45:16.591Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Successfully processed update for item f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.591Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.592Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.592Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.593Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023 (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.593Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps After Update Repo Call for f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.593Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Item fields did NOT change for f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.593Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Checking dependency changes for f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023..."}
{"level":"INFO","time":"2025-05-02T14:45:16.593Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService] Update called for f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023, but no effective changes detected (Item: false, Deps: false). Skipping history."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.594Z","pid":118906,"hostname":"richard","msg":"[WorkItemReadingService] Getting work item by ID: f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.595Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.595Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.596Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.596Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.596Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.597Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 1 dependencies for item f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023 (link active: true, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.597Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023 (link active: true, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.598Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023 (active: true, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.598Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023 (active: true, status: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.598Z","pid":118906,"hostname":"richard","msg":"Test: should add, modify, and manage dependencies - Initial dependency added."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.598Z","pid":118906,"hostname":"richard","msg":"Test: should add, modify, and manage dependencies - Updating dependency to dep2"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.599Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService] Updating work item f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023 with data:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.600Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.601Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.601Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.603Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023 (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.603Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps Before Update for f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.603Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Desired Deps State for f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.603Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updating work item f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023 in transaction"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.604Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] No core fields to update for f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.604Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updating dependencies for item f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023. Input dependencies:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.605Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] Found 1 existing dependencies (any state) for f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.605Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] Desired Deps State for f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.605Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] Dependencies actions for f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023: To Insert/Update:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.605Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Deactivating 1 dependencies for f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.606Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Deactivated 1 dependencies for f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.606Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Inserting/Updating 1 dependencies for f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.608Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Total inserted/updated dependencies for f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023: 1."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.608Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Finished updating dependencies for item f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023."}
{"level":"INFO","time":"2025-05-02T14:45:16.608Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Successfully processed update for item f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.608Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.609Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.609Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.609Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 1 dependencies for item f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023 (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.610Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps After Update Repo Call for f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.610Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Item fields did NOT change for f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.610Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Checking dependency changes for f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023..."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.610Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Dependency f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023:31549524-bda1-4674-9c46-e58c4034ca30 ADDED/ACTIVATED."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.610Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Effective changes detected for f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023. Generating history."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.611Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 0268304a-be0c-44ab-9949-a0b011e52032 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.612Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 4c344051-d0c8-440d-adc6-be91d5b57990 for action 0268304a-be0c-44ab-9949-a0b011e52032 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.613Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:16.613Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService] Recorded history for update of work item f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.615Z","pid":118906,"hostname":"richard","msg":"[WorkItemReadingService] Getting work item by ID: f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.615Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.617Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.617Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.617Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.617Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.619Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 1 dependencies for item f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023 (link active: true, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.619Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023 (link active: true, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.619Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023 (active: true, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.619Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023 (active: true, status: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.619Z","pid":118906,"hostname":"richard","msg":"Test: should add, modify, and manage dependencies - Dependency updated to dep2. Result:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.619Z","pid":118906,"hostname":"richard","msg":"Test: should add, modify, and manage dependencies - Verifying dependencies in result object."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.620Z","pid":118906,"hostname":"richard","msg":"Test: should add, modify, and manage dependencies - Result object verification complete."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.620Z","pid":118906,"hostname":"richard","msg":"Test: should add, modify, and manage dependencies - Fetching all dependencies from DB."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.621Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 1 dependencies for item f4023cad-1afa-4d2d-bb0e-a8a0a8c6e023 (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.621Z","pid":118906,"hostname":"richard","msg":"Test: should add, modify, and manage dependencies - Fetched DB dependencies (isActive: false):"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.621Z","pid":118906,"hostname":"richard","msg":"Test: should add, modify, and manage dependencies - Filtered DB dependencies. Active:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.622Z","pid":118906,"hostname":"richard","msg":"Test: should add, modify, and manage dependencies - Finished"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.622Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Starting database clean up..."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.623Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating undo_steps CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.624Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating action_history CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.636Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating work_item_dependencies CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.637Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating work_items CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.650Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Database clean up committed."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.650Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Database client released."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.650Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 5f3b8c3a-12fb-41d5-8975-a26b725d3215"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.650Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Parent Project\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.652Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:16.652Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: parent-project"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.652Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:16.652Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197116652"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.652Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 5f3b8c3a-12fb-41d5-8975-a26b725d3215 within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:16.653Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 5f3b8c3a-12fb-41d5-8975-a26b725d3215 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.654Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action eef24aa5-bcfe-4fa8-bc8a-c15fd7c0f186 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.655Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 484bfc55-0d86-429e-bede-f10afc266915 for action eef24aa5-bcfe-4fa8-bc8a-c15fd7c0f186 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.655Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:16.655Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 5f3b8c3a-12fb-41d5-8975-a26b725d3215 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.657Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item c50033ae-cf5e-4644-bdb1-34b8f5131c88"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.658Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Update Me\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.658Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:16.658Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: update-me"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.658Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:16.658Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197116658"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.658Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item c50033ae-cf5e-4644-bdb1-34b8f5131c88 within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:16.659Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item c50033ae-cf5e-4644-bdb1-34b8f5131c88 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.660Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 15710335-7832-4b36-b3f1-4e55f6e88ac4 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.661Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 4eeb46d0-e4b1-4025-98c3-2e171fb6d3ab for action 15710335-7832-4b36-b3f1-4e55f6e88ac4 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.662Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:16.662Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item c50033ae-cf5e-4644-bdb1-34b8f5131c88 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.664Z","pid":118906,"hostname":"richard","msg":"BeforeEach setup complete for WorkItemUpdateIntegration.test.ts"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.664Z","pid":118906,"hostname":"richard","msg":"Test: should handle updates to non-existent parent - Starting"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.664Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService] Updating work item c50033ae-cf5e-4644-bdb1-34b8f5131c88 with data:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.665Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: c50033ae-cf5e-4644-bdb1-34b8f5131c88 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.666Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID c50033ae-cf5e-4644-bdb1-34b8f5131c88 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.666Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item c50033ae-cf5e-4644-bdb1-34b8f5131c88. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.667Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item c50033ae-cf5e-4644-bdb1-34b8f5131c88 (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.667Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps Before Update for c50033ae-cf5e-4644-bdb1-34b8f5131c88:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.667Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: f47ac10b-58cc-4372-a567-0e02b2c3d479 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.668Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID f47ac10b-58cc-4372-a567-0e02b2c3d479 (isActive: true) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.668Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Work item f47ac10b-58cc-4372-a567-0e02b2c3d479 not found or filtered out (isActive filter: true)."}
{"level":"ERROR","time":"2025-05-02T14:45:16.668Z","pid":118906,"hostname":"richard","err":{"type":"ValidationError","message":"New parent work item with ID f47ac10b-58cc-4372-a567-0e02b2c3d479 not found or is inactive.","stack":"ValidationError: New parent work item with ID f47ac10b-58cc-4372-a567-0e02b2c3d479 not found or is inactive.\n    at /home/richard/repos/mcp-task-manager-server/src/services/WorkItemUpdateService.ts:88:17\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at ActionHistoryRepository.withTransaction (/home/richard/repos/mcp-task-manager-server/src/repositories/ActionHistoryRepositoryBase.ts:107:22)\n    at WorkItemUpdateService.updateWorkItem (/home/richard/repos/mcp-task-manager-server/src/services/WorkItemUpdateService.ts:57:25)\n    at Object.<anonymous> (/home/richard/repos/mcp-task-manager-server/src/services/__tests__/workItemUpdateIntegration.test.ts:160:7)","name":"ValidationError"},"msg":"[ActionHistoryRepositoryBase.withTransaction] Transaction error, attempting rollback"}
{"level":"INFO","time":"2025-05-02T14:45:16.689Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryBase.withTransaction] Transaction rolled back successfully."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.689Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService] Updating work item c50033ae-cf5e-4644-bdb1-34b8f5131c88 with data:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.690Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: c50033ae-cf5e-4644-bdb1-34b8f5131c88 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.691Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID c50033ae-cf5e-4644-bdb1-34b8f5131c88 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.691Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item c50033ae-cf5e-4644-bdb1-34b8f5131c88. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.692Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item c50033ae-cf5e-4644-bdb1-34b8f5131c88 (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.692Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps Before Update for c50033ae-cf5e-4644-bdb1-34b8f5131c88:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.692Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: f47ac10b-58cc-4372-a567-0e02b2c3d479 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.693Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID f47ac10b-58cc-4372-a567-0e02b2c3d479 (isActive: true) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.693Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Work item f47ac10b-58cc-4372-a567-0e02b2c3d479 not found or filtered out (isActive filter: true)."}
{"level":"ERROR","time":"2025-05-02T14:45:16.693Z","pid":118906,"hostname":"richard","err":{"type":"ValidationError","message":"New parent work item with ID f47ac10b-58cc-4372-a567-0e02b2c3d479 not found or is inactive.","stack":"ValidationError: New parent work item with ID f47ac10b-58cc-4372-a567-0e02b2c3d479 not found or is inactive.\n    at /home/richard/repos/mcp-task-manager-server/src/services/WorkItemUpdateService.ts:88:17\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at ActionHistoryRepository.withTransaction (/home/richard/repos/mcp-task-manager-server/src/repositories/ActionHistoryRepositoryBase.ts:107:22)\n    at WorkItemUpdateService.updateWorkItem (/home/richard/repos/mcp-task-manager-server/src/services/WorkItemUpdateService.ts:57:25)\n    at Object.<anonymous> (/home/richard/repos/mcp-task-manager-server/src/services/__tests__/workItemUpdateIntegration.test.ts:165:7)","name":"ValidationError"},"msg":"[ActionHistoryRepositoryBase.withTransaction] Transaction error, attempting rollback"}
{"level":"INFO","time":"2025-05-02T14:45:16.694Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryBase.withTransaction] Transaction rolled back successfully."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.694Z","pid":118906,"hostname":"richard","msg":"Test: should handle updates to non-existent parent - Finished"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.695Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Starting database clean up..."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.696Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating undo_steps CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.699Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating action_history CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.711Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating work_item_dependencies CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.713Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating work_items CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.725Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Database clean up committed."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.726Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Database client released."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.726Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item dec2f2a9-e1f6-410f-871c-29c4b10aa291"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.727Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Parent Project\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.728Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:16.728Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: parent-project"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.728Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:16.728Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197116728"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.728Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item dec2f2a9-e1f6-410f-871c-29c4b10aa291 within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:16.729Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item dec2f2a9-e1f6-410f-871c-29c4b10aa291 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.731Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 2f7d1bbe-ba91-453f-80f4-fdf93912661b in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.732Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 54040a39-124d-4c80-ab28-c86bc36dd9d6 for action 2f7d1bbe-ba91-453f-80f4-fdf93912661b in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.733Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:16.733Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item dec2f2a9-e1f6-410f-871c-29c4b10aa291 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.735Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 7b2f0056-35e7-4750-8e3a-c602ad868ed7"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.735Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Update Me\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.736Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:16.736Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: update-me"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.736Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:16.736Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197116736"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.737Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 7b2f0056-35e7-4750-8e3a-c602ad868ed7 within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:16.737Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 7b2f0056-35e7-4750-8e3a-c602ad868ed7 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.738Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 9ec088b0-46ac-42e1-8ddc-466ef0dd949a in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.740Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step db6586a4-9070-4f80-884b-0002758a488f for action 9ec088b0-46ac-42e1-8ddc-466ef0dd949a in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.740Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:16.740Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 7b2f0056-35e7-4750-8e3a-c602ad868ed7 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.742Z","pid":118906,"hostname":"richard","msg":"BeforeEach setup complete for WorkItemUpdateIntegration.test.ts"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.743Z","pid":118906,"hostname":"richard","msg":"Test: should not create history for no-change updates - Starting"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.744Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 2 recent actions."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.744Z","pid":118906,"hostname":"richard","msg":"[WorkItemReadingService] Getting work item by ID: 7b2f0056-35e7-4750-8e3a-c602ad868ed7 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.744Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 7b2f0056-35e7-4750-8e3a-c602ad868ed7 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.745Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 7b2f0056-35e7-4750-8e3a-c602ad868ed7 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.745Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 7b2f0056-35e7-4750-8e3a-c602ad868ed7. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.745Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: 7b2f0056-35e7-4750-8e3a-c602ad868ed7 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.745Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.747Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item 7b2f0056-35e7-4750-8e3a-c602ad868ed7 (link active: true, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.747Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item 7b2f0056-35e7-4750-8e3a-c602ad868ed7 (link active: true, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.748Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent 7b2f0056-35e7-4750-8e3a-c602ad868ed7 (active: true, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.748Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent 7b2f0056-35e7-4750-8e3a-c602ad868ed7 (active: true, status: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.749Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService] Updating work item 7b2f0056-35e7-4750-8e3a-c602ad868ed7 with data:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.750Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 7b2f0056-35e7-4750-8e3a-c602ad868ed7 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.751Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 7b2f0056-35e7-4750-8e3a-c602ad868ed7 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.751Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 7b2f0056-35e7-4750-8e3a-c602ad868ed7. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.752Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item 7b2f0056-35e7-4750-8e3a-c602ad868ed7 (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.753Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps Before Update for 7b2f0056-35e7-4750-8e3a-c602ad868ed7:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.753Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Desired Deps State for 7b2f0056-35e7-4750-8e3a-c602ad868ed7:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.753Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updating work item 7b2f0056-35e7-4750-8e3a-c602ad868ed7 in transaction"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.753Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] No core fields to update for 7b2f0056-35e7-4750-8e3a-c602ad868ed7."}
{"level":"INFO","time":"2025-05-02T14:45:16.754Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Successfully processed update for item 7b2f0056-35e7-4750-8e3a-c602ad868ed7."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.754Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 7b2f0056-35e7-4750-8e3a-c602ad868ed7 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.754Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 7b2f0056-35e7-4750-8e3a-c602ad868ed7 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.754Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 7b2f0056-35e7-4750-8e3a-c602ad868ed7. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.755Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item 7b2f0056-35e7-4750-8e3a-c602ad868ed7 (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.755Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps After Update Repo Call for 7b2f0056-35e7-4750-8e3a-c602ad868ed7:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.755Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Item fields did NOT change for 7b2f0056-35e7-4750-8e3a-c602ad868ed7."}
{"level":"INFO","time":"2025-05-02T14:45:16.755Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService] Update called for 7b2f0056-35e7-4750-8e3a-c602ad868ed7, but no effective changes detected (Item: false, Deps: false). Skipping history."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.756Z","pid":118906,"hostname":"richard","msg":"[WorkItemReadingService] Getting work item by ID: 7b2f0056-35e7-4750-8e3a-c602ad868ed7 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.756Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 7b2f0056-35e7-4750-8e3a-c602ad868ed7 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.757Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 7b2f0056-35e7-4750-8e3a-c602ad868ed7 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.757Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 7b2f0056-35e7-4750-8e3a-c602ad868ed7. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.757Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: 7b2f0056-35e7-4750-8e3a-c602ad868ed7 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.757Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.758Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item 7b2f0056-35e7-4750-8e3a-c602ad868ed7 (link active: true, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.758Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item 7b2f0056-35e7-4750-8e3a-c602ad868ed7 (link active: true, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.758Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent 7b2f0056-35e7-4750-8e3a-c602ad868ed7 (active: true, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.758Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent 7b2f0056-35e7-4750-8e3a-c602ad868ed7 (active: true, status: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.761Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.762Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 2 recent actions."}
PASS dist/services/__tests__/workItemUpdateIntegration.test.js
{"level":"INFO","time":"2025-05-02T14:45:16.910Z","pid":118906,"hostname":"richard","msg":"Loading environment variable overrides for configuration..."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.763Z","pid":118906,"hostname":"richard","msg":"Test: should not create history for no-change updates - Finished"}
{"level":"INFO","time":"2025-05-02T14:45:16.910Z","pid":118906,"hostname":"richard","msg":"Overriding pgHost from env: localhost"}
{"level":"INFO","time":"2025-05-02T14:45:16.910Z","pid":118906,"hostname":"richard","msg":"Overriding pgPort from env: 5432"}
{"level":"INFO","time":"2025-05-02T14:45:16.910Z","pid":118906,"hostname":"richard","msg":"Overriding pgUser from env: taskmanager_user"}
{"level":"INFO","time":"2025-05-02T14:45:16.910Z","pid":118906,"hostname":"richard","msg":"Overriding pgPassword from env."}
{"level":"INFO","time":"2025-05-02T14:45:16.910Z","pid":118906,"hostname":"richard","msg":"Overriding pgDatabase from env: taskmanager_db"}
{"level":"INFO","time":"2025-05-02T14:45:16.910Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] Setting up PostgreSQL connection pool..."}
{"level":"INFO","time":"2025-05-02T14:45:16.911Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] PostgreSQL connection pool configured."}
{"level":"INFO","time":"2025-05-02T14:45:16.911Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] Starting database schema initialization..."}
{"level":"INFO","time":"2025-05-02T14:45:16.931Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] Connected to PostgreSQL for schema check/application."}
{"level":"INFO","time":"2025-05-02T14:45:16.931Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] Force schema run enabled or tables missing. Initializing/Re-initializing schema..."}
{"level":"INFO","time":"2025-05-02T14:45:16.931Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] Looking for schema file at: /home/richard/repos/mcp-task-manager-server/dist/db/schema.sql"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.931Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] Schema file read successfully. Executing schema setup..."}
{"level":"INFO","time":"2025-05-02T14:45:16.958Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] Full schema script executed."}
{"level":"INFO","time":"2025-05-02T14:45:16.966Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] Confirmed work_items table exists after schema execution."}
{"level":"INFO","time":"2025-05-02T14:45:16.966Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] Initialization marked as complete."}
{"level":"INFO","time":"2025-05-02T14:45:16.966Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] Released schema check/application client."}
{"level":"INFO","time":"2025-05-02T14:45:16.966Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] Instance created and database initialized."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.967Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Starting database clean up..."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.968Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating undo_steps CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.970Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating action_history CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.981Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating work_item_dependencies CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.983Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating work_items CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.996Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Database clean up committed."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.996Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Database client released."}
{"level":"DEBUG","time":"2025-05-02T14:45:16.996Z","pid":118906,"hostname":"richard","msg":"BeforeEach setup complete for WorkItemAddIntegration.test.ts"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.997Z","pid":118906,"hostname":"richard","msg":"Test: should add a root work item without dependencies - Starting"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.997Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 4df2342a-7ff7-4b53-a82d-914dd4e3e2ee"}
{"level":"DEBUG","time":"2025-05-02T14:45:16.999Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Root Project A\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.002Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:17.002Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: root-project-a"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.002Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:17.002Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197117002"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.003Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 4df2342a-7ff7-4b53-a82d-914dd4e3e2ee within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:17.005Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 4df2342a-7ff7-4b53-a82d-914dd4e3e2ee with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.007Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action a019592c-1f59-4178-93ab-b1d5884ceb5e in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.009Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step fc42666d-aa62-457b-bd83-c858ab5356cf for action a019592c-1f59-4178-93ab-b1d5884ceb5e in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.011Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:17.011Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 4df2342a-7ff7-4b53-a82d-914dd4e3e2ee and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.015Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 4df2342a-7ff7-4b53-a82d-914dd4e3e2ee with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.017Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 4df2342a-7ff7-4b53-a82d-914dd4e3e2ee (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.017Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 4df2342a-7ff7-4b53-a82d-914dd4e3e2ee. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.019Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.021Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Found 1 steps for action a019592c-1f59-4178-93ab-b1d5884ceb5e."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.022Z","pid":118906,"hostname":"richard","msg":"Test: should add a root work item without dependencies - Finished"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.024Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Starting database clean up..."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.024Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating undo_steps CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.026Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating action_history CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.037Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating work_item_dependencies CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.038Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating work_items CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.055Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Database clean up committed."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.055Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Database client released."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.055Z","pid":118906,"hostname":"richard","msg":"BeforeEach setup complete for WorkItemAddIntegration.test.ts"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.056Z","pid":118906,"hostname":"richard","msg":"Test: should add a child work item with a parent - Starting"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.056Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 6bcb478d-3b20-4fe0-8c4a-ac5ff82bffd5"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.057Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Parent Project\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.059Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:17.059Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: parent-project"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.059Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:17.059Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197117059"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.060Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 6bcb478d-3b20-4fe0-8c4a-ac5ff82bffd5 within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:17.062Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 6bcb478d-3b20-4fe0-8c4a-ac5ff82bffd5 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.064Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 5c878d8d-c535-4c6e-8fd5-7a70f67f8386 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.065Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 9d56a8b6-30b0-4b12-aa68-f1dff5b99532 for action 5c878d8d-c535-4c6e-8fd5-7a70f67f8386 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.066Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:17.066Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 6bcb478d-3b20-4fe0-8c4a-ac5ff82bffd5 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.069Z","pid":118906,"hostname":"richard","msg":"Test: should add a child work item with a parent - Created parent:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.069Z","pid":118906,"hostname":"richard","msg":"Test: should add a child work item with a parent - Adding child to parent"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.069Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 54481c0f-867d-4f11-84a8-967abe18deff"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.069Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 6bcb478d-3b20-4fe0-8c4a-ac5ff82bffd5 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.071Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 6bcb478d-3b20-4fe0-8c4a-ac5ff82bffd5 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.071Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 6bcb478d-3b20-4fe0-8c4a-ac5ff82bffd5. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.071Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Child Task\", parentId: 6bcb478d-3b20-4fe0-8c4a-ac5ff82bffd5, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.071Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: 6bcb478d-3b20-4fe0-8c4a-ac5ff82bffd5 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.071Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.072Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent 6bcb478d-3b20-4fe0-8c4a-ac5ff82bffd5 (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.072Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent 6bcb478d-3b20-4fe0-8c4a-ac5ff82bffd5 (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:17.072Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: child-task"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.072Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: 6bcb478d-3b20-4fe0-8c4a-ac5ff82bffd5, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:17.072Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197117072"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.072Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 54481c0f-867d-4f11-84a8-967abe18deff within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:17.074Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 54481c0f-867d-4f11-84a8-967abe18deff with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.075Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 44f3bc29-6d2b-4c48-a398-bba10fbb5af3 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.076Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 598c14e7-5f2c-4254-9f9a-0c9c748f91d9 for action 44f3bc29-6d2b-4c48-a398-bba10fbb5af3 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.077Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:17.077Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 54481c0f-867d-4f11-84a8-967abe18deff and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.079Z","pid":118906,"hostname":"richard","msg":"Test: should add a child work item with a parent - Child added:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.079Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 54481c0f-867d-4f11-84a8-967abe18deff with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.080Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 54481c0f-867d-4f11-84a8-967abe18deff (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.080Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 54481c0f-867d-4f11-84a8-967abe18deff. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.081Z","pid":118906,"hostname":"richard","msg":"Test: should add a child work item with a parent - Finished"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.081Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Starting database clean up..."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.082Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating undo_steps CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.084Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating action_history CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.094Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating work_item_dependencies CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.096Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating work_items CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.108Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Database clean up committed."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.108Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Database client released."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.108Z","pid":118906,"hostname":"richard","msg":"BeforeEach setup complete for WorkItemAddIntegration.test.ts"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.108Z","pid":118906,"hostname":"richard","msg":"Test: should add a work item with dependencies - Starting"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.108Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item ce891c6b-c027-46bd-adfb-d4263af99160"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.109Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Dependency Target\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.111Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:17.111Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: dependency-target"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.111Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:17.111Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197117111"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.111Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item ce891c6b-c027-46bd-adfb-d4263af99160 within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:17.112Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item ce891c6b-c027-46bd-adfb-d4263af99160 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.115Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action bd4e8367-ebf7-418b-8758-7d82fb28b583 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.116Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 07f7bc1e-217f-4eff-8adc-1fd24f7638eb for action bd4e8367-ebf7-418b-8758-7d82fb28b583 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.117Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:17.117Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item ce891c6b-c027-46bd-adfb-d4263af99160 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.119Z","pid":118906,"hostname":"richard","msg":"Test: should add a work item with dependencies - Created dependency target:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.119Z","pid":118906,"hostname":"richard","msg":"Test: should add a work item with dependencies - Adding item with dependency on"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.119Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 525525f2-7d66-487d-8490-5ce48b408e06"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.120Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Item with Dependency\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.121Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:17.121Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: item-with-dependency"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.121Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:17.121Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197117121"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.121Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 525525f2-7d66-487d-8490-5ce48b408e06 within transaction"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.122Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] create: Inserting 1 dependencies for item 525525f2-7d66-487d-8490-5ce48b408e06."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.122Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] create: Inserting dependency 525525f2-7d66-487d-8490-5ce48b408e06 -> ce891c6b-c027-46bd-adfb-d4263af99160"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.124Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] create: Finished inserting dependencies for item 525525f2-7d66-487d-8490-5ce48b408e06."}
{"level":"INFO","time":"2025-05-02T14:45:17.124Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 525525f2-7d66-487d-8490-5ce48b408e06 with 1 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.125Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 47f3efdc-8d46-4991-b693-37d1ddaf915a in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.126Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step d30b3d7a-5411-4d79-b2e1-1b3e96c86a32 for action 47f3efdc-8d46-4991-b693-37d1ddaf915a in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.128Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step fdc7b880-64ec-47d0-b810-f10905179db7 for action 47f3efdc-8d46-4991-b693-37d1ddaf915a in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.129Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:17.129Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 525525f2-7d66-487d-8490-5ce48b408e06 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.131Z","pid":118906,"hostname":"richard","msg":"Test: should add a work item with dependencies - Item with dependency added:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.133Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 1 dependencies for item 525525f2-7d66-487d-8490-5ce48b408e06 (link active: true, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.133Z","pid":118906,"hostname":"richard","msg":"Test: should add a work item with dependencies - Finished"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.134Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Starting database clean up..."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.135Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating undo_steps CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.137Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating action_history CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.151Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating work_item_dependencies CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.153Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating work_items CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.165Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Database clean up committed."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.165Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Database client released."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.165Z","pid":118906,"hostname":"richard","msg":"BeforeEach setup complete for WorkItemAddIntegration.test.ts"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.166Z","pid":118906,"hostname":"richard","msg":"Test: should clear the redo stack when adding a new item - Starting"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.166Z","pid":118906,"hostname":"richard","msg":"Test: should clear the redo stack when adding a new item - Adding Item 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.166Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 2c0eea09-b674-4a7d-91d4-dd58eab8bf2e"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.167Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Item 1\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.168Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:17.168Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: item-1"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.168Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:17.168Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197117168"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.168Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 2c0eea09-b674-4a7d-91d4-dd58eab8bf2e within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:17.170Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 2c0eea09-b674-4a7d-91d4-dd58eab8bf2e with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.171Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 63da12ef-8ea5-4adb-9b4f-7132d71be038 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.172Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step b4fdede0-e176-49fc-b55b-99847ca915e5 for action 63da12ef-8ea5-4adb-9b4f-7132d71be038 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.174Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:17.174Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 2c0eea09-b674-4a7d-91d4-dd58eab8bf2e and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.177Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.178Z","pid":118906,"hostname":"richard","msg":"Test: should clear the redo stack when adding a new item - Added Item 1, action:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.178Z","pid":118906,"hostname":"richard","msg":"Test: should clear the redo stack when adding a new item - Undoing Add Item 1"}
{"level":"INFO","time":"2025-05-02T14:45:17.179Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to undo last action."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.181Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Found original action to undo: 63da12ef-8ea5-4adb-9b4f-7132d71be038 (ADD_WORK_ITEM)"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.182Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Found 1 steps for action 63da12ef-8ea5-4adb-9b4f-7132d71be038."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.184Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Executing 1 undo steps for action 63da12ef-8ea5-4adb-9b4f-7132d71be038 in reverse order"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.184Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Executing undo step 1 (UPDATE) on work_items record 2c0eea09-b674-4a7d-91d4-dd58eab8bf2e for action 63da12ef-8ea5-4adb-9b4f-7132d71be038"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.187Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryUndoRedo] Updated row in work_items 2c0eea09-b674-4a7d-91d4-dd58eab8bf2e based on PKs."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.188Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 37d4051b-ebf4-4b14-ab5b-d5da5ed57f88 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.190Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked action 63da12ef-8ea5-4adb-9b4f-7132d71be038 as undone by action 37d4051b-ebf4-4b14-ab5b-d5da5ed57f88."}
{"level":"INFO","time":"2025-05-02T14:45:17.190Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Successfully undid action 63da12ef-8ea5-4adb-9b4f-7132d71be038"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.194Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.195Z","pid":118906,"hostname":"richard","msg":"Test: should clear the redo stack when adding a new item - Undid Add Item 1, undo action:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.197Z","pid":118906,"hostname":"richard","msg":"Test: should clear the redo stack when adding a new item - Verified action 1 is undone."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.197Z","pid":118906,"hostname":"richard","msg":"Test: should clear the redo stack when adding a new item - Adding Item 2 (clears redo stack)"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.197Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item d9d8899f-2312-450d-a7d7-8ddf04cd2060"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.198Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Item 2\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.199Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 1 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:17.199Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: item-2"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.199Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:17.199Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197117199"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.199Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item d9d8899f-2312-450d-a7d7-8ddf04cd2060 within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:17.200Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item d9d8899f-2312-450d-a7d7-8ddf04cd2060 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.201Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action ae78d8bd-fc6f-42ab-a0b9-31c5590b5b10 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.202Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 78186654-9f86-4fc4-a102-0b5f4e8b6778 for action ae78d8bd-fc6f-42ab-a0b9-31c5590b5b10 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.203Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.204Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked UNDO_ACTION 37d4051b-ebf4-4b14-ab5b-d5da5ed57f88 as redone/invalidated by action ae78d8bd-fc6f-42ab-a0b9-31c5590b5b10."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.204Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Invalidated 1 potential redo(s) due to new action ae78d8bd-fc6f-42ab-a0b9-31c5590b5b10."}
{"level":"INFO","time":"2025-05-02T14:45:17.204Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item d9d8899f-2312-450d-a7d7-8ddf04cd2060 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.207Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.207Z","pid":118906,"hostname":"richard","msg":"Test: should clear the redo stack when adding a new item - Added Item 2, action:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.208Z","pid":118906,"hostname":"richard","msg":"Test: should clear the redo stack when adding a new item - Verified undo action is invalidated by action 2."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.208Z","pid":118906,"hostname":"richard","msg":"Test: should clear the redo stack when adding a new item - Attempting redo (should be null)"}
{"level":"INFO","time":"2025-05-02T14:45:17.209Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to redo last undo action."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.210Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] No un-redone UNDO_ACTIONs found."}
{"level":"INFO","time":"2025-05-02T14:45:17.210Z","pid":118906,"hostname":"richard","msg":"[WorkItemHistoryService] No undo action found to redo."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.210Z","pid":118906,"hostname":"richard","msg":"Test: should clear the redo stack when adding a new item - Redo result:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.210Z","pid":118906,"hostname":"richard","msg":"Test: should clear the redo stack when adding a new item - Verifying item 1 is inactive (isActive: false)"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.210Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 2c0eea09-b674-4a7d-91d4-dd58eab8bf2e with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.211Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 2c0eea09-b674-4a7d-91d4-dd58eab8bf2e (isActive: false) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.211Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 2c0eea09-b674-4a7d-91d4-dd58eab8bf2e. isActive: false"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.211Z","pid":118906,"hostname":"richard","msg":"Test: should clear the redo stack when adding a new item - Fetched item 1 (isActive: false):"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.212Z","pid":118906,"hostname":"richard","msg":"Test: should clear the redo stack when adding a new item - Verified item 1 is inactive."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.212Z","pid":118906,"hostname":"richard","msg":"Test: should clear the redo stack when adding a new item - Verifying item 2 exists and is active (isActive: true)"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.212Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: d9d8899f-2312-450d-a7d7-8ddf04cd2060 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.213Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID d9d8899f-2312-450d-a7d7-8ddf04cd2060 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.213Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item d9d8899f-2312-450d-a7d7-8ddf04cd2060. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.213Z","pid":118906,"hostname":"richard","msg":"Test: should clear the redo stack when adding a new item - Fetched item 2 (isActive: true):"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.213Z","pid":118906,"hostname":"richard","msg":"Test: should clear the redo stack when adding a new item - Finished"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.214Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Starting database clean up..."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.215Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating undo_steps CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.216Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating action_history CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.227Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating work_item_dependencies CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.228Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating work_items CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.241Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Database clean up committed."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.241Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Database client released."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.241Z","pid":118906,"hostname":"richard","msg":"BeforeEach setup complete for WorkItemAddIntegration.test.ts"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.241Z","pid":118906,"hostname":"richard","msg":"Test: should validate parent work item is active - Starting"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.241Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item c22b0aa3-3f51-4ccb-b8d9-84779ed1f3cd"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.242Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Parent Project\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.243Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:17.243Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: parent-project"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.243Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:17.243Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197117243"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.243Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item c22b0aa3-3f51-4ccb-b8d9-84779ed1f3cd within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:17.244Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item c22b0aa3-3f51-4ccb-b8d9-84779ed1f3cd with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.245Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 7d0f157f-f19c-4b90-aa43-a1ac3c3737f4 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.246Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 71c99550-beaa-455f-91ea-b9fbe3207588 for action 7d0f157f-f19c-4b90-aa43-a1ac3c3737f4 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.247Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:17.247Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item c22b0aa3-3f51-4ccb-b8d9-84779ed1f3cd and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.249Z","pid":118906,"hostname":"richard","msg":"Test: should validate parent work item is active - Created parent:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.249Z","pid":118906,"hostname":"richard","msg":"Test: should validate parent work item is active - Soft deleting parent"}
{"level":"WARN","time":"2025-05-02T14:45:17.249Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Attempting to soft delete 1 work item(s) and cascade: c22b0aa3-3f51-4ccb-b8d9-84779ed1f3cd"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.250Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Finding all descendants..."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.250Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: c22b0aa3-3f51-4ccb-b8d9-84779ed1f3cd with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.250Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.251Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent c22b0aa3-3f51-4ccb-b8d9-84779ed1f3cd (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.251Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent c22b0aa3-3f51-4ccb-b8d9-84779ed1f3cd (active: false, status: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.251Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Full cascade list (1 items) identified: c22b0aa3-3f51-4ccb-b8d9-84779ed1f3cd"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.252Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item list (count: 1, link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.253Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item list (count: 1, link active: false, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.253Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Identified 0 potentially affected dependency links for cascade delete."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.254Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found 1 work items by IDs (count: 1, isActive: true)."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.255Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Found 1 active items in cascade list for deletion."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.255Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Attempting to soft delete item IDs in cascade: c22b0aa3-3f51-4ccb-b8d9-84779ed1f3cd"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.255Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] Executing softDelete SQL: \n      UPDATE work_items\n      SET is_active = FALSE, updated_at = $1\n      WHERE work_item_id IN ($2) AND is_active = TRUE;\n     PARAMS: [\"2025-05-02T14:45:17.255Z\",\"c22b0aa3-3f51-4ccb-b8d9-84779ed1f3cd\"]"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.256Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] softDelete result rowCount: 1"}
{"level":"INFO","time":"2025-05-02T14:45:17.256Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Soft deleted 1 work item(s)."}
{"level":"INFO","time":"2025-05-02T14:45:17.256Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Repository reported 1 work item(s) soft deleted."}
{"level":"INFO","time":"2025-05-02T14:45:17.256Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] No active dependency links found to soft delete within the cascade."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.257Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 5b04c66d-3551-4bd6-a6ba-e0ddfe283e8c in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.258Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step f980af33-e683-42e8-8132-86c104b9f674 for action 5b04c66d-3551-4bd6-a6ba-e0ddfe283e8c in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.258Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:17.258Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Recorded history for delete action 5b04c66d-3551-4bd6-a6ba-e0ddfe283e8c."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.260Z","pid":118906,"hostname":"richard","msg":"[WorkItemDeleteService] Returning count: 1 (based on repository rowCount)"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.260Z","pid":118906,"hostname":"richard","msg":"Test: should validate parent work item is active - Fetching parent (isActive: false) to confirm inactive"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.260Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: c22b0aa3-3f51-4ccb-b8d9-84779ed1f3cd with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.261Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID c22b0aa3-3f51-4ccb-b8d9-84779ed1f3cd (isActive: false) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.261Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item c22b0aa3-3f51-4ccb-b8d9-84779ed1f3cd. isActive: false"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.261Z","pid":118906,"hostname":"richard","msg":"Test: should validate parent work item is active - Fetched parent (isActive: false):"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.261Z","pid":118906,"hostname":"richard","msg":"Test: should validate parent work item is active - Attempting to add child to inactive parent"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.261Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 640dd1c6-7443-4148-a157-895aba13a2e4"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.262Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: c22b0aa3-3f51-4ccb-b8d9-84779ed1f3cd with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.263Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID c22b0aa3-3f51-4ccb-b8d9-84779ed1f3cd (isActive: true) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.263Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Work item c22b0aa3-3f51-4ccb-b8d9-84779ed1f3cd not found or filtered out (isActive filter: true)."}
{"level":"ERROR","time":"2025-05-02T14:45:17.263Z","pid":118906,"hostname":"richard","err":{"type":"ValidationError","message":"Parent work item with ID c22b0aa3-3f51-4ccb-b8d9-84779ed1f3cd not found or is inactive.","stack":"ValidationError: Parent work item with ID c22b0aa3-3f51-4ccb-b8d9-84779ed1f3cd not found or is inactive.\n    at /home/richard/repos/mcp-task-manager-server/src/services/WorkItemAddingService.ts:58:19\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at ActionHistoryRepository.withTransaction (/home/richard/repos/mcp-task-manager-server/src/repositories/ActionHistoryRepositoryBase.ts:107:22)\n    at WorkItemAddingService.addWorkItem (/home/richard/repos/mcp-task-manager-server/src/services/WorkItemAddingService.ts:54:27)\n    at Object.<anonymous> (/home/richard/repos/mcp-task-manager-server/src/services/__tests__/workItemAddIntegration.test.ts:235:7)","name":"ValidationError"},"msg":"[ActionHistoryRepositoryBase.withTransaction] Transaction error, attempting rollback"}
{"level":"INFO","time":"2025-05-02T14:45:17.279Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryBase.withTransaction] Transaction rolled back successfully."}
{"level":"WARN","time":"2025-05-02T14:45:17.279Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Validation error adding work item \"Child Task\": Parent work item with ID c22b0aa3-3f51-4ccb-b8d9-84779ed1f3cd not found or is inactive."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.279Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 7cc87707-2179-4bf4-b005-2a90f5541c92"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.280Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: c22b0aa3-3f51-4ccb-b8d9-84779ed1f3cd with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.281Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID c22b0aa3-3f51-4ccb-b8d9-84779ed1f3cd (isActive: true) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.281Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Work item c22b0aa3-3f51-4ccb-b8d9-84779ed1f3cd not found or filtered out (isActive filter: true)."}
{"level":"ERROR","time":"2025-05-02T14:45:17.281Z","pid":118906,"hostname":"richard","err":{"type":"ValidationError","message":"Parent work item with ID c22b0aa3-3f51-4ccb-b8d9-84779ed1f3cd not found or is inactive.","stack":"ValidationError: Parent work item with ID c22b0aa3-3f51-4ccb-b8d9-84779ed1f3cd not found or is inactive.\n    at /home/richard/repos/mcp-task-manager-server/src/services/WorkItemAddingService.ts:58:19\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at ActionHistoryRepository.withTransaction (/home/richard/repos/mcp-task-manager-server/src/repositories/ActionHistoryRepositoryBase.ts:107:22)\n    at WorkItemAddingService.addWorkItem (/home/richard/repos/mcp-task-manager-server/src/services/WorkItemAddingService.ts:54:27)\n    at Object.<anonymous> (/home/richard/repos/mcp-task-manager-server/src/services/__tests__/workItemAddIntegration.test.ts:241:7)","name":"ValidationError"},"msg":"[ActionHistoryRepositoryBase.withTransaction] Transaction error, attempting rollback"}
{"level":"INFO","time":"2025-05-02T14:45:17.282Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryBase.withTransaction] Transaction rolled back successfully."}
PASS dist/services/__tests__/workItemAddIntegration.test.js
{"level":"INFO","time":"2025-05-02T14:45:17.446Z","pid":118906,"hostname":"richard","msg":"Loading environment variable overrides for configuration..."}
{"level":"WARN","time":"2025-05-02T14:45:17.282Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Validation error adding work item \"Child Task\": Parent work item with ID c22b0aa3-3f51-4ccb-b8d9-84779ed1f3cd not found or is inactive."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.282Z","pid":118906,"hostname":"richard","msg":"Test: should validate parent work item is active - Finished"}
{"level":"INFO","time":"2025-05-02T14:45:17.446Z","pid":118906,"hostname":"richard","msg":"Overriding pgHost from env: localhost"}
{"level":"INFO","time":"2025-05-02T14:45:17.446Z","pid":118906,"hostname":"richard","msg":"Overriding pgPort from env: 5432"}
{"level":"INFO","time":"2025-05-02T14:45:17.446Z","pid":118906,"hostname":"richard","msg":"Overriding pgUser from env: taskmanager_user"}
{"level":"INFO","time":"2025-05-02T14:45:17.446Z","pid":118906,"hostname":"richard","msg":"Overriding pgPassword from env."}
{"level":"INFO","time":"2025-05-02T14:45:17.446Z","pid":118906,"hostname":"richard","msg":"Overriding pgDatabase from env: taskmanager_db"}
{"level":"INFO","time":"2025-05-02T14:45:17.446Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] Setting up PostgreSQL connection pool..."}
{"level":"INFO","time":"2025-05-02T14:45:17.447Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] PostgreSQL connection pool configured."}
{"level":"INFO","time":"2025-05-02T14:45:17.447Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] Starting database schema initialization..."}
{"level":"INFO","time":"2025-05-02T14:45:17.470Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] Connected to PostgreSQL for schema check/application."}
{"level":"INFO","time":"2025-05-02T14:45:17.470Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] Force schema run enabled or tables missing. Initializing/Re-initializing schema..."}
{"level":"INFO","time":"2025-05-02T14:45:17.470Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] Looking for schema file at: /home/richard/repos/mcp-task-manager-server/dist/db/schema.sql"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.471Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] Schema file read successfully. Executing schema setup..."}
{"level":"INFO","time":"2025-05-02T14:45:17.498Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] Full schema script executed."}
{"level":"INFO","time":"2025-05-02T14:45:17.502Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] Confirmed work_items table exists after schema execution."}
{"level":"INFO","time":"2025-05-02T14:45:17.502Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] Initialization marked as complete."}
{"level":"INFO","time":"2025-05-02T14:45:17.502Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] Released schema check/application client."}
{"level":"INFO","time":"2025-05-02T14:45:17.503Z","pid":118906,"hostname":"richard","msg":"[DatabaseManager] Instance created and database initialized."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.505Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Starting database clean up..."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.506Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating undo_steps CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.507Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating action_history CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.518Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating work_item_dependencies CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.520Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating work_items CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.533Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Database clean up committed."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.533Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Database client released."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.534Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 1215f982-aa28-4cbf-a191-d76a27a1f509"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.537Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Root Project 1\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.542Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:17.542Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: root-project-1"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.543Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:17.543Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197117543"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.543Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 1215f982-aa28-4cbf-a191-d76a27a1f509 within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:17.546Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 1215f982-aa28-4cbf-a191-d76a27a1f509 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.548Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 14d5a440-b417-4959-b941-6fa9beeb4d0f in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.550Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 8ea525c9-e117-429a-abd6-1e0c60b1de1e for action 14d5a440-b417-4959-b941-6fa9beeb4d0f in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.551Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:17.551Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 1215f982-aa28-4cbf-a191-d76a27a1f509 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.556Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 6f6e8ab2-985d-47d6-a838-d20191de9452"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.557Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Root Project 2\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.559Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:17.559Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: root-project-2"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.559Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:17.559Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197117559"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.559Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 6f6e8ab2-985d-47d6-a838-d20191de9452 within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:17.560Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 6f6e8ab2-985d-47d6-a838-d20191de9452 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.561Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 3dccb6c1-942d-4da3-a3ad-6664d5e05cf5 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.563Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step f44e26e0-be11-4363-be8c-8060a112198e for action 3dccb6c1-942d-4da3-a3ad-6664d5e05cf5 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.564Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:17.564Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 6f6e8ab2-985d-47d6-a838-d20191de9452 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.567Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 2b6f5b9d-1751-4bc6-b370-ccacc049aec6"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.568Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 1215f982-aa28-4cbf-a191-d76a27a1f509 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.570Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 1215f982-aa28-4cbf-a191-d76a27a1f509 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.570Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 1215f982-aa28-4cbf-a191-d76a27a1f509. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.571Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Child Task 1 (In Progress)\", parentId: 1215f982-aa28-4cbf-a191-d76a27a1f509, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.571Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: 1215f982-aa28-4cbf-a191-d76a27a1f509 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.572Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.573Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent 1215f982-aa28-4cbf-a191-d76a27a1f509 (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.573Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent 1215f982-aa28-4cbf-a191-d76a27a1f509 (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:17.573Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: child-task-1-in-progress"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.573Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: 1215f982-aa28-4cbf-a191-d76a27a1f509, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:17.573Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197117573"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.573Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 2b6f5b9d-1751-4bc6-b370-ccacc049aec6 within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:17.575Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 2b6f5b9d-1751-4bc6-b370-ccacc049aec6 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.577Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 2ba56038-ec99-4af2-8708-8234e45b371a in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.579Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 4d857e3f-4e12-4983-9d52-13095232e115 for action 2ba56038-ec99-4af2-8708-8234e45b371a in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.579Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:17.580Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 2b6f5b9d-1751-4bc6-b370-ccacc049aec6 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.581Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 7d81d747-9169-4c27-b2ad-6dc49214f9e8"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.582Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 1215f982-aa28-4cbf-a191-d76a27a1f509 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.583Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 1215f982-aa28-4cbf-a191-d76a27a1f509 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.583Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 1215f982-aa28-4cbf-a191-d76a27a1f509. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.583Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Child Task 2 (Todo)\", parentId: 1215f982-aa28-4cbf-a191-d76a27a1f509, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.583Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: 1215f982-aa28-4cbf-a191-d76a27a1f509 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.583Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.584Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent 1215f982-aa28-4cbf-a191-d76a27a1f509 (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.584Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent 1215f982-aa28-4cbf-a191-d76a27a1f509 (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:17.584Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: child-task-2-todo"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.584Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: 1215f982-aa28-4cbf-a191-d76a27a1f509, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:17.584Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197117584"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.584Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 7d81d747-9169-4c27-b2ad-6dc49214f9e8 within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:17.585Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 7d81d747-9169-4c27-b2ad-6dc49214f9e8 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.586Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action f20531f2-177d-440f-bcb9-4a2efd8ee783 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.587Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 554c5e1d-1871-4913-a898-1917fc96614c for action f20531f2-177d-440f-bcb9-4a2efd8ee783 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.588Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:17.588Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 7d81d747-9169-4c27-b2ad-6dc49214f9e8 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.590Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item fbfde504-cd17-4df4-87fc-9ea0db236164"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.591Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Dependency Target\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.592Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:17.592Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: dependency-target"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.592Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:17.592Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197117592"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.592Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item fbfde504-cd17-4df4-87fc-9ea0db236164 within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:17.593Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item fbfde504-cd17-4df4-87fc-9ea0db236164 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.594Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action bc1bb23f-4c10-4486-b26c-88d3a502070f in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.595Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step c2423580-4349-4fe2-80db-c068dde85df6 for action bc1bb23f-4c10-4486-b26c-88d3a502070f in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.597Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:17.597Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item fbfde504-cd17-4df4-87fc-9ea0db236164 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.601Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService] Updating work item 2b6f5b9d-1751-4bc6-b370-ccacc049aec6 with data:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.602Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 2b6f5b9d-1751-4bc6-b370-ccacc049aec6 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.604Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 2b6f5b9d-1751-4bc6-b370-ccacc049aec6 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.604Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 2b6f5b9d-1751-4bc6-b370-ccacc049aec6. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.606Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item 2b6f5b9d-1751-4bc6-b370-ccacc049aec6 (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.606Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps Before Update for 2b6f5b9d-1751-4bc6-b370-ccacc049aec6:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.606Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Desired Deps State for 2b6f5b9d-1751-4bc6-b370-ccacc049aec6:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.607Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updating work item 2b6f5b9d-1751-4bc6-b370-ccacc049aec6 in transaction"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.608Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] No core fields to update for 2b6f5b9d-1751-4bc6-b370-ccacc049aec6."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.608Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updating dependencies for item 2b6f5b9d-1751-4bc6-b370-ccacc049aec6. Input dependencies:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.609Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] Found 0 existing dependencies (any state) for 2b6f5b9d-1751-4bc6-b370-ccacc049aec6:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.609Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] Desired Deps State for 2b6f5b9d-1751-4bc6-b370-ccacc049aec6:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.609Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] Dependencies actions for 2b6f5b9d-1751-4bc6-b370-ccacc049aec6: To Insert/Update:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.609Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Inserting/Updating 1 dependencies for 2b6f5b9d-1751-4bc6-b370-ccacc049aec6."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.610Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Total inserted/updated dependencies for 2b6f5b9d-1751-4bc6-b370-ccacc049aec6: 1."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.611Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Finished updating dependencies for item 2b6f5b9d-1751-4bc6-b370-ccacc049aec6."}
{"level":"INFO","time":"2025-05-02T14:45:17.611Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Successfully processed update for item 2b6f5b9d-1751-4bc6-b370-ccacc049aec6."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.611Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 2b6f5b9d-1751-4bc6-b370-ccacc049aec6 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.612Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 2b6f5b9d-1751-4bc6-b370-ccacc049aec6 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.612Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 2b6f5b9d-1751-4bc6-b370-ccacc049aec6. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.613Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item 2b6f5b9d-1751-4bc6-b370-ccacc049aec6 (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.613Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps After Update Repo Call for 2b6f5b9d-1751-4bc6-b370-ccacc049aec6:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.613Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Item fields did NOT change for 2b6f5b9d-1751-4bc6-b370-ccacc049aec6."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.613Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Checking dependency changes for 2b6f5b9d-1751-4bc6-b370-ccacc049aec6..."}
{"level":"INFO","time":"2025-05-02T14:45:17.613Z","pid":118906,"hostname":"richard","msg":"[WorkItemUpdateService] Update called for 2b6f5b9d-1751-4bc6-b370-ccacc049aec6, but no effective changes detected (Item: false, Deps: false). Skipping history."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.615Z","pid":118906,"hostname":"richard","msg":"[WorkItemReadingService] Getting work item by ID: 2b6f5b9d-1751-4bc6-b370-ccacc049aec6 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.615Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 2b6f5b9d-1751-4bc6-b370-ccacc049aec6 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.617Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 2b6f5b9d-1751-4bc6-b370-ccacc049aec6 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.617Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 2b6f5b9d-1751-4bc6-b370-ccacc049aec6. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.617Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: 2b6f5b9d-1751-4bc6-b370-ccacc049aec6 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.617Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.618Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 1 dependencies for item 2b6f5b9d-1751-4bc6-b370-ccacc049aec6 (link active: true, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.640Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item 2b6f5b9d-1751-4bc6-b370-ccacc049aec6 (link active: true, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.640Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent 2b6f5b9d-1751-4bc6-b370-ccacc049aec6 (active: true, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.640Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent 2b6f5b9d-1751-4bc6-b370-ccacc049aec6 (active: true, status: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.640Z","pid":118906,"hostname":"richard","msg":"[WorkItemReadingService] Getting work item by ID: 2b6f5b9d-1751-4bc6-b370-ccacc049aec6 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.640Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 2b6f5b9d-1751-4bc6-b370-ccacc049aec6 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.641Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 2b6f5b9d-1751-4bc6-b370-ccacc049aec6 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.642Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 2b6f5b9d-1751-4bc6-b370-ccacc049aec6. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.642Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: 2b6f5b9d-1751-4bc6-b370-ccacc049aec6 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.642Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.644Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item 2b6f5b9d-1751-4bc6-b370-ccacc049aec6 (link active: true, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.644Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent 2b6f5b9d-1751-4bc6-b370-ccacc049aec6 (active: true, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.644Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent 2b6f5b9d-1751-4bc6-b370-ccacc049aec6 (active: true, status: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.645Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 1 dependencies for item 2b6f5b9d-1751-4bc6-b370-ccacc049aec6 (link active: true, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.652Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Starting database clean up..."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.652Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating undo_steps CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.656Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating action_history CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.669Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating work_item_dependencies CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.671Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating work_items CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.683Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Database clean up committed."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.683Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Database client released."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.683Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 1e611f0c-137d-412c-8b7b-90ea2ca8d007"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.684Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Root Project 1\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.685Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:17.685Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: root-project-1"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.685Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:17.685Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197117685"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.685Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 1e611f0c-137d-412c-8b7b-90ea2ca8d007 within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:17.687Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 1e611f0c-137d-412c-8b7b-90ea2ca8d007 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.688Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action a61a517f-01b3-413e-9218-82b69528eea4 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.689Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 1d46d4dc-21ab-4186-af24-39e357178b2d for action a61a517f-01b3-413e-9218-82b69528eea4 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.691Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:17.691Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 1e611f0c-137d-412c-8b7b-90ea2ca8d007 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.693Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item a88b2b7a-0725-417b-bb8d-e9cfd4c9449f"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.693Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Root Project 2\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.694Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:17.694Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: root-project-2"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.694Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:17.694Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197117694"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.694Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item a88b2b7a-0725-417b-bb8d-e9cfd4c9449f within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:17.695Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item a88b2b7a-0725-417b-bb8d-e9cfd4c9449f with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.696Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 9bd2d10c-77f1-4531-84f1-685885bfbac9 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.697Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 83f9b516-bcc5-4429-810b-8ea669172808 for action 9bd2d10c-77f1-4531-84f1-685885bfbac9 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.698Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:17.698Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item a88b2b7a-0725-417b-bb8d-e9cfd4c9449f and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.700Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 170fe4b8-fc8e-434c-88b4-7abafd09d810"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.700Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 1e611f0c-137d-412c-8b7b-90ea2ca8d007 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.701Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 1e611f0c-137d-412c-8b7b-90ea2ca8d007 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.701Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 1e611f0c-137d-412c-8b7b-90ea2ca8d007. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.701Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Child Task 1 (In Progress)\", parentId: 1e611f0c-137d-412c-8b7b-90ea2ca8d007, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.701Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: 1e611f0c-137d-412c-8b7b-90ea2ca8d007 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.701Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.702Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent 1e611f0c-137d-412c-8b7b-90ea2ca8d007 (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.702Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent 1e611f0c-137d-412c-8b7b-90ea2ca8d007 (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:17.702Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: child-task-1-in-progress"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.702Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: 1e611f0c-137d-412c-8b7b-90ea2ca8d007, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:17.702Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197117702"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.702Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 170fe4b8-fc8e-434c-88b4-7abafd09d810 within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:17.703Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 170fe4b8-fc8e-434c-88b4-7abafd09d810 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.703Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 7571f0c6-da0d-4070-a46f-bd987c5ee8bd in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.704Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step a4324869-4a98-4f81-8875-53e0450196a3 for action 7571f0c6-da0d-4070-a46f-bd987c5ee8bd in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.705Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:17.705Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 170fe4b8-fc8e-434c-88b4-7abafd09d810 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.706Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item a9192f6d-5c2c-4b22-832a-6e71ad99d98c"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.707Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 1e611f0c-137d-412c-8b7b-90ea2ca8d007 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.707Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 1e611f0c-137d-412c-8b7b-90ea2ca8d007 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.707Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 1e611f0c-137d-412c-8b7b-90ea2ca8d007. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.707Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Child Task 2 (Todo)\", parentId: 1e611f0c-137d-412c-8b7b-90ea2ca8d007, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.707Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: 1e611f0c-137d-412c-8b7b-90ea2ca8d007 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.707Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.708Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent 1e611f0c-137d-412c-8b7b-90ea2ca8d007 (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.708Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent 1e611f0c-137d-412c-8b7b-90ea2ca8d007 (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:17.708Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: child-task-2-todo"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.708Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: 1e611f0c-137d-412c-8b7b-90ea2ca8d007, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:17.708Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197117708"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.708Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item a9192f6d-5c2c-4b22-832a-6e71ad99d98c within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:17.710Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item a9192f6d-5c2c-4b22-832a-6e71ad99d98c with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.712Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action de2d840c-2a22-49fe-8cae-29cf51b1bb31 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.714Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 560b9f11-0df2-4c33-bd33-82470f569d6d for action de2d840c-2a22-49fe-8cae-29cf51b1bb31 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.715Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:17.715Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item a9192f6d-5c2c-4b22-832a-6e71ad99d98c and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.718Z","pid":118906,"hostname":"richard","msg":"[WorkItemReadingService] Getting work item by ID: f47ac10b-58cc-4372-a567-0e02b2c3d479 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.718Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: f47ac10b-58cc-4372-a567-0e02b2c3d479 with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.719Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID f47ac10b-58cc-4372-a567-0e02b2c3d479 (isActive: true) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.720Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Work item f47ac10b-58cc-4372-a567-0e02b2c3d479 not found or filtered out (isActive filter: true)."}
{"level":"WARN","time":"2025-05-02T14:45:17.720Z","pid":118906,"hostname":"richard","msg":"[WorkItemReadingService] Work item f47ac10b-58cc-4372-a567-0e02b2c3d479 not found or filtered out (isActive: true)."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.722Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Starting database clean up..."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.723Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating undo_steps CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.726Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating action_history CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.740Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating work_item_dependencies CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.743Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Truncating work_items CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.758Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Database clean up committed."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.759Z","pid":118906,"hostname":"richard","msg":"[integrationSetup] Database client released."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.759Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 29b7dcda-47f3-44c7-a082-a93fb392daba"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.759Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Root Project 1\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.762Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:17.762Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: root-project-1"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.762Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:17.762Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197117762"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.762Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 29b7dcda-47f3-44c7-a082-a93fb392daba within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:17.764Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 29b7dcda-47f3-44c7-a082-a93fb392daba with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.766Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 2013a3c5-7625-4120-aac4-4721cb48feff in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.769Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 6f68f1ee-6e28-4133-be3b-1d6f92ef81ad for action 2013a3c5-7625-4120-aac4-4721cb48feff in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.770Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:17.770Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 29b7dcda-47f3-44c7-a082-a93fb392daba and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.773Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 77727d20-8e40-45ed-ae25-2562ab9f721d"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.774Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Root Project 2\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.775Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:17.775Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: root-project-2"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.775Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:17.775Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197117775"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.775Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 77727d20-8e40-45ed-ae25-2562ab9f721d within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:17.776Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 77727d20-8e40-45ed-ae25-2562ab9f721d with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.777Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 02b3d469-ce2a-4d18-b025-24ec1f1c222e in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.778Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step ad0848b8-16b2-4ef1-8196-c50b6f44cabd for action 02b3d469-ce2a-4d18-b025-24ec1f1c222e in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.779Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:17.779Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 77727d20-8e40-45ed-ae25-2562ab9f721d and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.781Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 410d7955-f817-4526-8a20-85066f73db58"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.781Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 29b7dcda-47f3-44c7-a082-a93fb392daba with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.782Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 29b7dcda-47f3-44c7-a082-a93fb392daba (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.782Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 29b7dcda-47f3-44c7-a082-a93fb392daba. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.782Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Child Task 1 (In Progress)\", parentId: 29b7dcda-47f3-44c7-a082-a93fb392daba, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.782Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: 29b7dcda-47f3-44c7-a082-a93fb392daba with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.782Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.783Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent 29b7dcda-47f3-44c7-a082-a93fb392daba (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.783Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent 29b7dcda-47f3-44c7-a082-a93fb392daba (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:17.783Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: child-task-1-in-progress"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.783Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: 29b7dcda-47f3-44c7-a082-a93fb392daba, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:17.783Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197117783"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.783Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 410d7955-f817-4526-8a20-85066f73db58 within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:17.784Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 410d7955-f817-4526-8a20-85066f73db58 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.785Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action efc762fc-dd36-4a19-ac99-63e735ba6d71 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.786Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 8221e4c0-f14a-4069-be03-204679c7fa2e for action efc762fc-dd36-4a19-ac99-63e735ba6d71 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.787Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:17.787Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 410d7955-f817-4526-8a20-85066f73db58 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.789Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 9190ccb3-c069-4cad-8704-e2b53c8920ee"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.790Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 29b7dcda-47f3-44c7-a082-a93fb392daba with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.791Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 29b7dcda-47f3-44c7-a082-a93fb392daba (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.792Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 29b7dcda-47f3-44c7-a082-a93fb392daba. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.792Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Child Task 2 (Todo)\", parentId: 29b7dcda-47f3-44c7-a082-a93fb392daba, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.792Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: 29b7dcda-47f3-44c7-a082-a93fb392daba with filter:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.792Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.793Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent 29b7dcda-47f3-44c7-a082-a93fb392daba (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.793Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent 29b7dcda-47f3-44c7-a082-a93fb392daba (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T14:45:17.793Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: child-task-2-todo"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.793Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: 29b7dcda-47f3-44c7-a082-a93fb392daba, after item: null"}
{"level":"WARN","time":"2025-05-02T14:45:17.793Z","pid":118906,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746197117793"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.793Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 9190ccb3-c069-4cad-8704-e2b53c8920ee within transaction"}
{"level":"INFO","time":"2025-05-02T14:45:17.795Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 9190ccb3-c069-4cad-8704-e2b53c8920ee with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.797Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 5a695acc-3e83-44ed-b677-f20c1918bb88 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.798Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step d12d18ed-507d-4d98-a482-e8fa6103131c for action 5a695acc-3e83-44ed-b677-f20c1918bb88 in transaction."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.800Z","pid":118906,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T14:45:17.800Z","pid":118906,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 9190ccb3-c069-4cad-8704-e2b53c8920ee and recorded history"}
{"level":"DEBUG","time":"2025-05-02T14:45:17.803Z","pid":118906,"hostname":"richard","msg":"[WorkItemReadingService] Listing work items with filter:"}
{"level":"INFO","time":"2025-05-02T14:45:17.803Z","pid":118906,"hostname":"richard","msg":"[WorkItemReadingService] Listing all items (active: true, status: todo)."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.804Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found 3 work items (all, active: true, status: todo)."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.805Z","pid":118906,"hostname":"richard","msg":"[WorkItemReadingService] Listing work items with filter:"}
{"level":"INFO","time":"2025-05-02T14:45:17.805Z","pid":118906,"hostname":"richard","msg":"[WorkItemReadingService] Listing all items (active: true, status: in-progress)."}
{"level":"DEBUG","time":"2025-05-02T14:45:17.806Z","pid":118906,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found 1 work items (all, active: true, status: in-progress)."}
PASS dist/services/__tests__/workItemReadIntegration.test.js
PASS dist/services/__tests__/unit/WorkItemService.spec.js

Test Suites: 1 failed, 5 passed, 6 total
Tests:       1 failed, 24 passed, 25 total
Snapshots:   0 total
Time:        3.994 s
Ran all test suites.
