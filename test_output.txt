
> mcp-task-manager-server@0.1.0 test
> dotenv -e .env.test -- cross-env NODE_OPTIONS=--experimental-vm-modules jest --runInBand

{"level":"INFO","time":"2025-05-02T13:08:33.530Z","pid":113601,"hostname":"richard","msg":"Loading environment variable overrides for configuration..."}
(node:113601) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
{"level":"INFO","time":"2025-05-02T13:08:33.531Z","pid":113601,"hostname":"richard","msg":"Overriding pgHost from env: localhost"}
{"level":"INFO","time":"2025-05-02T13:08:33.531Z","pid":113601,"hostname":"richard","msg":"Overriding pgPort from env: 5432"}
{"level":"INFO","time":"2025-05-02T13:08:33.531Z","pid":113601,"hostname":"richard","msg":"Overriding pgUser from env: taskmanager_user"}
{"level":"INFO","time":"2025-05-02T13:08:33.531Z","pid":113601,"hostname":"richard","msg":"Overriding pgPassword from env."}
{"level":"INFO","time":"2025-05-02T13:08:33.531Z","pid":113601,"hostname":"richard","msg":"Overriding pgDatabase from env: taskmanager_db"}
{"level":"INFO","time":"2025-05-02T13:08:33.531Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] Setting up PostgreSQL connection pool..."}
{"level":"INFO","time":"2025-05-02T13:08:33.531Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] PostgreSQL connection pool configured."}
{"level":"INFO","time":"2025-05-02T13:08:33.531Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] Starting database schema initialization..."}
{"level":"INFO","time":"2025-05-02T13:08:33.558Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] Connected to PostgreSQL for schema check/application."}
{"level":"INFO","time":"2025-05-02T13:08:33.559Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] Force schema run enabled or tables missing. Initializing/Re-initializing schema..."}
{"level":"INFO","time":"2025-05-02T13:08:33.559Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] Looking for schema file at: /home/richard/repos/mcp-task-manager-server/dist/db/schema.sql"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.559Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] Schema file read successfully. Executing schema setup..."}
{"level":"INFO","time":"2025-05-02T13:08:33.574Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] Full schema script executed."}
{"level":"INFO","time":"2025-05-02T13:08:33.576Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] Confirmed work_items table exists after schema execution."}
{"level":"INFO","time":"2025-05-02T13:08:33.576Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] Initialization marked as complete."}
{"level":"INFO","time":"2025-05-02T13:08:33.576Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] Released schema check/application client."}
{"level":"INFO","time":"2025-05-02T13:08:33.576Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] Instance created and database initialized."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.577Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Starting database clean up..."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.578Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating undo_steps CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.579Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating action_history CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.587Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating work_item_dependencies CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.588Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating work_items CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.597Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Database clean up committed."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.597Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Database client released."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.598Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item d14aa430-0eb2-4f2d-8042-d6159249aef2"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.598Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Parent Project\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.600Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:33.600Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: parent-project"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.600Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:33.600Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191313600"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.600Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item d14aa430-0eb2-4f2d-8042-d6159249aef2 within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:33.602Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item d14aa430-0eb2-4f2d-8042-d6159249aef2 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.602Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action a106ac98-6222-4d99-8b71-5ce0da8e1b06 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.603Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 849227c5-ad6b-47ed-8386-c530852cf315 for action a106ac98-6222-4d99-8b71-5ce0da8e1b06 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.603Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:33.603Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item d14aa430-0eb2-4f2d-8042-d6159249aef2 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.605Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 14d5599a-fbee-438c-8153-02b99ec6e390"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.605Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: d14aa430-0eb2-4f2d-8042-d6159249aef2 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.605Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID d14aa430-0eb2-4f2d-8042-d6159249aef2 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.605Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item d14aa430-0eb2-4f2d-8042-d6159249aef2. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.605Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Child Task 1\", parentId: d14aa430-0eb2-4f2d-8042-d6159249aef2, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.605Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: d14aa430-0eb2-4f2d-8042-d6159249aef2 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.605Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.606Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent d14aa430-0eb2-4f2d-8042-d6159249aef2 (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.606Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent d14aa430-0eb2-4f2d-8042-d6159249aef2 (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:33.606Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: child-task-1"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.606Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: d14aa430-0eb2-4f2d-8042-d6159249aef2, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:33.606Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191313606"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.606Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 14d5599a-fbee-438c-8153-02b99ec6e390 within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:33.606Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 14d5599a-fbee-438c-8153-02b99ec6e390 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.607Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action b60f0b83-756a-4f20-8c12-181bfd85ca0e in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.607Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 3a600985-0dd6-4d8e-93e2-d298a64aa40d for action b60f0b83-756a-4f20-8c12-181bfd85ca0e in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.608Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:33.608Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 14d5599a-fbee-438c-8153-02b99ec6e390 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.609Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 64803332-c11c-4d4e-902b-2b300c4dd0dc"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.609Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: d14aa430-0eb2-4f2d-8042-d6159249aef2 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.609Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID d14aa430-0eb2-4f2d-8042-d6159249aef2 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.609Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item d14aa430-0eb2-4f2d-8042-d6159249aef2. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.609Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Child Task 2\", parentId: d14aa430-0eb2-4f2d-8042-d6159249aef2, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.609Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: d14aa430-0eb2-4f2d-8042-d6159249aef2 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.609Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.609Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent d14aa430-0eb2-4f2d-8042-d6159249aef2 (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.609Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent d14aa430-0eb2-4f2d-8042-d6159249aef2 (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:33.609Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: child-task-2"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.609Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: d14aa430-0eb2-4f2d-8042-d6159249aef2, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:33.609Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191313609"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.609Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 64803332-c11c-4d4e-902b-2b300c4dd0dc within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:33.610Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 64803332-c11c-4d4e-902b-2b300c4dd0dc with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.610Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 76087b38-cb90-439e-aca6-a6d0583ce833 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.610Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step de167fbf-a528-4222-916c-26da7b6fc5b3 for action 76087b38-cb90-439e-aca6-a6d0583ce833 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.610Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:33.610Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 64803332-c11c-4d4e-902b-2b300c4dd0dc and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.612Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 6809eff0-8de4-4351-9ce3-73a1bcf507e1"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.612Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 14d5599a-fbee-438c-8153-02b99ec6e390 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.612Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 14d5599a-fbee-438c-8153-02b99ec6e390 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.612Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 14d5599a-fbee-438c-8153-02b99ec6e390. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.612Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Grandchild Task 1\", parentId: 14d5599a-fbee-438c-8153-02b99ec6e390, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.612Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: 14d5599a-fbee-438c-8153-02b99ec6e390 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.612Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.612Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent 14d5599a-fbee-438c-8153-02b99ec6e390 (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.612Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent 14d5599a-fbee-438c-8153-02b99ec6e390 (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:33.612Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: grandchild-task-1"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.612Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: 14d5599a-fbee-438c-8153-02b99ec6e390, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:33.612Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191313612"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.612Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 6809eff0-8de4-4351-9ce3-73a1bcf507e1 within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:33.612Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 6809eff0-8de4-4351-9ce3-73a1bcf507e1 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.613Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 2b24c500-d3aa-45ed-b739-119feb6e1e26 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.613Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 04553094-9c13-44da-98d2-240a4b5dd59b for action 2b24c500-d3aa-45ed-b739-119feb6e1e26 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.613Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:33.613Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 6809eff0-8de4-4351-9ce3-73a1bcf507e1 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.614Z","pid":113601,"hostname":"richard","msg":"BeforeEach setup complete for WorkItemDeleteIntegration.test.ts"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.616Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found 4 work items (all, active: true, status: any)."}
{"level":"WARN","time":"2025-05-02T13:08:33.617Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Attempting to soft delete 1 work item(s) and cascade: 64803332-c11c-4d4e-902b-2b300c4dd0dc"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.618Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Finding all descendants..."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.618Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: 64803332-c11c-4d4e-902b-2b300c4dd0dc with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.618Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.619Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent 64803332-c11c-4d4e-902b-2b300c4dd0dc (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.619Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent 64803332-c11c-4d4e-902b-2b300c4dd0dc (active: false, status: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.619Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Full cascade list (1 items) identified: 64803332-c11c-4d4e-902b-2b300c4dd0dc"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.620Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item list (count: 1, link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.620Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item list (count: 1, link active: false, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.620Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Identified 0 potentially affected dependency links for cascade delete."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.621Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found 1 work items by IDs (count: 1, isActive: true)."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.621Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Found 1 active items in cascade list for deletion."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.621Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Items identified in cascade (all):"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.621Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Active items to delete (filtered):"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.621Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Attempting to soft delete these active item IDs: 64803332-c11c-4d4e-902b-2b300c4dd0dc"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.621Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] Executing softDelete SQL: \n      UPDATE work_items\n      SET is_active = FALSE, updated_at = $1\n      WHERE work_item_id IN ($2) AND is_active = TRUE;\n     PARAMS: [\"2025-05-02T13:08:33.621Z\",\"64803332-c11c-4d4e-902b-2b300c4dd0dc\"]"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.621Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] softDelete result rowCount: 1"}
{"level":"INFO","time":"2025-05-02T13:08:33.621Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Soft deleted 1 work item(s)."}
{"level":"INFO","time":"2025-05-02T13:08:33.621Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Repository reported 1 work item(s) soft deleted."}
{"level":"INFO","time":"2025-05-02T13:08:33.621Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] No active dependency links found to soft delete within the cascade."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.622Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action da9b6da4-59c7-47fa-a81c-cde1d4fff9b7 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.622Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step b7cfe1d3-d0c5-4733-a3e4-f45c97ddcaa9 for action da9b6da4-59c7-47fa-a81c-cde1d4fff9b7 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.622Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:33.622Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Recorded history for delete action da9b6da4-59c7-47fa-a81c-cde1d4fff9b7."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.624Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Returning count: 1 (based on repository rowCount)"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.625Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 64803332-c11c-4d4e-902b-2b300c4dd0dc with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.626Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 64803332-c11c-4d4e-902b-2b300c4dd0dc (isActive: false) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.626Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 64803332-c11c-4d4e-902b-2b300c4dd0dc. isActive: false"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.627Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found 3 work items (all, active: true, status: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.628Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 5 recent actions."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.629Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Found 1 steps for action da9b6da4-59c7-47fa-a81c-cde1d4fff9b7."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.631Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Starting database clean up..."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.631Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating undo_steps CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.632Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating action_history CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.641Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating work_item_dependencies CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.641Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating work_items CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.650Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Database clean up committed."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.650Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Database client released."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.650Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 3cf569be-c3aa-48c3-83ef-929df996f4e6"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.650Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Parent Project\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.651Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:33.651Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: parent-project"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.651Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:33.651Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191313651"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.651Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 3cf569be-c3aa-48c3-83ef-929df996f4e6 within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:33.651Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 3cf569be-c3aa-48c3-83ef-929df996f4e6 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.652Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 4558283e-06eb-460e-8406-9e401c93c104 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.652Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step d47650c5-a7c8-4406-934b-15573b301e61 for action 4558283e-06eb-460e-8406-9e401c93c104 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.652Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:33.652Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 3cf569be-c3aa-48c3-83ef-929df996f4e6 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.654Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 29c42b8a-ac82-4c15-8cb4-a0987d0b1528"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.654Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 3cf569be-c3aa-48c3-83ef-929df996f4e6 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.654Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 3cf569be-c3aa-48c3-83ef-929df996f4e6 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.654Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 3cf569be-c3aa-48c3-83ef-929df996f4e6. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.654Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Child Task 1\", parentId: 3cf569be-c3aa-48c3-83ef-929df996f4e6, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.654Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: 3cf569be-c3aa-48c3-83ef-929df996f4e6 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.654Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.654Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent 3cf569be-c3aa-48c3-83ef-929df996f4e6 (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.654Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent 3cf569be-c3aa-48c3-83ef-929df996f4e6 (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:33.654Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: child-task-1"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.654Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: 3cf569be-c3aa-48c3-83ef-929df996f4e6, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:33.654Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191313654"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.654Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 29c42b8a-ac82-4c15-8cb4-a0987d0b1528 within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:33.655Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 29c42b8a-ac82-4c15-8cb4-a0987d0b1528 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.655Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 5b302ec3-7444-471a-81f9-dcfd30dfea43 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.656Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 44213320-d92a-482c-b3ca-02dbf734bff1 for action 5b302ec3-7444-471a-81f9-dcfd30dfea43 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.656Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:33.656Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 29c42b8a-ac82-4c15-8cb4-a0987d0b1528 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.657Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item aff30405-14c5-4071-8904-15b9b7ac7270"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.657Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 3cf569be-c3aa-48c3-83ef-929df996f4e6 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.658Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 3cf569be-c3aa-48c3-83ef-929df996f4e6 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.658Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 3cf569be-c3aa-48c3-83ef-929df996f4e6. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.658Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Child Task 2\", parentId: 3cf569be-c3aa-48c3-83ef-929df996f4e6, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.658Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: 3cf569be-c3aa-48c3-83ef-929df996f4e6 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.658Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.659Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent 3cf569be-c3aa-48c3-83ef-929df996f4e6 (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.659Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent 3cf569be-c3aa-48c3-83ef-929df996f4e6 (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:33.659Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: child-task-2"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.659Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: 3cf569be-c3aa-48c3-83ef-929df996f4e6, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:33.659Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191313659"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.659Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item aff30405-14c5-4071-8904-15b9b7ac7270 within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:33.659Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item aff30405-14c5-4071-8904-15b9b7ac7270 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.660Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action f38a05d4-1629-47a4-b0b1-5de9e4dda47d in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.660Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step b705d6f1-9e83-4773-9bf2-4d9c8ee49371 for action f38a05d4-1629-47a4-b0b1-5de9e4dda47d in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.661Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:33.661Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item aff30405-14c5-4071-8904-15b9b7ac7270 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.662Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 01292f68-66b7-4b4b-b31c-8afa6bc80285"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.662Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 29c42b8a-ac82-4c15-8cb4-a0987d0b1528 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.663Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 29c42b8a-ac82-4c15-8cb4-a0987d0b1528 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.663Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 29c42b8a-ac82-4c15-8cb4-a0987d0b1528. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.663Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Grandchild Task 1\", parentId: 29c42b8a-ac82-4c15-8cb4-a0987d0b1528, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.663Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: 29c42b8a-ac82-4c15-8cb4-a0987d0b1528 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.663Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.663Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent 29c42b8a-ac82-4c15-8cb4-a0987d0b1528 (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.663Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent 29c42b8a-ac82-4c15-8cb4-a0987d0b1528 (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:33.663Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: grandchild-task-1"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.663Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: 29c42b8a-ac82-4c15-8cb4-a0987d0b1528, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:33.663Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191313663"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.663Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 01292f68-66b7-4b4b-b31c-8afa6bc80285 within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:33.664Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 01292f68-66b7-4b4b-b31c-8afa6bc80285 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.664Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 47a248d7-1dd0-4526-b0eb-759ffb6436b0 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.664Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 849aa988-a63f-4e3b-aa02-f3ac140f5726 for action 47a248d7-1dd0-4526-b0eb-759ffb6436b0 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.664Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:33.664Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 01292f68-66b7-4b4b-b31c-8afa6bc80285 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.665Z","pid":113601,"hostname":"richard","msg":"BeforeEach setup complete for WorkItemDeleteIntegration.test.ts"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.666Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService] Updating work item 01292f68-66b7-4b4b-b31c-8afa6bc80285 with data:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.667Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 01292f68-66b7-4b4b-b31c-8afa6bc80285 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.667Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 01292f68-66b7-4b4b-b31c-8afa6bc80285 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.667Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 01292f68-66b7-4b4b-b31c-8afa6bc80285. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.668Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item 01292f68-66b7-4b4b-b31c-8afa6bc80285 (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.668Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps Before Update for 01292f68-66b7-4b4b-b31c-8afa6bc80285:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.668Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Desired Deps State for 01292f68-66b7-4b4b-b31c-8afa6bc80285:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.668Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updating work item 01292f68-66b7-4b4b-b31c-8afa6bc80285 in transaction"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.669Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] No core fields to update for 01292f68-66b7-4b4b-b31c-8afa6bc80285."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.669Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updating dependencies for item 01292f68-66b7-4b4b-b31c-8afa6bc80285. Input dependencies:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.669Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] Found 0 existing dependencies (any state) for 01292f68-66b7-4b4b-b31c-8afa6bc80285:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.669Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] Desired Deps State for 01292f68-66b7-4b4b-b31c-8afa6bc80285:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.669Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] Dependencies actions for 01292f68-66b7-4b4b-b31c-8afa6bc80285: To Insert/Update:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.669Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Inserting/Updating 1 dependencies for 01292f68-66b7-4b4b-b31c-8afa6bc80285."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.670Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Total inserted/updated dependencies for 01292f68-66b7-4b4b-b31c-8afa6bc80285: 1."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.670Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Finished updating dependencies for item 01292f68-66b7-4b4b-b31c-8afa6bc80285."}
{"level":"INFO","time":"2025-05-02T13:08:33.670Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Successfully processed update for item 01292f68-66b7-4b4b-b31c-8afa6bc80285."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.670Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 01292f68-66b7-4b4b-b31c-8afa6bc80285 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.670Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 01292f68-66b7-4b4b-b31c-8afa6bc80285 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.670Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 01292f68-66b7-4b4b-b31c-8afa6bc80285. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.670Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item 01292f68-66b7-4b4b-b31c-8afa6bc80285 (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.670Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps After Update Repo Call for 01292f68-66b7-4b4b-b31c-8afa6bc80285:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.670Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Item fields did NOT change for 01292f68-66b7-4b4b-b31c-8afa6bc80285."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.670Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Checking dependency changes for 01292f68-66b7-4b4b-b31c-8afa6bc80285..."}
{"level":"INFO","time":"2025-05-02T13:08:33.670Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService] Update called for 01292f68-66b7-4b4b-b31c-8afa6bc80285, but no effective changes detected (Item: false, Deps: false). Skipping history."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.672Z","pid":113601,"hostname":"richard","msg":"[WorkItemReadingService] Getting work item by ID: 01292f68-66b7-4b4b-b31c-8afa6bc80285 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.672Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 01292f68-66b7-4b4b-b31c-8afa6bc80285 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.672Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 01292f68-66b7-4b4b-b31c-8afa6bc80285 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.672Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 01292f68-66b7-4b4b-b31c-8afa6bc80285. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.672Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: 01292f68-66b7-4b4b-b31c-8afa6bc80285 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.672Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.674Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 1 dependencies for item 01292f68-66b7-4b4b-b31c-8afa6bc80285 (link active: true, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.687Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item 01292f68-66b7-4b4b-b31c-8afa6bc80285 (link active: true, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.687Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent 01292f68-66b7-4b4b-b31c-8afa6bc80285 (active: true, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.687Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent 01292f68-66b7-4b4b-b31c-8afa6bc80285 (active: true, status: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.688Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 1 dependencies for item 01292f68-66b7-4b4b-b31c-8afa6bc80285 (link active: true, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.688Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found 4 work items (all, active: true, status: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.689Z","pid":113601,"hostname":"richard","msg":"--- DB State Check: BEFORE DELETE ---"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.689Z","pid":113601,"hostname":"richard","msg":"Work Items Found (4):\n[\n  {\n    \"work_item_id\": \"3cf569be-c3aa-48c3-83ef-929df996f4e6\",\n    \"name\": \"Parent Project\",\n    \"shortname\": \"parent-project\",\n    \"is_active\": true,\n    \"status\": \"todo\",\n    \"parent_work_item_id\": null\n  },\n  {\n    \"work_item_id\": \"29c42b8a-ac82-4c15-8cb4-a0987d0b1528\",\n    \"name\": \"Child Task 1\",\n    \"shortname\": \"child-task-1\",\n    \"is_active\": true,\n    \"status\": \"todo\",\n    \"parent_work_item_id\": \"3cf569be-c3aa-48c3-83ef-929df996f4e6\"\n  },\n  {\n    \"work_item_id\": \"aff30405-14c5-4071-8904-15b9b7ac7270\",\n    \"name\": \"Child Task 2\",\n    \"shortname\": \"child-task-2\",\n    \"is_active\": true,\n    \"status\": \"todo\",\n    \"parent_work_item_id\": \"3cf569be-c3aa-48c3-83ef-929df996f4e6\"\n  },\n  {\n    \"work_item_id\": \"01292f68-66b7-4b4b-b31c-8afa6bc80285\",\n    \"name\": \"Grandchild Task 1\",\n    \"shortname\": \"grandchild-task-1\",\n    \"is_active\": true,\n    \"status\": \"todo\",\n    \"parent_work_item_id\": \"29c42b8a-ac82-4c15-8cb4-a0987d0b1528\"\n  }\n]"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.689Z","pid":113601,"hostname":"richard","msg":"Dependency Link 01292f68-66b7-4b4b-b31c-8afa6bc80285 -> aff30405-14c5-4071-8904-15b9b7ac7270 Found (1):\n[\n  {\n    \"work_item_id\": \"01292f68-66b7-4b4b-b31c-8afa6bc80285\",\n    \"depends_on_work_item_id\": \"aff30405-14c5-4071-8904-15b9b7ac7270\",\n    \"is_active\": true,\n    \"dependency_type\": \"finish-to-start\"\n  }\n]"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.689Z","pid":113601,"hostname":"richard","msg":"--- End DB State Check: BEFORE DELETE ---"}
{"level":"WARN","time":"2025-05-02T13:08:33.689Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Attempting to soft delete 1 work item(s) and cascade: 3cf569be-c3aa-48c3-83ef-929df996f4e6"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.690Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Finding all descendants..."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.690Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: 3cf569be-c3aa-48c3-83ef-929df996f4e6 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.690Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.690Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent 3cf569be-c3aa-48c3-83ef-929df996f4e6 (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.690Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent 3cf569be-c3aa-48c3-83ef-929df996f4e6 (active: false, status: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.690Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Full cascade list (1 items) identified: 3cf569be-c3aa-48c3-83ef-929df996f4e6"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.690Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item list (count: 1, link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.690Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item list (count: 1, link active: false, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.690Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Identified 0 potentially affected dependency links for cascade delete."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.691Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found 1 work items by IDs (count: 1, isActive: true)."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.691Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Found 1 active items in cascade list for deletion."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.691Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Items identified in cascade (all):"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.691Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Active items to delete (filtered):"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.691Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Attempting to soft delete these active item IDs: 3cf569be-c3aa-48c3-83ef-929df996f4e6"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.691Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] Executing softDelete SQL: \n      UPDATE work_items\n      SET is_active = FALSE, updated_at = $1\n      WHERE work_item_id IN ($2) AND is_active = TRUE;\n     PARAMS: [\"2025-05-02T13:08:33.691Z\",\"3cf569be-c3aa-48c3-83ef-929df996f4e6\"]"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.691Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] softDelete result rowCount: 1"}
{"level":"INFO","time":"2025-05-02T13:08:33.691Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Soft deleted 1 work item(s)."}
{"level":"INFO","time":"2025-05-02T13:08:33.691Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Repository reported 1 work item(s) soft deleted."}
{"level":"INFO","time":"2025-05-02T13:08:33.691Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] No active dependency links found to soft delete within the cascade."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.691Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 9d061509-7e75-4c44-90c0-256e53acbaa0 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.692Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step d49f9e19-4bb5-462c-aecf-0068b5ce21af for action 9d061509-7e75-4c44-90c0-256e53acbaa0 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.692Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:33.692Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Recorded history for delete action 9d061509-7e75-4c44-90c0-256e53acbaa0."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.697Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Returning count: 1 (based on repository rowCount)"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.697Z","pid":113601,"hostname":"richard","msg":"--- DB State Check: AFTER DELETE ---"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.698Z","pid":113601,"hostname":"richard","msg":"Work Items Found (4):\n[\n  {\n    \"work_item_id\": \"3cf569be-c3aa-48c3-83ef-929df996f4e6\",\n    \"name\": \"Parent Project\",\n    \"shortname\": \"parent-project\",\n    \"is_active\": false,\n    \"status\": \"todo\",\n    \"parent_work_item_id\": null\n  },\n  {\n    \"work_item_id\": \"29c42b8a-ac82-4c15-8cb4-a0987d0b1528\",\n    \"name\": \"Child Task 1\",\n    \"shortname\": \"child-task-1\",\n    \"is_active\": true,\n    \"status\": \"todo\",\n    \"parent_work_item_id\": \"3cf569be-c3aa-48c3-83ef-929df996f4e6\"\n  },\n  {\n    \"work_item_id\": \"aff30405-14c5-4071-8904-15b9b7ac7270\",\n    \"name\": \"Child Task 2\",\n    \"shortname\": \"child-task-2\",\n    \"is_active\": true,\n    \"status\": \"todo\",\n    \"parent_work_item_id\": \"3cf569be-c3aa-48c3-83ef-929df996f4e6\"\n  },\n  {\n    \"work_item_id\": \"01292f68-66b7-4b4b-b31c-8afa6bc80285\",\n    \"name\": \"Grandchild Task 1\",\n    \"shortname\": \"grandchild-task-1\",\n    \"is_active\": true,\n    \"status\": \"todo\",\n    \"parent_work_item_id\": \"29c42b8a-ac82-4c15-8cb4-a0987d0b1528\"\n  }\n]"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.698Z","pid":113601,"hostname":"richard","msg":"Dependency Link 01292f68-66b7-4b4b-b31c-8afa6bc80285 -> aff30405-14c5-4071-8904-15b9b7ac7270 Found (1):\n[\n  {\n    \"work_item_id\": \"01292f68-66b7-4b4b-b31c-8afa6bc80285\",\n    \"depends_on_work_item_id\": \"aff30405-14c5-4071-8904-15b9b7ac7270\",\n    \"is_active\": true,\n    \"dependency_type\": \"finish-to-start\"\n  }\n]"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.698Z","pid":113601,"hostname":"richard","msg":"--- End DB State Check: AFTER DELETE ---"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.707Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Starting database clean up..."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.708Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating undo_steps CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.709Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating action_history CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.717Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating work_item_dependencies CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.718Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating work_items CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.727Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Database clean up committed."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.727Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Database client released."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.727Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 41bbafa8-c1e1-4997-aea1-aa5a9df1c0ad"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.727Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Parent Project\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.727Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:33.727Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: parent-project"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.727Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:33.727Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191313727"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.727Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 41bbafa8-c1e1-4997-aea1-aa5a9df1c0ad within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:33.728Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 41bbafa8-c1e1-4997-aea1-aa5a9df1c0ad with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.728Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 60cb3b80-9253-449e-8fad-9233acf74fc8 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.729Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step b758f505-387d-40d7-9cf8-4aa4ddd2e44f for action 60cb3b80-9253-449e-8fad-9233acf74fc8 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.729Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:33.729Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 41bbafa8-c1e1-4997-aea1-aa5a9df1c0ad and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.730Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 857e5efe-f115-4252-bb73-bd962dc02d75"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.730Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 41bbafa8-c1e1-4997-aea1-aa5a9df1c0ad with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.731Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 41bbafa8-c1e1-4997-aea1-aa5a9df1c0ad (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.731Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 41bbafa8-c1e1-4997-aea1-aa5a9df1c0ad. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.731Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Child Task 1\", parentId: 41bbafa8-c1e1-4997-aea1-aa5a9df1c0ad, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.731Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: 41bbafa8-c1e1-4997-aea1-aa5a9df1c0ad with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.731Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.731Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent 41bbafa8-c1e1-4997-aea1-aa5a9df1c0ad (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.731Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent 41bbafa8-c1e1-4997-aea1-aa5a9df1c0ad (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:33.731Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: child-task-1"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.731Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: 41bbafa8-c1e1-4997-aea1-aa5a9df1c0ad, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:33.731Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191313731"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.731Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 857e5efe-f115-4252-bb73-bd962dc02d75 within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:33.731Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 857e5efe-f115-4252-bb73-bd962dc02d75 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.731Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 49d88f5d-e29f-4811-aad7-1e11a07ccee2 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.732Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 13a5c01c-dcbc-42b3-8f77-e1b918387214 for action 49d88f5d-e29f-4811-aad7-1e11a07ccee2 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.732Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:33.732Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 857e5efe-f115-4252-bb73-bd962dc02d75 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.733Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 771ddc9a-2f42-4c85-bb8f-0fcc9b84cf0e"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.733Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 41bbafa8-c1e1-4997-aea1-aa5a9df1c0ad with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.733Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 41bbafa8-c1e1-4997-aea1-aa5a9df1c0ad (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.733Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 41bbafa8-c1e1-4997-aea1-aa5a9df1c0ad. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.733Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Child Task 2\", parentId: 41bbafa8-c1e1-4997-aea1-aa5a9df1c0ad, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.733Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: 41bbafa8-c1e1-4997-aea1-aa5a9df1c0ad with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.733Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.734Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent 41bbafa8-c1e1-4997-aea1-aa5a9df1c0ad (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.734Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent 41bbafa8-c1e1-4997-aea1-aa5a9df1c0ad (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:33.734Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: child-task-2"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.734Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: 41bbafa8-c1e1-4997-aea1-aa5a9df1c0ad, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:33.734Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191313734"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.734Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 771ddc9a-2f42-4c85-bb8f-0fcc9b84cf0e within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:33.734Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 771ddc9a-2f42-4c85-bb8f-0fcc9b84cf0e with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.734Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 35507813-e2e0-4e1f-9347-15dab571a78b in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.734Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 50017869-451d-4ec9-bf85-e2efaf5be95e for action 35507813-e2e0-4e1f-9347-15dab571a78b in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.735Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:33.735Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 771ddc9a-2f42-4c85-bb8f-0fcc9b84cf0e and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.736Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item c0548e27-f9af-4de2-8982-403103a62f25"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.736Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 857e5efe-f115-4252-bb73-bd962dc02d75 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.736Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 857e5efe-f115-4252-bb73-bd962dc02d75 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.736Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 857e5efe-f115-4252-bb73-bd962dc02d75. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.736Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Grandchild Task 1\", parentId: 857e5efe-f115-4252-bb73-bd962dc02d75, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.736Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: 857e5efe-f115-4252-bb73-bd962dc02d75 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.736Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.736Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent 857e5efe-f115-4252-bb73-bd962dc02d75 (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.736Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent 857e5efe-f115-4252-bb73-bd962dc02d75 (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:33.736Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: grandchild-task-1"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.736Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: 857e5efe-f115-4252-bb73-bd962dc02d75, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:33.736Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191313736"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.736Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item c0548e27-f9af-4de2-8982-403103a62f25 within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:33.737Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item c0548e27-f9af-4de2-8982-403103a62f25 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.737Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 8dea31d8-1916-4c30-8036-ae0e12ce1c4d in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.737Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step d5614ec9-eea8-4cc6-93c7-63f9a1ca2698 for action 8dea31d8-1916-4c30-8036-ae0e12ce1c4d in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.737Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:33.737Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item c0548e27-f9af-4de2-8982-403103a62f25 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.738Z","pid":113601,"hostname":"richard","msg":"BeforeEach setup complete for WorkItemDeleteIntegration.test.ts"}
{"level":"WARN","time":"2025-05-02T13:08:33.738Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Attempting to soft delete 1 work item(s) and cascade: 857e5efe-f115-4252-bb73-bd962dc02d75"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.739Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Finding all descendants..."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.739Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: 857e5efe-f115-4252-bb73-bd962dc02d75 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.739Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.739Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent 857e5efe-f115-4252-bb73-bd962dc02d75 (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.739Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent 857e5efe-f115-4252-bb73-bd962dc02d75 (active: false, status: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.739Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Full cascade list (1 items) identified: 857e5efe-f115-4252-bb73-bd962dc02d75"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.739Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item list (count: 1, link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.739Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item list (count: 1, link active: false, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.739Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Identified 0 potentially affected dependency links for cascade delete."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.740Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found 1 work items by IDs (count: 1, isActive: true)."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.740Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Found 1 active items in cascade list for deletion."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.740Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Items identified in cascade (all):"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.740Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Active items to delete (filtered):"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.740Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Attempting to soft delete these active item IDs: 857e5efe-f115-4252-bb73-bd962dc02d75"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.740Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] Executing softDelete SQL: \n      UPDATE work_items\n      SET is_active = FALSE, updated_at = $1\n      WHERE work_item_id IN ($2) AND is_active = TRUE;\n     PARAMS: [\"2025-05-02T13:08:33.740Z\",\"857e5efe-f115-4252-bb73-bd962dc02d75\"]"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.740Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] softDelete result rowCount: 1"}
{"level":"INFO","time":"2025-05-02T13:08:33.740Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Soft deleted 1 work item(s)."}
{"level":"INFO","time":"2025-05-02T13:08:33.740Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Repository reported 1 work item(s) soft deleted."}
{"level":"INFO","time":"2025-05-02T13:08:33.740Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] No active dependency links found to soft delete within the cascade."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.740Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 22398ca0-3234-489e-b786-784461113d3e in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.740Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 9b364285-b40e-4af3-a756-7de70f945f70 for action 22398ca0-3234-489e-b786-784461113d3e in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.740Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:33.740Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Recorded history for delete action 22398ca0-3234-489e-b786-784461113d3e."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.741Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Returning count: 1 (based on repository rowCount)"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.742Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"INFO","time":"2025-05-02T13:08:33.742Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to undo last action."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.742Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Found original action to undo: 22398ca0-3234-489e-b786-784461113d3e (DELETE_WORK_ITEM_CASCADE)"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.743Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Found 1 steps for action 22398ca0-3234-489e-b786-784461113d3e."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.743Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Executing 1 undo steps for action 22398ca0-3234-489e-b786-784461113d3e in reverse order"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.743Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Executing undo step 1 (UPDATE) on work_items record 857e5efe-f115-4252-bb73-bd962dc02d75 for action 22398ca0-3234-489e-b786-784461113d3e"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.743Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryUndoRedo] Updated row in work_items 857e5efe-f115-4252-bb73-bd962dc02d75 based on PKs."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.744Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 177e6795-52b9-47b8-8ec4-5bd8be32659c in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.744Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked action 22398ca0-3234-489e-b786-784461113d3e as undone by action 177e6795-52b9-47b8-8ec4-5bd8be32659c."}
{"level":"INFO","time":"2025-05-02T13:08:33.744Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Successfully undid action 22398ca0-3234-489e-b786-784461113d3e"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.746Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"WARN","time":"2025-05-02T13:08:33.746Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Attempting to soft delete 1 work item(s) and cascade: 771ddc9a-2f42-4c85-bb8f-0fcc9b84cf0e"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.747Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Finding all descendants..."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.747Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: 771ddc9a-2f42-4c85-bb8f-0fcc9b84cf0e with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.747Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.747Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent 771ddc9a-2f42-4c85-bb8f-0fcc9b84cf0e (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.747Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent 771ddc9a-2f42-4c85-bb8f-0fcc9b84cf0e (active: false, status: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.747Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Full cascade list (1 items) identified: 771ddc9a-2f42-4c85-bb8f-0fcc9b84cf0e"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.747Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item list (count: 1, link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.748Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item list (count: 1, link active: false, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.748Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Identified 0 potentially affected dependency links for cascade delete."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.748Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found 1 work items by IDs (count: 1, isActive: true)."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.748Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Found 1 active items in cascade list for deletion."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.748Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Items identified in cascade (all):"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.748Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Active items to delete (filtered):"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.748Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Attempting to soft delete these active item IDs: 771ddc9a-2f42-4c85-bb8f-0fcc9b84cf0e"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.748Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] Executing softDelete SQL: \n      UPDATE work_items\n      SET is_active = FALSE, updated_at = $1\n      WHERE work_item_id IN ($2) AND is_active = TRUE;\n     PARAMS: [\"2025-05-02T13:08:33.748Z\",\"771ddc9a-2f42-4c85-bb8f-0fcc9b84cf0e\"]"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.749Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] softDelete result rowCount: 1"}
{"level":"INFO","time":"2025-05-02T13:08:33.749Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Soft deleted 1 work item(s)."}
{"level":"INFO","time":"2025-05-02T13:08:33.749Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Repository reported 1 work item(s) soft deleted."}
{"level":"INFO","time":"2025-05-02T13:08:33.749Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] No active dependency links found to soft delete within the cascade."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.749Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 46502106-c1df-4636-b37b-66fd058e47ec in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.750Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 5406e1ef-448e-4d5a-9fa9-9fdb70c4c05c for action 46502106-c1df-4636-b37b-66fd058e47ec in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.751Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.752Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked UNDO_ACTION 177e6795-52b9-47b8-8ec4-5bd8be32659c as redone/invalidated by action 46502106-c1df-4636-b37b-66fd058e47ec."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.752Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Invalidated 1 potential redo(s) due to new action 46502106-c1df-4636-b37b-66fd058e47ec."}
{"level":"INFO","time":"2025-05-02T13:08:33.752Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Recorded history for delete action 46502106-c1df-4636-b37b-66fd058e47ec."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.753Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Returning count: 1 (based on repository rowCount)"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.754Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"INFO","time":"2025-05-02T13:08:33.754Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to redo last undo action."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.755Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] No un-redone UNDO_ACTIONs found."}
FAIL dist/services/__tests__/workItemDeleteIntegration.test.js
   WorkItemService - Delete Work Item Integration Tests  Soft Delete Operations  should soft delete parent and all descendants recursively

    expect(received).toBe(expected) // Object.is equality

    Expected: 4
    Received: 1

      150 |       // *** REVERTED ASSERTION ***
      151 |       // Verify count of deleted items matches the full cascade size now
    > 152 |       expect(deletedCount).toBe(descendantIds.length); // Should return 4 once the repo bug is fixed
          |                            ^
      153 |
      154 |       // Query each descendant to confirm soft delete (verify the cascade *intent* worked)
      155 |       logger.debug('Verifying final state after delete cascade using repository...');

      at Object.<anonymous> (src/services/__tests__/workItemDeleteIntegration.test.ts:152:28)

{"level":"INFO","time":"2025-05-02T13:08:33.850Z","pid":113601,"hostname":"richard","msg":"Loading environment variable overrides for configuration..."}
{"level":"INFO","time":"2025-05-02T13:08:33.755Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] No undo action found to redo."}
{"level":"INFO","time":"2025-05-02T13:08:33.850Z","pid":113601,"hostname":"richard","msg":"Overriding pgHost from env: localhost"}
{"level":"INFO","time":"2025-05-02T13:08:33.850Z","pid":113601,"hostname":"richard","msg":"Overriding pgPort from env: 5432"}
{"level":"INFO","time":"2025-05-02T13:08:33.850Z","pid":113601,"hostname":"richard","msg":"Overriding pgUser from env: taskmanager_user"}
{"level":"INFO","time":"2025-05-02T13:08:33.850Z","pid":113601,"hostname":"richard","msg":"Overriding pgPassword from env."}
{"level":"INFO","time":"2025-05-02T13:08:33.850Z","pid":113601,"hostname":"richard","msg":"Overriding pgDatabase from env: taskmanager_db"}
{"level":"INFO","time":"2025-05-02T13:08:33.851Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] Setting up PostgreSQL connection pool..."}
{"level":"INFO","time":"2025-05-02T13:08:33.851Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] PostgreSQL connection pool configured."}
{"level":"INFO","time":"2025-05-02T13:08:33.851Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] Starting database schema initialization..."}
{"level":"INFO","time":"2025-05-02T13:08:33.866Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] Connected to PostgreSQL for schema check/application."}
{"level":"INFO","time":"2025-05-02T13:08:33.866Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] Force schema run enabled or tables missing. Initializing/Re-initializing schema..."}
{"level":"INFO","time":"2025-05-02T13:08:33.866Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] Looking for schema file at: /home/richard/repos/mcp-task-manager-server/dist/db/schema.sql"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.866Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] Schema file read successfully. Executing schema setup..."}
{"level":"INFO","time":"2025-05-02T13:08:33.884Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] Full schema script executed."}
{"level":"INFO","time":"2025-05-02T13:08:33.886Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] Confirmed work_items table exists after schema execution."}
{"level":"INFO","time":"2025-05-02T13:08:33.886Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] Initialization marked as complete."}
{"level":"INFO","time":"2025-05-02T13:08:33.886Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] Released schema check/application client."}
{"level":"INFO","time":"2025-05-02T13:08:33.886Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] Instance created and database initialized."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.888Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Starting database clean up..."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.888Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating undo_steps CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.889Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating action_history CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.898Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating work_item_dependencies CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.899Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating work_items CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.908Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Database clean up committed."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.908Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Database client released."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.908Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 4622efad-b2bc-4fbc-858a-6a6e32f92131"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.909Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Item 1\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.910Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:33.910Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: item-1"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.910Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:33.910Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191313910"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.911Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 4622efad-b2bc-4fbc-858a-6a6e32f92131 within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:33.912Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 4622efad-b2bc-4fbc-858a-6a6e32f92131 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.913Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 7b8af6a7-d3e8-48e8-b8d7-c1cd968b61fa in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.914Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 749e57fe-b37e-43e9-98c5-8784e24e8152 for action 7b8af6a7-d3e8-48e8-b8d7-c1cd968b61fa in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.915Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:33.915Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 4622efad-b2bc-4fbc-858a-6a6e32f92131 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.917Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.917Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 8d8401f3-b4e6-4cce-bee8-b07ad79ea494"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.917Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Item 2\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.918Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:33.918Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: item-2"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.918Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:33.918Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191313918"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.918Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 8d8401f3-b4e6-4cce-bee8-b07ad79ea494 within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:33.918Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 8d8401f3-b4e6-4cce-bee8-b07ad79ea494 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.918Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 04e66651-04f6-419f-9bd4-77037baed448 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.918Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 84bfc469-197c-46f0-981a-41c2ae6e7745 for action 04e66651-04f6-419f-9bd4-77037baed448 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.919Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:33.919Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 8d8401f3-b4e6-4cce-bee8-b07ad79ea494 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.920Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.920Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService] Updating work item 4622efad-b2bc-4fbc-858a-6a6e32f92131 with data:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.921Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 4622efad-b2bc-4fbc-858a-6a6e32f92131 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.921Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 4622efad-b2bc-4fbc-858a-6a6e32f92131 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.922Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 4622efad-b2bc-4fbc-858a-6a6e32f92131. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.922Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item 4622efad-b2bc-4fbc-858a-6a6e32f92131 (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.922Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps Before Update for 4622efad-b2bc-4fbc-858a-6a6e32f92131:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.922Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Item 1 Updated\", parentId: null, currentItemId: 4622efad-b2bc-4fbc-858a-6a6e32f92131"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.922Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:33.922Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: item-1-updated"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.922Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Desired Deps State for 4622efad-b2bc-4fbc-858a-6a6e32f92131:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.923Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updating work item 4622efad-b2bc-4fbc-858a-6a6e32f92131 in transaction"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.923Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updated work item 4622efad-b2bc-4fbc-858a-6a6e32f92131 fields. Row count: 1"}
{"level":"INFO","time":"2025-05-02T13:08:33.923Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Successfully processed update for item 4622efad-b2bc-4fbc-858a-6a6e32f92131."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.923Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 4622efad-b2bc-4fbc-858a-6a6e32f92131 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.923Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 4622efad-b2bc-4fbc-858a-6a6e32f92131 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.923Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 4622efad-b2bc-4fbc-858a-6a6e32f92131. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.923Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item 4622efad-b2bc-4fbc-858a-6a6e32f92131 (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.924Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps After Update Repo Call for 4622efad-b2bc-4fbc-858a-6a6e32f92131:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.924Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Item fields changed for 4622efad-b2bc-4fbc-858a-6a6e32f92131."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.924Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Effective changes detected for 4622efad-b2bc-4fbc-858a-6a6e32f92131. Generating history."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.924Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 477efe61-aa94-4b82-a32c-1816a13dfd61 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.924Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 3edd68ab-785b-48c8-9fad-3f542f50258e for action 477efe61-aa94-4b82-a32c-1816a13dfd61 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.924Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:33.924Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService] Recorded history for update of work item 4622efad-b2bc-4fbc-858a-6a6e32f92131."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.925Z","pid":113601,"hostname":"richard","msg":"[WorkItemReadingService] Getting work item by ID: 4622efad-b2bc-4fbc-858a-6a6e32f92131 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.925Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 4622efad-b2bc-4fbc-858a-6a6e32f92131 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.926Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 4622efad-b2bc-4fbc-858a-6a6e32f92131 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.926Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 4622efad-b2bc-4fbc-858a-6a6e32f92131. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.926Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: 4622efad-b2bc-4fbc-858a-6a6e32f92131 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.926Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.926Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item 4622efad-b2bc-4fbc-858a-6a6e32f92131 (link active: true, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.936Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item 4622efad-b2bc-4fbc-858a-6a6e32f92131 (link active: true, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.936Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent 4622efad-b2bc-4fbc-858a-6a6e32f92131 (active: true, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.936Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent 4622efad-b2bc-4fbc-858a-6a6e32f92131 (active: true, status: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.937Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"WARN","time":"2025-05-02T13:08:33.938Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Attempting to soft delete 1 work item(s) and cascade: 8d8401f3-b4e6-4cce-bee8-b07ad79ea494"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.938Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Finding all descendants..."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.938Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: 8d8401f3-b4e6-4cce-bee8-b07ad79ea494 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.938Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.939Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent 8d8401f3-b4e6-4cce-bee8-b07ad79ea494 (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.939Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent 8d8401f3-b4e6-4cce-bee8-b07ad79ea494 (active: false, status: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.939Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Full cascade list (1 items) identified: 8d8401f3-b4e6-4cce-bee8-b07ad79ea494"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.940Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item list (count: 1, link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.941Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item list (count: 1, link active: false, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.941Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Identified 0 potentially affected dependency links for cascade delete."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.942Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found 1 work items by IDs (count: 1, isActive: true)."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.942Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Found 1 active items in cascade list for deletion."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.942Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Items identified in cascade (all):"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.942Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Active items to delete (filtered):"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.942Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Attempting to soft delete these active item IDs: 8d8401f3-b4e6-4cce-bee8-b07ad79ea494"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.942Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] Executing softDelete SQL: \n      UPDATE work_items\n      SET is_active = FALSE, updated_at = $1\n      WHERE work_item_id IN ($2) AND is_active = TRUE;\n     PARAMS: [\"2025-05-02T13:08:33.942Z\",\"8d8401f3-b4e6-4cce-bee8-b07ad79ea494\"]"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.943Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] softDelete result rowCount: 1"}
{"level":"INFO","time":"2025-05-02T13:08:33.943Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Soft deleted 1 work item(s)."}
{"level":"INFO","time":"2025-05-02T13:08:33.943Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Repository reported 1 work item(s) soft deleted."}
{"level":"INFO","time":"2025-05-02T13:08:33.943Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] No active dependency links found to soft delete within the cascade."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.943Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 804f09d3-b6d1-4674-a746-96740bb1b053 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.944Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 397dc21d-bb9d-44eb-ad6e-0d33fa779b0f for action 804f09d3-b6d1-4674-a746-96740bb1b053 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.946Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:33.946Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Recorded history for delete action 804f09d3-b6d1-4674-a746-96740bb1b053."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.958Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Returning count: 1 (based on repository rowCount)"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.959Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.961Z","pid":113601,"hostname":"richard","msg":"BeforeEach setup complete. Initial items: item1"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.961Z","pid":113601,"hostname":"richard","msg":"Initial actions: action1"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.961Z","pid":113601,"hostname":"richard","msg":"Test: should undo last action (delete item 2) - Starting"}
{"level":"INFO","time":"2025-05-02T13:08:33.961Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to undo last action."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.962Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Found original action to undo: 804f09d3-b6d1-4674-a746-96740bb1b053 (DELETE_WORK_ITEM_CASCADE)"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.963Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Found 1 steps for action 804f09d3-b6d1-4674-a746-96740bb1b053."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.964Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Executing 1 undo steps for action 804f09d3-b6d1-4674-a746-96740bb1b053 in reverse order"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.964Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Executing undo step 1 (UPDATE) on work_items record 8d8401f3-b4e6-4cce-bee8-b07ad79ea494 for action 804f09d3-b6d1-4674-a746-96740bb1b053"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.965Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryUndoRedo] Updated row in work_items 8d8401f3-b4e6-4cce-bee8-b07ad79ea494 based on PKs."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.965Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 67b5f756-14ea-41b9-8c38-aa5a9568d4cd in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.966Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked action 804f09d3-b6d1-4674-a746-96740bb1b053 as undone by action 67b5f756-14ea-41b9-8c38-aa5a9568d4cd."}
{"level":"INFO","time":"2025-05-02T13:08:33.966Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Successfully undid action 804f09d3-b6d1-4674-a746-96740bb1b053"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.968Z","pid":113601,"hostname":"richard","msg":"Test: should undo last action (delete item 2) - undoLastAction result:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.968Z","pid":113601,"hostname":"richard","msg":"Test: should undo last action (delete item 2) - Fetching item 2 after undo"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.968Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 8d8401f3-b4e6-4cce-bee8-b07ad79ea494 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.969Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 8d8401f3-b4e6-4cce-bee8-b07ad79ea494 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.969Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 8d8401f3-b4e6-4cce-bee8-b07ad79ea494. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.969Z","pid":113601,"hostname":"richard","msg":"Test: should undo last action (delete item 2) - Fetched item 2 after undo:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.969Z","pid":113601,"hostname":"richard","msg":"Test: should undo last action (delete item 2) - Fetching item 1 after undo"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.969Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 4622efad-b2bc-4fbc-858a-6a6e32f92131 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.969Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 4622efad-b2bc-4fbc-858a-6a6e32f92131 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.970Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 4622efad-b2bc-4fbc-858a-6a6e32f92131. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.970Z","pid":113601,"hostname":"richard","msg":"Test: should undo last action (delete item 2) - Fetched item 1 after undo:"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.971Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.971Z","pid":113601,"hostname":"richard","msg":"Test: should undo last action (delete item 2) - Finished"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.973Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Starting database clean up..."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.973Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating undo_steps CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.974Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating action_history CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.983Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating work_item_dependencies CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.984Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating work_items CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.995Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Database clean up committed."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.995Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Database client released."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.995Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item fa9549f3-332d-4f1c-99f4-0ee774dee0c7"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.996Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Item 1\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.996Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:33.996Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: item-1"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.996Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:33.996Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191313996"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.996Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item fa9549f3-332d-4f1c-99f4-0ee774dee0c7 within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:33.997Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item fa9549f3-332d-4f1c-99f4-0ee774dee0c7 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.997Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action ded70a9f-721c-4c7d-91b3-33037c19b70f in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.998Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 31e0a64c-4c69-45e1-a43c-c22ece793a29 for action ded70a9f-721c-4c7d-91b3-33037c19b70f in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.998Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:33.998Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item fa9549f3-332d-4f1c-99f4-0ee774dee0c7 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:33.999Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T13:08:33.999Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 89b85128-e4ad-42d2-9130-ce4fc5d51795"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.000Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Item 2\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.000Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:34.000Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: item-2"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.000Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:34.000Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191314000"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.000Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 89b85128-e4ad-42d2-9130-ce4fc5d51795 within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:34.000Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 89b85128-e4ad-42d2-9130-ce4fc5d51795 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.000Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action e508c092-9b98-4b7e-ad06-400e80fa4901 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.001Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 268db793-ed6e-4fef-9bf2-82ee4e4ab94e for action e508c092-9b98-4b7e-ad06-400e80fa4901 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.001Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:34.001Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 89b85128-e4ad-42d2-9130-ce4fc5d51795 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.002Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.002Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService] Updating work item fa9549f3-332d-4f1c-99f4-0ee774dee0c7 with data:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.002Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: fa9549f3-332d-4f1c-99f4-0ee774dee0c7 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.003Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID fa9549f3-332d-4f1c-99f4-0ee774dee0c7 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.003Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item fa9549f3-332d-4f1c-99f4-0ee774dee0c7. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.003Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item fa9549f3-332d-4f1c-99f4-0ee774dee0c7 (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.003Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps Before Update for fa9549f3-332d-4f1c-99f4-0ee774dee0c7:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.003Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Item 1 Updated\", parentId: null, currentItemId: fa9549f3-332d-4f1c-99f4-0ee774dee0c7"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.004Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:34.004Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: item-1-updated"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.004Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Desired Deps State for fa9549f3-332d-4f1c-99f4-0ee774dee0c7:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.004Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updating work item fa9549f3-332d-4f1c-99f4-0ee774dee0c7 in transaction"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.005Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updated work item fa9549f3-332d-4f1c-99f4-0ee774dee0c7 fields. Row count: 1"}
{"level":"INFO","time":"2025-05-02T13:08:34.005Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Successfully processed update for item fa9549f3-332d-4f1c-99f4-0ee774dee0c7."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.005Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: fa9549f3-332d-4f1c-99f4-0ee774dee0c7 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.005Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID fa9549f3-332d-4f1c-99f4-0ee774dee0c7 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.005Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item fa9549f3-332d-4f1c-99f4-0ee774dee0c7. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.005Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item fa9549f3-332d-4f1c-99f4-0ee774dee0c7 (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.005Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps After Update Repo Call for fa9549f3-332d-4f1c-99f4-0ee774dee0c7:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.005Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Item fields changed for fa9549f3-332d-4f1c-99f4-0ee774dee0c7."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.005Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Effective changes detected for fa9549f3-332d-4f1c-99f4-0ee774dee0c7. Generating history."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.006Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 68c58959-c6f7-4629-8005-1b26efe21fe3 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.006Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step ab136bd9-cd58-4074-b950-e73f9df73ea8 for action 68c58959-c6f7-4629-8005-1b26efe21fe3 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.007Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:34.007Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService] Recorded history for update of work item fa9549f3-332d-4f1c-99f4-0ee774dee0c7."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.008Z","pid":113601,"hostname":"richard","msg":"[WorkItemReadingService] Getting work item by ID: fa9549f3-332d-4f1c-99f4-0ee774dee0c7 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.008Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: fa9549f3-332d-4f1c-99f4-0ee774dee0c7 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.008Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID fa9549f3-332d-4f1c-99f4-0ee774dee0c7 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.008Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item fa9549f3-332d-4f1c-99f4-0ee774dee0c7. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.008Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: fa9549f3-332d-4f1c-99f4-0ee774dee0c7 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.008Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.009Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item fa9549f3-332d-4f1c-99f4-0ee774dee0c7 (link active: true, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.009Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item fa9549f3-332d-4f1c-99f4-0ee774dee0c7 (link active: true, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.010Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent fa9549f3-332d-4f1c-99f4-0ee774dee0c7 (active: true, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.010Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent fa9549f3-332d-4f1c-99f4-0ee774dee0c7 (active: true, status: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.010Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"WARN","time":"2025-05-02T13:08:34.010Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Attempting to soft delete 1 work item(s) and cascade: 89b85128-e4ad-42d2-9130-ce4fc5d51795"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.010Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Finding all descendants..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.011Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: 89b85128-e4ad-42d2-9130-ce4fc5d51795 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.011Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.011Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent 89b85128-e4ad-42d2-9130-ce4fc5d51795 (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.011Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent 89b85128-e4ad-42d2-9130-ce4fc5d51795 (active: false, status: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.011Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Full cascade list (1 items) identified: 89b85128-e4ad-42d2-9130-ce4fc5d51795"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.012Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item list (count: 1, link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.012Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item list (count: 1, link active: false, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.012Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Identified 0 potentially affected dependency links for cascade delete."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.013Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found 1 work items by IDs (count: 1, isActive: true)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.013Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Found 1 active items in cascade list for deletion."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.013Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Items identified in cascade (all):"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.013Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Active items to delete (filtered):"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.013Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Attempting to soft delete these active item IDs: 89b85128-e4ad-42d2-9130-ce4fc5d51795"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.013Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] Executing softDelete SQL: \n      UPDATE work_items\n      SET is_active = FALSE, updated_at = $1\n      WHERE work_item_id IN ($2) AND is_active = TRUE;\n     PARAMS: [\"2025-05-02T13:08:34.013Z\",\"89b85128-e4ad-42d2-9130-ce4fc5d51795\"]"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.013Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] softDelete result rowCount: 1"}
{"level":"INFO","time":"2025-05-02T13:08:34.013Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Soft deleted 1 work item(s)."}
{"level":"INFO","time":"2025-05-02T13:08:34.013Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Repository reported 1 work item(s) soft deleted."}
{"level":"INFO","time":"2025-05-02T13:08:34.013Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] No active dependency links found to soft delete within the cascade."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.014Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action fd795f38-6c19-4bf7-8037-7fab3d0265d4 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.014Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 080af0dc-eb2f-4559-836f-fb9828c25015 for action fd795f38-6c19-4bf7-8037-7fab3d0265d4 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.015Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:34.015Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Recorded history for delete action fd795f38-6c19-4bf7-8037-7fab3d0265d4."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.016Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Returning count: 1 (based on repository rowCount)"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.016Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.017Z","pid":113601,"hostname":"richard","msg":"BeforeEach setup complete. Initial items: item1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.017Z","pid":113601,"hostname":"richard","msg":"Initial actions: action1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.017Z","pid":113601,"hostname":"richard","msg":"Test: should undo multiple actions sequentially - Starting"}
{"level":"INFO","time":"2025-05-02T13:08:34.017Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to undo last action."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.018Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Found original action to undo: fd795f38-6c19-4bf7-8037-7fab3d0265d4 (DELETE_WORK_ITEM_CASCADE)"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.019Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Found 1 steps for action fd795f38-6c19-4bf7-8037-7fab3d0265d4."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.019Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Executing 1 undo steps for action fd795f38-6c19-4bf7-8037-7fab3d0265d4 in reverse order"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.019Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Executing undo step 1 (UPDATE) on work_items record 89b85128-e4ad-42d2-9130-ce4fc5d51795 for action fd795f38-6c19-4bf7-8037-7fab3d0265d4"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.020Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryUndoRedo] Updated row in work_items 89b85128-e4ad-42d2-9130-ce4fc5d51795 based on PKs."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.020Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action b9079cbe-9a07-469f-ab35-3f63eb591d56 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.020Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked action fd795f38-6c19-4bf7-8037-7fab3d0265d4 as undone by action b9079cbe-9a07-469f-ab35-3f63eb591d56."}
{"level":"INFO","time":"2025-05-02T13:08:34.020Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Successfully undid action fd795f38-6c19-4bf7-8037-7fab3d0265d4"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.022Z","pid":113601,"hostname":"richard","msg":"Test: should undo multiple actions sequentially - 1st undo (delete) result:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.022Z","pid":113601,"hostname":"richard","msg":"Test: should undo multiple actions sequentially - Performing 2nd undo (update)"}
{"level":"INFO","time":"2025-05-02T13:08:34.022Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to undo last action."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.023Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Found original action to undo: 68c58959-c6f7-4629-8005-1b26efe21fe3 (UPDATE_WORK_ITEM)"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.023Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Found 1 steps for action 68c58959-c6f7-4629-8005-1b26efe21fe3."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.024Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Executing 1 undo steps for action 68c58959-c6f7-4629-8005-1b26efe21fe3 in reverse order"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.024Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Executing undo step 1 (UPDATE) on work_items record fa9549f3-332d-4f1c-99f4-0ee774dee0c7 for action 68c58959-c6f7-4629-8005-1b26efe21fe3"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.024Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryUndoRedo] Updated row in work_items fa9549f3-332d-4f1c-99f4-0ee774dee0c7 based on PKs."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.025Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action b2f02ae3-e9c0-4419-ac07-7fe3dbfe1601 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.025Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked action 68c58959-c6f7-4629-8005-1b26efe21fe3 as undone by action b2f02ae3-e9c0-4419-ac07-7fe3dbfe1601."}
{"level":"INFO","time":"2025-05-02T13:08:34.025Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Successfully undid action 68c58959-c6f7-4629-8005-1b26efe21fe3"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.026Z","pid":113601,"hostname":"richard","msg":"Test: should undo multiple actions sequentially - 2nd undo (update) result:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.027Z","pid":113601,"hostname":"richard","msg":"Test: should undo multiple actions sequentially - Fetching items after 2nd undo"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.027Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: fa9549f3-332d-4f1c-99f4-0ee774dee0c7 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.027Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID fa9549f3-332d-4f1c-99f4-0ee774dee0c7 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.027Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item fa9549f3-332d-4f1c-99f4-0ee774dee0c7. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.027Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 89b85128-e4ad-42d2-9130-ce4fc5d51795 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.027Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 89b85128-e4ad-42d2-9130-ce4fc5d51795 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.027Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 89b85128-e4ad-42d2-9130-ce4fc5d51795. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.027Z","pid":113601,"hostname":"richard","msg":"Test: should undo multiple actions sequentially - Fetched item 1 after 2nd undo:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.027Z","pid":113601,"hostname":"richard","msg":"Test: should undo multiple actions sequentially - Fetched item 2 after 2nd undo:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.028Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.028Z","pid":113601,"hostname":"richard","msg":"Test: should undo multiple actions sequentially - Finished"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.029Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Starting database clean up..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.029Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating undo_steps CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.030Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating action_history CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.038Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating work_item_dependencies CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.039Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating work_items CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.048Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Database clean up committed."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.048Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Database client released."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.049Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 9946c06f-b63d-401e-862d-07682c2b2474"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.049Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Item 1\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.049Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:34.049Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: item-1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.049Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:34.049Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191314049"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.049Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 9946c06f-b63d-401e-862d-07682c2b2474 within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:34.050Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 9946c06f-b63d-401e-862d-07682c2b2474 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.050Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 9d9644cc-d9c1-4b6e-b79e-3d9bf91f9be2 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.051Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step acca25d7-e62f-46dc-8742-c06d0d5a832e for action 9d9644cc-d9c1-4b6e-b79e-3d9bf91f9be2 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.051Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:34.051Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 9946c06f-b63d-401e-862d-07682c2b2474 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.052Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.052Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item c0e7fd7e-5291-469e-a9d6-0fbf81950ac7"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.052Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Item 2\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.053Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:34.053Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: item-2"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.053Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:34.053Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191314053"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.053Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item c0e7fd7e-5291-469e-a9d6-0fbf81950ac7 within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:34.053Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item c0e7fd7e-5291-469e-a9d6-0fbf81950ac7 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.053Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 2741e176-a8de-48eb-a728-207be5745cdf in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.054Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 1ca4142c-5c36-4f14-983b-3c8a98a40e95 for action 2741e176-a8de-48eb-a728-207be5745cdf in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.054Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:34.054Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item c0e7fd7e-5291-469e-a9d6-0fbf81950ac7 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.055Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.055Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService] Updating work item 9946c06f-b63d-401e-862d-07682c2b2474 with data:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.055Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 9946c06f-b63d-401e-862d-07682c2b2474 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.055Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 9946c06f-b63d-401e-862d-07682c2b2474 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.055Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 9946c06f-b63d-401e-862d-07682c2b2474. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.056Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item 9946c06f-b63d-401e-862d-07682c2b2474 (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.056Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps Before Update for 9946c06f-b63d-401e-862d-07682c2b2474:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.056Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Item 1 Updated\", parentId: null, currentItemId: 9946c06f-b63d-401e-862d-07682c2b2474"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.056Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:34.056Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: item-1-updated"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.056Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Desired Deps State for 9946c06f-b63d-401e-862d-07682c2b2474:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.056Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updating work item 9946c06f-b63d-401e-862d-07682c2b2474 in transaction"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.056Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updated work item 9946c06f-b63d-401e-862d-07682c2b2474 fields. Row count: 1"}
{"level":"INFO","time":"2025-05-02T13:08:34.056Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Successfully processed update for item 9946c06f-b63d-401e-862d-07682c2b2474."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.056Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 9946c06f-b63d-401e-862d-07682c2b2474 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.057Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 9946c06f-b63d-401e-862d-07682c2b2474 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.057Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 9946c06f-b63d-401e-862d-07682c2b2474. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.057Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item 9946c06f-b63d-401e-862d-07682c2b2474 (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.057Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps After Update Repo Call for 9946c06f-b63d-401e-862d-07682c2b2474:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.057Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Item fields changed for 9946c06f-b63d-401e-862d-07682c2b2474."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.057Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Effective changes detected for 9946c06f-b63d-401e-862d-07682c2b2474. Generating history."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.057Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 6bb55d6e-9795-4d0d-bfdf-e69f3abf11eb in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.057Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 93618659-4765-409a-8ae7-826364628349 for action 6bb55d6e-9795-4d0d-bfdf-e69f3abf11eb in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.058Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:34.058Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService] Recorded history for update of work item 9946c06f-b63d-401e-862d-07682c2b2474."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.059Z","pid":113601,"hostname":"richard","msg":"[WorkItemReadingService] Getting work item by ID: 9946c06f-b63d-401e-862d-07682c2b2474 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.059Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 9946c06f-b63d-401e-862d-07682c2b2474 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.059Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 9946c06f-b63d-401e-862d-07682c2b2474 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.059Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 9946c06f-b63d-401e-862d-07682c2b2474. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.059Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: 9946c06f-b63d-401e-862d-07682c2b2474 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.059Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.059Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item 9946c06f-b63d-401e-862d-07682c2b2474 (link active: true, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.060Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent 9946c06f-b63d-401e-862d-07682c2b2474 (active: true, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.060Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent 9946c06f-b63d-401e-862d-07682c2b2474 (active: true, status: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.060Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item 9946c06f-b63d-401e-862d-07682c2b2474 (link active: true, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.061Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"WARN","time":"2025-05-02T13:08:34.061Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Attempting to soft delete 1 work item(s) and cascade: c0e7fd7e-5291-469e-a9d6-0fbf81950ac7"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.062Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Finding all descendants..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.062Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: c0e7fd7e-5291-469e-a9d6-0fbf81950ac7 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.062Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.062Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent c0e7fd7e-5291-469e-a9d6-0fbf81950ac7 (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.062Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent c0e7fd7e-5291-469e-a9d6-0fbf81950ac7 (active: false, status: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.062Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Full cascade list (1 items) identified: c0e7fd7e-5291-469e-a9d6-0fbf81950ac7"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.063Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item list (count: 1, link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.063Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item list (count: 1, link active: false, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.063Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Identified 0 potentially affected dependency links for cascade delete."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.063Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found 1 work items by IDs (count: 1, isActive: true)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.063Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Found 1 active items in cascade list for deletion."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.063Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Items identified in cascade (all):"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.063Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Active items to delete (filtered):"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.063Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Attempting to soft delete these active item IDs: c0e7fd7e-5291-469e-a9d6-0fbf81950ac7"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.063Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] Executing softDelete SQL: \n      UPDATE work_items\n      SET is_active = FALSE, updated_at = $1\n      WHERE work_item_id IN ($2) AND is_active = TRUE;\n     PARAMS: [\"2025-05-02T13:08:34.063Z\",\"c0e7fd7e-5291-469e-a9d6-0fbf81950ac7\"]"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.064Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] softDelete result rowCount: 1"}
{"level":"INFO","time":"2025-05-02T13:08:34.064Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Soft deleted 1 work item(s)."}
{"level":"INFO","time":"2025-05-02T13:08:34.064Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Repository reported 1 work item(s) soft deleted."}
{"level":"INFO","time":"2025-05-02T13:08:34.064Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] No active dependency links found to soft delete within the cascade."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.064Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action b145bcd7-61d0-44ec-8497-980581b1b147 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.065Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 3354d9a1-f182-4f58-97b6-aa7367ca969c for action b145bcd7-61d0-44ec-8497-980581b1b147 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.065Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:34.065Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Recorded history for delete action b145bcd7-61d0-44ec-8497-980581b1b147."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.066Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Returning count: 1 (based on repository rowCount)"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.067Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.067Z","pid":113601,"hostname":"richard","msg":"BeforeEach setup complete. Initial items: item1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.067Z","pid":113601,"hostname":"richard","msg":"Initial actions: action1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.067Z","pid":113601,"hostname":"richard","msg":"Test: should return null if no action to undo - Starting"}
{"level":"INFO","time":"2025-05-02T13:08:34.067Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to undo last action."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.068Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Found original action to undo: b145bcd7-61d0-44ec-8497-980581b1b147 (DELETE_WORK_ITEM_CASCADE)"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.068Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Found 1 steps for action b145bcd7-61d0-44ec-8497-980581b1b147."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.068Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Executing 1 undo steps for action b145bcd7-61d0-44ec-8497-980581b1b147 in reverse order"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.068Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Executing undo step 1 (UPDATE) on work_items record c0e7fd7e-5291-469e-a9d6-0fbf81950ac7 for action b145bcd7-61d0-44ec-8497-980581b1b147"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.068Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryUndoRedo] Updated row in work_items c0e7fd7e-5291-469e-a9d6-0fbf81950ac7 based on PKs."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.069Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 1db9d019-4efd-4919-a5f9-9bfaf6f231df in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.069Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked action b145bcd7-61d0-44ec-8497-980581b1b147 as undone by action 1db9d019-4efd-4919-a5f9-9bfaf6f231df."}
{"level":"INFO","time":"2025-05-02T13:08:34.069Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Successfully undid action b145bcd7-61d0-44ec-8497-980581b1b147"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.070Z","pid":113601,"hostname":"richard","msg":"Test: should return null if no action to undo - 1st undo result:"}
{"level":"INFO","time":"2025-05-02T13:08:34.070Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to undo last action."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.070Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Found original action to undo: 6bb55d6e-9795-4d0d-bfdf-e69f3abf11eb (UPDATE_WORK_ITEM)"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.070Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Found 1 steps for action 6bb55d6e-9795-4d0d-bfdf-e69f3abf11eb."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.070Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Executing 1 undo steps for action 6bb55d6e-9795-4d0d-bfdf-e69f3abf11eb in reverse order"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.071Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Executing undo step 1 (UPDATE) on work_items record 9946c06f-b63d-401e-862d-07682c2b2474 for action 6bb55d6e-9795-4d0d-bfdf-e69f3abf11eb"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.071Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryUndoRedo] Updated row in work_items 9946c06f-b63d-401e-862d-07682c2b2474 based on PKs."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.071Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 1180df17-60fd-44cf-ab2f-a1588e5a37f4 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.071Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked action 6bb55d6e-9795-4d0d-bfdf-e69f3abf11eb as undone by action 1180df17-60fd-44cf-ab2f-a1588e5a37f4."}
{"level":"INFO","time":"2025-05-02T13:08:34.071Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Successfully undid action 6bb55d6e-9795-4d0d-bfdf-e69f3abf11eb"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.072Z","pid":113601,"hostname":"richard","msg":"Test: should return null if no action to undo - 2nd undo result:"}
{"level":"INFO","time":"2025-05-02T13:08:34.072Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to undo last action."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.072Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Found original action to undo: 2741e176-a8de-48eb-a728-207be5745cdf (ADD_WORK_ITEM)"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.073Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Found 1 steps for action 2741e176-a8de-48eb-a728-207be5745cdf."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.073Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Executing 1 undo steps for action 2741e176-a8de-48eb-a728-207be5745cdf in reverse order"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.073Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Executing undo step 1 (UPDATE) on work_items record c0e7fd7e-5291-469e-a9d6-0fbf81950ac7 for action 2741e176-a8de-48eb-a728-207be5745cdf"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.073Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryUndoRedo] Updated row in work_items c0e7fd7e-5291-469e-a9d6-0fbf81950ac7 based on PKs."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.074Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 619a37df-4602-41ae-adb7-59bed91d884d in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.074Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked action 2741e176-a8de-48eb-a728-207be5745cdf as undone by action 619a37df-4602-41ae-adb7-59bed91d884d."}
{"level":"INFO","time":"2025-05-02T13:08:34.074Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Successfully undid action 2741e176-a8de-48eb-a728-207be5745cdf"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.076Z","pid":113601,"hostname":"richard","msg":"Test: should return null if no action to undo - 3rd undo result:"}
{"level":"INFO","time":"2025-05-02T13:08:34.076Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to undo last action."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.076Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Found original action to undo: 9d9644cc-d9c1-4b6e-b79e-3d9bf91f9be2 (ADD_WORK_ITEM)"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.076Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Found 1 steps for action 9d9644cc-d9c1-4b6e-b79e-3d9bf91f9be2."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.076Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Executing 1 undo steps for action 9d9644cc-d9c1-4b6e-b79e-3d9bf91f9be2 in reverse order"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.076Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Executing undo step 1 (UPDATE) on work_items record 9946c06f-b63d-401e-862d-07682c2b2474 for action 9d9644cc-d9c1-4b6e-b79e-3d9bf91f9be2"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.077Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryUndoRedo] Updated row in work_items 9946c06f-b63d-401e-862d-07682c2b2474 based on PKs."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.077Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 72d8f41b-b507-43b9-a2d8-0fe92ad911e0 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.077Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked action 9d9644cc-d9c1-4b6e-b79e-3d9bf91f9be2 as undone by action 72d8f41b-b507-43b9-a2d8-0fe92ad911e0."}
{"level":"INFO","time":"2025-05-02T13:08:34.077Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Successfully undid action 9d9644cc-d9c1-4b6e-b79e-3d9bf91f9be2"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.078Z","pid":113601,"hostname":"richard","msg":"Test: should return null if no action to undo - 4th undo result:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.078Z","pid":113601,"hostname":"richard","msg":"Test: should return null if no action to undo - Attempting 5th undo"}
{"level":"INFO","time":"2025-05-02T13:08:34.078Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to undo last action."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.078Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] No un-undone original actions found."}
{"level":"INFO","time":"2025-05-02T13:08:34.078Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] No original action found to undo."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.078Z","pid":113601,"hostname":"richard","msg":"Test: should return null if no action to undo - 5th undo result:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.079Z","pid":113601,"hostname":"richard","msg":"Test: should return null if no action to undo - Fetching items after all undos"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.079Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 9946c06f-b63d-401e-862d-07682c2b2474 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.079Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 9946c06f-b63d-401e-862d-07682c2b2474 (isActive: false) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.079Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 9946c06f-b63d-401e-862d-07682c2b2474. isActive: false"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.079Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: c0e7fd7e-5291-469e-a9d6-0fbf81950ac7 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.079Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID c0e7fd7e-5291-469e-a9d6-0fbf81950ac7 (isActive: false) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.079Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item c0e7fd7e-5291-469e-a9d6-0fbf81950ac7. isActive: false"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.079Z","pid":113601,"hostname":"richard","msg":"Test: should return null if no action to undo - Fetched item 1 after all undos (isActive: false):"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.079Z","pid":113601,"hostname":"richard","msg":"Test: should return null if no action to undo - Fetched item 2 after all undos (isActive: false):"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.079Z","pid":113601,"hostname":"richard","msg":"Test: should return null if no action to undo - Finished"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.080Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Starting database clean up..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.080Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating undo_steps CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.081Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating action_history CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.089Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating work_item_dependencies CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.090Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating work_items CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.098Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Database clean up committed."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.098Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Database client released."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.098Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item ad9c048d-3259-49e0-be32-338b936570a1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.098Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Item 1\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.099Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:34.099Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: item-1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.099Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:34.099Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191314099"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.099Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item ad9c048d-3259-49e0-be32-338b936570a1 within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:34.099Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item ad9c048d-3259-49e0-be32-338b936570a1 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.100Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 118a0173-b7b1-453c-bf15-383b7499cc6e in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.100Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 551bc6b0-18b7-4b85-80ca-02a2109c893b for action 118a0173-b7b1-453c-bf15-383b7499cc6e in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.100Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:34.100Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item ad9c048d-3259-49e0-be32-338b936570a1 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.102Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.102Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 97afbe94-31be-4dba-98ae-b897fe51bab4"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.102Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Item 2\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.102Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:34.102Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: item-2"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.102Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:34.102Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191314102"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.102Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 97afbe94-31be-4dba-98ae-b897fe51bab4 within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:34.102Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 97afbe94-31be-4dba-98ae-b897fe51bab4 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.102Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 68aca1fd-42b9-4f0c-bad4-31e6303bc07f in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.103Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step d5f582c0-e61a-4da4-bcfe-0ced7f1dcf46 for action 68aca1fd-42b9-4f0c-bad4-31e6303bc07f in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.103Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:34.103Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 97afbe94-31be-4dba-98ae-b897fe51bab4 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.104Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.104Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService] Updating work item ad9c048d-3259-49e0-be32-338b936570a1 with data:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.104Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: ad9c048d-3259-49e0-be32-338b936570a1 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.105Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID ad9c048d-3259-49e0-be32-338b936570a1 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.105Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item ad9c048d-3259-49e0-be32-338b936570a1. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.106Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item ad9c048d-3259-49e0-be32-338b936570a1 (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.106Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps Before Update for ad9c048d-3259-49e0-be32-338b936570a1:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.106Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Item 1 Updated\", parentId: null, currentItemId: ad9c048d-3259-49e0-be32-338b936570a1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.107Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:34.107Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: item-1-updated"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.107Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Desired Deps State for ad9c048d-3259-49e0-be32-338b936570a1:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.107Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updating work item ad9c048d-3259-49e0-be32-338b936570a1 in transaction"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.107Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updated work item ad9c048d-3259-49e0-be32-338b936570a1 fields. Row count: 1"}
{"level":"INFO","time":"2025-05-02T13:08:34.107Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Successfully processed update for item ad9c048d-3259-49e0-be32-338b936570a1."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.107Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: ad9c048d-3259-49e0-be32-338b936570a1 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.107Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID ad9c048d-3259-49e0-be32-338b936570a1 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.107Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item ad9c048d-3259-49e0-be32-338b936570a1. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.107Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item ad9c048d-3259-49e0-be32-338b936570a1 (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.107Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps After Update Repo Call for ad9c048d-3259-49e0-be32-338b936570a1:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.107Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Item fields changed for ad9c048d-3259-49e0-be32-338b936570a1."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.107Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Effective changes detected for ad9c048d-3259-49e0-be32-338b936570a1. Generating history."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.108Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action da27cd44-2194-4a04-8e7e-eb268064d584 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.108Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 910e93cb-9023-427b-85ca-2ff4ad895333 for action da27cd44-2194-4a04-8e7e-eb268064d584 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.108Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:34.108Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService] Recorded history for update of work item ad9c048d-3259-49e0-be32-338b936570a1."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.109Z","pid":113601,"hostname":"richard","msg":"[WorkItemReadingService] Getting work item by ID: ad9c048d-3259-49e0-be32-338b936570a1 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.109Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: ad9c048d-3259-49e0-be32-338b936570a1 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.110Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID ad9c048d-3259-49e0-be32-338b936570a1 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.110Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item ad9c048d-3259-49e0-be32-338b936570a1. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.110Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: ad9c048d-3259-49e0-be32-338b936570a1 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.110Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.110Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item ad9c048d-3259-49e0-be32-338b936570a1 (link active: true, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.110Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent ad9c048d-3259-49e0-be32-338b936570a1 (active: true, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.110Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent ad9c048d-3259-49e0-be32-338b936570a1 (active: true, status: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.110Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item ad9c048d-3259-49e0-be32-338b936570a1 (link active: true, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.111Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"WARN","time":"2025-05-02T13:08:34.111Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Attempting to soft delete 1 work item(s) and cascade: 97afbe94-31be-4dba-98ae-b897fe51bab4"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.111Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Finding all descendants..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.111Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: 97afbe94-31be-4dba-98ae-b897fe51bab4 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.111Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.111Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent 97afbe94-31be-4dba-98ae-b897fe51bab4 (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.111Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent 97afbe94-31be-4dba-98ae-b897fe51bab4 (active: false, status: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.111Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Full cascade list (1 items) identified: 97afbe94-31be-4dba-98ae-b897fe51bab4"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.112Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item list (count: 1, link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.112Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item list (count: 1, link active: false, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.112Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Identified 0 potentially affected dependency links for cascade delete."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.112Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found 1 work items by IDs (count: 1, isActive: true)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.112Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Found 1 active items in cascade list for deletion."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.112Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Items identified in cascade (all):"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.112Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Active items to delete (filtered):"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.112Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Attempting to soft delete these active item IDs: 97afbe94-31be-4dba-98ae-b897fe51bab4"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.112Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] Executing softDelete SQL: \n      UPDATE work_items\n      SET is_active = FALSE, updated_at = $1\n      WHERE work_item_id IN ($2) AND is_active = TRUE;\n     PARAMS: [\"2025-05-02T13:08:34.112Z\",\"97afbe94-31be-4dba-98ae-b897fe51bab4\"]"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.113Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] softDelete result rowCount: 1"}
{"level":"INFO","time":"2025-05-02T13:08:34.113Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Soft deleted 1 work item(s)."}
{"level":"INFO","time":"2025-05-02T13:08:34.113Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Repository reported 1 work item(s) soft deleted."}
{"level":"INFO","time":"2025-05-02T13:08:34.113Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] No active dependency links found to soft delete within the cascade."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.113Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 4dba6aa4-0d34-4eb4-a966-186e07c967d7 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.114Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step cb9cc7e1-f4e9-455f-b65a-2650918ce14b for action 4dba6aa4-0d34-4eb4-a966-186e07c967d7 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.114Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:34.114Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Recorded history for delete action 4dba6aa4-0d34-4eb4-a966-186e07c967d7."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.115Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Returning count: 1 (based on repository rowCount)"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.116Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.116Z","pid":113601,"hostname":"richard","msg":"BeforeEach setup complete. Initial items: item1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.116Z","pid":113601,"hostname":"richard","msg":"Initial actions: action1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.117Z","pid":113601,"hostname":"richard","msg":"Test: should redo the last undone action - Starting"}
{"level":"INFO","time":"2025-05-02T13:08:34.117Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to undo last action."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.117Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Found original action to undo: 4dba6aa4-0d34-4eb4-a966-186e07c967d7 (DELETE_WORK_ITEM_CASCADE)"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.117Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Found 1 steps for action 4dba6aa4-0d34-4eb4-a966-186e07c967d7."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.118Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Executing 1 undo steps for action 4dba6aa4-0d34-4eb4-a966-186e07c967d7 in reverse order"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.118Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Executing undo step 1 (UPDATE) on work_items record 97afbe94-31be-4dba-98ae-b897fe51bab4 for action 4dba6aa4-0d34-4eb4-a966-186e07c967d7"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.118Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryUndoRedo] Updated row in work_items 97afbe94-31be-4dba-98ae-b897fe51bab4 based on PKs."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.118Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 19d6964b-56ba-471b-b9e5-f78e7690d726 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.119Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked action 4dba6aa4-0d34-4eb4-a966-186e07c967d7 as undone by action 19d6964b-56ba-471b-b9e5-f78e7690d726."}
{"level":"INFO","time":"2025-05-02T13:08:34.119Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Successfully undid action 4dba6aa4-0d34-4eb4-a966-186e07c967d7"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.120Z","pid":113601,"hostname":"richard","msg":"Test: should redo the last undone action - After undoing delete (action 4)"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.120Z","pid":113601,"hostname":"richard","msg":"Test: should redo the last undone action - Fetching item 2 after undo"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.120Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 97afbe94-31be-4dba-98ae-b897fe51bab4 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.120Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 97afbe94-31be-4dba-98ae-b897fe51bab4 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.120Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 97afbe94-31be-4dba-98ae-b897fe51bab4. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.120Z","pid":113601,"hostname":"richard","msg":"Test: should redo the last undone action - Fetched item 2 after undo:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.120Z","pid":113601,"hostname":"richard","msg":"Test: should redo the last undone action - Performing redo"}
{"level":"INFO","time":"2025-05-02T13:08:34.121Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to redo last undo action."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.121Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Found UNDO action to redo: 19d6964b-56ba-471b-b9e5-f78e7690d726"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.121Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Found original action 4dba6aa4-0d34-4eb4-a966-186e07c967d7 linked to UNDO action 19d6964b-56ba-471b-b9e5-f78e7690d726."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.122Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Found 1 steps for action 4dba6aa4-0d34-4eb4-a966-186e07c967d7."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.122Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Re-executing 1 original steps (redo) for action 4dba6aa4-0d34-4eb4-a966-186e07c967d7"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.122Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Re-executing 1 (UPDATE) on work_items record 97afbe94-31be-4dba-98ae-b897fe51bab4 from original action 4dba6aa4-0d34-4eb4-a966-186e07c967d7"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.122Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryUndoRedo] Updated row in work_items 97afbe94-31be-4dba-98ae-b897fe51bab4 based on PKs."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.123Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 197dc9c2-69df-47b9-b3a7-d4eb181562d4 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.123Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked action 4dba6aa4-0d34-4eb4-a966-186e07c967d7 as NOT undone (redone)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.123Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked UNDO_ACTION 19d6964b-56ba-471b-b9e5-f78e7690d726 as redone/invalidated by action 197dc9c2-69df-47b9-b3a7-d4eb181562d4."}
{"level":"INFO","time":"2025-05-02T13:08:34.123Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Successfully redid action 4dba6aa4-0d34-4eb4-a966-186e07c967d7"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.124Z","pid":113601,"hostname":"richard","msg":"Test: should redo the last undone action - redoLastUndo result:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.125Z","pid":113601,"hostname":"richard","msg":"Test: should redo the last undone action - Fetching item 2 after redo"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.125Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 97afbe94-31be-4dba-98ae-b897fe51bab4 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.128Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 97afbe94-31be-4dba-98ae-b897fe51bab4 (isActive: false) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.128Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 97afbe94-31be-4dba-98ae-b897fe51bab4. isActive: false"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.128Z","pid":113601,"hostname":"richard","msg":"Test: should redo the last undone action - Fetched item 2 after redo:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.128Z","pid":113601,"hostname":"richard","msg":"Test: should redo the last undone action - Fetching item 1 after redo"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.128Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: ad9c048d-3259-49e0-be32-338b936570a1 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.128Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID ad9c048d-3259-49e0-be32-338b936570a1 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.128Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item ad9c048d-3259-49e0-be32-338b936570a1. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.128Z","pid":113601,"hostname":"richard","msg":"Test: should redo the last undone action - Fetched item 1 after redo:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.129Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 6 recent actions."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.129Z","pid":113601,"hostname":"richard","msg":"Test: should redo the last undone action - Finished"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.129Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Starting database clean up..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.130Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating undo_steps CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.130Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating action_history CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.138Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating work_item_dependencies CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.139Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating work_items CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.147Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Database clean up committed."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.147Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Database client released."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.147Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 31213ef5-a6a3-447c-8944-4db796df74f7"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.148Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Item 1\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.148Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:34.148Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: item-1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.148Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:34.148Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191314148"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.148Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 31213ef5-a6a3-447c-8944-4db796df74f7 within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:34.148Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 31213ef5-a6a3-447c-8944-4db796df74f7 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.149Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 109869ce-09f6-4368-8e7b-3988753417b4 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.149Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step f95e77ab-e91f-46df-a8f8-4b221781267a for action 109869ce-09f6-4368-8e7b-3988753417b4 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.149Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:34.149Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 31213ef5-a6a3-447c-8944-4db796df74f7 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.151Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.151Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 77b74077-b5f1-4e65-a046-62006008e360"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.151Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Item 2\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.151Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:34.151Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: item-2"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.151Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:34.151Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191314151"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.151Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 77b74077-b5f1-4e65-a046-62006008e360 within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:34.151Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 77b74077-b5f1-4e65-a046-62006008e360 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.151Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 0d09af94-b350-475e-99ab-8fa76ac25681 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.152Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 98ead764-2d0c-4901-aecd-65f7280ae9f4 for action 0d09af94-b350-475e-99ab-8fa76ac25681 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.152Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:34.152Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 77b74077-b5f1-4e65-a046-62006008e360 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.153Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.153Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService] Updating work item 31213ef5-a6a3-447c-8944-4db796df74f7 with data:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.153Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 31213ef5-a6a3-447c-8944-4db796df74f7 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.153Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 31213ef5-a6a3-447c-8944-4db796df74f7 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.153Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 31213ef5-a6a3-447c-8944-4db796df74f7. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.154Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item 31213ef5-a6a3-447c-8944-4db796df74f7 (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.154Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps Before Update for 31213ef5-a6a3-447c-8944-4db796df74f7:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.154Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Item 1 Updated\", parentId: null, currentItemId: 31213ef5-a6a3-447c-8944-4db796df74f7"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.154Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:34.154Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: item-1-updated"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.154Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Desired Deps State for 31213ef5-a6a3-447c-8944-4db796df74f7:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.154Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updating work item 31213ef5-a6a3-447c-8944-4db796df74f7 in transaction"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.154Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updated work item 31213ef5-a6a3-447c-8944-4db796df74f7 fields. Row count: 1"}
{"level":"INFO","time":"2025-05-02T13:08:34.154Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Successfully processed update for item 31213ef5-a6a3-447c-8944-4db796df74f7."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.154Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 31213ef5-a6a3-447c-8944-4db796df74f7 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.154Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 31213ef5-a6a3-447c-8944-4db796df74f7 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.154Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 31213ef5-a6a3-447c-8944-4db796df74f7. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.154Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item 31213ef5-a6a3-447c-8944-4db796df74f7 (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.154Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps After Update Repo Call for 31213ef5-a6a3-447c-8944-4db796df74f7:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.154Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Item fields changed for 31213ef5-a6a3-447c-8944-4db796df74f7."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.154Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Effective changes detected for 31213ef5-a6a3-447c-8944-4db796df74f7. Generating history."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.155Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 3ef51c41-20ad-4ff3-ad7c-4919ee68099b in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.155Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step ebde3671-ace2-472c-9b2b-dcb4d9b73e98 for action 3ef51c41-20ad-4ff3-ad7c-4919ee68099b in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.155Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:34.155Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService] Recorded history for update of work item 31213ef5-a6a3-447c-8944-4db796df74f7."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.156Z","pid":113601,"hostname":"richard","msg":"[WorkItemReadingService] Getting work item by ID: 31213ef5-a6a3-447c-8944-4db796df74f7 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.156Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 31213ef5-a6a3-447c-8944-4db796df74f7 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.156Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 31213ef5-a6a3-447c-8944-4db796df74f7 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.156Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 31213ef5-a6a3-447c-8944-4db796df74f7. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.156Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: 31213ef5-a6a3-447c-8944-4db796df74f7 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.156Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.157Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item 31213ef5-a6a3-447c-8944-4db796df74f7 (link active: true, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.157Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item 31213ef5-a6a3-447c-8944-4db796df74f7 (link active: true, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.157Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent 31213ef5-a6a3-447c-8944-4db796df74f7 (active: true, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.157Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent 31213ef5-a6a3-447c-8944-4db796df74f7 (active: true, status: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.157Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"WARN","time":"2025-05-02T13:08:34.157Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Attempting to soft delete 1 work item(s) and cascade: 77b74077-b5f1-4e65-a046-62006008e360"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.157Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Finding all descendants..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.158Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: 77b74077-b5f1-4e65-a046-62006008e360 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.158Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.158Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent 77b74077-b5f1-4e65-a046-62006008e360 (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.158Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent 77b74077-b5f1-4e65-a046-62006008e360 (active: false, status: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.158Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Full cascade list (1 items) identified: 77b74077-b5f1-4e65-a046-62006008e360"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.158Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item list (count: 1, link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.158Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item list (count: 1, link active: false, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.158Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Identified 0 potentially affected dependency links for cascade delete."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.159Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found 1 work items by IDs (count: 1, isActive: true)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.159Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Found 1 active items in cascade list for deletion."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.159Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Items identified in cascade (all):"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.159Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Active items to delete (filtered):"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.159Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Attempting to soft delete these active item IDs: 77b74077-b5f1-4e65-a046-62006008e360"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.159Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] Executing softDelete SQL: \n      UPDATE work_items\n      SET is_active = FALSE, updated_at = $1\n      WHERE work_item_id IN ($2) AND is_active = TRUE;\n     PARAMS: [\"2025-05-02T13:08:34.159Z\",\"77b74077-b5f1-4e65-a046-62006008e360\"]"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.160Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] softDelete result rowCount: 1"}
{"level":"INFO","time":"2025-05-02T13:08:34.160Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Soft deleted 1 work item(s)."}
{"level":"INFO","time":"2025-05-02T13:08:34.160Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Repository reported 1 work item(s) soft deleted."}
{"level":"INFO","time":"2025-05-02T13:08:34.160Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] No active dependency links found to soft delete within the cascade."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.161Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action b940461a-b1f7-4d53-93f6-dbcb725bf5da in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.162Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 244bb8b8-06a2-4b06-9af6-e05eb027f758 for action b940461a-b1f7-4d53-93f6-dbcb725bf5da in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.163Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:34.163Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Recorded history for delete action b940461a-b1f7-4d53-93f6-dbcb725bf5da."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.164Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Returning count: 1 (based on repository rowCount)"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.164Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.165Z","pid":113601,"hostname":"richard","msg":"BeforeEach setup complete. Initial items: item1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.165Z","pid":113601,"hostname":"richard","msg":"Initial actions: action1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.165Z","pid":113601,"hostname":"richard","msg":"Test: should redo multiple undone actions sequentially - Starting"}
{"level":"INFO","time":"2025-05-02T13:08:34.165Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to undo last action."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.166Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Found original action to undo: b940461a-b1f7-4d53-93f6-dbcb725bf5da (DELETE_WORK_ITEM_CASCADE)"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.166Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Found 1 steps for action b940461a-b1f7-4d53-93f6-dbcb725bf5da."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.167Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Executing 1 undo steps for action b940461a-b1f7-4d53-93f6-dbcb725bf5da in reverse order"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.167Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Executing undo step 1 (UPDATE) on work_items record 77b74077-b5f1-4e65-a046-62006008e360 for action b940461a-b1f7-4d53-93f6-dbcb725bf5da"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.167Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryUndoRedo] Updated row in work_items 77b74077-b5f1-4e65-a046-62006008e360 based on PKs."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.167Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action d5daa561-fcb1-490a-817c-2413118612d0 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.168Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked action b940461a-b1f7-4d53-93f6-dbcb725bf5da as undone by action d5daa561-fcb1-490a-817c-2413118612d0."}
{"level":"INFO","time":"2025-05-02T13:08:34.168Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Successfully undid action b940461a-b1f7-4d53-93f6-dbcb725bf5da"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.170Z","pid":113601,"hostname":"richard","msg":"Test: should redo multiple undone actions sequentially - After 1st undo (delete action 4)"}
{"level":"INFO","time":"2025-05-02T13:08:34.170Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to undo last action."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.170Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Found original action to undo: 3ef51c41-20ad-4ff3-ad7c-4919ee68099b (UPDATE_WORK_ITEM)"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.170Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Found 1 steps for action 3ef51c41-20ad-4ff3-ad7c-4919ee68099b."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.170Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Executing 1 undo steps for action 3ef51c41-20ad-4ff3-ad7c-4919ee68099b in reverse order"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.170Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Executing undo step 1 (UPDATE) on work_items record 31213ef5-a6a3-447c-8944-4db796df74f7 for action 3ef51c41-20ad-4ff3-ad7c-4919ee68099b"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.171Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryUndoRedo] Updated row in work_items 31213ef5-a6a3-447c-8944-4db796df74f7 based on PKs."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.171Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 1de5a75d-9142-4de9-b44e-25099b904447 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.172Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked action 3ef51c41-20ad-4ff3-ad7c-4919ee68099b as undone by action 1de5a75d-9142-4de9-b44e-25099b904447."}
{"level":"INFO","time":"2025-05-02T13:08:34.172Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Successfully undid action 3ef51c41-20ad-4ff3-ad7c-4919ee68099b"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.173Z","pid":113601,"hostname":"richard","msg":"Test: should redo multiple undone actions sequentially - After 2nd undo (update action 3)"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.173Z","pid":113601,"hostname":"richard","msg":"Test: should redo multiple undone actions sequentially - Fetching items after undos"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.173Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 31213ef5-a6a3-447c-8944-4db796df74f7 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.173Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 31213ef5-a6a3-447c-8944-4db796df74f7 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.173Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 31213ef5-a6a3-447c-8944-4db796df74f7. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.173Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 77b74077-b5f1-4e65-a046-62006008e360 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.174Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 77b74077-b5f1-4e65-a046-62006008e360 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.174Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 77b74077-b5f1-4e65-a046-62006008e360. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.174Z","pid":113601,"hostname":"richard","msg":"Test: should redo multiple undone actions sequentially - Fetched item 1 after undos:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.174Z","pid":113601,"hostname":"richard","msg":"Test: should redo multiple undone actions sequentially - Fetched item 2 after undos:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.174Z","pid":113601,"hostname":"richard","msg":"Test: should redo multiple undone actions sequentially - Performing 1st redo (update action 3)"}
{"level":"INFO","time":"2025-05-02T13:08:34.174Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to redo last undo action."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.174Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Found UNDO action to redo: 1de5a75d-9142-4de9-b44e-25099b904447"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.175Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Found original action 3ef51c41-20ad-4ff3-ad7c-4919ee68099b linked to UNDO action 1de5a75d-9142-4de9-b44e-25099b904447."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.175Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Found 1 steps for action 3ef51c41-20ad-4ff3-ad7c-4919ee68099b."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.176Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Re-executing 1 original steps (redo) for action 3ef51c41-20ad-4ff3-ad7c-4919ee68099b"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.176Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Re-executing 1 (UPDATE) on work_items record 31213ef5-a6a3-447c-8944-4db796df74f7 from original action 3ef51c41-20ad-4ff3-ad7c-4919ee68099b"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.176Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryUndoRedo] Updated row in work_items 31213ef5-a6a3-447c-8944-4db796df74f7 based on PKs."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.176Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action d9c8269c-e8bb-4a95-9d44-851f1d30eec9 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.177Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked action 3ef51c41-20ad-4ff3-ad7c-4919ee68099b as NOT undone (redone)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.177Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked UNDO_ACTION 1de5a75d-9142-4de9-b44e-25099b904447 as redone/invalidated by action d9c8269c-e8bb-4a95-9d44-851f1d30eec9."}
{"level":"INFO","time":"2025-05-02T13:08:34.177Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Successfully redid action 3ef51c41-20ad-4ff3-ad7c-4919ee68099b"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.179Z","pid":113601,"hostname":"richard","msg":"Test: should redo multiple undone actions sequentially - 1st redo (update) result:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.179Z","pid":113601,"hostname":"richard","msg":"Test: should redo multiple undone actions sequentially - Fetching items after 1st redo"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.179Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 31213ef5-a6a3-447c-8944-4db796df74f7 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.179Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 31213ef5-a6a3-447c-8944-4db796df74f7 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.179Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 31213ef5-a6a3-447c-8944-4db796df74f7. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.179Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 77b74077-b5f1-4e65-a046-62006008e360 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.180Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 77b74077-b5f1-4e65-a046-62006008e360 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.180Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 77b74077-b5f1-4e65-a046-62006008e360. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.180Z","pid":113601,"hostname":"richard","msg":"Test: should redo multiple actions sequentially - Fetched item 1 after 1st redo:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.180Z","pid":113601,"hostname":"richard","msg":"Test: should redo multiple actions sequentially - Fetched item 2 after 1st redo:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.180Z","pid":113601,"hostname":"richard","msg":"Test: should redo multiple undone actions sequentially - Performing 2nd redo (delete action 4)"}
{"level":"INFO","time":"2025-05-02T13:08:34.180Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to redo last undo action."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.180Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Found UNDO action to redo: d5daa561-fcb1-490a-817c-2413118612d0"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.181Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Found original action b940461a-b1f7-4d53-93f6-dbcb725bf5da linked to UNDO action d5daa561-fcb1-490a-817c-2413118612d0."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.181Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Found 1 steps for action b940461a-b1f7-4d53-93f6-dbcb725bf5da."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.181Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Re-executing 1 original steps (redo) for action b940461a-b1f7-4d53-93f6-dbcb725bf5da"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.181Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Re-executing 1 (UPDATE) on work_items record 77b74077-b5f1-4e65-a046-62006008e360 from original action b940461a-b1f7-4d53-93f6-dbcb725bf5da"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.182Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryUndoRedo] Updated row in work_items 77b74077-b5f1-4e65-a046-62006008e360 based on PKs."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.182Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 6b0ee9bd-be25-42c6-92bb-40d212a07583 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.182Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked action b940461a-b1f7-4d53-93f6-dbcb725bf5da as NOT undone (redone)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.182Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked UNDO_ACTION d5daa561-fcb1-490a-817c-2413118612d0 as redone/invalidated by action 6b0ee9bd-be25-42c6-92bb-40d212a07583."}
{"level":"INFO","time":"2025-05-02T13:08:34.182Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Successfully redid action b940461a-b1f7-4d53-93f6-dbcb725bf5da"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.184Z","pid":113601,"hostname":"richard","msg":"Test: should redo multiple undone actions sequentially - 2nd redo (delete) result:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.184Z","pid":113601,"hostname":"richard","msg":"Test: should redo multiple undone actions sequentially - Fetching items after 2nd redo"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.184Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 31213ef5-a6a3-447c-8944-4db796df74f7 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.184Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 31213ef5-a6a3-447c-8944-4db796df74f7 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.184Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 31213ef5-a6a3-447c-8944-4db796df74f7. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.184Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 77b74077-b5f1-4e65-a046-62006008e360 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.184Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 77b74077-b5f1-4e65-a046-62006008e360 (isActive: false) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.184Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 77b74077-b5f1-4e65-a046-62006008e360. isActive: false"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.184Z","pid":113601,"hostname":"richard","msg":"Test: should redo multiple actions sequentially - Fetched item 1 after 2nd redo:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.184Z","pid":113601,"hostname":"richard","msg":"Test: should redo multiple actions sequentially - Fetched item 2 after 2nd redo:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.185Z","pid":113601,"hostname":"richard","msg":"Test: should redo multiple undone actions sequentially - Finished"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.185Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Starting database clean up..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.185Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating undo_steps CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.186Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating action_history CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.193Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating work_item_dependencies CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.194Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating work_items CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.202Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Database clean up committed."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.202Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Database client released."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.202Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 7b120f13-985f-4351-b8b1-988b542fb5d9"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.202Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Item 1\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.203Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:34.203Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: item-1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.203Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:34.203Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191314203"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.203Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 7b120f13-985f-4351-b8b1-988b542fb5d9 within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:34.203Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 7b120f13-985f-4351-b8b1-988b542fb5d9 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.204Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 767e8b75-8636-41e0-8ed1-e52abbf74659 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.204Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 2d567d7f-abb1-4477-bf01-8fe1d6036cd5 for action 767e8b75-8636-41e0-8ed1-e52abbf74659 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.204Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:34.204Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 7b120f13-985f-4351-b8b1-988b542fb5d9 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.206Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.206Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 6a2513d1-a324-4aa4-9fcf-bf5db6cdef1a"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.206Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Item 2\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.206Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:34.206Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: item-2"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.206Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:34.206Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191314206"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.206Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 6a2513d1-a324-4aa4-9fcf-bf5db6cdef1a within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:34.206Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 6a2513d1-a324-4aa4-9fcf-bf5db6cdef1a with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.207Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action f3e30f30-9496-4f54-a7a4-3460161ca007 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.207Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step b1f56ab8-bb4c-4c9c-b65f-75abf64821bf for action f3e30f30-9496-4f54-a7a4-3460161ca007 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.207Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:34.207Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 6a2513d1-a324-4aa4-9fcf-bf5db6cdef1a and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.208Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.208Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService] Updating work item 7b120f13-985f-4351-b8b1-988b542fb5d9 with data:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.209Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 7b120f13-985f-4351-b8b1-988b542fb5d9 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.209Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 7b120f13-985f-4351-b8b1-988b542fb5d9 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.209Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 7b120f13-985f-4351-b8b1-988b542fb5d9. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.209Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item 7b120f13-985f-4351-b8b1-988b542fb5d9 (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.209Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps Before Update for 7b120f13-985f-4351-b8b1-988b542fb5d9:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.209Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Item 1 Updated\", parentId: null, currentItemId: 7b120f13-985f-4351-b8b1-988b542fb5d9"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.209Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:34.209Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: item-1-updated"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.209Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Desired Deps State for 7b120f13-985f-4351-b8b1-988b542fb5d9:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.209Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updating work item 7b120f13-985f-4351-b8b1-988b542fb5d9 in transaction"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.210Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updated work item 7b120f13-985f-4351-b8b1-988b542fb5d9 fields. Row count: 1"}
{"level":"INFO","time":"2025-05-02T13:08:34.210Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Successfully processed update for item 7b120f13-985f-4351-b8b1-988b542fb5d9."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.210Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 7b120f13-985f-4351-b8b1-988b542fb5d9 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.210Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 7b120f13-985f-4351-b8b1-988b542fb5d9 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.210Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 7b120f13-985f-4351-b8b1-988b542fb5d9. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.210Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item 7b120f13-985f-4351-b8b1-988b542fb5d9 (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.210Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps After Update Repo Call for 7b120f13-985f-4351-b8b1-988b542fb5d9:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.210Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Item fields changed for 7b120f13-985f-4351-b8b1-988b542fb5d9."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.210Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Effective changes detected for 7b120f13-985f-4351-b8b1-988b542fb5d9. Generating history."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.210Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 3c483f7a-f27c-445d-878d-c480ad72c886 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.210Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 2f46fbac-9aa3-48ef-801d-9bcb9cff7d29 for action 3c483f7a-f27c-445d-878d-c480ad72c886 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.211Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:34.211Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService] Recorded history for update of work item 7b120f13-985f-4351-b8b1-988b542fb5d9."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.212Z","pid":113601,"hostname":"richard","msg":"[WorkItemReadingService] Getting work item by ID: 7b120f13-985f-4351-b8b1-988b542fb5d9 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.212Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 7b120f13-985f-4351-b8b1-988b542fb5d9 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.212Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 7b120f13-985f-4351-b8b1-988b542fb5d9 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.212Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 7b120f13-985f-4351-b8b1-988b542fb5d9. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.212Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: 7b120f13-985f-4351-b8b1-988b542fb5d9 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.212Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.212Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item 7b120f13-985f-4351-b8b1-988b542fb5d9 (link active: true, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.213Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item 7b120f13-985f-4351-b8b1-988b542fb5d9 (link active: true, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.213Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent 7b120f13-985f-4351-b8b1-988b542fb5d9 (active: true, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.213Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent 7b120f13-985f-4351-b8b1-988b542fb5d9 (active: true, status: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.213Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"WARN","time":"2025-05-02T13:08:34.214Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Attempting to soft delete 1 work item(s) and cascade: 6a2513d1-a324-4aa4-9fcf-bf5db6cdef1a"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.214Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Finding all descendants..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.214Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: 6a2513d1-a324-4aa4-9fcf-bf5db6cdef1a with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.214Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.214Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent 6a2513d1-a324-4aa4-9fcf-bf5db6cdef1a (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.214Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent 6a2513d1-a324-4aa4-9fcf-bf5db6cdef1a (active: false, status: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.214Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Full cascade list (1 items) identified: 6a2513d1-a324-4aa4-9fcf-bf5db6cdef1a"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.214Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item list (count: 1, link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.215Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item list (count: 1, link active: false, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.215Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Identified 0 potentially affected dependency links for cascade delete."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.215Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found 1 work items by IDs (count: 1, isActive: true)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.215Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Found 1 active items in cascade list for deletion."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.215Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Items identified in cascade (all):"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.215Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Active items to delete (filtered):"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.215Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Attempting to soft delete these active item IDs: 6a2513d1-a324-4aa4-9fcf-bf5db6cdef1a"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.215Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] Executing softDelete SQL: \n      UPDATE work_items\n      SET is_active = FALSE, updated_at = $1\n      WHERE work_item_id IN ($2) AND is_active = TRUE;\n     PARAMS: [\"2025-05-02T13:08:34.215Z\",\"6a2513d1-a324-4aa4-9fcf-bf5db6cdef1a\"]"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.215Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] softDelete result rowCount: 1"}
{"level":"INFO","time":"2025-05-02T13:08:34.216Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Soft deleted 1 work item(s)."}
{"level":"INFO","time":"2025-05-02T13:08:34.216Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Repository reported 1 work item(s) soft deleted."}
{"level":"INFO","time":"2025-05-02T13:08:34.216Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] No active dependency links found to soft delete within the cascade."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.216Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 41d3609c-d978-4d75-a808-f28717beb2c1 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.216Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step ec3fe60b-fd8d-4ef0-93d2-08b96edc5394 for action 41d3609c-d978-4d75-a808-f28717beb2c1 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.216Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:34.217Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Recorded history for delete action 41d3609c-d978-4d75-a808-f28717beb2c1."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.218Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Returning count: 1 (based on repository rowCount)"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.218Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.218Z","pid":113601,"hostname":"richard","msg":"BeforeEach setup complete. Initial items: item1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.218Z","pid":113601,"hostname":"richard","msg":"Initial actions: action1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.218Z","pid":113601,"hostname":"richard","msg":"Test: should return null if no action to undo - Starting"}
{"level":"INFO","time":"2025-05-02T13:08:34.218Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to undo last action."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.219Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Found original action to undo: 41d3609c-d978-4d75-a808-f28717beb2c1 (DELETE_WORK_ITEM_CASCADE)"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.219Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Found 1 steps for action 41d3609c-d978-4d75-a808-f28717beb2c1."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.219Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Executing 1 undo steps for action 41d3609c-d978-4d75-a808-f28717beb2c1 in reverse order"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.219Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Executing undo step 1 (UPDATE) on work_items record 6a2513d1-a324-4aa4-9fcf-bf5db6cdef1a for action 41d3609c-d978-4d75-a808-f28717beb2c1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.219Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryUndoRedo] Updated row in work_items 6a2513d1-a324-4aa4-9fcf-bf5db6cdef1a based on PKs."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.219Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action ad512458-272d-4ffe-8088-6815a9fe872f in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.220Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked action 41d3609c-d978-4d75-a808-f28717beb2c1 as undone by action ad512458-272d-4ffe-8088-6815a9fe872f."}
{"level":"INFO","time":"2025-05-02T13:08:34.220Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Successfully undid action 41d3609c-d978-4d75-a808-f28717beb2c1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.221Z","pid":113601,"hostname":"richard","msg":"Test: should return null if no action to undo - 1st undo result:"}
{"level":"INFO","time":"2025-05-02T13:08:34.221Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to undo last action."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.221Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Found original action to undo: 3c483f7a-f27c-445d-878d-c480ad72c886 (UPDATE_WORK_ITEM)"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.221Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Found 1 steps for action 3c483f7a-f27c-445d-878d-c480ad72c886."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.221Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Executing 1 undo steps for action 3c483f7a-f27c-445d-878d-c480ad72c886 in reverse order"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.221Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Executing undo step 1 (UPDATE) on work_items record 7b120f13-985f-4351-b8b1-988b542fb5d9 for action 3c483f7a-f27c-445d-878d-c480ad72c886"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.222Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryUndoRedo] Updated row in work_items 7b120f13-985f-4351-b8b1-988b542fb5d9 based on PKs."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.222Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 821719ba-083d-4142-82cc-8fe7969bf8a1 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.222Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked action 3c483f7a-f27c-445d-878d-c480ad72c886 as undone by action 821719ba-083d-4142-82cc-8fe7969bf8a1."}
{"level":"INFO","time":"2025-05-02T13:08:34.222Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Successfully undid action 3c483f7a-f27c-445d-878d-c480ad72c886"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.223Z","pid":113601,"hostname":"richard","msg":"Test: should return null if no action to undo - 2nd undo result:"}
{"level":"INFO","time":"2025-05-02T13:08:34.223Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to undo last action."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.223Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Found original action to undo: f3e30f30-9496-4f54-a7a4-3460161ca007 (ADD_WORK_ITEM)"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.224Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Found 1 steps for action f3e30f30-9496-4f54-a7a4-3460161ca007."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.224Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Executing 1 undo steps for action f3e30f30-9496-4f54-a7a4-3460161ca007 in reverse order"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.224Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Executing undo step 1 (UPDATE) on work_items record 6a2513d1-a324-4aa4-9fcf-bf5db6cdef1a for action f3e30f30-9496-4f54-a7a4-3460161ca007"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.224Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryUndoRedo] Updated row in work_items 6a2513d1-a324-4aa4-9fcf-bf5db6cdef1a based on PKs."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.224Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action c0ec04f1-7909-48b5-a1f2-451778096e8d in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.224Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked action f3e30f30-9496-4f54-a7a4-3460161ca007 as undone by action c0ec04f1-7909-48b5-a1f2-451778096e8d."}
{"level":"INFO","time":"2025-05-02T13:08:34.224Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Successfully undid action f3e30f30-9496-4f54-a7a4-3460161ca007"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.226Z","pid":113601,"hostname":"richard","msg":"Test: should return null if no action to undo - 3rd undo result:"}
{"level":"INFO","time":"2025-05-02T13:08:34.226Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to undo last action."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.226Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Found original action to undo: 767e8b75-8636-41e0-8ed1-e52abbf74659 (ADD_WORK_ITEM)"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.226Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Found 1 steps for action 767e8b75-8636-41e0-8ed1-e52abbf74659."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.226Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Executing 1 undo steps for action 767e8b75-8636-41e0-8ed1-e52abbf74659 in reverse order"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.226Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Executing undo step 1 (UPDATE) on work_items record 7b120f13-985f-4351-b8b1-988b542fb5d9 for action 767e8b75-8636-41e0-8ed1-e52abbf74659"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.226Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryUndoRedo] Updated row in work_items 7b120f13-985f-4351-b8b1-988b542fb5d9 based on PKs."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.227Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action eee1376b-d3d8-471d-b56e-040a8325cd16 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.227Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked action 767e8b75-8636-41e0-8ed1-e52abbf74659 as undone by action eee1376b-d3d8-471d-b56e-040a8325cd16."}
{"level":"INFO","time":"2025-05-02T13:08:34.227Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Successfully undid action 767e8b75-8636-41e0-8ed1-e52abbf74659"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.228Z","pid":113601,"hostname":"richard","msg":"Test: should return null if no action to undo - 4th undo result:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.228Z","pid":113601,"hostname":"richard","msg":"Test: should return null if no action to undo - Attempting 5th undo"}
{"level":"INFO","time":"2025-05-02T13:08:34.228Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to undo last action."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.228Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] No un-undone original actions found."}
{"level":"INFO","time":"2025-05-02T13:08:34.228Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] No original action found to undo."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.228Z","pid":113601,"hostname":"richard","msg":"Test: should return null if no action to undo - 5th undo result:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.228Z","pid":113601,"hostname":"richard","msg":"Test: should return null if no action to undo - Fetching items after all undos"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.228Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 7b120f13-985f-4351-b8b1-988b542fb5d9 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.229Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 7b120f13-985f-4351-b8b1-988b542fb5d9 (isActive: false) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.229Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 7b120f13-985f-4351-b8b1-988b542fb5d9. isActive: false"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.229Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 6a2513d1-a324-4aa4-9fcf-bf5db6cdef1a with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.229Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 6a2513d1-a324-4aa4-9fcf-bf5db6cdef1a (isActive: false) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.229Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 6a2513d1-a324-4aa4-9fcf-bf5db6cdef1a. isActive: false"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.229Z","pid":113601,"hostname":"richard","msg":"Test: should return null if no action to undo - Fetched item 1 after all undos (isActive: false):"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.229Z","pid":113601,"hostname":"richard","msg":"Test: should return null if no action to undo - Fetched item 2 after all undos (isActive: false):"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.229Z","pid":113601,"hostname":"richard","msg":"Test: should return null if no action to undo - Finished"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.229Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Starting database clean up..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.229Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating undo_steps CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.231Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating action_history CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.239Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating work_item_dependencies CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.240Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating work_items CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.249Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Database clean up committed."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.249Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Database client released."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.249Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item e55a3a6c-f954-4302-a6e9-b0452cc5d73a"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.250Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Item 1\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.251Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:34.251Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: item-1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.251Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:34.251Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191314251"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.251Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item e55a3a6c-f954-4302-a6e9-b0452cc5d73a within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:34.251Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item e55a3a6c-f954-4302-a6e9-b0452cc5d73a with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.251Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 2495519a-3b28-44c4-a6b3-d4658ade363e in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.252Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 15d23fb0-c8a4-4f50-adea-04651a0f9cef for action 2495519a-3b28-44c4-a6b3-d4658ade363e in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.252Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:34.252Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item e55a3a6c-f954-4302-a6e9-b0452cc5d73a and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.253Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.253Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 2a844188-e704-4317-980a-bdd44f779835"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.254Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Item 2\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.254Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:34.254Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: item-2"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.254Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:34.254Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191314254"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.254Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 2a844188-e704-4317-980a-bdd44f779835 within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:34.254Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 2a844188-e704-4317-980a-bdd44f779835 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.254Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 5058f975-bc61-4352-9d01-16a6e8a1e524 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.255Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 90a50296-1616-47ee-b15d-76238ad6279e for action 5058f975-bc61-4352-9d01-16a6e8a1e524 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.255Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:34.255Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 2a844188-e704-4317-980a-bdd44f779835 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.256Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.256Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService] Updating work item e55a3a6c-f954-4302-a6e9-b0452cc5d73a with data:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.256Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: e55a3a6c-f954-4302-a6e9-b0452cc5d73a with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.257Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID e55a3a6c-f954-4302-a6e9-b0452cc5d73a (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.257Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item e55a3a6c-f954-4302-a6e9-b0452cc5d73a. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.257Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item e55a3a6c-f954-4302-a6e9-b0452cc5d73a (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.257Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps Before Update for e55a3a6c-f954-4302-a6e9-b0452cc5d73a:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.257Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Item 1 Updated\", parentId: null, currentItemId: e55a3a6c-f954-4302-a6e9-b0452cc5d73a"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.257Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:34.257Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: item-1-updated"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.257Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Desired Deps State for e55a3a6c-f954-4302-a6e9-b0452cc5d73a:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.257Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updating work item e55a3a6c-f954-4302-a6e9-b0452cc5d73a in transaction"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.258Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updated work item e55a3a6c-f954-4302-a6e9-b0452cc5d73a fields. Row count: 1"}
{"level":"INFO","time":"2025-05-02T13:08:34.258Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Successfully processed update for item e55a3a6c-f954-4302-a6e9-b0452cc5d73a."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.258Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: e55a3a6c-f954-4302-a6e9-b0452cc5d73a with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.258Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID e55a3a6c-f954-4302-a6e9-b0452cc5d73a (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.258Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item e55a3a6c-f954-4302-a6e9-b0452cc5d73a. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.259Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item e55a3a6c-f954-4302-a6e9-b0452cc5d73a (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.259Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps After Update Repo Call for e55a3a6c-f954-4302-a6e9-b0452cc5d73a:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.259Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Item fields changed for e55a3a6c-f954-4302-a6e9-b0452cc5d73a."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.259Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Effective changes detected for e55a3a6c-f954-4302-a6e9-b0452cc5d73a. Generating history."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.260Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 097e85d7-c68c-4fe6-b1b0-5724c49a40d8 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.261Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 923dbc8d-6fee-46f8-83e8-c44992500b9b for action 097e85d7-c68c-4fe6-b1b0-5724c49a40d8 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.262Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:34.262Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService] Recorded history for update of work item e55a3a6c-f954-4302-a6e9-b0452cc5d73a."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.263Z","pid":113601,"hostname":"richard","msg":"[WorkItemReadingService] Getting work item by ID: e55a3a6c-f954-4302-a6e9-b0452cc5d73a with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.263Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: e55a3a6c-f954-4302-a6e9-b0452cc5d73a with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.264Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID e55a3a6c-f954-4302-a6e9-b0452cc5d73a (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.264Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item e55a3a6c-f954-4302-a6e9-b0452cc5d73a. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.264Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: e55a3a6c-f954-4302-a6e9-b0452cc5d73a with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.264Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.264Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item e55a3a6c-f954-4302-a6e9-b0452cc5d73a (link active: true, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.265Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent e55a3a6c-f954-4302-a6e9-b0452cc5d73a (active: true, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.265Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent e55a3a6c-f954-4302-a6e9-b0452cc5d73a (active: true, status: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.265Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item e55a3a6c-f954-4302-a6e9-b0452cc5d73a (link active: true, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.266Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"WARN","time":"2025-05-02T13:08:34.266Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Attempting to soft delete 1 work item(s) and cascade: 2a844188-e704-4317-980a-bdd44f779835"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.266Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Finding all descendants..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.266Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: 2a844188-e704-4317-980a-bdd44f779835 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.266Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.266Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent 2a844188-e704-4317-980a-bdd44f779835 (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.266Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent 2a844188-e704-4317-980a-bdd44f779835 (active: false, status: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.266Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Full cascade list (1 items) identified: 2a844188-e704-4317-980a-bdd44f779835"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.266Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item list (count: 1, link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.267Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item list (count: 1, link active: false, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.267Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Identified 0 potentially affected dependency links for cascade delete."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.267Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found 1 work items by IDs (count: 1, isActive: true)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.267Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Found 1 active items in cascade list for deletion."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.267Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Items identified in cascade (all):"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.267Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Active items to delete (filtered):"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.267Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Attempting to soft delete these active item IDs: 2a844188-e704-4317-980a-bdd44f779835"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.267Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] Executing softDelete SQL: \n      UPDATE work_items\n      SET is_active = FALSE, updated_at = $1\n      WHERE work_item_id IN ($2) AND is_active = TRUE;\n     PARAMS: [\"2025-05-02T13:08:34.267Z\",\"2a844188-e704-4317-980a-bdd44f779835\"]"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.267Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] softDelete result rowCount: 1"}
{"level":"INFO","time":"2025-05-02T13:08:34.267Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Soft deleted 1 work item(s)."}
{"level":"INFO","time":"2025-05-02T13:08:34.267Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Repository reported 1 work item(s) soft deleted."}
{"level":"INFO","time":"2025-05-02T13:08:34.267Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] No active dependency links found to soft delete within the cascade."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.268Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 3f61e360-5242-4d9f-b13e-df10f7c5a900 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.268Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 9e672955-4a73-4585-8c1f-b8213cd74f53 for action 3f61e360-5242-4d9f-b13e-df10f7c5a900 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.268Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:34.268Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Recorded history for delete action 3f61e360-5242-4d9f-b13e-df10f7c5a900."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.270Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Returning count: 1 (based on repository rowCount)"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.270Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.271Z","pid":113601,"hostname":"richard","msg":"BeforeEach setup complete. Initial items: item1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.271Z","pid":113601,"hostname":"richard","msg":"Initial actions: action1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.271Z","pid":113601,"hostname":"richard","msg":"Test: should return null if no action to redo - Starting"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.271Z","pid":113601,"hostname":"richard","msg":"Test: should return null if no action to redo - Attempting 1st redo"}
{"level":"INFO","time":"2025-05-02T13:08:34.271Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to redo last undo action."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.271Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] No un-redone UNDO_ACTIONs found."}
{"level":"INFO","time":"2025-05-02T13:08:34.271Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] No undo action found to redo."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.271Z","pid":113601,"hostname":"richard","msg":"Test: should return null if no action to redo - 1st redo result:"}
{"level":"INFO","time":"2025-05-02T13:08:34.271Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to undo last action."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.272Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Found original action to undo: 3f61e360-5242-4d9f-b13e-df10f7c5a900 (DELETE_WORK_ITEM_CASCADE)"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.272Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Found 1 steps for action 3f61e360-5242-4d9f-b13e-df10f7c5a900."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.272Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Executing 1 undo steps for action 3f61e360-5242-4d9f-b13e-df10f7c5a900 in reverse order"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.272Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Executing undo step 1 (UPDATE) on work_items record 2a844188-e704-4317-980a-bdd44f779835 for action 3f61e360-5242-4d9f-b13e-df10f7c5a900"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.272Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryUndoRedo] Updated row in work_items 2a844188-e704-4317-980a-bdd44f779835 based on PKs."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.272Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action f78ad416-b684-442f-b3c8-bd7b3ba75284 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.273Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked action 3f61e360-5242-4d9f-b13e-df10f7c5a900 as undone by action f78ad416-b684-442f-b3c8-bd7b3ba75284."}
{"level":"INFO","time":"2025-05-02T13:08:34.273Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Successfully undid action 3f61e360-5242-4d9f-b13e-df10f7c5a900"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.274Z","pid":113601,"hostname":"richard","msg":"Test: should return null if no action to redo - After undoing delete item 2"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.274Z","pid":113601,"hostname":"richard","msg":"Test: should return null if no action to redo - Attempting 2nd redo"}
{"level":"INFO","time":"2025-05-02T13:08:34.274Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to redo last undo action."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.274Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Found UNDO action to redo: f78ad416-b684-442f-b3c8-bd7b3ba75284"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.274Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Found original action 3f61e360-5242-4d9f-b13e-df10f7c5a900 linked to UNDO action f78ad416-b684-442f-b3c8-bd7b3ba75284."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.275Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Found 1 steps for action 3f61e360-5242-4d9f-b13e-df10f7c5a900."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.275Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Re-executing 1 original steps (redo) for action 3f61e360-5242-4d9f-b13e-df10f7c5a900"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.275Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Re-executing 1 (UPDATE) on work_items record 2a844188-e704-4317-980a-bdd44f779835 from original action 3f61e360-5242-4d9f-b13e-df10f7c5a900"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.275Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryUndoRedo] Updated row in work_items 2a844188-e704-4317-980a-bdd44f779835 based on PKs."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.275Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 5ff88ef5-a897-4510-a217-d9fb125436a2 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.275Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked action 3f61e360-5242-4d9f-b13e-df10f7c5a900 as NOT undone (redone)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.276Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked UNDO_ACTION f78ad416-b684-442f-b3c8-bd7b3ba75284 as redone/invalidated by action 5ff88ef5-a897-4510-a217-d9fb125436a2."}
{"level":"INFO","time":"2025-05-02T13:08:34.276Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Successfully redid action 3f61e360-5242-4d9f-b13e-df10f7c5a900"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.277Z","pid":113601,"hostname":"richard","msg":"Test: should return null if no action to redo - After redoing delete item 2"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.277Z","pid":113601,"hostname":"richard","msg":"Test: should return null if no action to redo - Attempting 3rd redo"}
{"level":"INFO","time":"2025-05-02T13:08:34.277Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to redo last undo action."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.277Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] No un-redone UNDO_ACTIONs found."}
{"level":"INFO","time":"2025-05-02T13:08:34.277Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] No undo action found to redo."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.277Z","pid":113601,"hostname":"richard","msg":"Test: should return null if no action to redo - 3rd redo result:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.277Z","pid":113601,"hostname":"richard","msg":"Test: should return null if no action to redo - Fetching items at the end"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.277Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: e55a3a6c-f954-4302-a6e9-b0452cc5d73a with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.278Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID e55a3a6c-f954-4302-a6e9-b0452cc5d73a (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.278Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item e55a3a6c-f954-4302-a6e9-b0452cc5d73a. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.278Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 2a844188-e704-4317-980a-bdd44f779835 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.278Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 2a844188-e704-4317-980a-bdd44f779835 (isActive: false) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.278Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 2a844188-e704-4317-980a-bdd44f779835. isActive: false"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.278Z","pid":113601,"hostname":"richard","msg":"Test: should return null if no action to redo - Fetched item 1 at end (isActive: true):"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.278Z","pid":113601,"hostname":"richard","msg":"Test: should return null if no action to redo - Fetched item 2 at end (isActive: false):"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.278Z","pid":113601,"hostname":"richard","msg":"Test: should return null if no action to redo - Finished"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.278Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Starting database clean up..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.278Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating undo_steps CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.279Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating action_history CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.288Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating work_item_dependencies CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.289Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating work_items CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.299Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Database clean up committed."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.299Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Database client released."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.299Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item c222a7d7-6319-4885-a5f4-e904783ef4b2"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.299Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Item 1\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.300Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:34.300Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: item-1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.300Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:34.300Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191314300"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.300Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item c222a7d7-6319-4885-a5f4-e904783ef4b2 within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:34.300Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item c222a7d7-6319-4885-a5f4-e904783ef4b2 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.301Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action b3d71795-8319-4ebe-9668-25ceb31580c1 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.302Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step cf23c8b5-151e-4eeb-81ae-c4d9d0bad814 for action b3d71795-8319-4ebe-9668-25ceb31580c1 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.302Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:34.302Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item c222a7d7-6319-4885-a5f4-e904783ef4b2 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.303Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.303Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 9b968fb3-63fd-4800-a394-f959f7317a7e"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.304Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Item 2\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.304Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:34.304Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: item-2"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.304Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:34.304Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191314304"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.304Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 9b968fb3-63fd-4800-a394-f959f7317a7e within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:34.304Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 9b968fb3-63fd-4800-a394-f959f7317a7e with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.305Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 15facc6f-0211-4a01-ae97-60d9246294cd in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.305Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step a2805dc8-4c20-493d-8217-bfeaf324227e for action 15facc6f-0211-4a01-ae97-60d9246294cd in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.305Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:34.305Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 9b968fb3-63fd-4800-a394-f959f7317a7e and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.307Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.307Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService] Updating work item c222a7d7-6319-4885-a5f4-e904783ef4b2 with data:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.307Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: c222a7d7-6319-4885-a5f4-e904783ef4b2 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.307Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID c222a7d7-6319-4885-a5f4-e904783ef4b2 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.307Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item c222a7d7-6319-4885-a5f4-e904783ef4b2. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.308Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item c222a7d7-6319-4885-a5f4-e904783ef4b2 (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.308Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps Before Update for c222a7d7-6319-4885-a5f4-e904783ef4b2:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.308Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Item 1 Updated\", parentId: null, currentItemId: c222a7d7-6319-4885-a5f4-e904783ef4b2"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.308Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:34.308Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: item-1-updated"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.308Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Desired Deps State for c222a7d7-6319-4885-a5f4-e904783ef4b2:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.308Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updating work item c222a7d7-6319-4885-a5f4-e904783ef4b2 in transaction"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.309Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updated work item c222a7d7-6319-4885-a5f4-e904783ef4b2 fields. Row count: 1"}
{"level":"INFO","time":"2025-05-02T13:08:34.309Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Successfully processed update for item c222a7d7-6319-4885-a5f4-e904783ef4b2."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.309Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: c222a7d7-6319-4885-a5f4-e904783ef4b2 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.309Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID c222a7d7-6319-4885-a5f4-e904783ef4b2 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.309Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item c222a7d7-6319-4885-a5f4-e904783ef4b2. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.309Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item c222a7d7-6319-4885-a5f4-e904783ef4b2 (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.309Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps After Update Repo Call for c222a7d7-6319-4885-a5f4-e904783ef4b2:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.309Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Item fields changed for c222a7d7-6319-4885-a5f4-e904783ef4b2."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.309Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Effective changes detected for c222a7d7-6319-4885-a5f4-e904783ef4b2. Generating history."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.310Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 06a2e806-abc1-4421-906f-d90214ad9d5c in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.310Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 78d3e251-7fd8-4e59-848a-0a082826f985 for action 06a2e806-abc1-4421-906f-d90214ad9d5c in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.310Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:34.310Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService] Recorded history for update of work item c222a7d7-6319-4885-a5f4-e904783ef4b2."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.311Z","pid":113601,"hostname":"richard","msg":"[WorkItemReadingService] Getting work item by ID: c222a7d7-6319-4885-a5f4-e904783ef4b2 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.311Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: c222a7d7-6319-4885-a5f4-e904783ef4b2 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.312Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID c222a7d7-6319-4885-a5f4-e904783ef4b2 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.312Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item c222a7d7-6319-4885-a5f4-e904783ef4b2. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.312Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: c222a7d7-6319-4885-a5f4-e904783ef4b2 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.312Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.312Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item c222a7d7-6319-4885-a5f4-e904783ef4b2 (link active: true, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.313Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent c222a7d7-6319-4885-a5f4-e904783ef4b2 (active: true, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.313Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent c222a7d7-6319-4885-a5f4-e904783ef4b2 (active: true, status: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.313Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item c222a7d7-6319-4885-a5f4-e904783ef4b2 (link active: true, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.313Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"WARN","time":"2025-05-02T13:08:34.313Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Attempting to soft delete 1 work item(s) and cascade: 9b968fb3-63fd-4800-a394-f959f7317a7e"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.313Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Finding all descendants..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.313Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: 9b968fb3-63fd-4800-a394-f959f7317a7e with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.313Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.314Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent 9b968fb3-63fd-4800-a394-f959f7317a7e (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.314Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent 9b968fb3-63fd-4800-a394-f959f7317a7e (active: false, status: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.314Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Full cascade list (1 items) identified: 9b968fb3-63fd-4800-a394-f959f7317a7e"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.314Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item list (count: 1, link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.314Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item list (count: 1, link active: false, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.314Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Identified 0 potentially affected dependency links for cascade delete."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.315Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found 1 work items by IDs (count: 1, isActive: true)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.315Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Found 1 active items in cascade list for deletion."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.315Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Items identified in cascade (all):"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.315Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Active items to delete (filtered):"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.315Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Attempting to soft delete these active item IDs: 9b968fb3-63fd-4800-a394-f959f7317a7e"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.315Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] Executing softDelete SQL: \n      UPDATE work_items\n      SET is_active = FALSE, updated_at = $1\n      WHERE work_item_id IN ($2) AND is_active = TRUE;\n     PARAMS: [\"2025-05-02T13:08:34.315Z\",\"9b968fb3-63fd-4800-a394-f959f7317a7e\"]"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.315Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] softDelete result rowCount: 1"}
{"level":"INFO","time":"2025-05-02T13:08:34.315Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Soft deleted 1 work item(s)."}
{"level":"INFO","time":"2025-05-02T13:08:34.315Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Repository reported 1 work item(s) soft deleted."}
{"level":"INFO","time":"2025-05-02T13:08:34.315Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] No active dependency links found to soft delete within the cascade."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.315Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 9b37a9ca-0301-4dc9-a7b9-7a4dd97a8ec7 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.316Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 5b0d8351-61c1-432d-ac6b-13c29f945f7d for action 9b37a9ca-0301-4dc9-a7b9-7a4dd97a8ec7 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.316Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:34.316Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Recorded history for delete action 9b37a9ca-0301-4dc9-a7b9-7a4dd97a8ec7."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.317Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Returning count: 1 (based on repository rowCount)"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.317Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.318Z","pid":113601,"hostname":"richard","msg":"BeforeEach setup complete. Initial items: item1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.318Z","pid":113601,"hostname":"richard","msg":"Initial actions: action1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.318Z","pid":113601,"hostname":"richard","msg":"Test: should return null if redo stack is cleared by a new action - Starting"}
{"level":"INFO","time":"2025-05-02T13:08:34.318Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to undo last action."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.318Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Found original action to undo: 9b37a9ca-0301-4dc9-a7b9-7a4dd97a8ec7 (DELETE_WORK_ITEM_CASCADE)"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.318Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Found 1 steps for action 9b37a9ca-0301-4dc9-a7b9-7a4dd97a8ec7."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.318Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Executing 1 undo steps for action 9b37a9ca-0301-4dc9-a7b9-7a4dd97a8ec7 in reverse order"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.318Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Executing undo step 1 (UPDATE) on work_items record 9b968fb3-63fd-4800-a394-f959f7317a7e for action 9b37a9ca-0301-4dc9-a7b9-7a4dd97a8ec7"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.318Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryUndoRedo] Updated row in work_items 9b968fb3-63fd-4800-a394-f959f7317a7e based on PKs."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.319Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 46058fe3-509b-4f9b-b05d-531eac0f96ef in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.319Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked action 9b37a9ca-0301-4dc9-a7b9-7a4dd97a8ec7 as undone by action 46058fe3-509b-4f9b-b05d-531eac0f96ef."}
{"level":"INFO","time":"2025-05-02T13:08:34.319Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Successfully undid action 9b37a9ca-0301-4dc9-a7b9-7a4dd97a8ec7"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.320Z","pid":113601,"hostname":"richard","msg":"Test: should return null if redo stack is cleared by a new action - After undoing delete item 2"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.320Z","pid":113601,"hostname":"richard","msg":"Test: should return null if redo stack is cleared by a new action - Performing new action (update item 1)"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.320Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService] Updating work item c222a7d7-6319-4885-a5f4-e904783ef4b2 with data:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.320Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: c222a7d7-6319-4885-a5f4-e904783ef4b2 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.321Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID c222a7d7-6319-4885-a5f4-e904783ef4b2 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.321Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item c222a7d7-6319-4885-a5f4-e904783ef4b2. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.321Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item c222a7d7-6319-4885-a5f4-e904783ef4b2 (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.321Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps Before Update for c222a7d7-6319-4885-a5f4-e904783ef4b2:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.321Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Desired Deps State for c222a7d7-6319-4885-a5f4-e904783ef4b2:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.321Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updating work item c222a7d7-6319-4885-a5f4-e904783ef4b2 in transaction"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.321Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updated work item c222a7d7-6319-4885-a5f4-e904783ef4b2 fields. Row count: 1"}
{"level":"INFO","time":"2025-05-02T13:08:34.321Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Successfully processed update for item c222a7d7-6319-4885-a5f4-e904783ef4b2."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.321Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: c222a7d7-6319-4885-a5f4-e904783ef4b2 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.321Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID c222a7d7-6319-4885-a5f4-e904783ef4b2 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.321Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item c222a7d7-6319-4885-a5f4-e904783ef4b2. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.321Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item c222a7d7-6319-4885-a5f4-e904783ef4b2 (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.321Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps After Update Repo Call for c222a7d7-6319-4885-a5f4-e904783ef4b2:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.321Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Item fields changed for c222a7d7-6319-4885-a5f4-e904783ef4b2."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.321Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Effective changes detected for c222a7d7-6319-4885-a5f4-e904783ef4b2. Generating history."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.321Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 6efff97c-fbd2-4cb3-a250-3f971ba39502 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.322Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step ceeee7e7-9380-4c29-9d3f-5eaadd35298d for action 6efff97c-fbd2-4cb3-a250-3f971ba39502 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.322Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.322Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked UNDO_ACTION 46058fe3-509b-4f9b-b05d-531eac0f96ef as redone/invalidated by action 6efff97c-fbd2-4cb3-a250-3f971ba39502."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.322Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Invalidated 1 potential redo(s) due to new action 6efff97c-fbd2-4cb3-a250-3f971ba39502."}
{"level":"INFO","time":"2025-05-02T13:08:34.322Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService] Recorded history for update of work item c222a7d7-6319-4885-a5f4-e904783ef4b2."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.323Z","pid":113601,"hostname":"richard","msg":"[WorkItemReadingService] Getting work item by ID: c222a7d7-6319-4885-a5f4-e904783ef4b2 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.323Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: c222a7d7-6319-4885-a5f4-e904783ef4b2 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.323Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID c222a7d7-6319-4885-a5f4-e904783ef4b2 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.323Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item c222a7d7-6319-4885-a5f4-e904783ef4b2. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.323Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: c222a7d7-6319-4885-a5f4-e904783ef4b2 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.323Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.324Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item c222a7d7-6319-4885-a5f4-e904783ef4b2 (link active: true, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.324Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent c222a7d7-6319-4885-a5f4-e904783ef4b2 (active: true, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.324Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent c222a7d7-6319-4885-a5f4-e904783ef4b2 (active: true, status: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.324Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item c222a7d7-6319-4885-a5f4-e904783ef4b2 (link active: true, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.324Z","pid":113601,"hostname":"richard","msg":"Test: should return null if redo stack is cleared by a new action - After new action"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.324Z","pid":113601,"hostname":"richard","msg":"Test: should return null if redo stack is cleared by a new action - Attempting redo"}
{"level":"INFO","time":"2025-05-02T13:08:34.324Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to redo last undo action."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.324Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] No un-redone UNDO_ACTIONs found."}
{"level":"INFO","time":"2025-05-02T13:08:34.324Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] No undo action found to redo."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.324Z","pid":113601,"hostname":"richard","msg":"Test: should return null if redo stack is cleared by a new action - Redo result:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.324Z","pid":113601,"hostname":"richard","msg":"Test: should return null if redo stack is cleared by a new action - Fetching items at the end"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.324Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: c222a7d7-6319-4885-a5f4-e904783ef4b2 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.324Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID c222a7d7-6319-4885-a5f4-e904783ef4b2 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.324Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item c222a7d7-6319-4885-a5f4-e904783ef4b2. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.324Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 9b968fb3-63fd-4800-a394-f959f7317a7e with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.324Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 9b968fb3-63fd-4800-a394-f959f7317a7e (isActive: false) executed. Rows found: 0"}
PASS dist/services/__tests__/workItemHistoryIntegration.test.js
{"level":"INFO","time":"2025-05-02T13:08:34.409Z","pid":113601,"hostname":"richard","msg":"Loading environment variable overrides for configuration..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.324Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Work item 9b968fb3-63fd-4800-a394-f959f7317a7e not found or filtered out (isActive filter: false)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.324Z","pid":113601,"hostname":"richard","msg":"Test: should return null if redo stack is cleared by a new action - Fetched item 1 at end (isActive: true):"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.324Z","pid":113601,"hostname":"richard","msg":"Test: should return null if redo stack is cleared by a new action - Fetched item 2 at end (isActive: false):"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.324Z","pid":113601,"hostname":"richard","msg":"Test: should return null if redo stack is cleared by a new action - Finished"}
{"level":"INFO","time":"2025-05-02T13:08:34.409Z","pid":113601,"hostname":"richard","msg":"Overriding pgHost from env: localhost"}
{"level":"INFO","time":"2025-05-02T13:08:34.409Z","pid":113601,"hostname":"richard","msg":"Overriding pgPort from env: 5432"}
{"level":"INFO","time":"2025-05-02T13:08:34.409Z","pid":113601,"hostname":"richard","msg":"Overriding pgUser from env: taskmanager_user"}
{"level":"INFO","time":"2025-05-02T13:08:34.409Z","pid":113601,"hostname":"richard","msg":"Overriding pgPassword from env."}
{"level":"INFO","time":"2025-05-02T13:08:34.409Z","pid":113601,"hostname":"richard","msg":"Overriding pgDatabase from env: taskmanager_db"}
{"level":"INFO","time":"2025-05-02T13:08:34.409Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] Setting up PostgreSQL connection pool..."}
{"level":"INFO","time":"2025-05-02T13:08:34.409Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] PostgreSQL connection pool configured."}
{"level":"INFO","time":"2025-05-02T13:08:34.409Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] Starting database schema initialization..."}
{"level":"INFO","time":"2025-05-02T13:08:34.422Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] Connected to PostgreSQL for schema check/application."}
{"level":"INFO","time":"2025-05-02T13:08:34.422Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] Force schema run enabled or tables missing. Initializing/Re-initializing schema..."}
{"level":"INFO","time":"2025-05-02T13:08:34.422Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] Looking for schema file at: /home/richard/repos/mcp-task-manager-server/dist/db/schema.sql"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.422Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] Schema file read successfully. Executing schema setup..."}
{"level":"INFO","time":"2025-05-02T13:08:34.441Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] Full schema script executed."}
{"level":"INFO","time":"2025-05-02T13:08:34.442Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] Confirmed work_items table exists after schema execution."}
{"level":"INFO","time":"2025-05-02T13:08:34.442Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] Initialization marked as complete."}
{"level":"INFO","time":"2025-05-02T13:08:34.442Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] Released schema check/application client."}
{"level":"INFO","time":"2025-05-02T13:08:34.442Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] Instance created and database initialized."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.443Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Starting database clean up..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.444Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating undo_steps CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.445Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating action_history CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.454Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating work_item_dependencies CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.454Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating work_items CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.464Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Database clean up committed."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.464Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Database client released."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.465Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 17b06ab3-e2cd-4a20-818c-b4f4283a8ed6"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.466Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Parent Project\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.468Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:34.468Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: parent-project"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.468Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:34.468Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191314468"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.468Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 17b06ab3-e2cd-4a20-818c-b4f4283a8ed6 within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:34.470Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 17b06ab3-e2cd-4a20-818c-b4f4283a8ed6 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.470Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 16070eb2-e8f2-4825-a5fb-476a687af5d3 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.471Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step eff3f6ed-a01c-491b-be2e-d62c06b89012 for action 16070eb2-e8f2-4825-a5fb-476a687af5d3 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.472Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:34.472Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 17b06ab3-e2cd-4a20-818c-b4f4283a8ed6 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.473Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item c0b0abc8-8cff-47e2-8375-901dc76ad355"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.474Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Update Me\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.474Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:34.474Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: update-me"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.474Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:34.474Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191314474"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.474Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item c0b0abc8-8cff-47e2-8375-901dc76ad355 within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:34.474Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item c0b0abc8-8cff-47e2-8375-901dc76ad355 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.475Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action be90c248-6fd0-43dc-9226-90a2ea9f8925 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.476Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 3a97b725-4b4f-4a4b-a199-374dca7543d3 for action be90c248-6fd0-43dc-9226-90a2ea9f8925 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.477Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:34.477Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item c0b0abc8-8cff-47e2-8375-901dc76ad355 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.478Z","pid":113601,"hostname":"richard","msg":"BeforeEach setup complete for WorkItemUpdateIntegration.test.ts"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.478Z","pid":113601,"hostname":"richard","msg":"Test: should update item basic fields - Starting"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.478Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService] Updating work item c0b0abc8-8cff-47e2-8375-901dc76ad355 with data:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.479Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: c0b0abc8-8cff-47e2-8375-901dc76ad355 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.479Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID c0b0abc8-8cff-47e2-8375-901dc76ad355 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.479Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item c0b0abc8-8cff-47e2-8375-901dc76ad355. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.480Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item c0b0abc8-8cff-47e2-8375-901dc76ad355 (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.480Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps Before Update for c0b0abc8-8cff-47e2-8375-901dc76ad355:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.480Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Updated Name\", parentId: null, currentItemId: c0b0abc8-8cff-47e2-8375-901dc76ad355"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.481Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:34.481Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: updated-name"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.481Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Desired Deps State for c0b0abc8-8cff-47e2-8375-901dc76ad355:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.481Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updating work item c0b0abc8-8cff-47e2-8375-901dc76ad355 in transaction"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.482Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updated work item c0b0abc8-8cff-47e2-8375-901dc76ad355 fields. Row count: 1"}
{"level":"INFO","time":"2025-05-02T13:08:34.482Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Successfully processed update for item c0b0abc8-8cff-47e2-8375-901dc76ad355."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.482Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: c0b0abc8-8cff-47e2-8375-901dc76ad355 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.482Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID c0b0abc8-8cff-47e2-8375-901dc76ad355 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.482Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item c0b0abc8-8cff-47e2-8375-901dc76ad355. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.483Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item c0b0abc8-8cff-47e2-8375-901dc76ad355 (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.483Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps After Update Repo Call for c0b0abc8-8cff-47e2-8375-901dc76ad355:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.483Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Item fields changed for c0b0abc8-8cff-47e2-8375-901dc76ad355."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.483Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Effective changes detected for c0b0abc8-8cff-47e2-8375-901dc76ad355. Generating history."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.484Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 397cd033-1991-485d-a64e-a2e690e88891 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.484Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 76d93d57-143f-4e87-a337-f4dc2615821a for action 397cd033-1991-485d-a64e-a2e690e88891 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.484Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:34.485Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService] Recorded history for update of work item c0b0abc8-8cff-47e2-8375-901dc76ad355."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.486Z","pid":113601,"hostname":"richard","msg":"[WorkItemReadingService] Getting work item by ID: c0b0abc8-8cff-47e2-8375-901dc76ad355 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.486Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: c0b0abc8-8cff-47e2-8375-901dc76ad355 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.487Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID c0b0abc8-8cff-47e2-8375-901dc76ad355 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.487Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item c0b0abc8-8cff-47e2-8375-901dc76ad355. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.487Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: c0b0abc8-8cff-47e2-8375-901dc76ad355 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.487Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.488Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item c0b0abc8-8cff-47e2-8375-901dc76ad355 (link active: true, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.495Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent c0b0abc8-8cff-47e2-8375-901dc76ad355 (active: true, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.495Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent c0b0abc8-8cff-47e2-8375-901dc76ad355 (active: true, status: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.495Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item c0b0abc8-8cff-47e2-8375-901dc76ad355 (link active: true, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.496Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: c0b0abc8-8cff-47e2-8375-901dc76ad355 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.496Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID c0b0abc8-8cff-47e2-8375-901dc76ad355 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.496Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item c0b0abc8-8cff-47e2-8375-901dc76ad355. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.497Z","pid":113601,"hostname":"richard","msg":"Test: should update item basic fields - Finished"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.497Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Starting database clean up..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.497Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating undo_steps CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.498Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating action_history CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.506Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating work_item_dependencies CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.507Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating work_items CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.515Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Database clean up committed."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.515Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Database client released."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.515Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item fd4f3b5e-fcd2-42a5-8b9a-d4e6fffc61b1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.515Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Parent Project\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.516Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:34.516Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: parent-project"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.516Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:34.516Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191314516"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.516Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item fd4f3b5e-fcd2-42a5-8b9a-d4e6fffc61b1 within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:34.517Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item fd4f3b5e-fcd2-42a5-8b9a-d4e6fffc61b1 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.517Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 4c3d60b5-c5ef-45c9-a988-8b32ff7a476f in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.518Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 5396f5e4-e21a-46ad-88bd-fb17303322fc for action 4c3d60b5-c5ef-45c9-a988-8b32ff7a476f in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.518Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:34.518Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item fd4f3b5e-fcd2-42a5-8b9a-d4e6fffc61b1 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.519Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 097da5ed-2aa7-45f6-b333-436c703815b4"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.519Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Update Me\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.519Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:34.519Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: update-me"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.519Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:34.519Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191314519"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.519Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 097da5ed-2aa7-45f6-b333-436c703815b4 within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:34.520Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 097da5ed-2aa7-45f6-b333-436c703815b4 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.520Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 27c81832-0f21-4496-ad9c-396429f0ca55 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.520Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 65849176-ea38-44cb-a631-927b675e1b2b for action 27c81832-0f21-4496-ad9c-396429f0ca55 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.520Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:34.520Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 097da5ed-2aa7-45f6-b333-436c703815b4 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.521Z","pid":113601,"hostname":"richard","msg":"BeforeEach setup complete for WorkItemUpdateIntegration.test.ts"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.521Z","pid":113601,"hostname":"richard","msg":"Test: should update parent and recalculate related fields - Starting"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.521Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService] Updating work item 097da5ed-2aa7-45f6-b333-436c703815b4 with data:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.522Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 097da5ed-2aa7-45f6-b333-436c703815b4 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.522Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 097da5ed-2aa7-45f6-b333-436c703815b4 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.522Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 097da5ed-2aa7-45f6-b333-436c703815b4. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.522Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item 097da5ed-2aa7-45f6-b333-436c703815b4 (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.522Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps Before Update for 097da5ed-2aa7-45f6-b333-436c703815b4:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.522Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: fd4f3b5e-fcd2-42a5-8b9a-d4e6fffc61b1 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.522Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID fd4f3b5e-fcd2-42a5-8b9a-d4e6fffc61b1 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.522Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item fd4f3b5e-fcd2-42a5-8b9a-d4e6fffc61b1. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.522Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Update Me\", parentId: fd4f3b5e-fcd2-42a5-8b9a-d4e6fffc61b1, currentItemId: 097da5ed-2aa7-45f6-b333-436c703815b4"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.523Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 siblings for item 097da5ed-2aa7-45f6-b333-436c703815b4 (parent: fd4f3b5e-fcd2-42a5-8b9a-d4e6fffc61b1, active filter: false)."}
{"level":"INFO","time":"2025-05-02T13:08:34.523Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: update-me"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.523Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: fd4f3b5e-fcd2-42a5-8b9a-d4e6fffc61b1, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:34.523Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191314523"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.523Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Desired Deps State for 097da5ed-2aa7-45f6-b333-436c703815b4:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.523Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updating work item 097da5ed-2aa7-45f6-b333-436c703815b4 in transaction"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.523Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updated work item 097da5ed-2aa7-45f6-b333-436c703815b4 fields. Row count: 1"}
{"level":"INFO","time":"2025-05-02T13:08:34.523Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Successfully processed update for item 097da5ed-2aa7-45f6-b333-436c703815b4."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.523Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 097da5ed-2aa7-45f6-b333-436c703815b4 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.523Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 097da5ed-2aa7-45f6-b333-436c703815b4 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.523Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 097da5ed-2aa7-45f6-b333-436c703815b4. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.523Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item 097da5ed-2aa7-45f6-b333-436c703815b4 (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.523Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps After Update Repo Call for 097da5ed-2aa7-45f6-b333-436c703815b4:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.523Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Item fields changed for 097da5ed-2aa7-45f6-b333-436c703815b4."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.523Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Effective changes detected for 097da5ed-2aa7-45f6-b333-436c703815b4. Generating history."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.524Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 14a2822c-78b5-440e-9292-7358c0d0241e in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.524Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 727ab135-c87a-4df1-a65d-5ef765acfb8f for action 14a2822c-78b5-440e-9292-7358c0d0241e in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.524Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:34.524Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService] Recorded history for update of work item 097da5ed-2aa7-45f6-b333-436c703815b4."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.525Z","pid":113601,"hostname":"richard","msg":"[WorkItemReadingService] Getting work item by ID: 097da5ed-2aa7-45f6-b333-436c703815b4 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.525Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 097da5ed-2aa7-45f6-b333-436c703815b4 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.525Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 097da5ed-2aa7-45f6-b333-436c703815b4 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.526Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 097da5ed-2aa7-45f6-b333-436c703815b4. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.526Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: 097da5ed-2aa7-45f6-b333-436c703815b4 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.526Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.526Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item 097da5ed-2aa7-45f6-b333-436c703815b4 (link active: true, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.527Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item 097da5ed-2aa7-45f6-b333-436c703815b4 (link active: true, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.527Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent 097da5ed-2aa7-45f6-b333-436c703815b4 (active: true, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.527Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent 097da5ed-2aa7-45f6-b333-436c703815b4 (active: true, status: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.527Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 097da5ed-2aa7-45f6-b333-436c703815b4 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.527Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 097da5ed-2aa7-45f6-b333-436c703815b4 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.527Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 097da5ed-2aa7-45f6-b333-436c703815b4. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.527Z","pid":113601,"hostname":"richard","msg":"Test: should update parent and recalculate related fields - Finished"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.528Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Starting database clean up..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.528Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating undo_steps CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.529Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating action_history CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.538Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating work_item_dependencies CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.539Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating work_items CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.551Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Database clean up committed."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.551Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Database client released."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.551Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item bb897aae-91d0-4445-890f-9073238a1f5d"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.551Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Parent Project\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.552Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:34.552Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: parent-project"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.552Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:34.552Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191314552"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.552Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item bb897aae-91d0-4445-890f-9073238a1f5d within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:34.552Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item bb897aae-91d0-4445-890f-9073238a1f5d with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.553Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action c1349bcc-d08d-46f0-98e7-d47b94cc9480 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.554Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 30afab19-501f-4e06-9b93-d5f4e74ab853 for action c1349bcc-d08d-46f0-98e7-d47b94cc9480 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.555Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:34.555Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item bb897aae-91d0-4445-890f-9073238a1f5d and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.556Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 8832a69f-f05b-49eb-8359-1e5d688f5525"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.556Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Update Me\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.557Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:34.557Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: update-me"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.557Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:34.557Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191314557"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.557Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 8832a69f-f05b-49eb-8359-1e5d688f5525 within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:34.557Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 8832a69f-f05b-49eb-8359-1e5d688f5525 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.558Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action cbf3425b-387b-435b-91b8-af7ea6e153c6 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.558Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 802617cc-cc01-4b33-8226-02588ae0612e for action cbf3425b-387b-435b-91b8-af7ea6e153c6 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.559Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:34.559Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 8832a69f-f05b-49eb-8359-1e5d688f5525 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.560Z","pid":113601,"hostname":"richard","msg":"BeforeEach setup complete for WorkItemUpdateIntegration.test.ts"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.560Z","pid":113601,"hostname":"richard","msg":"Test: should add, modify, and manage dependencies - Starting"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.561Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item d0f01e93-0553-4d5a-b6db-65b844cbed75"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.561Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Dependency 1\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.561Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:34.561Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: dependency-1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.561Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:34.561Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191314561"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.561Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item d0f01e93-0553-4d5a-b6db-65b844cbed75 within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:34.561Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item d0f01e93-0553-4d5a-b6db-65b844cbed75 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.562Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action cb088396-ac4c-409a-87d7-ebe6100f8fd6 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.562Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step fc21ff76-a2fc-4233-9765-59b5e5fcf15b for action cb088396-ac4c-409a-87d7-ebe6100f8fd6 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.563Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:34.563Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item d0f01e93-0553-4d5a-b6db-65b844cbed75 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.564Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item b376d343-8fca-4c43-8d63-40ea65244da9"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.564Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Dependency 2\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.565Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:34.565Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: dependency-2"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.565Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:34.565Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191314565"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.565Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item b376d343-8fca-4c43-8d63-40ea65244da9 within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:34.565Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item b376d343-8fca-4c43-8d63-40ea65244da9 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.565Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 973861ad-560b-4f55-b82c-df820e45ffd0 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.566Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step c0ceccb7-dc0c-4cbd-8dc8-eba74bb84132 for action 973861ad-560b-4f55-b82c-df820e45ffd0 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.566Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:34.566Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item b376d343-8fca-4c43-8d63-40ea65244da9 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.567Z","pid":113601,"hostname":"richard","msg":"Test: should add, modify, and manage dependencies - Created dep1:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.567Z","pid":113601,"hostname":"richard","msg":"Test: should add, modify, and manage dependencies - Adding initial dependency to dep1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.567Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService] Updating work item 8832a69f-f05b-49eb-8359-1e5d688f5525 with data:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.568Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 8832a69f-f05b-49eb-8359-1e5d688f5525 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.568Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 8832a69f-f05b-49eb-8359-1e5d688f5525 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.568Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 8832a69f-f05b-49eb-8359-1e5d688f5525. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.569Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item 8832a69f-f05b-49eb-8359-1e5d688f5525 (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.569Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps Before Update for 8832a69f-f05b-49eb-8359-1e5d688f5525:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.569Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Desired Deps State for 8832a69f-f05b-49eb-8359-1e5d688f5525:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.569Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updating work item 8832a69f-f05b-49eb-8359-1e5d688f5525 in transaction"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.569Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] No core fields to update for 8832a69f-f05b-49eb-8359-1e5d688f5525."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.569Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updating dependencies for item 8832a69f-f05b-49eb-8359-1e5d688f5525. Input dependencies:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.569Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] Found 0 existing dependencies (any state) for 8832a69f-f05b-49eb-8359-1e5d688f5525:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.569Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] Desired Deps State for 8832a69f-f05b-49eb-8359-1e5d688f5525:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.569Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] Dependencies actions for 8832a69f-f05b-49eb-8359-1e5d688f5525: To Insert/Update:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.569Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Inserting/Updating 1 dependencies for 8832a69f-f05b-49eb-8359-1e5d688f5525."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.570Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Total inserted/updated dependencies for 8832a69f-f05b-49eb-8359-1e5d688f5525: 1."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.570Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Finished updating dependencies for item 8832a69f-f05b-49eb-8359-1e5d688f5525."}
{"level":"INFO","time":"2025-05-02T13:08:34.570Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Successfully processed update for item 8832a69f-f05b-49eb-8359-1e5d688f5525."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.570Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 8832a69f-f05b-49eb-8359-1e5d688f5525 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.570Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 8832a69f-f05b-49eb-8359-1e5d688f5525 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.570Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 8832a69f-f05b-49eb-8359-1e5d688f5525. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.571Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item 8832a69f-f05b-49eb-8359-1e5d688f5525 (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.571Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps After Update Repo Call for 8832a69f-f05b-49eb-8359-1e5d688f5525:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.571Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Item fields did NOT change for 8832a69f-f05b-49eb-8359-1e5d688f5525."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.571Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Checking dependency changes for 8832a69f-f05b-49eb-8359-1e5d688f5525..."}
{"level":"INFO","time":"2025-05-02T13:08:34.571Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService] Update called for 8832a69f-f05b-49eb-8359-1e5d688f5525, but no effective changes detected (Item: false, Deps: false). Skipping history."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.572Z","pid":113601,"hostname":"richard","msg":"[WorkItemReadingService] Getting work item by ID: 8832a69f-f05b-49eb-8359-1e5d688f5525 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.572Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 8832a69f-f05b-49eb-8359-1e5d688f5525 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.572Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 8832a69f-f05b-49eb-8359-1e5d688f5525 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.572Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 8832a69f-f05b-49eb-8359-1e5d688f5525. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.572Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: 8832a69f-f05b-49eb-8359-1e5d688f5525 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.572Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.573Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 1 dependencies for item 8832a69f-f05b-49eb-8359-1e5d688f5525 (link active: true, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.573Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item 8832a69f-f05b-49eb-8359-1e5d688f5525 (link active: true, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.574Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent 8832a69f-f05b-49eb-8359-1e5d688f5525 (active: true, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.574Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent 8832a69f-f05b-49eb-8359-1e5d688f5525 (active: true, status: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.574Z","pid":113601,"hostname":"richard","msg":"Test: should add, modify, and manage dependencies - Initial dependency added."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.574Z","pid":113601,"hostname":"richard","msg":"Test: should add, modify, and manage dependencies - Updating dependency to dep2"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.574Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService] Updating work item 8832a69f-f05b-49eb-8359-1e5d688f5525 with data:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.574Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 8832a69f-f05b-49eb-8359-1e5d688f5525 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.574Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 8832a69f-f05b-49eb-8359-1e5d688f5525 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.574Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 8832a69f-f05b-49eb-8359-1e5d688f5525. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.575Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item 8832a69f-f05b-49eb-8359-1e5d688f5525 (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.575Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps Before Update for 8832a69f-f05b-49eb-8359-1e5d688f5525:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.575Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Desired Deps State for 8832a69f-f05b-49eb-8359-1e5d688f5525:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.575Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updating work item 8832a69f-f05b-49eb-8359-1e5d688f5525 in transaction"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.575Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] No core fields to update for 8832a69f-f05b-49eb-8359-1e5d688f5525."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.575Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updating dependencies for item 8832a69f-f05b-49eb-8359-1e5d688f5525. Input dependencies:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.575Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] Found 1 existing dependencies (any state) for 8832a69f-f05b-49eb-8359-1e5d688f5525:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.575Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] Desired Deps State for 8832a69f-f05b-49eb-8359-1e5d688f5525:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.575Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] Dependencies actions for 8832a69f-f05b-49eb-8359-1e5d688f5525: To Insert/Update:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.575Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Deactivating 1 dependencies for 8832a69f-f05b-49eb-8359-1e5d688f5525."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.576Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Deactivated 1 dependencies for 8832a69f-f05b-49eb-8359-1e5d688f5525."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.576Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Inserting/Updating 1 dependencies for 8832a69f-f05b-49eb-8359-1e5d688f5525."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.576Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Total inserted/updated dependencies for 8832a69f-f05b-49eb-8359-1e5d688f5525: 1."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.576Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Finished updating dependencies for item 8832a69f-f05b-49eb-8359-1e5d688f5525."}
{"level":"INFO","time":"2025-05-02T13:08:34.576Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Successfully processed update for item 8832a69f-f05b-49eb-8359-1e5d688f5525."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.576Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 8832a69f-f05b-49eb-8359-1e5d688f5525 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.576Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 8832a69f-f05b-49eb-8359-1e5d688f5525 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.576Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 8832a69f-f05b-49eb-8359-1e5d688f5525. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.577Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 1 dependencies for item 8832a69f-f05b-49eb-8359-1e5d688f5525 (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.577Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps After Update Repo Call for 8832a69f-f05b-49eb-8359-1e5d688f5525:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.577Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Item fields did NOT change for 8832a69f-f05b-49eb-8359-1e5d688f5525."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.577Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Checking dependency changes for 8832a69f-f05b-49eb-8359-1e5d688f5525..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.577Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Dependency 8832a69f-f05b-49eb-8359-1e5d688f5525:d0f01e93-0553-4d5a-b6db-65b844cbed75 ADDED/ACTIVATED."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.577Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Effective changes detected for 8832a69f-f05b-49eb-8359-1e5d688f5525. Generating history."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.577Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 19fd8015-6f7f-4ad0-a1e2-4c7dc4a6b86c in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.577Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 4d6a840d-7411-4899-ab28-0b49ce4b5e7d for action 19fd8015-6f7f-4ad0-a1e2-4c7dc4a6b86c in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.578Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:34.578Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService] Recorded history for update of work item 8832a69f-f05b-49eb-8359-1e5d688f5525."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.579Z","pid":113601,"hostname":"richard","msg":"[WorkItemReadingService] Getting work item by ID: 8832a69f-f05b-49eb-8359-1e5d688f5525 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.579Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 8832a69f-f05b-49eb-8359-1e5d688f5525 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.579Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 8832a69f-f05b-49eb-8359-1e5d688f5525 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.579Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 8832a69f-f05b-49eb-8359-1e5d688f5525. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.579Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: 8832a69f-f05b-49eb-8359-1e5d688f5525 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.579Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.579Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 1 dependencies for item 8832a69f-f05b-49eb-8359-1e5d688f5525 (link active: true, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.580Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item 8832a69f-f05b-49eb-8359-1e5d688f5525 (link active: true, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.580Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent 8832a69f-f05b-49eb-8359-1e5d688f5525 (active: true, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.580Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent 8832a69f-f05b-49eb-8359-1e5d688f5525 (active: true, status: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.580Z","pid":113601,"hostname":"richard","msg":"Test: should add, modify, and manage dependencies - Dependency updated to dep2. Result:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.580Z","pid":113601,"hostname":"richard","msg":"Test: should add, modify, and manage dependencies - Verifying dependencies in result object."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.580Z","pid":113601,"hostname":"richard","msg":"Test: should add, modify, and manage dependencies - Result object verification complete."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.580Z","pid":113601,"hostname":"richard","msg":"Test: should add, modify, and manage dependencies - Fetching all dependencies from DB."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.580Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 1 dependencies for item 8832a69f-f05b-49eb-8359-1e5d688f5525 (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.580Z","pid":113601,"hostname":"richard","msg":"Test: should add, modify, and manage dependencies - Fetched DB dependencies (isActive: false):"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.580Z","pid":113601,"hostname":"richard","msg":"Test: should add, modify, and manage dependencies - Filtered DB dependencies. Active:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.580Z","pid":113601,"hostname":"richard","msg":"Test: should add, modify, and manage dependencies - Finished"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.581Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Starting database clean up..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.581Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating undo_steps CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.582Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating action_history CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.590Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating work_item_dependencies CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.590Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating work_items CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.600Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Database clean up committed."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.600Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Database client released."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.600Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 40f527f5-b705-496d-9185-651c0545fc4a"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.600Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Parent Project\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.601Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:34.601Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: parent-project"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.601Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:34.601Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191314601"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.601Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 40f527f5-b705-496d-9185-651c0545fc4a within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:34.601Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 40f527f5-b705-496d-9185-651c0545fc4a with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.602Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 6b026b68-afb5-44b6-8cf7-32e7a9c83b15 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.602Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 631374b3-b844-465e-a13d-302cdc7661ce for action 6b026b68-afb5-44b6-8cf7-32e7a9c83b15 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.603Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:34.603Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 40f527f5-b705-496d-9185-651c0545fc4a and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.604Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item d01ceb60-8029-4c5e-9ab7-97577390f9da"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.604Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Update Me\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.604Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:34.604Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: update-me"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.604Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:34.604Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191314604"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.604Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item d01ceb60-8029-4c5e-9ab7-97577390f9da within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:34.604Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item d01ceb60-8029-4c5e-9ab7-97577390f9da with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.604Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 33d4f055-08cf-4acb-a0d2-add70f248e14 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.605Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 17b51051-1779-4172-96a6-a95d5d6b887f for action 33d4f055-08cf-4acb-a0d2-add70f248e14 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.605Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:34.605Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item d01ceb60-8029-4c5e-9ab7-97577390f9da and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.606Z","pid":113601,"hostname":"richard","msg":"BeforeEach setup complete for WorkItemUpdateIntegration.test.ts"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.606Z","pid":113601,"hostname":"richard","msg":"Test: should handle updates to non-existent parent - Starting"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.606Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService] Updating work item d01ceb60-8029-4c5e-9ab7-97577390f9da with data:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.607Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: d01ceb60-8029-4c5e-9ab7-97577390f9da with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.607Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID d01ceb60-8029-4c5e-9ab7-97577390f9da (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.607Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item d01ceb60-8029-4c5e-9ab7-97577390f9da. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.607Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item d01ceb60-8029-4c5e-9ab7-97577390f9da (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.607Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps Before Update for d01ceb60-8029-4c5e-9ab7-97577390f9da:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.607Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: f47ac10b-58cc-4372-a567-0e02b2c3d479 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.607Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID f47ac10b-58cc-4372-a567-0e02b2c3d479 (isActive: true) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.607Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Work item f47ac10b-58cc-4372-a567-0e02b2c3d479 not found or filtered out (isActive filter: true)."}
{"level":"ERROR","time":"2025-05-02T13:08:34.607Z","pid":113601,"hostname":"richard","err":{"type":"ValidationError","message":"New parent work item with ID f47ac10b-58cc-4372-a567-0e02b2c3d479 not found or is inactive.","stack":"ValidationError: New parent work item with ID f47ac10b-58cc-4372-a567-0e02b2c3d479 not found or is inactive.\n    at /home/richard/repos/mcp-task-manager-server/src/services/WorkItemUpdateService.ts:88:17\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at ActionHistoryRepository.withTransaction (/home/richard/repos/mcp-task-manager-server/src/repositories/ActionHistoryRepositoryBase.ts:107:22)\n    at WorkItemUpdateService.updateWorkItem (/home/richard/repos/mcp-task-manager-server/src/services/WorkItemUpdateService.ts:57:25)\n    at Object.<anonymous> (/home/richard/repos/mcp-task-manager-server/src/services/__tests__/workItemUpdateIntegration.test.ts:160:7)","name":"ValidationError"},"msg":"[ActionHistoryRepositoryBase.withTransaction] Transaction error, attempting rollback"}
{"level":"INFO","time":"2025-05-02T13:08:34.617Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryBase.withTransaction] Transaction rolled back successfully."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.618Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService] Updating work item d01ceb60-8029-4c5e-9ab7-97577390f9da with data:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.618Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: d01ceb60-8029-4c5e-9ab7-97577390f9da with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.619Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID d01ceb60-8029-4c5e-9ab7-97577390f9da (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.619Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item d01ceb60-8029-4c5e-9ab7-97577390f9da. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.619Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item d01ceb60-8029-4c5e-9ab7-97577390f9da (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.619Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps Before Update for d01ceb60-8029-4c5e-9ab7-97577390f9da:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.619Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: f47ac10b-58cc-4372-a567-0e02b2c3d479 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.620Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID f47ac10b-58cc-4372-a567-0e02b2c3d479 (isActive: true) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.620Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Work item f47ac10b-58cc-4372-a567-0e02b2c3d479 not found or filtered out (isActive filter: true)."}
{"level":"ERROR","time":"2025-05-02T13:08:34.620Z","pid":113601,"hostname":"richard","err":{"type":"ValidationError","message":"New parent work item with ID f47ac10b-58cc-4372-a567-0e02b2c3d479 not found or is inactive.","stack":"ValidationError: New parent work item with ID f47ac10b-58cc-4372-a567-0e02b2c3d479 not found or is inactive.\n    at /home/richard/repos/mcp-task-manager-server/src/services/WorkItemUpdateService.ts:88:17\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at ActionHistoryRepository.withTransaction (/home/richard/repos/mcp-task-manager-server/src/repositories/ActionHistoryRepositoryBase.ts:107:22)\n    at WorkItemUpdateService.updateWorkItem (/home/richard/repos/mcp-task-manager-server/src/services/WorkItemUpdateService.ts:57:25)\n    at Object.<anonymous> (/home/richard/repos/mcp-task-manager-server/src/services/__tests__/workItemUpdateIntegration.test.ts:165:7)","name":"ValidationError"},"msg":"[ActionHistoryRepositoryBase.withTransaction] Transaction error, attempting rollback"}
{"level":"INFO","time":"2025-05-02T13:08:34.621Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryBase.withTransaction] Transaction rolled back successfully."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.621Z","pid":113601,"hostname":"richard","msg":"Test: should handle updates to non-existent parent - Finished"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.622Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Starting database clean up..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.622Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating undo_steps CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.623Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating action_history CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.631Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating work_item_dependencies CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.631Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating work_items CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.640Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Database clean up committed."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.640Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Database client released."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.640Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 730b9079-8e26-4caf-ac91-30a23e5f45d0"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.640Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Parent Project\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.640Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:34.640Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: parent-project"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.640Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:34.640Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191314640"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.640Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 730b9079-8e26-4caf-ac91-30a23e5f45d0 within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:34.642Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 730b9079-8e26-4caf-ac91-30a23e5f45d0 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.644Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 229d8a41-3b7b-4637-9dd0-75f7c5fda13c in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.645Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 4e8a575d-dbc6-4dfd-938f-a498b59731bc for action 229d8a41-3b7b-4637-9dd0-75f7c5fda13c in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.646Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:34.646Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 730b9079-8e26-4caf-ac91-30a23e5f45d0 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.647Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 162782e0-bb2f-4093-9e94-4a56108750e6"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.648Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Update Me\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.648Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:34.648Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: update-me"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.648Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:34.648Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191314648"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.648Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 162782e0-bb2f-4093-9e94-4a56108750e6 within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:34.649Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 162782e0-bb2f-4093-9e94-4a56108750e6 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.649Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 2b8e46e0-2182-4c1f-9661-a910d81c9014 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.650Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step a16fd8a2-7651-4ab7-80b4-9b8be3649b86 for action 2b8e46e0-2182-4c1f-9661-a910d81c9014 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.650Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:34.650Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 162782e0-bb2f-4093-9e94-4a56108750e6 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.651Z","pid":113601,"hostname":"richard","msg":"BeforeEach setup complete for WorkItemUpdateIntegration.test.ts"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.652Z","pid":113601,"hostname":"richard","msg":"Test: should not create history for no-change updates - Starting"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.652Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 2 recent actions."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.652Z","pid":113601,"hostname":"richard","msg":"[WorkItemReadingService] Getting work item by ID: 162782e0-bb2f-4093-9e94-4a56108750e6 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.652Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 162782e0-bb2f-4093-9e94-4a56108750e6 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.653Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 162782e0-bb2f-4093-9e94-4a56108750e6 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.653Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 162782e0-bb2f-4093-9e94-4a56108750e6. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.653Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: 162782e0-bb2f-4093-9e94-4a56108750e6 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.653Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.653Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item 162782e0-bb2f-4093-9e94-4a56108750e6 (link active: true, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.654Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item 162782e0-bb2f-4093-9e94-4a56108750e6 (link active: true, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.655Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent 162782e0-bb2f-4093-9e94-4a56108750e6 (active: true, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.655Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent 162782e0-bb2f-4093-9e94-4a56108750e6 (active: true, status: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.656Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService] Updating work item 162782e0-bb2f-4093-9e94-4a56108750e6 with data:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.656Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 162782e0-bb2f-4093-9e94-4a56108750e6 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.656Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 162782e0-bb2f-4093-9e94-4a56108750e6 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.656Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 162782e0-bb2f-4093-9e94-4a56108750e6. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.657Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item 162782e0-bb2f-4093-9e94-4a56108750e6 (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.657Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps Before Update for 162782e0-bb2f-4093-9e94-4a56108750e6:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.657Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Desired Deps State for 162782e0-bb2f-4093-9e94-4a56108750e6:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.657Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updating work item 162782e0-bb2f-4093-9e94-4a56108750e6 in transaction"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.657Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] No core fields to update for 162782e0-bb2f-4093-9e94-4a56108750e6."}
{"level":"INFO","time":"2025-05-02T13:08:34.657Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Successfully processed update for item 162782e0-bb2f-4093-9e94-4a56108750e6."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.657Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 162782e0-bb2f-4093-9e94-4a56108750e6 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.658Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 162782e0-bb2f-4093-9e94-4a56108750e6 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.658Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 162782e0-bb2f-4093-9e94-4a56108750e6. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.658Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item 162782e0-bb2f-4093-9e94-4a56108750e6 (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.658Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps After Update Repo Call for 162782e0-bb2f-4093-9e94-4a56108750e6:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.658Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Item fields did NOT change for 162782e0-bb2f-4093-9e94-4a56108750e6."}
{"level":"INFO","time":"2025-05-02T13:08:34.658Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService] Update called for 162782e0-bb2f-4093-9e94-4a56108750e6, but no effective changes detected (Item: false, Deps: false). Skipping history."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.658Z","pid":113601,"hostname":"richard","msg":"[WorkItemReadingService] Getting work item by ID: 162782e0-bb2f-4093-9e94-4a56108750e6 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.658Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 162782e0-bb2f-4093-9e94-4a56108750e6 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.658Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 162782e0-bb2f-4093-9e94-4a56108750e6 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.659Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 162782e0-bb2f-4093-9e94-4a56108750e6. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.659Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: 162782e0-bb2f-4093-9e94-4a56108750e6 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.659Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.659Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item 162782e0-bb2f-4093-9e94-4a56108750e6 (link active: true, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.659Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item 162782e0-bb2f-4093-9e94-4a56108750e6 (link active: true, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.659Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent 162782e0-bb2f-4093-9e94-4a56108750e6 (active: true, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.659Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent 162782e0-bb2f-4093-9e94-4a56108750e6 (active: true, status: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.660Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.660Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 2 recent actions."}
PASS dist/services/__tests__/workItemUpdateIntegration.test.js
{"level":"INFO","time":"2025-05-02T13:08:34.746Z","pid":113601,"hostname":"richard","msg":"Loading environment variable overrides for configuration..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.661Z","pid":113601,"hostname":"richard","msg":"Test: should not create history for no-change updates - Finished"}
{"level":"INFO","time":"2025-05-02T13:08:34.746Z","pid":113601,"hostname":"richard","msg":"Overriding pgHost from env: localhost"}
{"level":"INFO","time":"2025-05-02T13:08:34.746Z","pid":113601,"hostname":"richard","msg":"Overriding pgPort from env: 5432"}
{"level":"INFO","time":"2025-05-02T13:08:34.746Z","pid":113601,"hostname":"richard","msg":"Overriding pgUser from env: taskmanager_user"}
{"level":"INFO","time":"2025-05-02T13:08:34.746Z","pid":113601,"hostname":"richard","msg":"Overriding pgPassword from env."}
{"level":"INFO","time":"2025-05-02T13:08:34.746Z","pid":113601,"hostname":"richard","msg":"Overriding pgDatabase from env: taskmanager_db"}
{"level":"INFO","time":"2025-05-02T13:08:34.747Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] Setting up PostgreSQL connection pool..."}
{"level":"INFO","time":"2025-05-02T13:08:34.747Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] PostgreSQL connection pool configured."}
{"level":"INFO","time":"2025-05-02T13:08:34.747Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] Starting database schema initialization..."}
{"level":"INFO","time":"2025-05-02T13:08:34.758Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] Connected to PostgreSQL for schema check/application."}
{"level":"INFO","time":"2025-05-02T13:08:34.758Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] Force schema run enabled or tables missing. Initializing/Re-initializing schema..."}
{"level":"INFO","time":"2025-05-02T13:08:34.758Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] Looking for schema file at: /home/richard/repos/mcp-task-manager-server/dist/db/schema.sql"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.758Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] Schema file read successfully. Executing schema setup..."}
{"level":"INFO","time":"2025-05-02T13:08:34.773Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] Full schema script executed."}
{"level":"INFO","time":"2025-05-02T13:08:34.775Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] Confirmed work_items table exists after schema execution."}
{"level":"INFO","time":"2025-05-02T13:08:34.775Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] Initialization marked as complete."}
{"level":"INFO","time":"2025-05-02T13:08:34.775Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] Released schema check/application client."}
{"level":"INFO","time":"2025-05-02T13:08:34.775Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] Instance created and database initialized."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.776Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Starting database clean up..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.776Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating undo_steps CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.777Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating action_history CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.785Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating work_item_dependencies CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.785Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating work_items CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.794Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Database clean up committed."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.794Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Database client released."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.794Z","pid":113601,"hostname":"richard","msg":"BeforeEach setup complete for WorkItemAddIntegration.test.ts"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.794Z","pid":113601,"hostname":"richard","msg":"Test: should add a root work item without dependencies - Starting"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.795Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 916a12c2-e298-4132-841c-6eca541ca626"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.795Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Root Project A\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.797Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:34.797Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: root-project-a"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.797Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:34.797Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191314797"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.797Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 916a12c2-e298-4132-841c-6eca541ca626 within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:34.798Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 916a12c2-e298-4132-841c-6eca541ca626 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.798Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 3479fc42-8f65-404f-9da3-7671d7ac94cf in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.799Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 4234dbfc-c672-42cb-9b70-ede9c3101402 for action 3479fc42-8f65-404f-9da3-7671d7ac94cf in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.799Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:34.799Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 916a12c2-e298-4132-841c-6eca541ca626 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.802Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 916a12c2-e298-4132-841c-6eca541ca626 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.802Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 916a12c2-e298-4132-841c-6eca541ca626 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.802Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 916a12c2-e298-4132-841c-6eca541ca626. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.803Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.804Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Found 1 steps for action 3479fc42-8f65-404f-9da3-7671d7ac94cf."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.804Z","pid":113601,"hostname":"richard","msg":"Test: should add a root work item without dependencies - Finished"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.805Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Starting database clean up..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.805Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating undo_steps CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.806Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating action_history CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.813Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating work_item_dependencies CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.814Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating work_items CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.822Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Database clean up committed."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.822Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Database client released."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.822Z","pid":113601,"hostname":"richard","msg":"BeforeEach setup complete for WorkItemAddIntegration.test.ts"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.823Z","pid":113601,"hostname":"richard","msg":"Test: should add a child work item with a parent - Starting"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.823Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item c7138b30-3abb-41d2-89d7-4e8cca7933b1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.823Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Parent Project\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.823Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:34.823Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: parent-project"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.823Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:34.823Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191314823"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.823Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item c7138b30-3abb-41d2-89d7-4e8cca7933b1 within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:34.823Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item c7138b30-3abb-41d2-89d7-4e8cca7933b1 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.824Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 9480c0ed-9393-4ad2-8e25-315a9852774e in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.824Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 48d740e5-9538-4234-b689-5807c71599b7 for action 9480c0ed-9393-4ad2-8e25-315a9852774e in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.824Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:34.824Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item c7138b30-3abb-41d2-89d7-4e8cca7933b1 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.826Z","pid":113601,"hostname":"richard","msg":"Test: should add a child work item with a parent - Created parent:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.826Z","pid":113601,"hostname":"richard","msg":"Test: should add a child work item with a parent - Adding child to parent"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.826Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 546dad5a-e555-42b5-9ab4-514c57f76c72"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.826Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: c7138b30-3abb-41d2-89d7-4e8cca7933b1 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.826Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID c7138b30-3abb-41d2-89d7-4e8cca7933b1 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.826Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item c7138b30-3abb-41d2-89d7-4e8cca7933b1. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.826Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Child Task\", parentId: c7138b30-3abb-41d2-89d7-4e8cca7933b1, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.826Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: c7138b30-3abb-41d2-89d7-4e8cca7933b1 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.826Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.826Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent c7138b30-3abb-41d2-89d7-4e8cca7933b1 (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.826Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent c7138b30-3abb-41d2-89d7-4e8cca7933b1 (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:34.826Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: child-task"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.826Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: c7138b30-3abb-41d2-89d7-4e8cca7933b1, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:34.826Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191314826"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.826Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 546dad5a-e555-42b5-9ab4-514c57f76c72 within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:34.827Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 546dad5a-e555-42b5-9ab4-514c57f76c72 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.827Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 846434b4-2239-4f23-b090-c8522e5e6a5c in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.827Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 7c57e48b-437b-49d7-8099-fad4bc5b3a0e for action 846434b4-2239-4f23-b090-c8522e5e6a5c in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.827Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:34.827Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 546dad5a-e555-42b5-9ab4-514c57f76c72 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.828Z","pid":113601,"hostname":"richard","msg":"Test: should add a child work item with a parent - Child added:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.828Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 546dad5a-e555-42b5-9ab4-514c57f76c72 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.829Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 546dad5a-e555-42b5-9ab4-514c57f76c72 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.829Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 546dad5a-e555-42b5-9ab4-514c57f76c72. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.829Z","pid":113601,"hostname":"richard","msg":"Test: should add a child work item with a parent - Finished"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.829Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Starting database clean up..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.829Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating undo_steps CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.830Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating action_history CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.837Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating work_item_dependencies CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.838Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating work_items CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.846Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Database clean up committed."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.846Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Database client released."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.846Z","pid":113601,"hostname":"richard","msg":"BeforeEach setup complete for WorkItemAddIntegration.test.ts"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.846Z","pid":113601,"hostname":"richard","msg":"Test: should add a work item with dependencies - Starting"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.846Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 224cf0ae-d626-4900-b8c8-e708f3b6dd22"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.846Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Dependency Target\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.847Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:34.847Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: dependency-target"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.847Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:34.847Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191314847"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.847Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 224cf0ae-d626-4900-b8c8-e708f3b6dd22 within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:34.847Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 224cf0ae-d626-4900-b8c8-e708f3b6dd22 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.848Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action f0eb938b-4c37-4b57-ae45-abe7bd0c90dc in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.848Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 24e18f4a-d0a8-4f19-9748-2d549286028c for action f0eb938b-4c37-4b57-ae45-abe7bd0c90dc in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.848Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:34.848Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 224cf0ae-d626-4900-b8c8-e708f3b6dd22 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.849Z","pid":113601,"hostname":"richard","msg":"Test: should add a work item with dependencies - Created dependency target:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.849Z","pid":113601,"hostname":"richard","msg":"Test: should add a work item with dependencies - Adding item with dependency on"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.849Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 739601ff-a61d-4da6-8d56-326b11c8aa9a"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.850Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Item with Dependency\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.850Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:34.850Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: item-with-dependency"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.850Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:34.850Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191314850"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.850Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 739601ff-a61d-4da6-8d56-326b11c8aa9a within transaction"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.850Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] create: Inserting 1 dependencies for item 739601ff-a61d-4da6-8d56-326b11c8aa9a."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.850Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] create: Inserting dependency 739601ff-a61d-4da6-8d56-326b11c8aa9a -> 224cf0ae-d626-4900-b8c8-e708f3b6dd22"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.851Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] create: Finished inserting dependencies for item 739601ff-a61d-4da6-8d56-326b11c8aa9a."}
{"level":"INFO","time":"2025-05-02T13:08:34.851Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 739601ff-a61d-4da6-8d56-326b11c8aa9a with 1 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.852Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 4ec76455-d626-4341-9902-47ec590ee536 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.852Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step db50c34d-ba31-4c28-9f2a-e12c94ad7d68 for action 4ec76455-d626-4341-9902-47ec590ee536 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.853Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step ba2b1962-cc08-437e-9b92-8ac8846ba99b for action 4ec76455-d626-4341-9902-47ec590ee536 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.853Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:34.853Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 739601ff-a61d-4da6-8d56-326b11c8aa9a and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.855Z","pid":113601,"hostname":"richard","msg":"Test: should add a work item with dependencies - Item with dependency added:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.855Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 1 dependencies for item 739601ff-a61d-4da6-8d56-326b11c8aa9a (link active: true, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.856Z","pid":113601,"hostname":"richard","msg":"Test: should add a work item with dependencies - Finished"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.856Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Starting database clean up..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.859Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating undo_steps CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.860Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating action_history CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.870Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating work_item_dependencies CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.870Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating work_items CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.880Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Database clean up committed."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.880Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Database client released."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.880Z","pid":113601,"hostname":"richard","msg":"BeforeEach setup complete for WorkItemAddIntegration.test.ts"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.881Z","pid":113601,"hostname":"richard","msg":"Test: should clear the redo stack when adding a new item - Starting"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.881Z","pid":113601,"hostname":"richard","msg":"Test: should clear the redo stack when adding a new item - Adding Item 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.881Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item cd8c2f4c-f7b7-4005-b0cb-cb3721f8a7ad"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.881Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Item 1\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.882Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:34.882Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: item-1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.882Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:34.882Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191314882"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.882Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item cd8c2f4c-f7b7-4005-b0cb-cb3721f8a7ad within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:34.882Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item cd8c2f4c-f7b7-4005-b0cb-cb3721f8a7ad with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.882Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 61b8eac9-8e21-45cc-a96f-98d7839e63b0 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.883Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step c3c7484d-62e3-46a9-9614-d9f69ed80081 for action 61b8eac9-8e21-45cc-a96f-98d7839e63b0 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.883Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:34.883Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item cd8c2f4c-f7b7-4005-b0cb-cb3721f8a7ad and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.884Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.884Z","pid":113601,"hostname":"richard","msg":"Test: should clear the redo stack when adding a new item - Added Item 1, action:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.884Z","pid":113601,"hostname":"richard","msg":"Test: should clear the redo stack when adding a new item - Undoing Add Item 1"}
{"level":"INFO","time":"2025-05-02T13:08:34.885Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to undo last action."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.885Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Found original action to undo: 61b8eac9-8e21-45cc-a96f-98d7839e63b0 (ADD_WORK_ITEM)"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.885Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Found 1 steps for action 61b8eac9-8e21-45cc-a96f-98d7839e63b0."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.886Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Executing 1 undo steps for action 61b8eac9-8e21-45cc-a96f-98d7839e63b0 in reverse order"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.886Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Executing undo step 1 (UPDATE) on work_items record cd8c2f4c-f7b7-4005-b0cb-cb3721f8a7ad for action 61b8eac9-8e21-45cc-a96f-98d7839e63b0"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.886Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryUndoRedo] Updated row in work_items cd8c2f4c-f7b7-4005-b0cb-cb3721f8a7ad based on PKs."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.887Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action a9c4c5ed-c159-4e7b-a6eb-d7f10eca0b81 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.887Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked action 61b8eac9-8e21-45cc-a96f-98d7839e63b0 as undone by action a9c4c5ed-c159-4e7b-a6eb-d7f10eca0b81."}
{"level":"INFO","time":"2025-05-02T13:08:34.887Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Successfully undid action 61b8eac9-8e21-45cc-a96f-98d7839e63b0"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.889Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.889Z","pid":113601,"hostname":"richard","msg":"Test: should clear the redo stack when adding a new item - Undid Add Item 1, undo action:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.890Z","pid":113601,"hostname":"richard","msg":"Test: should clear the redo stack when adding a new item - Verified action 1 is undone."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.890Z","pid":113601,"hostname":"richard","msg":"Test: should clear the redo stack when adding a new item - Adding Item 2 (clears redo stack)"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.890Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item cef9912c-be83-4e12-83f2-f22f70798e7d"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.890Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Item 2\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.891Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 1 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:34.891Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: item-2"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.891Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:34.891Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191314891"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.891Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item cef9912c-be83-4e12-83f2-f22f70798e7d within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:34.892Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item cef9912c-be83-4e12-83f2-f22f70798e7d with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.893Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 6dc055ad-cfed-4d87-bb90-0fabd1b45536 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.893Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 977e957f-c1e1-4232-b43e-02df8f771d02 for action 6dc055ad-cfed-4d87-bb90-0fabd1b45536 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.893Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.894Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Marked UNDO_ACTION a9c4c5ed-c159-4e7b-a6eb-d7f10eca0b81 as redone/invalidated by action 6dc055ad-cfed-4d87-bb90-0fabd1b45536."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.894Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Invalidated 1 potential redo(s) due to new action 6dc055ad-cfed-4d87-bb90-0fabd1b45536."}
{"level":"INFO","time":"2025-05-02T13:08:34.894Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item cef9912c-be83-4e12-83f2-f22f70798e7d and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.895Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 1 recent actions."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.895Z","pid":113601,"hostname":"richard","msg":"Test: should clear the redo stack when adding a new item - Added Item 2, action:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.895Z","pid":113601,"hostname":"richard","msg":"Test: should clear the redo stack when adding a new item - Verified undo action is invalidated by action 2."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.895Z","pid":113601,"hostname":"richard","msg":"Test: should clear the redo stack when adding a new item - Attempting redo (should be null)"}
{"level":"INFO","time":"2025-05-02T13:08:34.895Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] Attempting to redo last undo action."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.896Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] No un-redone UNDO_ACTIONs found."}
{"level":"INFO","time":"2025-05-02T13:08:34.896Z","pid":113601,"hostname":"richard","msg":"[WorkItemHistoryService] No undo action found to redo."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.896Z","pid":113601,"hostname":"richard","msg":"Test: should clear the redo stack when adding a new item - Redo result:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.896Z","pid":113601,"hostname":"richard","msg":"Test: should clear the redo stack when adding a new item - Verifying item 1 is inactive (isActive: false)"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.896Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: cd8c2f4c-f7b7-4005-b0cb-cb3721f8a7ad with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.896Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID cd8c2f4c-f7b7-4005-b0cb-cb3721f8a7ad (isActive: false) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.896Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item cd8c2f4c-f7b7-4005-b0cb-cb3721f8a7ad. isActive: false"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.896Z","pid":113601,"hostname":"richard","msg":"Test: should clear the redo stack when adding a new item - Fetched item 1 (isActive: false):"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.896Z","pid":113601,"hostname":"richard","msg":"Test: should clear the redo stack when adding a new item - Verified item 1 is inactive."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.896Z","pid":113601,"hostname":"richard","msg":"Test: should clear the redo stack when adding a new item - Verifying item 2 exists and is active (isActive: true)"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.896Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: cef9912c-be83-4e12-83f2-f22f70798e7d with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.897Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID cef9912c-be83-4e12-83f2-f22f70798e7d (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.897Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item cef9912c-be83-4e12-83f2-f22f70798e7d. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.897Z","pid":113601,"hostname":"richard","msg":"Test: should clear the redo stack when adding a new item - Fetched item 2 (isActive: true):"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.897Z","pid":113601,"hostname":"richard","msg":"Test: should clear the redo stack when adding a new item - Finished"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.897Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Starting database clean up..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.897Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating undo_steps CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.898Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating action_history CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.905Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating work_item_dependencies CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.906Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating work_items CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.915Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Database clean up committed."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.915Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Database client released."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.915Z","pid":113601,"hostname":"richard","msg":"BeforeEach setup complete for WorkItemAddIntegration.test.ts"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.915Z","pid":113601,"hostname":"richard","msg":"Test: should validate parent work item is active - Starting"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.915Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 37cc15f9-462e-423a-a814-d9a8a3797115"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.915Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Parent Project\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.916Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:34.916Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: parent-project"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.916Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:34.916Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191314916"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.916Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 37cc15f9-462e-423a-a814-d9a8a3797115 within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:34.916Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 37cc15f9-462e-423a-a814-d9a8a3797115 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.917Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 2bd41d0b-e6db-4957-b3ed-7e20e4b12006 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.917Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 9c1598a4-5934-4e44-9a6e-c4f917a5faaf for action 2bd41d0b-e6db-4957-b3ed-7e20e4b12006 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.917Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:34.917Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 37cc15f9-462e-423a-a814-d9a8a3797115 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.918Z","pid":113601,"hostname":"richard","msg":"Test: should validate parent work item is active - Created parent:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.918Z","pid":113601,"hostname":"richard","msg":"Test: should validate parent work item is active - Soft deleting parent"}
{"level":"WARN","time":"2025-05-02T13:08:34.919Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Attempting to soft delete 1 work item(s) and cascade: 37cc15f9-462e-423a-a814-d9a8a3797115"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.919Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Finding all descendants..."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.919Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: 37cc15f9-462e-423a-a814-d9a8a3797115 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.919Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.919Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent 37cc15f9-462e-423a-a814-d9a8a3797115 (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.919Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent 37cc15f9-462e-423a-a814-d9a8a3797115 (active: false, status: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.919Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Full cascade list (1 items) identified: 37cc15f9-462e-423a-a814-d9a8a3797115"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.919Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item list (count: 1, link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.920Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item list (count: 1, link active: false, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.920Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Identified 0 potentially affected dependency links for cascade delete."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.920Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found 1 work items by IDs (count: 1, isActive: true)."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.920Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Found 1 active items in cascade list for deletion."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.920Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Items identified in cascade (all):"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.920Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Active items to delete (filtered):"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.920Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService DIAG] Attempting to soft delete these active item IDs: 37cc15f9-462e-423a-a814-d9a8a3797115"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.920Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] Executing softDelete SQL: \n      UPDATE work_items\n      SET is_active = FALSE, updated_at = $1\n      WHERE work_item_id IN ($2) AND is_active = TRUE;\n     PARAMS: [\"2025-05-02T13:08:34.920Z\",\"37cc15f9-462e-423a-a814-d9a8a3797115\"]"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.921Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] softDelete result rowCount: 1"}
{"level":"INFO","time":"2025-05-02T13:08:34.921Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Soft deleted 1 work item(s)."}
{"level":"INFO","time":"2025-05-02T13:08:34.921Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Repository reported 1 work item(s) soft deleted."}
{"level":"INFO","time":"2025-05-02T13:08:34.921Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] No active dependency links found to soft delete within the cascade."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.921Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 0925742c-bc07-4e14-8469-dab0476a10b5 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.921Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step d1cf4e7d-dfca-4f44-bc71-b00f73455e61 for action 0925742c-bc07-4e14-8469-dab0476a10b5 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.921Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:34.921Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Recorded history for delete action 0925742c-bc07-4e14-8469-dab0476a10b5."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.922Z","pid":113601,"hostname":"richard","msg":"[WorkItemDeleteService] Returning count: 1 (based on repository rowCount)"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.922Z","pid":113601,"hostname":"richard","msg":"Test: should validate parent work item is active - Fetching parent (isActive: false) to confirm inactive"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.922Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 37cc15f9-462e-423a-a814-d9a8a3797115 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.922Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 37cc15f9-462e-423a-a814-d9a8a3797115 (isActive: false) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.922Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 37cc15f9-462e-423a-a814-d9a8a3797115. isActive: false"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.922Z","pid":113601,"hostname":"richard","msg":"Test: should validate parent work item is active - Fetched parent (isActive: false):"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.923Z","pid":113601,"hostname":"richard","msg":"Test: should validate parent work item is active - Attempting to add child to inactive parent"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.923Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item c981e8ed-2a3c-416b-afe6-a398ebacfe52"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.923Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 37cc15f9-462e-423a-a814-d9a8a3797115 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.923Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 37cc15f9-462e-423a-a814-d9a8a3797115 (isActive: true) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.923Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Work item 37cc15f9-462e-423a-a814-d9a8a3797115 not found or filtered out (isActive filter: true)."}
{"level":"ERROR","time":"2025-05-02T13:08:34.923Z","pid":113601,"hostname":"richard","err":{"type":"ValidationError","message":"Parent work item with ID 37cc15f9-462e-423a-a814-d9a8a3797115 not found or is inactive.","stack":"ValidationError: Parent work item with ID 37cc15f9-462e-423a-a814-d9a8a3797115 not found or is inactive.\n    at /home/richard/repos/mcp-task-manager-server/src/services/WorkItemAddingService.ts:58:19\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at ActionHistoryRepository.withTransaction (/home/richard/repos/mcp-task-manager-server/src/repositories/ActionHistoryRepositoryBase.ts:107:22)\n    at WorkItemAddingService.addWorkItem (/home/richard/repos/mcp-task-manager-server/src/services/WorkItemAddingService.ts:54:27)\n    at Object.<anonymous> (/home/richard/repos/mcp-task-manager-server/src/services/__tests__/workItemAddIntegration.test.ts:235:7)","name":"ValidationError"},"msg":"[ActionHistoryRepositoryBase.withTransaction] Transaction error, attempting rollback"}
{"level":"INFO","time":"2025-05-02T13:08:34.930Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryBase.withTransaction] Transaction rolled back successfully."}
{"level":"WARN","time":"2025-05-02T13:08:34.931Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Validation error adding work item \"Child Task\": Parent work item with ID 37cc15f9-462e-423a-a814-d9a8a3797115 not found or is inactive."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.931Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item f05ef23b-3d86-488b-b719-f8bd86522081"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.931Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 37cc15f9-462e-423a-a814-d9a8a3797115 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.931Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 37cc15f9-462e-423a-a814-d9a8a3797115 (isActive: true) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T13:08:34.931Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Work item 37cc15f9-462e-423a-a814-d9a8a3797115 not found or filtered out (isActive filter: true)."}
{"level":"ERROR","time":"2025-05-02T13:08:34.931Z","pid":113601,"hostname":"richard","err":{"type":"ValidationError","message":"Parent work item with ID 37cc15f9-462e-423a-a814-d9a8a3797115 not found or is inactive.","stack":"ValidationError: Parent work item with ID 37cc15f9-462e-423a-a814-d9a8a3797115 not found or is inactive.\n    at /home/richard/repos/mcp-task-manager-server/src/services/WorkItemAddingService.ts:58:19\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at ActionHistoryRepository.withTransaction (/home/richard/repos/mcp-task-manager-server/src/repositories/ActionHistoryRepositoryBase.ts:107:22)\n    at WorkItemAddingService.addWorkItem (/home/richard/repos/mcp-task-manager-server/src/services/WorkItemAddingService.ts:54:27)\n    at Object.<anonymous> (/home/richard/repos/mcp-task-manager-server/src/services/__tests__/workItemAddIntegration.test.ts:241:7)","name":"ValidationError"},"msg":"[ActionHistoryRepositoryBase.withTransaction] Transaction error, attempting rollback"}
{"level":"INFO","time":"2025-05-02T13:08:34.932Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryBase.withTransaction] Transaction rolled back successfully."}
PASS dist/services/__tests__/workItemAddIntegration.test.js
{"level":"INFO","time":"2025-05-02T13:08:35.014Z","pid":113601,"hostname":"richard","msg":"Loading environment variable overrides for configuration..."}
{"level":"WARN","time":"2025-05-02T13:08:34.932Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Validation error adding work item \"Child Task\": Parent work item with ID 37cc15f9-462e-423a-a814-d9a8a3797115 not found or is inactive."}
{"level":"DEBUG","time":"2025-05-02T13:08:34.932Z","pid":113601,"hostname":"richard","msg":"Test: should validate parent work item is active - Finished"}
{"level":"INFO","time":"2025-05-02T13:08:35.014Z","pid":113601,"hostname":"richard","msg":"Overriding pgHost from env: localhost"}
{"level":"INFO","time":"2025-05-02T13:08:35.014Z","pid":113601,"hostname":"richard","msg":"Overriding pgPort from env: 5432"}
{"level":"INFO","time":"2025-05-02T13:08:35.014Z","pid":113601,"hostname":"richard","msg":"Overriding pgUser from env: taskmanager_user"}
{"level":"INFO","time":"2025-05-02T13:08:35.014Z","pid":113601,"hostname":"richard","msg":"Overriding pgPassword from env."}
{"level":"INFO","time":"2025-05-02T13:08:35.014Z","pid":113601,"hostname":"richard","msg":"Overriding pgDatabase from env: taskmanager_db"}
{"level":"INFO","time":"2025-05-02T13:08:35.014Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] Setting up PostgreSQL connection pool..."}
{"level":"INFO","time":"2025-05-02T13:08:35.014Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] PostgreSQL connection pool configured."}
{"level":"INFO","time":"2025-05-02T13:08:35.015Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] Starting database schema initialization..."}
{"level":"INFO","time":"2025-05-02T13:08:35.024Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] Connected to PostgreSQL for schema check/application."}
{"level":"INFO","time":"2025-05-02T13:08:35.024Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] Force schema run enabled or tables missing. Initializing/Re-initializing schema..."}
{"level":"INFO","time":"2025-05-02T13:08:35.024Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] Looking for schema file at: /home/richard/repos/mcp-task-manager-server/dist/db/schema.sql"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.024Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] Schema file read successfully. Executing schema setup..."}
{"level":"INFO","time":"2025-05-02T13:08:35.038Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] Full schema script executed."}
{"level":"INFO","time":"2025-05-02T13:08:35.040Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] Confirmed work_items table exists after schema execution."}
{"level":"INFO","time":"2025-05-02T13:08:35.040Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] Initialization marked as complete."}
{"level":"INFO","time":"2025-05-02T13:08:35.040Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] Released schema check/application client."}
{"level":"INFO","time":"2025-05-02T13:08:35.040Z","pid":113601,"hostname":"richard","msg":"[DatabaseManager] Instance created and database initialized."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.041Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Starting database clean up..."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.041Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating undo_steps CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.042Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating action_history CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.050Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating work_item_dependencies CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.051Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating work_items CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.060Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Database clean up committed."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.060Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Database client released."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.060Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item f716cb13-ccf9-4811-b073-1aae1feef8b0"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.061Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Root Project 1\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.063Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:35.063Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: root-project-1"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.063Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:35.063Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191315063"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.064Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item f716cb13-ccf9-4811-b073-1aae1feef8b0 within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:35.065Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item f716cb13-ccf9-4811-b073-1aae1feef8b0 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.065Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 8f16a203-e49d-4bdf-ac89-a736884ad379 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.066Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 1fd631a1-3644-4adc-b05d-29eb48dcd80f for action 8f16a203-e49d-4bdf-ac89-a736884ad379 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.067Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:35.067Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item f716cb13-ccf9-4811-b073-1aae1feef8b0 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.068Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 3b869e0c-ecf7-42e6-9fb1-d8a46fd1bec1"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.068Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Root Project 2\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.068Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:35.068Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: root-project-2"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.068Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:35.068Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191315068"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.068Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 3b869e0c-ecf7-42e6-9fb1-d8a46fd1bec1 within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:35.069Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 3b869e0c-ecf7-42e6-9fb1-d8a46fd1bec1 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.069Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 21372b05-b0fb-46e4-8d13-8636bb87ed6e in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.069Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 062b41e8-cc06-40de-b9fa-996f7eab1014 for action 21372b05-b0fb-46e4-8d13-8636bb87ed6e in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.069Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:35.069Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 3b869e0c-ecf7-42e6-9fb1-d8a46fd1bec1 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.071Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 646daf10-2316-45f3-a8dc-5272b3a2bf0d"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.071Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: f716cb13-ccf9-4811-b073-1aae1feef8b0 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.071Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID f716cb13-ccf9-4811-b073-1aae1feef8b0 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.071Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item f716cb13-ccf9-4811-b073-1aae1feef8b0. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.071Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Child Task 1 (In Progress)\", parentId: f716cb13-ccf9-4811-b073-1aae1feef8b0, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.071Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: f716cb13-ccf9-4811-b073-1aae1feef8b0 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.071Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.072Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent f716cb13-ccf9-4811-b073-1aae1feef8b0 (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.072Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent f716cb13-ccf9-4811-b073-1aae1feef8b0 (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:35.072Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: child-task-1-in-progress"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.072Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: f716cb13-ccf9-4811-b073-1aae1feef8b0, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:35.072Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191315072"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.072Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 646daf10-2316-45f3-a8dc-5272b3a2bf0d within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:35.072Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 646daf10-2316-45f3-a8dc-5272b3a2bf0d with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.072Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 245f549b-79ac-43c0-9552-dd4ad277a01c in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.072Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step e1d0516d-afc8-4cb4-973b-e0475e229aaa for action 245f549b-79ac-43c0-9552-dd4ad277a01c in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.072Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:35.072Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 646daf10-2316-45f3-a8dc-5272b3a2bf0d and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.073Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 4b7bd365-b272-4ed5-87a2-9ac24d949619"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.074Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: f716cb13-ccf9-4811-b073-1aae1feef8b0 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.074Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID f716cb13-ccf9-4811-b073-1aae1feef8b0 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.074Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item f716cb13-ccf9-4811-b073-1aae1feef8b0. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.074Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Child Task 2 (Todo)\", parentId: f716cb13-ccf9-4811-b073-1aae1feef8b0, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.074Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: f716cb13-ccf9-4811-b073-1aae1feef8b0 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.074Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.074Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent f716cb13-ccf9-4811-b073-1aae1feef8b0 (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.074Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent f716cb13-ccf9-4811-b073-1aae1feef8b0 (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:35.074Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: child-task-2-todo"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.074Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: f716cb13-ccf9-4811-b073-1aae1feef8b0, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:35.074Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191315074"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.074Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 4b7bd365-b272-4ed5-87a2-9ac24d949619 within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:35.075Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 4b7bd365-b272-4ed5-87a2-9ac24d949619 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.076Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action f5d3a41c-bac6-47b6-8a1e-340fdbb19e0a in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.076Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 177c9e6c-1a62-4f69-97d5-258461489d29 for action f5d3a41c-bac6-47b6-8a1e-340fdbb19e0a in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.076Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:35.076Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 4b7bd365-b272-4ed5-87a2-9ac24d949619 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.078Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 76f1cf78-0f99-4aeb-b275-d9dd7ef7e9a6"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.078Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Dependency Target\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.079Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:35.079Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: dependency-target"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.079Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:35.079Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191315079"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.079Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 76f1cf78-0f99-4aeb-b275-d9dd7ef7e9a6 within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:35.079Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 76f1cf78-0f99-4aeb-b275-d9dd7ef7e9a6 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.080Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 281409b8-e177-4097-b725-c87bd40fc282 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.080Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 70e2f622-a2e2-4eef-8b5f-d26c7120e255 for action 281409b8-e177-4097-b725-c87bd40fc282 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.081Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:35.081Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 76f1cf78-0f99-4aeb-b275-d9dd7ef7e9a6 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.082Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService] Updating work item 646daf10-2316-45f3-a8dc-5272b3a2bf0d with data:"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.083Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 646daf10-2316-45f3-a8dc-5272b3a2bf0d with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.083Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 646daf10-2316-45f3-a8dc-5272b3a2bf0d (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.083Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 646daf10-2316-45f3-a8dc-5272b3a2bf0d. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.084Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item 646daf10-2316-45f3-a8dc-5272b3a2bf0d (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.084Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps Before Update for 646daf10-2316-45f3-a8dc-5272b3a2bf0d:"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.084Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Desired Deps State for 646daf10-2316-45f3-a8dc-5272b3a2bf0d:"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.084Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updating work item 646daf10-2316-45f3-a8dc-5272b3a2bf0d in transaction"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.084Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] No core fields to update for 646daf10-2316-45f3-a8dc-5272b3a2bf0d."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.084Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Updating dependencies for item 646daf10-2316-45f3-a8dc-5272b3a2bf0d. Input dependencies:"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.084Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] Found 0 existing dependencies (any state) for 646daf10-2316-45f3-a8dc-5272b3a2bf0d:"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.084Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] Desired Deps State for 646daf10-2316-45f3-a8dc-5272b3a2bf0d:"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.084Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD DIAG] Dependencies actions for 646daf10-2316-45f3-a8dc-5272b3a2bf0d: To Insert/Update:"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.084Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Inserting/Updating 1 dependencies for 646daf10-2316-45f3-a8dc-5272b3a2bf0d."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.085Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Total inserted/updated dependencies for 646daf10-2316-45f3-a8dc-5272b3a2bf0d: 1."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.085Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Finished updating dependencies for item 646daf10-2316-45f3-a8dc-5272b3a2bf0d."}
{"level":"INFO","time":"2025-05-02T13:08:35.085Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Successfully processed update for item 646daf10-2316-45f3-a8dc-5272b3a2bf0d."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.085Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 646daf10-2316-45f3-a8dc-5272b3a2bf0d with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.086Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 646daf10-2316-45f3-a8dc-5272b3a2bf0d (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.086Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 646daf10-2316-45f3-a8dc-5272b3a2bf0d. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.086Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependencies for item 646daf10-2316-45f3-a8dc-5272b3a2bf0d (link active: false, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.086Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Deps After Update Repo Call for 646daf10-2316-45f3-a8dc-5272b3a2bf0d:"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.086Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Item fields did NOT change for 646daf10-2316-45f3-a8dc-5272b3a2bf0d."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.086Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService DIAG] Checking dependency changes for 646daf10-2316-45f3-a8dc-5272b3a2bf0d..."}
{"level":"INFO","time":"2025-05-02T13:08:35.086Z","pid":113601,"hostname":"richard","msg":"[WorkItemUpdateService] Update called for 646daf10-2316-45f3-a8dc-5272b3a2bf0d, but no effective changes detected (Item: false, Deps: false). Skipping history."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.088Z","pid":113601,"hostname":"richard","msg":"[WorkItemReadingService] Getting work item by ID: 646daf10-2316-45f3-a8dc-5272b3a2bf0d with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.088Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 646daf10-2316-45f3-a8dc-5272b3a2bf0d with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.088Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 646daf10-2316-45f3-a8dc-5272b3a2bf0d (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.088Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 646daf10-2316-45f3-a8dc-5272b3a2bf0d. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.089Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: 646daf10-2316-45f3-a8dc-5272b3a2bf0d with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.089Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.090Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 1 dependencies for item 646daf10-2316-45f3-a8dc-5272b3a2bf0d (link active: true, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.098Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent 646daf10-2316-45f3-a8dc-5272b3a2bf0d (active: true, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.098Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent 646daf10-2316-45f3-a8dc-5272b3a2bf0d (active: true, status: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.098Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item 646daf10-2316-45f3-a8dc-5272b3a2bf0d (link active: true, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.099Z","pid":113601,"hostname":"richard","msg":"[WorkItemReadingService] Getting work item by ID: 646daf10-2316-45f3-a8dc-5272b3a2bf0d with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.099Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: 646daf10-2316-45f3-a8dc-5272b3a2bf0d with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.099Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID 646daf10-2316-45f3-a8dc-5272b3a2bf0d (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.099Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item 646daf10-2316-45f3-a8dc-5272b3a2bf0d. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.099Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: 646daf10-2316-45f3-a8dc-5272b3a2bf0d with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.099Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.100Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 1 dependencies for item 646daf10-2316-45f3-a8dc-5272b3a2bf0d (link active: true, dependsOn active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.100Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent 646daf10-2316-45f3-a8dc-5272b3a2bf0d (active: true, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.100Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent 646daf10-2316-45f3-a8dc-5272b3a2bf0d (active: true, status: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.100Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryDependencies] Found 0 dependents for item 646daf10-2316-45f3-a8dc-5272b3a2bf0d (link active: true, dependent active: any)."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.103Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Starting database clean up..."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.104Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating undo_steps CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.105Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating action_history CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.113Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating work_item_dependencies CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.113Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating work_items CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.122Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Database clean up committed."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.122Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Database client released."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.122Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item f811001a-89b7-4937-a77a-5dfa90c1cfb2"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.123Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Root Project 1\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.123Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:35.123Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: root-project-1"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.123Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:35.123Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191315123"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.123Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item f811001a-89b7-4937-a77a-5dfa90c1cfb2 within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:35.124Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item f811001a-89b7-4937-a77a-5dfa90c1cfb2 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.125Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 72051bbc-76aa-461f-966a-1b4b93dc2081 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.125Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 0a541b9b-3311-4b11-b3b8-07b7e6c749e8 for action 72051bbc-76aa-461f-966a-1b4b93dc2081 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.126Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:35.126Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item f811001a-89b7-4937-a77a-5dfa90c1cfb2 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.127Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 9b9bab81-d57b-4bd9-82c3-56a7239f7d72"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.127Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Root Project 2\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.127Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:35.127Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: root-project-2"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.127Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:35.127Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191315127"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.127Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 9b9bab81-d57b-4bd9-82c3-56a7239f7d72 within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:35.128Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 9b9bab81-d57b-4bd9-82c3-56a7239f7d72 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.128Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action be6be525-5918-4938-a5c0-11198917d8b3 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.128Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 3bf1a0f1-656b-4cf7-b6ef-f4f30cbcf3bf for action be6be525-5918-4938-a5c0-11198917d8b3 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.128Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:35.128Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 9b9bab81-d57b-4bd9-82c3-56a7239f7d72 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.129Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 46f6fb1c-88f9-41e6-8a82-4fadc848a65d"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.130Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: f811001a-89b7-4937-a77a-5dfa90c1cfb2 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.130Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID f811001a-89b7-4937-a77a-5dfa90c1cfb2 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.130Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item f811001a-89b7-4937-a77a-5dfa90c1cfb2. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.130Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Child Task 1 (In Progress)\", parentId: f811001a-89b7-4937-a77a-5dfa90c1cfb2, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.130Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: f811001a-89b7-4937-a77a-5dfa90c1cfb2 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.130Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.130Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent f811001a-89b7-4937-a77a-5dfa90c1cfb2 (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.130Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent f811001a-89b7-4937-a77a-5dfa90c1cfb2 (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:35.130Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: child-task-1-in-progress"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.130Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: f811001a-89b7-4937-a77a-5dfa90c1cfb2, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:35.130Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191315130"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.130Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 46f6fb1c-88f9-41e6-8a82-4fadc848a65d within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:35.130Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 46f6fb1c-88f9-41e6-8a82-4fadc848a65d with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.131Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action de4512ad-b8d1-4fb6-888e-b2d856691e35 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.131Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step ddc296ea-eb6b-494c-a000-85bb1f12ad8f for action de4512ad-b8d1-4fb6-888e-b2d856691e35 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.131Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:35.131Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 46f6fb1c-88f9-41e6-8a82-4fadc848a65d and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.132Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 2a0e1380-3623-4725-85df-309ad3f35372"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.132Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: f811001a-89b7-4937-a77a-5dfa90c1cfb2 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.132Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID f811001a-89b7-4937-a77a-5dfa90c1cfb2 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.133Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item f811001a-89b7-4937-a77a-5dfa90c1cfb2. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.133Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Child Task 2 (Todo)\", parentId: f811001a-89b7-4937-a77a-5dfa90c1cfb2, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.133Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: f811001a-89b7-4937-a77a-5dfa90c1cfb2 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.133Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.133Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent f811001a-89b7-4937-a77a-5dfa90c1cfb2 (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.133Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent f811001a-89b7-4937-a77a-5dfa90c1cfb2 (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:35.133Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: child-task-2-todo"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.133Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: f811001a-89b7-4937-a77a-5dfa90c1cfb2, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:35.133Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191315133"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.133Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 2a0e1380-3623-4725-85df-309ad3f35372 within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:35.133Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 2a0e1380-3623-4725-85df-309ad3f35372 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.133Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 698eca71-ffce-4bfd-ac9a-d3431073d87d in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.134Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 63eb96aa-012e-4234-a44a-43958ce7b158 for action 698eca71-ffce-4bfd-ac9a-d3431073d87d in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.134Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:35.134Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 2a0e1380-3623-4725-85df-309ad3f35372 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.135Z","pid":113601,"hostname":"richard","msg":"[WorkItemReadingService] Getting work item by ID: f47ac10b-58cc-4372-a567-0e02b2c3d479 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.135Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: f47ac10b-58cc-4372-a567-0e02b2c3d479 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.135Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID f47ac10b-58cc-4372-a567-0e02b2c3d479 (isActive: true) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.135Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Work item f47ac10b-58cc-4372-a567-0e02b2c3d479 not found or filtered out (isActive filter: true)."}
{"level":"WARN","time":"2025-05-02T13:08:35.135Z","pid":113601,"hostname":"richard","msg":"[WorkItemReadingService] Work item f47ac10b-58cc-4372-a567-0e02b2c3d479 not found or filtered out (isActive: true)."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.136Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Starting database clean up..."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.136Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating undo_steps CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.136Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating action_history CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.144Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating work_item_dependencies CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.145Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Truncating work_items CASCADE..."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.153Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Database clean up committed."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.153Z","pid":113601,"hostname":"richard","msg":"[integrationSetup] Database client released."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.153Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item a1ffcc52-acc1-4cb5-9dd3-bf307b04a3b7"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.154Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Root Project 1\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.154Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:35.154Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: root-project-1"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.154Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:35.154Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191315154"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.154Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item a1ffcc52-acc1-4cb5-9dd3-bf307b04a3b7 within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:35.154Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item a1ffcc52-acc1-4cb5-9dd3-bf307b04a3b7 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.155Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action e27def38-b903-4458-9b89-e788abd51788 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.155Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 3e7d5f74-616d-41d1-aeda-4f2f9efb709c for action e27def38-b903-4458-9b89-e788abd51788 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.156Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:35.156Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item a1ffcc52-acc1-4cb5-9dd3-bf307b04a3b7 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.157Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item 5161752d-86c6-4130-82d3-af1516ba288b"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.157Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Root Project 2\", parentId: null, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.157Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 root work items (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:35.157Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: root-project-2"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.157Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: null, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:35.157Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191315157"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.157Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item 5161752d-86c6-4130-82d3-af1516ba288b within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:35.158Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item 5161752d-86c6-4130-82d3-af1516ba288b with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.158Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action af925d1f-a2dc-443b-8a2b-62363e7deba6 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.158Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step f98dc17a-e921-4a35-83c4-35f6b69bd6c4 for action af925d1f-a2dc-443b-8a2b-62363e7deba6 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.158Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:35.158Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item 5161752d-86c6-4130-82d3-af1516ba288b and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.159Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item ad8ffb40-d47a-4e51-9772-09d4e8700b7d"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.160Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: a1ffcc52-acc1-4cb5-9dd3-bf307b04a3b7 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.160Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID a1ffcc52-acc1-4cb5-9dd3-bf307b04a3b7 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.160Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item a1ffcc52-acc1-4cb5-9dd3-bf307b04a3b7. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.160Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Child Task 1 (In Progress)\", parentId: a1ffcc52-acc1-4cb5-9dd3-bf307b04a3b7, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.160Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: a1ffcc52-acc1-4cb5-9dd3-bf307b04a3b7 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.160Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.160Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent a1ffcc52-acc1-4cb5-9dd3-bf307b04a3b7 (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.160Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent a1ffcc52-acc1-4cb5-9dd3-bf307b04a3b7 (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:35.160Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: child-task-1-in-progress"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.160Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: a1ffcc52-acc1-4cb5-9dd3-bf307b04a3b7, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:35.160Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191315160"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.160Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item ad8ffb40-d47a-4e51-9772-09d4e8700b7d within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:35.160Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item ad8ffb40-d47a-4e51-9772-09d4e8700b7d with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.161Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 85136e88-5ec1-4677-927e-de06e7638aef in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.161Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step 0d4254e8-6358-418f-98ea-0cfff6cdeb33 for action 85136e88-5ec1-4677-927e-de06e7638aef in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.161Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:35.161Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item ad8ffb40-d47a-4e51-9772-09d4e8700b7d and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.163Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Starting transaction to add work item cb8d381a-2319-4c65-95d6-679ba3827fc9"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.163Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById called for ID: a1ffcc52-acc1-4cb5-9dd3-bf307b04a3b7 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.163Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] findById query for ID a1ffcc52-acc1-4cb5-9dd3-bf307b04a3b7 (isActive: true) executed. Rows found: 1"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.163Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found work item a1ffcc52-acc1-4cb5-9dd3-bf307b04a3b7. isActive: true"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.163Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating shortname for name: \"Child Task 2 (Todo)\", parentId: a1ffcc52-acc1-4cb5-9dd3-bf307b04a3b7, currentItemId: undefined"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.163Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren called for parentId: a1ffcc52-acc1-4cb5-9dd3-bf307b04a3b7 with filter:"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.163Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren executing SQL:  SELECT * FROM work_items WHERE parent_work_item_id = $1  AND is_active = $2 ORDER BY order_key ASC, created_at ASC; with params:"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.163Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy DIAG] findChildren query for parent a1ffcc52-acc1-4cb5-9dd3-bf307b04a3b7 (active: false, status: any) executed. Rows found: 0"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.163Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryHierarchy] Found 0 children for parent a1ffcc52-acc1-4cb5-9dd3-bf307b04a3b7 (active: false, status: any)."}
{"level":"INFO","time":"2025-05-02T13:08:35.163Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Generated shortname: child-task-2-todo"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.163Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Calculating order key for parentId: a1ffcc52-acc1-4cb5-9dd3-bf307b04a3b7, after item: null"}
{"level":"WARN","time":"2025-05-02T13:08:35.163Z","pid":113601,"hostname":"richard","msg":"[WorkItemUtilsService] Using placeholder order key generation: 1746191315163"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.163Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Creating item cb8d381a-2319-4c65-95d6-679ba3827fc9 within transaction"}
{"level":"INFO","time":"2025-05-02T13:08:35.164Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Created work item cb8d381a-2319-4c65-95d6-679ba3827fc9 with 0 dependencies."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.164Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Created action 4c862dc2-4ea2-4f8c-832a-1533476fa643 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.164Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositorySteps] Created undo step c330e77c-c3c7-43e4-a9df-d68350fe7492 for action 4c862dc2-4ea2-4f8c-832a-1533476fa643 in transaction."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.165Z","pid":113601,"hostname":"richard","msg":"[ActionHistoryRepositoryActions] Found 0 recent un-redone UNDO_ACTIONs in transaction."}
{"level":"INFO","time":"2025-05-02T13:08:35.165Z","pid":113601,"hostname":"richard","msg":"[WorkItemAddingService] Added work item cb8d381a-2319-4c65-95d6-679ba3827fc9 and recorded history"}
{"level":"DEBUG","time":"2025-05-02T13:08:35.166Z","pid":113601,"hostname":"richard","msg":"[WorkItemReadingService] Listing work items with filter:"}
{"level":"INFO","time":"2025-05-02T13:08:35.166Z","pid":113601,"hostname":"richard","msg":"[WorkItemReadingService] Listing all items (active: true, status: todo)."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.167Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found 3 work items (all, active: true, status: todo)."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.167Z","pid":113601,"hostname":"richard","msg":"[WorkItemReadingService] Listing work items with filter:"}
{"level":"INFO","time":"2025-05-02T13:08:35.167Z","pid":113601,"hostname":"richard","msg":"[WorkItemReadingService] Listing all items (active: true, status: in-progress)."}
{"level":"DEBUG","time":"2025-05-02T13:08:35.168Z","pid":113601,"hostname":"richard","msg":"[WorkItemRepositoryCRUD] Found 1 work items (all, active: true, status: in-progress)."}
PASS dist/services/__tests__/workItemReadIntegration.test.js
PASS dist/services/__tests__/unit/WorkItemService.spec.js

Test Suites: 1 failed, 5 passed, 6 total
Tests:       1 failed, 24 passed, 25 total
Snapshots:   0 total
Time:        2.038 s, estimated 4 s
Ran all test suites.
